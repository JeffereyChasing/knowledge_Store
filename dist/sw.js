const CACHE_NAME="bagu-mock-cache-v2",OFFLINE_URL="/offline.html";self.addEventListener("install",n=>{console.log("🔄 Service Worker 安装中..."),n.waitUntil(caches.open(CACHE_NAME).then(n=>(console.log("💾 开始缓存离线资源"),Promise.all([n.add(new Request(OFFLINE_URL,{cache:"reload"})),n.add("/manifest.json")]))).then(()=>(console.log("✅ 离线资源缓存完成"),self.skipWaiting())).catch(n=>{console.error("❌ 缓存失败:",n)}))}),self.addEventListener("activate",n=>{console.log("🚀 Service Worker 激活中..."),n.waitUntil(Promise.all([self.clients.claim(),caches.keys().then(n=>Promise.all(n.map(n=>{if(n!==CACHE_NAME)return console.log("🗑️ 删除旧缓存:",n),caches.delete(n)})))]))}),self.addEventListener("fetch",n=>{const{request:e}=n;if("navigate"===e.mode)return console.log("🌐 处理导航请求:",e.url),void n.respondWith((async()=>{try{const n=await fetch(e);return console.log("✅ 网络请求成功"),n}catch(n){console.log("📶 网络失败，准备返回离线页面");const e=await caches.open(CACHE_NAME);let t=await e.match(OFFLINE_URL);return t?(console.log("✅ 返回缓存的离线页面"),t):(console.log("⚠️ 缓存中未找到离线页面，创建新的"),new Response('<!DOCTYPE html>\n            <html lang="zh-CN">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>离线模式 - 八股精Mock</title>\n                <style>\n                    body {\n                        font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n                        display: flex;\n                        justify-content: center;\n                        align-items: center;\n                        height: 100vh;\n                        margin: 0;\n                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                        color: white;\n                    }\n                    .container {\n                        text-align: center;\n                        padding: 2rem;\n                        background: rgba(255, 255, 255, 0.1);\n                        border-radius: 16px;\n                        backdrop-filter: blur(10px);\n                        max-width: 400px;\n                    }\n                    h1 { margin-bottom: 1rem; }\n                    p { margin-bottom: 1.5rem; opacity: 0.9; }\n                    button {\n                        background: white;\n                        color: #667eea;\n                        border: none;\n                        padding: 12px 24px;\n                        border-radius: 25px;\n                        cursor: pointer;\n                        font-weight: 600;\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="container">\n                    <h1>📶 离线模式</h1>\n                    <p>网络连接已断开，请检查网络连接</p>\n                    <button onclick="window.location.reload()">重新加载</button>\n                </div>\n                <script>\n                    window.addEventListener(\'online\', function() {\n                        window.location.reload();\n                    });\n                <\/script>\n            </body>\n            </html>',{headers:{"Content-Type":"text/html; charset=utf-8"}}))}})());e.url.endsWith("/offline.html")?n.respondWith(caches.match(OFFLINE_URL).then(n=>n||fetch(e))):e.url.startsWith(self.location.origin)&&n.respondWith(caches.match(e).then(n=>n||fetch(e)))});