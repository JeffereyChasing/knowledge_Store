const STATIC_CACHE_NAME="bagu-mock-static-v1.0.2",DATA_CACHE_NAME="questions-data-v1";async function handleDataCache(e){try{const n=await caches.open(DATA_CACHE_NAME),t=await n.match(e);return t?(console.log("ğŸ“¦ ä»æ•°æ®ç¼“å­˜è¿”å›:",e.url),t):new Response(JSON.stringify({data:[],timestamp:Date.now(),version:"1.0"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("âŒ æ•°æ®ç¼“å­˜å¤„ç†å¤±è´¥:",e),new Response(JSON.stringify({error:"Cache error",data:[]}),{status:500,headers:{"Content-Type":"application/json"}})}}async function handleNavigation(e){try{console.log("ğŸŒ å°è¯•ç½‘ç»œè¯·æ±‚:",e.url);const n=await fetch(e);if(200===n.status)return console.log("âœ… ç½‘ç»œè¯·æ±‚æˆåŠŸ"),n;throw new Error(`Server responded with ${n.status}`)}catch(e){return console.log("ğŸ“¶ ç½‘ç»œä¸å¯ç”¨ï¼Œæ˜¾ç¤ºç¦»çº¿é¡µé¢"),createOfflinePage()}}async function handleStaticResource(e){const n=await caches.match(e);if(n)return console.log("ğŸ’¾ ä»ç¼“å­˜è¿”å›:",e.url),n;try{const n=await fetch(e);return 200===n.status&&(await caches.open(STATIC_CACHE_NAME)).put(e,n.clone()),n}catch(n){if(console.log("âŒ èµ„æºåŠ è½½å¤±è´¥:",e.url),"image"===e.destination)return createImagePlaceholder();throw n}}function createOfflinePage(){return new Response('<!DOCTYPE html>\n    <html lang="zh-CN">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>ç¦»çº¿æ¨¡å¼ - å…«è‚¡ç²¾Mock</title>\n        <style>\n            body {\n                font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                height: 100vh;\n                margin: 0;\n                background: linear-gradient(135deg, #667eea, #764ba2);\n                color: white;\n                text-align: center;\n            }\n            .container {\n                background: rgba(255,255,255,0.1);\n                padding: 2rem;\n                border-radius: 16px;\n                backdrop-filter: blur(10px);\n                max-width: 450px;\n                margin: 1rem;\n            }\n            .icon { font-size: 4rem; margin-bottom: 1rem; }\n            h1 { margin-bottom: 1rem; }\n            .features { text-align: left; margin: 1.5rem 0; }\n            .feature { margin: 0.5rem 0; }\n            button {\n                background: white;\n                color: #667eea;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 25px;\n                cursor: pointer;\n                font-weight: 600;\n                margin: 0.5rem;\n            }\n        </style>\n    </head>\n    <body>\n        <div class="container">\n            <div class="icon">ğŸ“¶</div>\n            <h1>ç¦»çº¿æ¨¡å¼</h1>\n            <p>ç½‘ç»œè¿æ¥å·²æ–­å¼€</p>\n            \n            <div class="features">\n                <div class="feature">âœ“ æŸ¥çœ‹ä¹‹å‰åŠ è½½çš„é¢˜ç›®</div>\n                <div class="feature">âœ“ å¤ä¹ å·²ç¼“å­˜çš„å†…å®¹</div>\n                <div class="feature">âœ“ åœ¨æœ¬åœ°è®°å½•å­¦ä¹ è¿›åº¦</div>\n            </div>\n            \n            <button onclick="window.location.reload()">é‡æ–°åŠ è½½</button>\n        </div>\n        \n        <script>\n            window.addEventListener(\'online\', () => window.location.reload());\n        <\/script>\n    </body>\n    </html>',{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})}function createImagePlaceholder(){return new Response('<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">\n    <rect width="100" height="100" fill="#f5f5f5"/>\n    <text x="50" y="55" text-anchor="middle" fill="#999" font-size="12">å›¾ç‰‡</text>\n  </svg>',{headers:{"Content-Type":"image/svg+xml"}})}self.addEventListener("install",e=>{console.log("ğŸ”„ Service Worker å®‰è£…"),e.waitUntil(caches.open(STATIC_CACHE_NAME).then(e=>e.addAll(["/manifest.json","/favicon.ico"])).then(()=>{console.log("âœ… é™æ€èµ„æºé¢„ç¼“å­˜å®Œæˆ"),self.skipWaiting()}).catch(e=>{console.error("âŒ é¢„ç¼“å­˜å¤±è´¥:",e),self.skipWaiting()}))}),self.addEventListener("activate",e=>{console.log("ğŸš€ Service Worker æ¿€æ´»"),e.waitUntil(Promise.all([self.clients.claim(),caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==STATIC_CACHE_NAME&&e!==DATA_CACHE_NAME)return console.log("ğŸ—‘ï¸ åˆ é™¤æ—§ç¼“å­˜:",e),caches.delete(e)})))]))}),self.addEventListener("fetch",e=>{const{request:n}=e;n.url.startsWith(self.location.origin)&&(n.url.includes("/api/cached/")?e.respondWith(handleDataCache(n)):"navigate"!==n.mode?("script"===n.destination||"style"===n.destination||"image"===n.destination||n.url.includes("/static/"))&&e.respondWith(handleStaticResource(n)):e.respondWith(handleNavigation(n)))});