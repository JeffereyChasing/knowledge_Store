"use strict";(self.webpackChunkbagu=self.webpackChunkbagu||[]).push([[792],{1674:(e,s,t)=>{t(9848);var a=t(6540),n=t(5338),i=t(6868),c=t(7865),r=t(7665);t(5537);const l="learningassistant-vjfs",o="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDW4AJbGny8vMAu\nhyF7G4qwDBmms1u/Scw3C+o//ocj+Q+rmFDzYKK8pRktJGfyqj+FCI3+y+GAYmet\nHP+YFKmmQoeUdOKxJGlojKNmaMcUHFoAbAGwQhLoQ44NgbDywS8sGm4DiUAjxBUv\nHHH81Tz5fWmnB/Sd7Y8bUbUpiCAikR6leJFFlZWpEPjkpv6uV+AL2Dv6i8ZHo3mH\nFXYwgJrG4aHNw9reBl1yky6cYYmhDiHVPxfT4Q4z6WgAQcnXfS/1EOmfCiBohdPG\nMK6C8Jt2PBXiVBo/p/uHpow08J1is7nBbsFMkngsbml5h7wD3tipph+Cpbjo4ME9\nH/OX+EivAgMBAAECggEALWvV46cyNf1aTJuRBsJ4KyWrqHLikomJixtQLa3iqEaG\nOvosJn5HeEQYEdRPytqVKcx4o6M6bFag3tWx69Z2VChdG5MntlVhmNGd2tCMQKKL\nneo24yjccU+ScCV5n58ZlyORHNs+/TB+X+KN7+mthXmuwzmpylaEuTwo5Poa/OM3\n4jOoXf3mnMFNyF6+HDlWFyPChEkNuY+7axobvGL0X2OdrltwmU/XD7YSh3l5kMBX\naptojVpmF3L3ujCwLCvXl+BsEzG5eXyzEzyqGFv8dszXAyzbji+02GhNVeEsLCvM\nPQcbTefPh5zymBTxIoFUXheX300hO9CqUEEeMuSk+QKBgQD8H2+UEKqLiyOx2o31\nMqqd1ZTC4dkmRQLfRKJLgxvwgkNPSTcyXHtIwq2B1+3ipsuQyQyXMd+EMHXo/Ql8\npGZftWmKby97q9bI9oxxFCxCuy5c063pjR9QqWioTsRVaPJ1VkZNu6Y+L8uc57jm\nTOwYrfYSYjCBkbJrqiXiBBkY+QKBgQDaLe9ww03DGVFgxLL6OFJO2iOMKoKieZ/M\nkmro2H3+wd6xY8+/UrMuybEGBT+kYuZJxlcgBPQDcT5Y11MNdWRM9b8U1YztNUZp\nmcoBTSIvyPQYidLsf+C6nDaYgqT8ToAmDSrBU2wX/vlVNBAZVKGEqq9zjI97ycDQ\ny01mpVjA5wKBgHoNBcjZ4JW4/8ijksE2i93ofSFyj9q04dUPtrlzeN0PUmJZgT0C\nBDSO+cu3qlNkh3tJuKyg2iF2DD6D8EnElEKU4cjAVm46G7ohkI9VQq/zSVhqqPA8\n/wHfYOjJaMYoDee7okETLEFChgEpNBtY9Zpk7JCts+mljIgOUFR/w16RAoGAM7zS\n2+WkahB16MGcQ5PZiNNXvKRUCB1ZVJSf/4lfD2t/2Ib3u8HrtbukW+4gsmW1gGcl\nP/WMu8g95aliC338A/f+kP03BwUsJlyOt5JH+hboM21zdBu6+eWTWMUaRK6E2wEi\nU2fp6SLQk3DeJHOaPbCQHJGHcO5d5+Vd/GpXSp8CgYEAzWMxNssPlkjOuI1OH/Tl\nek2NDmQqAxQPmkSZDxQ+atRvyXn9OnDY4ruXFFv16kpZvFf6HaEiz5oaVesI40VJ\nKXzmA0TVJt4vrCvDqRCWLYMKqpQKiIZ6HDLvJrEZsoZr//ZVl4La+U4JJfECRmK5\nz/cqkmBVD2YrCEkYnXLHlDk=\n-----END PRIVATE KEY-----\n"?.replace(/\\n/g,"\n"),d=async()=>{try{const e=await(async()=>{const e=Math.floor(Date.now()/1e3),s={iss:"dialogflow-client@learningassistant-vjfs.iam.gserviceaccount.com",scope:"https://www.googleapis.com/auth/cloud-platform",aud:"https://oauth2.googleapis.com/token",exp:e+3600,iat:e},t=`${btoa(JSON.stringify({alg:"RS256",typ:"JWT"})).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}.${btoa(JSON.stringify(s)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}`,a=await crypto.subtle.importKey("pkcs8",m(atob(o.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,""))),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await crypto.subtle.sign("RSASSA-PKCS1-v1_5",a,(new TextEncoder).encode(t));return`${t}.${btoa(String.fromCharCode(...new Uint8Array(n))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}`})(),s=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=${e}`});if(!s.ok)throw new Error(`Token request failed: ${s.status}`);return(await s.json()).access_token}catch(e){throw console.error("èŽ·å–è®¿é—®ä»¤ç‰Œå¤±è´¥:",e),e}},h=e=>{const s=[],t=e.parameters||{};switch(console.log("ðŸ” extractActions è¢«è°ƒç”¨:",{intent:e.intent?.displayName,parameters:t}),e.intent?.displayName){case"CategoryView":if(console.log("ðŸŽ¯ è¯†åˆ«åˆ° CategoryView æ„å›¾ï¼Œå‚æ•°:",t),t.category){const e=t.category;console.log(`ðŸ“‚ æ‰¾åˆ°åˆ†ç±»å‚æ•°: ${e}`),s.push({type:"triggerCategory",target:"viewSpecificCategory",label:`æŸ¥çœ‹ ${e} é¢˜ç›®`,buttonId:`category-${e.toLowerCase().replace(/\s+/g,"-")}`,categoryName:e})}else console.log("ðŸ“š æ²¡æœ‰å…·ä½“åˆ†ç±»ï¼Œæ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»"),s.push({type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»",buttonId:"categories-button"});break;case"SearchQuestions":s.push({type:"function",target:"searchQuestions",label:"ðŸ” å¼€å§‹æœç´¢"});break;case"StartReview":s.push({type:"triggerButton",target:"startReviewBtn",label:"ðŸ”„ å¼€å§‹å¤ä¹ ",buttonId:"review-button"});break;case"ViewStatistics":s.push({type:"triggerButton",target:"viewStatsBtn",label:"ðŸ“Š å­¦ä¹ ç»Ÿè®¡",buttonId:"stats-button"});break;case"CreateCategory":s.push({type:"triggerButton",target:"createCategoryBtn",label:"âž• åˆ›å»ºåˆ†ç±»",buttonId:"create-category-button"});break;default:if(console.log("ðŸ” é»˜è®¤æƒ…å†µï¼Œå‚æ•°:",t),t.category){const e=t.category;console.log(`ðŸ“‚ é»˜è®¤æƒ…å†µæ‰¾åˆ°åˆ†ç±»: ${e}`),s.push({type:"triggerCategory",target:"viewSpecificCategory",label:`æŸ¥çœ‹ ${e} é¢˜ç›®`,buttonId:`category-${e.toLowerCase().replace(/\s+/g,"-")}`,categoryName:e})}s.push({type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹åˆ†ç±»",buttonId:"categories-button"},{type:"triggerButton",target:"startReviewBtn",label:"ðŸ”„ å¼€å§‹å¤ä¹ ",buttonId:"review-button"})}return console.log("ðŸŽ¯ æœ€ç»ˆç”Ÿæˆçš„åŠ¨ä½œ:",s),s},u=async(e,s="react-client-session")=>{try{const t=await d(),a=`projects/${l}/agent/sessions/${s}`,n={queryInput:{text:{text:e,languageCode:"zh-CN"}}},i=`https://dialogflow.googleapis.com/v2/${a}:detectIntent`,c=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)});if(!c.ok)throw new Error(`Dialogflow API request failed: ${c.status}`);const r=await c.json();console.log("ðŸ” Dialogflow å®Œæ•´å“åº”:",r),console.log("ðŸ“ Dialogflow Response è¯¦æƒ…:",{intent:r.queryResult.intent?.displayName,parameters:r.queryResult.parameters,text:r.queryResult.fulfillmentText,hasFulfillmentText:!!r.queryResult.fulfillmentText});let o=r.queryResult.fulfillmentText;if(!o){const e=r.queryResult.parameters||{};o="CategoryView"===r.queryResult.intent?.displayName&&e.category?`æ­£åœ¨ä¸ºæ‚¨æ‰“å¼€ ${e.category} åˆ†ç±»...`:"è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"}const u={text:o,actions:h(r.queryResult),quickReplies:["æŸ¥çœ‹åˆ†ç±»","æœç´¢é¢˜ç›®","å¼€å§‹å¤ä¹ ","å­¦ä¹ ç»Ÿè®¡"],parameters:r.queryResult.parameters||{},intent:r.queryResult.intent?.displayName};return console.log("ðŸš€ æœ€ç»ˆè¿”å›žçš„ç»“æžœ:",u),u}catch(e){return console.error("Dialogflow è¯·æ±‚å¤±è´¥:",e),{text:"ç½‘ç»œè¿žæŽ¥å‡ºçŽ°é—®é¢˜ï¼Œä½†æˆ‘ä»ç„¶å¯ä»¥å¸®æ‚¨ï¼š",actions:[{type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹åˆ†ç±»",buttonId:"categories-button"},{type:"triggerButton",target:"startReviewBtn",label:"ðŸ”„ å¼€å§‹å¤ä¹ ",buttonId:"review-button"}],quickReplies:["æŸ¥çœ‹åˆ†ç±»","å¼€å§‹å¤ä¹ ","å­¦ä¹ ç»Ÿè®¡"],parameters:{},intent:"Fallback"}}},m=e=>{const s=new ArrayBuffer(e.length),t=new Uint8Array(s);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return s},g=u,x=async e=>{try{return await u("ä½ å¥½",`user-${e||"anonymous"}`)}catch(e){return console.error("Welcome message failed, using fallback:",e),{text:"ðŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„å­¦ä¹ åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š\n\nâ€¢ å¯¼èˆªåˆ°ä¸åŒåŠŸèƒ½é¡µé¢\nâ€¢ æŸ¥æ‰¾åˆ†ç±»å’Œé¢˜ç›®\nâ€¢ ç®¡ç†å¤ä¹ è®¡åˆ’\nâ€¢ æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡\n\nè¯·é—®éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",quickReplies:["æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»","éœ€è¦å¤ä¹ çš„é¢˜ç›®","å­¦ä¹ ç»Ÿè®¡","åˆ›å»ºæ–°åˆ†ç±»"],actions:[{type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹åˆ†ç±»",buttonId:"categories-button"}],parameters:{},intent:"WelcomeFallback"}}};var p=t(4848);const j=({onNavigate:e,onTriggerCategory:s,categories:t,questions:n,currentUser:i})=>{const[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)([]),[d,h]=(0,a.useState)(""),[u,m]=(0,a.useState)(!1),j=(0,a.useRef)(null);(0,a.useEffect)(()=>{c&&0===l.length&&v()},[c]);const v=async()=>{m(!0);try{const e=await x(i?.id),s={id:Date.now(),text:e.text,isBot:!0,timestamp:new Date,quickReplies:e.quickReplies||["æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»","éœ€è¦å¤ä¹ çš„é¢˜ç›®","å­¦ä¹ ç»Ÿè®¡","åˆ›å»ºæ–°åˆ†ç±»"],actions:e.actions||[]};o([s])}catch(e){console.error("Welcome message error:",e);const s={id:1,text:`ðŸ‘‹ ä½ å¥½${i?` ${i.getUsername()}`:""}ï¼æˆ‘æ˜¯ä½ çš„å­¦ä¹ åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š\n\nâ€¢ å¯¼èˆªåˆ°ä¸åŒåŠŸèƒ½é¡µé¢\nâ€¢ æŸ¥æ‰¾åˆ†ç±»å’Œé¢˜ç›®\nâ€¢ ç®¡ç†å¤ä¹ è®¡åˆ’\nâ€¢ æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡\n\nè¯·é—®éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ`,isBot:!0,timestamp:new Date,quickReplies:["æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»","éœ€è¦å¤ä¹ çš„é¢˜ç›®","å­¦ä¹ ç»Ÿè®¡","åˆ›å»ºæ–°åˆ†ç±»"],actions:[{type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹åˆ†ç±»",buttonId:"categories-button"}]};o([s])}finally{m(!1)}};(0,a.useEffect)(()=>{j.current?.scrollIntoView({behavior:"smooth"})},[l]);const N=async()=>{if(!d.trim())return;const e={id:Date.now(),text:d,isBot:!1,timestamp:new Date};o(s=>[...s,e]),h("");const s=await(async e=>{m(!0);try{return await g(e,i?.id)}catch(e){return console.error("Message processing error:",e),{text:"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•ã€‚",quickReplies:["æŸ¥çœ‹åˆ†ç±»","æœç´¢é¢˜ç›®","å¼€å§‹å¤ä¹ ","å­¦ä¹ ç»Ÿè®¡"],actions:[{type:"triggerButton",target:"viewCategoriesBtn",label:"ðŸ“š æŸ¥çœ‹åˆ†ç±»",buttonId:"categories-button"}],parameters:{},intent:"Fallback"}}finally{m(!1)}})(d),t={id:Date.now()+1,text:s.text,isBot:!0,timestamp:new Date,actions:s.actions,quickReplies:s.quickReplies};o(e=>[...e,t])};return(0,p.jsxs)(p.Fragment,{children:[!c&&(0,p.jsxs)("button",{className:"chatbox-floating-btn",onClick:()=>r(!0),title:"AIå­¦ä¹ åŠ©æ‰‹",children:[(0,p.jsx)("span",{className:"chatbot-icon",children:"ðŸ¤–"}),(0,p.jsx)("span",{className:"pulse-dot"})]}),c&&(0,p.jsxs)("div",{className:"chatbox-container",children:[(0,p.jsxs)("div",{className:"chatbox-header",children:[(0,p.jsxs)("div",{className:"chatbox-title",children:[(0,p.jsx)("span",{className:"bot-avatar",children:"ðŸ¤–"}),(0,p.jsxs)("div",{className:"title-text",children:[(0,p.jsx)("h4",{children:"AIå­¦ä¹ åŠ©æ‰‹"}),(0,p.jsx)("span",{className:"status",children:"AIåœ¨çº¿"})]})]}),(0,p.jsxs)("div",{className:"header-actions",children:[(0,p.jsx)("button",{className:"clear-btn",onClick:()=>{o([]),v()},title:"æ¸…é™¤å¯¹è¯",children:"ðŸ—‘ï¸"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>r(!1),children:"Ã—"})]})]}),(0,p.jsxs)("div",{className:"chatbox-messages",children:[l.map(t=>(0,p.jsx)("div",{className:"message "+(t.isBot?"bot-message":"user-message"),children:(0,p.jsxs)("div",{className:"message-content",children:[(0,p.jsx)("div",{className:"message-text",children:t.text.split("\n").map((e,s)=>(0,p.jsxs)("span",{children:[e,(0,p.jsx)("br",{})]},s))}),(0,p.jsx)("div",{className:"message-time",children:t.timestamp.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),t.quickReplies&&(0,p.jsx)("div",{className:"quick-replies",children:t.quickReplies.map((e,s)=>(0,p.jsx)("button",{className:"quick-reply-btn",onClick:()=>(h(e),void setTimeout(()=>{N()},100)),children:e},s))}),t.actions&&(0,p.jsx)("div",{className:"action-buttons",children:t.actions.map((t,a)=>(0,p.jsx)("button",{className:"action-btn",onClick:()=>(t=>{if(console.log("ðŸ–±ï¸ åŠ¨ä½œè¢«ç‚¹å‡»:",t),"navigate"===t.type&&e){console.log(`ðŸ“ å¯¼èˆªåˆ°: ${t.target}`),e(t.target);const s={id:Date.now(),text:`âœ… æ­£åœ¨ä¸ºä½ è·³è½¬åˆ° ${t.label}...`,isBot:!0,timestamp:new Date};o(e=>[...e,s])}else if("triggerButton"===t.type&&e){console.log(`ðŸ”˜ è§¦å‘æŒ‰é’®: ${t.buttonId}`),e(t.target);const s={id:Date.now(),text:`âœ… æ­£åœ¨ä¸ºä½ æ‰“å¼€ ${t.label}...`,isBot:!0,timestamp:new Date};o(e=>[...e,s])}else if("triggerCategory"===t.type&&s){console.log(`ðŸ“‚ è§¦å‘åˆ†ç±»: ${t.categoryName}`),s(t.categoryName,t.buttonId);const e={id:Date.now(),text:`âœ… æ­£åœ¨ä¸ºä½ æ‰“å¼€ ${t.categoryName} åˆ†ç±»...`,isBot:!0,timestamp:new Date};o(s=>[...s,e])}else"function"===t.type?(console.log(`âš™ï¸ æ‰§è¡ŒåŠŸèƒ½: ${t.target}`),(e=>{if("searchQuestions"===e.target){const e={id:Date.now(),text:"è¯·å‘Šè¯‰æˆ‘ä½ æƒ³æœç´¢é¢˜ç›®çš„å…³é”®è¯ï¼š",isBot:!0,timestamp:new Date};o(s=>[...s,e])}else console.log("Function action:",e)})(t)):console.warn("âŒ æœªçŸ¥çš„åŠ¨ä½œç±»åž‹æˆ–ç¼ºå°‘å¤„ç†å™¨:",t)})(t),children:t.label},a))})]})},t.id)),u&&(0,p.jsx)("div",{className:"message bot-message",children:(0,p.jsx)("div",{className:"message-content",children:(0,p.jsxs)("div",{className:"typing-indicator",children:[(0,p.jsx)("span",{children:"AIæ­£åœ¨æ€è€ƒ"}),(0,p.jsxs)("div",{className:"typing-dots",children:[(0,p.jsx)("span",{}),(0,p.jsx)("span",{}),(0,p.jsx)("span",{})]})]})})}),(0,p.jsx)("div",{ref:j})]}),(0,p.jsxs)("div",{className:"chatbox-input",children:[(0,p.jsxs)("div",{className:"input-container",children:[(0,p.jsx)("textarea",{value:d,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},placeholder:"å‘AIåŠ©æ‰‹æé—®...",rows:"1",className:"message-input"}),(0,p.jsx)("button",{onClick:N,disabled:!d.trim()||u,className:"send-btn",children:u?"â³":"ðŸ“¤"})]}),(0,p.jsx)("div",{className:"input-hint",children:"æŒ‰ Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ"})]})]})]})};var v=t(6068),N=t.n(v);const y=new class{constructor(){this.isOnline=!0,this.setupOnlineListeners()}setupOnlineListeners(){"undefined"!=typeof window&&(window.addEventListener("online",()=>{console.log("ðŸŒ ç½‘ç»œå·²è¿žæŽ¥"),this.isOnline=!0,this.dispatchEvent("online")}),window.addEventListener("offline",()=>{console.log("ðŸ“¶ ç½‘ç»œå·²æ–­å¼€"),this.isOnline=!1,this.dispatchEvent("offline")}),this.isOnline=navigator.onLine)}isOnlineMode(){return this.isOnline}shouldUseOfflineData(){return!this.isOnline}simulateNetworkRequest(){return new Promise((e,s)=>{this.shouldUseOfflineData()?s(new Error("ç½‘ç»œä¸å¯ç”¨ï¼Œå½“å‰å¤„äºŽç¦»çº¿æ¨¡å¼")):e()})}dispatchEvent(e,s){"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent(`offline:${e}`,{detail:s}))}addEventListener(e,s){"undefined"!=typeof window&&window.addEventListener(`offline:${e}`,s)}removeEventListener(e,s){"undefined"!=typeof window&&window.removeEventListener(`offline:${e}`,s)}},f=()=>{y.shouldUseOfflineData()?console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šè·³è¿‡ LeanCloud åˆå§‹åŒ–"):N().init({appId:"JjTQ2R5rn16RRhUdrcjUSBxW-gzGzoHsz",appKey:"UkvR0e4OPaeW5rYMQwNTvD7Z",serverURL:"https://jjtq2r5r.lc-cn-n1-shared.com"})},w={SORT_BY_NAME:"name",SORT_BY_QUESTION_COUNT:"questionCount",SORT_BY_UPDATED_AT:"updatedAt"},b={categories:{data:null,timestamp:0,ttl:3e5},categoryDetails:new Map,categoryDetailTtl:18e4,questionCounts:new Map,questionCountTtl:12e4},C="offline_categories",S=(e,s)=>e&&Date.now()-e<s,k=()=>{try{const e=localStorage.getItem(C);if(e){const s=JSON.parse(e);return console.log("ðŸ“¦ ä»Žç¦»çº¿å­˜å‚¨åŠ è½½åˆ†ç±»æ•°æ®:",s.data.length,"ä¸ªåˆ†ç±»"),s}return{data:[],total:0,page:1,pageSize:50}}catch(e){return console.error("èŽ·å–ç¦»çº¿åˆ†ç±»æ•°æ®å¤±è´¥:",e),{data:[],total:0,page:1,pageSize:50}}},A=e=>{try{const s={data:e,total:e.length,page:1,pageSize:50,timestamp:Date.now()};localStorage.setItem(C,JSON.stringify(s))}catch(e){console.error("ä¿å­˜åˆ†ç±»æ•°æ®åˆ°ç¦»çº¿å­˜å‚¨å¤±è´¥:",e)}},E=async e=>{if(y.shouldUseOfflineData()){console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šè·³è¿‡é¢˜ç›®æ•°é‡ç»Ÿè®¡");const s={};return e.forEach(e=>{s[e.id]=0}),s}try{const s=e.map(e=>e.id),t={},a=Date.now();s.forEach(e=>{t[e]=0});const n=[];if(s.forEach(e=>{const s=b.questionCounts.get(e);s&&S(s.timestamp,b.questionCountTtl)?t[e]=s.count:n.push(e)}),n.length>0)try{const e=n.map(async e=>{try{const s=N().Object.createWithoutData("Category",e),t=new(N().Query)("Question");return t.equalTo("category",s),{categoryId:e,count:await t.count()}}catch(s){return console.warn(`èŽ·å–åˆ†ç±» ${e} é¢˜ç›®æ•°é‡å¤±è´¥:`,s),{categoryId:e,count:0}}}),s=await Promise.all(e);s.forEach(({categoryId:e,count:s})=>{t[e]=s}),s.forEach(({categoryId:e,count:s})=>{b.questionCounts.set(e,{count:s,timestamp:a})})}catch(e){console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®æ•°é‡å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ:",e);try{const e=n.map(e=>N().Object.createWithoutData("Category",e)),s=new(N().Query)("Question");s.containedIn("category",e),s.select(["category"]),(await s.find()).forEach(e=>{const s=e.get("category");if(s){const e=s.id;t[e]=(t[e]||0)+1}}),n.forEach(e=>{const s=t[e]||0;b.questionCounts.set(e,{count:s,timestamp:a})})}catch(e){console.warn("å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥:",e)}}return t}catch(e){return console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®æ•°é‡å¤±è´¥:",e),{}}},q=async()=>{if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šä»Žæœ¬åœ°å­˜å‚¨èŽ·å–åˆ†ç±»æ•°æ®"),k().data||[];try{const e=N().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=Date.now();if(b.categories.data&&S(b.categories.timestamp,b.categories.ttl))return b.categories.data;const t=new(N().Query)("Category");t.equalTo("createdBy",e),t.include("createdBy"),t.descending("updatedAt");const a=await t.find(),n=await E(a),i=a.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:void 0!==n[e.id]?n[e.id]:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),createdBy:e.get("createdBy")}));return b.categories.data=i,b.categories.timestamp=s,A(i),i}catch(e){if(console.error("èŽ·å–æ‰€æœ‰åˆ†ç±»å¤±è´¥:",e),e.message.includes("offline")||e.message.includes("network")||e.message.includes("CORS"))return console.log("ðŸŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç¦»çº¿æ•°æ®"),k().data||[];throw e}},L=async(e={})=>{if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šä»Žæœ¬åœ°å­˜å‚¨èŽ·å–åˆ†ç±»æ•°æ®"),k();try{const s=N().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=!(e.page||e.pageSize||e.sortBy&&e.sortBy!==w.SORT_BY_UPDATED_AT),a=Date.now();if(t&&b.categories.data&&S(b.categories.timestamp,b.categories.ttl))return{data:b.categories.data,total:b.categories.data.length,page:1,pageSize:b.categories.data.length};const n=new(N().Query)("Category");if(n.equalTo("createdBy",s),e.sortBy===w.SORT_BY_UPDATED_AT?n.descending("updatedAt"):e.sortBy===w.SORT_BY_CREATED_AT?n.descending("createdAt"):n.descending("updatedAt"),e.page&&e.pageSize){const s=(e.page-1)*e.pageSize;n.limit(e.pageSize),n.skip(s)}const i=await n.find(),c=await E(i),r=i.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:void 0!==c[e.id]?c[e.id]:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),createdBy:e.get("createdBy")})),l={data:r,total:r.length,page:e.page||1,pageSize:e.pageSize||r.length};return t&&(b.categories.data=r,b.categories.timestamp=a,A(r)),l}catch(e){if(console.error("èŽ·å–åˆ†ç±»å¤±è´¥:",e),e.message.includes("offline")||e.message.includes("network")||e.message.includes("CORS"))return console.log("ðŸŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç¦»çº¿æ•°æ®"),k();throw e}},D=async e=>{if(y.shouldUseOfflineData())throw new Error("ç¦»çº¿æ¨¡å¼ä¸‹æ— æ³•åˆ›å»ºåˆ†ç±»");try{const s=N().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(N().Object.extend("Category"));t.set("name",e.name),t.set("description",e.description||""),t.set("createdBy",s);const a=new(N().ACL);return a.setReadAccess(s,!0),a.setWriteAccess(s,!0),a.setPublicReadAccess(!1),t.setACL(a),await t.save(),b.categories.data=null,b.categories.timestamp=0,b.categoryDetails.clear(),b.questionCounts.clear(),{id:t.id,name:t.get("name"),description:t.get("description"),questionCount:0,createdAt:t.get("createdAt"),updatedAt:t.get("updatedAt")}}catch(e){throw console.error("åˆ›å»ºåˆ†ç±»å¤±è´¥:",e),e}},T=new class{constructor(){this.isSupported=this.checkSupport(),this.cacheLimit=30,this.cacheVersion="2.0.0",this.cacheExpiry=6048e5,this.CACHE_KEYS={SW_CACHE:"questions-data-v2",LOCAL_STORAGE:"offline_questions_v2",FALLBACK:"offline_questions_fallback_v2",META:"cache_metadata_v2"},this.cacheState={swAvailable:!1,localStorageAvailable:!1,lastSync:null,strategy:"dual"},this.init()}async init(){try{this.cacheState.swAvailable=await this.checkSWCacheSupport(),this.cacheState.localStorageAvailable=this.checkLocalStorageSupport(),this.determineCacheStrategy(),console.log(`ðŸ”„ ç¼“å­˜æœåŠ¡åˆå§‹åŒ–å®Œæˆ - ç­–ç•¥: ${this.cacheState.strategy}`,{sw:this.cacheState.swAvailable,ls:this.cacheState.localStorageAvailable})}catch(e){console.error("âŒ ç¼“å­˜æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",e),this.cacheState.strategy="none"}}checkSupport(){return"undefined"!=typeof window&&("serviceWorker"in navigator||"caches"in window)}async checkSWCacheSupport(){try{if(!("caches"in window))return!1;const e=await caches.open("test-cache-support");return await e.put(new Request("/test-support"),new Response("test")),await e.delete("/test-support"),!0}catch{return!1}}checkLocalStorageSupport(){try{const e="test_local_storage_support";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch{return!1}}determineCacheStrategy(){this.cacheState.swAvailable&&this.cacheState.localStorageAvailable?this.cacheState.strategy="dual":this.cacheState.swAvailable?this.cacheState.strategy="sw-only":this.cacheState.localStorageAvailable?this.cacheState.strategy="ls-only":this.cacheState.strategy="none"}setCacheLimit(e){return e>0&&e<=500?(this.cacheLimit=e,console.log(`ðŸ”„ ç¼“å­˜é¢˜ç›®æ•°é‡é™åˆ¶è®¾ç½®ä¸º: ${e}`),this.updateCacheMetadata(),!0):(console.warn("âŒ ç¼“å­˜æ•°é‡é™åˆ¶å¿…é¡»åœ¨ 1-500 ä¹‹é—´"),!1)}getCacheLimit(){return this.cacheLimit}async cacheQuestions(e){if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ä¸‹è·³è¿‡ç¼“å­˜æ“ä½œ"),!1;if("none"===this.cacheState.strategy)return console.warn("âŒ å½“å‰çŽ¯å¢ƒä¸æ”¯æŒä»»ä½•ç¼“å­˜ç­–ç•¥"),!1;try{const s={questions:e.slice(0,this.cacheLimit),timestamp:Date.now(),version:this.cacheVersion,count:Math.min(e.length,this.cacheLimit),cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy},t=[];return this.cacheState.swAvailable&&t.push(this.cacheToServiceWorker(s)),this.cacheState.localStorageAvailable&&t.push(this.cacheToLocalStorage(s)),await Promise.allSettled(t),this.cacheState.lastSync=Date.now(),this.updateCacheMetadata(s),console.log(`âœ… é¢˜ç›®æ•°æ®åŒç¼“å­˜æˆåŠŸ: ${s.count} é“é¢˜ç›®`,{strategy:this.cacheState.strategy,limit:this.cacheLimit}),this.dispatchEvent("cacheUpdated",{count:s.count,timestamp:s.timestamp,cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy}),!0}catch(e){return console.error("âŒ åŒç¼“å­˜ç­–ç•¥å¤±è´¥:",e),!1}}async cacheToServiceWorker(e){try{const s=await caches.open(this.CACHE_KEYS.SW_CACHE),t=new Request("/api/cached/questions"),a=new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json"}});return await s.put(t,a),console.log("âœ… Service Worker ç¼“å­˜æˆåŠŸ"),!0}catch(e){throw console.error("âŒ Service Worker ç¼“å­˜å¤±è´¥:",e),e}}async cacheToLocalStorage(e){try{return localStorage.setItem(this.CACHE_KEYS.LOCAL_STORAGE,JSON.stringify(e)),console.log("âœ… localStorage ç¼“å­˜æˆåŠŸ"),!0}catch(s){console.error("âŒ localStorage ç¼“å­˜å¤±è´¥:",s);try{const s={...e,version:e.version+"-fallback"};return localStorage.setItem(this.CACHE_KEYS.FALLBACK,JSON.stringify(s)),console.log("âœ… ä½¿ç”¨å›žé€€æ–¹æ¡ˆç¼“å­˜æˆåŠŸ"),!0}catch(e){throw console.error("âŒ å›žé€€æ–¹æ¡ˆä¹Ÿå¤±è´¥:",e),s}}}async getCachedQuestions(){if("none"===this.cacheState.strategy)return this.getEmptyCacheData();try{let e=null;return"dual"!==this.cacheState.strategy&&"sw-only"!==this.cacheState.strategy||(e=await this.getFromServiceWorker()),e||"dual"!==this.cacheState.strategy&&"ls-only"!==this.cacheState.strategy||(e=this.getFromLocalStorage()),e?this.isCacheExpired(e.timestamp)?(console.log("ðŸ•’ ç¼“å­˜å·²è¿‡æœŸï¼Œæ¸…ç†æ—§æ•°æ®"),await this.clearCache(),this.getEmptyCacheData()):e:this.getEmptyCacheData()}catch(e){return console.error("âŒ èŽ·å–ç¼“å­˜æ•°æ®å¤±è´¥:",e),this.getEmptyCacheData()}}async getFromServiceWorker(){try{const e=await caches.open(this.CACHE_KEYS.SW_CACHE),s=await e.match("/api/cached/questions");if(s){const e=await s.json();return console.log("âœ… ä»Ž Service Worker ç¼“å­˜è¯»å–æ•°æ®"),e}return null}catch(e){return console.error("âŒ ä»Ž Service Worker è¯»å–å¤±è´¥:",e),null}}getFromLocalStorage(){try{const e=localStorage.getItem(this.CACHE_KEYS.LOCAL_STORAGE);if(e){const s=JSON.parse(e);return console.log("âœ… ä»Ž localStorage è¯»å–æ•°æ®"),s}const s=localStorage.getItem(this.CACHE_KEYS.FALLBACK);if(s){const e=JSON.parse(s);return console.log("âœ… ä»Žå›žé€€å­˜å‚¨è¯»å–æ•°æ®"),e}return null}catch(e){return console.error("âŒ ä»Ž localStorage è¯»å–å¤±è´¥:",e),null}}isCacheExpired(e){return Date.now()-e>this.cacheExpiry}getEmptyCacheData(){return{questions:[],timestamp:null,version:null,count:0,cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy}}getCacheStatus(){if("none"===this.cacheState.strategy)return this.getDefaultCacheStatus();try{let e=null;if(("dual"===this.cacheState.strategy||"sw-only"===this.cacheState.strategy||"ls-only"===this.cacheState.strategy)&&(e=this.getFromLocalStorage()),!e)return this.getDefaultCacheStatus();if(this.isCacheExpired(e.timestamp))return console.log("ðŸ•’ ç¼“å­˜çŠ¶æ€ï¼šå·²è¿‡æœŸ"),{...this.getDefaultCacheStatus(),isExpired:!0};const s=this.getCacheMetadata();return{supported:"none"!==this.cacheState.strategy,hasCache:!0,count:e.questions.length,timestamp:e.timestamp,cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy,swAvailable:this.cacheState.swAvailable,lsAvailable:this.cacheState.localStorageAvailable,isExpired:!1,lastSync:this.cacheState.lastSync,metadata:s}}catch(e){return console.error("âŒ èŽ·å–ç¼“å­˜çŠ¶æ€å¤±è´¥:",e),this.getDefaultCacheStatus()}}getDefaultCacheStatus(){return{supported:"none"!==this.cacheState.strategy,hasCache:!1,count:0,timestamp:null,cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy,swAvailable:this.cacheState.swAvailable,lsAvailable:this.cacheState.localStorageAvailable,isExpired:!1,lastSync:this.cacheState.lastSync,metadata:this.getCacheMetadata()}}updateCacheMetadata(e=null){try{const s={version:this.cacheVersion,cacheLimit:this.cacheLimit,lastUpdated:Date.now(),strategy:this.cacheState.strategy,dataInfo:e?{count:e.count,timestamp:e.timestamp}:null};this.cacheState.localStorageAvailable&&localStorage.setItem(this.CACHE_KEYS.META,JSON.stringify(s))}catch(e){console.error("âŒ æ›´æ–°ç¼“å­˜å…ƒæ•°æ®å¤±è´¥:",e)}}getCacheMetadata(){try{if(this.cacheState.localStorageAvailable){const e=localStorage.getItem(this.CACHE_KEYS.META);return e?JSON.parse(e):null}return null}catch{return null}}async clearCache(){try{const e=[];return this.cacheState.swAvailable&&e.push(caches.delete(this.CACHE_KEYS.SW_CACHE).catch(()=>{})),this.cacheState.localStorageAvailable&&Object.values(this.CACHE_KEYS).forEach(e=>{localStorage.removeItem(e)}),await Promise.allSettled(e),this.cacheState.lastSync=null,console.log("ðŸ—‘ï¸ æ‰€æœ‰ç¼“å­˜å·²æ¸…ç†"),this.dispatchEvent("cacheCleared",{strategy:this.cacheState.strategy}),!0}catch(e){return console.error("âŒ æ¸…ç†ç¼“å­˜å¤±è´¥:",e),!1}}getCacheConfig(){return{cacheLimit:this.cacheLimit,strategy:this.cacheState.strategy,swAvailable:this.cacheState.swAvailable,lsAvailable:this.cacheState.localStorageAvailable,maxLimit:500,minLimit:1,defaultLimit:30,expiryDays:7,version:this.cacheVersion}}resetToDefault(){return this.cacheLimit=30,this.updateCacheMetadata(),console.log("ðŸ”„ ç¼“å­˜é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼"),this.cacheLimit}async testCachePerformance(){const e={questions:Array.from({length:10},(e,s)=>({id:s,question:`æµ‹è¯•é—®é¢˜ ${s}`,answer:`æµ‹è¯•ç­”æ¡ˆ ${s}`})),timestamp:Date.now(),count:10},s=performance.now();try{await this.cacheQuestions(e.questions);const t=await this.getCachedQuestions(),a=performance.now(),n=t.questions.length===e.questions.length,i=a-s;return console.log("ðŸ“Š ç¼“å­˜æ€§èƒ½æµ‹è¯•: "+(n?"æˆåŠŸ":"å¤±è´¥"),{è€—æ—¶:`${i.toFixed(2)}ms`,ç­–ç•¥:this.cacheState.strategy,æ•°æ®é‡:e.questions.length}),{success:n,duration:i,strategy:this.cacheState.strategy}}catch(e){return console.error("âŒ ç¼“å­˜æ€§èƒ½æµ‹è¯•å¤±è´¥:",e),{success:!1,duration:0,strategy:this.cacheState.strategy}}}dispatchEvent(e,s){"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent(`cache:${e}`,{detail:{...s,timestamp:Date.now(),service:"CacheService"}}))}addEventListener(e,s){"undefined"!=typeof window&&window.addEventListener(`cache:${e}`,s)}removeEventListener(e,s){"undefined"!=typeof window&&window.removeEventListener(`cache:${e}`,s)}},$="medium",P="beginner",I=e=>e&&e.objectId?e.objectId:"string"==typeof e?e:e&&e.id?e.id:null,Q=e=>e?N().Object.createWithoutData("Category",e):null;let O=[],R=null;const U=(e,s)=>{if(y.shouldUseOfflineData())return;const t=I(e);t&&(O.push({categoryId:t,change:s}),R&&clearTimeout(R),R=setTimeout(()=>{const e=[...O];O=[],R=null,(async e=>{if(y.shouldUseOfflineData())console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šè·³è¿‡åˆ†ç±»è®¡æ•°æ›´æ–°");else if(0!==e.length)try{const s={};e.forEach(({categoryId:e,change:t})=>{e&&!s[e]&&(s[e]=0),e&&(s[e]+=t)});const t=Object.entries(s).map(async([e,s])=>{try{const t=new(N().Query)("Category"),a=await t.get(e),n=a.get("questionCount")||0,i=Math.max(0,n+s);a.set("questionCount",i),await a.save(),console.log(`åˆ†ç±» ${a.get("name")} é¢˜ç›®æ•°é‡æ‰¹é‡æ›´æ–°: ${n} -> ${i}`)}catch(s){console.error(`æ›´æ–°åˆ†ç±» ${e} é¢˜ç›®æ•°é‡å¤±è´¥:`,s)}});await Promise.all(t)}catch(e){console.error("æ‰¹é‡æ›´æ–°åˆ†ç±»é¢˜ç›®æ•°é‡å¤±è´¥:",e)}})(e)},2e3))},M=e=>{const s=e.get("category");return{id:e.id,objectId:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),url:e.get("url"),tags:e.get("tags")||[],difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel")||50,category:s?{id:s.id,objectId:s.id,name:s.get("name"),description:s.get("description"),questionCount:s.get("questionCount")||0}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),lastReviewedAt:e.get("lastReviewedAt")}},B=e=>new Promise(s=>setTimeout(s,e)),F=()=>{const e=N().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");return e},_=(e="æ“ä½œ")=>{if(y.shouldUseOfflineData())throw console.log(`ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šæ— æ³•${e}`),new Error(`ç¦»çº¿æ¨¡å¼ä¸‹æ— æ³•${e}`)},W=async e=>{_("åˆ›å»ºé¢˜ç›®");try{const s=F(),t=new(N().Object.extend("Question"));if(t.set("title",e.title||""),t.set("detailedAnswer",e.detailedAnswer||""),t.set("oralAnswer",e.oralAnswer||""),t.set("code",e.code||""),t.set("url",e.url||""),t.set("tags",e.tags||[]),t.set("difficulty",e.difficulty||$),t.set("proficiency",e.proficiency||P),t.set("appearanceLevel",e.appearanceLevel||50),t.set("createdBy",s),e.categoryId){const s=Q(e.categoryId);t.set("category",s)}const a=new(N().ACL);return a.setReadAccess(s,!0),a.setWriteAccess(s,!0),a.setPublicReadAccess(!1),t.setACL(a),await t.save(),e.categoryId&&await K(e.categoryId,1),M(t)}catch(e){throw console.error("åˆ›å»ºé¢˜ç›®å¤±è´¥:",e),e}},z=async e=>{_("åˆ é™¤é¢˜ç›®");try{const s=F(),t=new(N().Query)("Question");t.equalTo("objectId",e),t.equalTo("createdBy",s),t.include("category");const a=await t.first();if(!a)throw new Error("é¢˜ç›®ä¸å­˜åœ¨æˆ–æ— æƒåˆ é™¤");const n=a.get("category");return await a.destroy(),n&&await K(n,-1),!0}catch(e){throw console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e),e}},V=async()=>{if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šä»Žç¼“å­˜èŽ·å–æ‰€æœ‰é¢˜ç›®æ•°æ®"),(await T.getCachedQuestions()).questions;await B(1e3);try{const e=F(),s=[];let t=0;const a=100;let n=!0;for(;n;){const i=new(N().Query)("Question");i.equalTo("createdBy",e),i.include("category"),i.descending("updatedAt"),i.limit(a),i.skip(t);const c=await i.find();s.push(...c),n=c.length===a,t+=a,console.log(`ðŸ“¦ æ‰¹é‡èŽ·å–é¢˜ç›®: ç¬¬ ${t/a} æ‰¹, èŽ·å– ${c.length} æ¡`)}const i=s.map(e=>M(e));return console.log("ðŸ“Š getAllQuestions å®žæ—¶æŸ¥è¯¢ç»“æžœ:",{é¢˜ç›®æ€»æ•°:i.length,æ‰¹æ¬¡:t/a+" æ‰¹",æœ€æ–°é¢˜ç›®:i.slice(0,3).map(e=>({id:e.id,title:e.title}))}),await T.cacheQuestions(i),i}catch(e){if(console.error("èŽ·å–æ‰€æœ‰é¢˜ç›®å¤±è´¥:",e),e.message.includes("offline")||e.message.includes("network")||e.message.includes("CORS"))return console.log("ðŸŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç¼“å­˜æ•°æ®"),(await T.getCachedQuestions()).questions;throw e}},J=async(e,s)=>{_("æ›´æ–°é¢˜ç›®");try{console.log("questionService: æ›´æ–°é¢˜ç›®",e,s);const t=N().Object.createWithoutData("Question",e);let a=null;s.categoryId&&(a=(await new(N().Query)("Question").include("category").get(e)).get("category")),Object.keys(s).forEach(e=>{if(void 0!==s[e])if("categoryId"===e){const a=Q(s[e]);t.set("category",a)}else t.set(e,s[e])});const n=await t.save();if(console.log("questionService: æ›´æ–°æˆåŠŸ",n),s.categoryId&&a){const e=s.categoryId,t=I(a);t!==e&&(t&&U(t,-1),e&&U(e,1))}const i=await new(N().Query)("Question").include("category").get(e);return M(i)}catch(e){throw console.error("questionService: æ›´æ–°é¢˜ç›®å¤±è´¥:",e),e}},K=async(e,s)=>{if(y.shouldUseOfflineData())return;if(!e)return;const t=I(e);if(t)try{const e=new(N().Query)("Category"),a=await e.get(t),n=a.get("questionCount")||0,i=Math.max(0,n+s);a.set("questionCount",i),await a.save(),console.log(`åˆ†ç±» ${a.get("name")} é¢˜ç›®æ•°é‡ç«‹å³æ›´æ–°: ${n} -> ${i}`)}catch(e){console.error(`ç«‹å³æ›´æ–°åˆ†ç±» ${t} é¢˜ç›®æ•°é‡å¤±è´¥:`,e)}},H=()=>{const[e,s]=(0,a.useState)(!0),[t,n]=(0,a.useState)({});return(0,a.useEffect)(()=>{s(y.isOnlineMode()),n(T.getCacheStatus());const e=()=>s(!0),t=()=>s(!1);y.addEventListener("online",e),y.addEventListener("offline",t);const a=setInterval(()=>{n(T.getCacheStatus())},5e3);return()=>{y.removeEventListener("online",e),y.removeEventListener("offline",t),clearInterval(a)}},[]),e?null:(0,p.jsx)("div",{className:"offline-indicator",children:(0,p.jsxs)("div",{className:"offline-content",children:[(0,p.jsx)("div",{className:"offline-icon",children:"ðŸ“¶"}),(0,p.jsxs)("div",{className:"offline-text",children:[(0,p.jsx)("strong",{children:"ç¦»çº¿æ¨¡å¼"}),(0,p.jsx)("span",{children:"ä½¿ç”¨ç¼“å­˜çš„é¢˜ç›®æ•°æ®"}),t.hasCache&&(0,p.jsxs)("span",{className:"cache-info",children:["å·²ç¼“å­˜ ",t.count," é“é¢˜ç›®"]})]})]})})},G=({questions:e=[],onCacheUpdate:s,currentUser:t})=>{const n=(0,i.Zp)(),[c,r]=(0,a.useState)({}),[l,o]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!0),[u,m]=(0,a.useState)({cacheLimit:30,autoCache:!0,cacheStrategy:"recent"}),[g,x]=(0,a.useState)(30),[j,v]=(0,a.useState)(!1),N=(e=>{const[s,t]=(0,a.useState)(e);return(0,a.useEffect)(()=>{const s=setTimeout(()=>{t(e)},300);return()=>{clearTimeout(s)}},[e,300]),s})(g),f=(e=>{const[s,t]=(0,a.useState)(e),n=(0,a.useRef)(Date.now());return(0,a.useEffect)(()=>{const s=setTimeout(()=>{Date.now()-n.current>=100&&(t(e),n.current=Date.now())},100-(Date.now()-n.current));return()=>{clearTimeout(s)}},[e,100]),s})(g);(0,a.useEffect)(()=>{const e=T.getCacheStatus();r(e),m(e=>({...e,cacheLimit:T.getCacheLimit()})),x(T.getCacheLimit()),h(y.isOnlineMode());const s=()=>h(!0),t=()=>h(!1);return y.addEventListener("online",s),y.addEventListener("offline",t),()=>{y.removeEventListener("online",s),y.removeEventListener("offline",t)}},[]),(0,a.useEffect)(()=>{N!==u.cacheLimit&&(m(e=>({...e,cacheLimit:N})),T.setCacheLimit(N))},[N,u.cacheLimit]);const w=(0,a.useCallback)(async()=>{if(t){o(!0);try{if(await T.cacheQuestions(e)){const e=T.getCacheStatus();r(e),s?.(e),setTimeout(()=>{},100)}}catch(e){console.error("ç¼“å­˜å¤±è´¥:",e)}finally{o(!1)}}else alert("è¯·å…ˆç™»å½•")},[t,e,s]),b=(0,a.useCallback)(()=>{T.clearCache();const e=T.getCacheStatus();r(e),s?.(e)},[s]),C=(0,a.useCallback)(e=>{x(e)},[]),S=()=>(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"âš™ï¸ ç¼“å­˜è®¾ç½®"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>v(!1),children:"Ã—"})]}),(0,p.jsxs)("div",{className:"cache-settings-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"cacheLimit",children:["ç¼“å­˜é¢˜ç›®æ•°é‡: ",(0,p.jsx)("span",{className:"limit-value",children:f})," é¢˜"]}),(0,p.jsx)("div",{className:"slider-container",children:(0,p.jsx)("input",{id:"cacheLimit",type:"range",min:"10",max:"100",step:"10",value:g,onChange:e=>{const s=parseInt(e.target.value);C(s)},onInput:e=>{const s=(parseInt(e.target.value)-10)/90*100;e.target.style.setProperty("--slider-progress",`${s}%`)},className:"cache-limit-slider"})}),(0,p.jsxs)("div",{className:"slider-labels",children:[(0,p.jsx)("span",{children:"10"}),(0,p.jsx)("span",{children:"30"}),(0,p.jsx)("span",{children:"50"}),(0,p.jsx)("span",{children:"70"}),(0,p.jsx)("span",{children:"90"}),(0,p.jsx)("span",{children:"100"})]}),(0,p.jsx)("div",{className:"setting-feedback",children:g!==u.cacheLimit?(0,p.jsxs)("span",{children:["ðŸ”„ å°†æ›´æ–°ä¸º: ",g," é¢˜"]}):(0,p.jsxs)("span",{children:["âœ… å½“å‰è®¾ç½®: ",u.cacheLimit," é¢˜"]})})]}),(0,p.jsxs)("div",{className:"form-actions",children:[(0,p.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>v(!1),children:"å–æ¶ˆ"}),(0,p.jsx)("button",{type:"button",className:"submit-btn",onClick:()=>{T.setCacheLimit(g),v(!1)},children:"ä¿å­˜è®¾ç½®"})]})]})]})});return(0,p.jsxs)("section",{className:"cache-management-section",children:[(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"cache-overview",children:[(0,p.jsxs)("div",{className:"cache-header",children:[(0,p.jsx)("h2",{children:"ðŸ’¾ ç¼“å­˜ç®¡ç†"}),(0,p.jsx)("p",{children:"ç®¡ç†ç¦»çº¿ç¼“å­˜æ•°æ®ï¼Œç¡®ä¿åœ¨æ— ç½‘ç»œçŽ¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨"})]}),(0,p.jsxs)("div",{className:"cache-stats-cards",children:[(0,p.jsxs)("div",{className:"cache-stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“¦"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:c.hasCache?c.count:0}),(0,p.jsx)("div",{className:"stat-label",children:"å·²ç¼“å­˜é¢˜ç›®"})]})]}),(0,p.jsxs)("div",{className:"cache-stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"âš¡"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:u.cacheLimit}),(0,p.jsx)("div",{className:"stat-label",children:"ç¼“å­˜é™åˆ¶"})]})]}),(0,p.jsxs)("div",{className:"cache-stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ•’"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:c.hasCache?"7å¤©":"æ— "}),(0,p.jsx)("div",{className:"stat-label",children:"ç¼“å­˜æœ‰æ•ˆæœŸ"})]})]}),(0,p.jsxs)("div",{className:"cache-stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸŒ"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:d?"åœ¨çº¿":"ç¦»çº¿"}),(0,p.jsx)("div",{className:"stat-label",children:"ç½‘ç»œçŠ¶æ€"})]})]})]})]}),(0,p.jsxs)("div",{className:"cache-actions-panel",children:[(0,p.jsxs)("div",{className:"cache-action-group",children:[(0,p.jsx)("h3",{children:"ç¼“å­˜æ“ä½œ"}),(0,p.jsxs)("div",{className:"action-buttons",children:[(0,p.jsx)("button",{onClick:w,disabled:l||!d,className:"cache-action-btn primary "+(l?"loading":""),children:l?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"loading-spinner"}),"ç¼“å­˜ä¸­..."]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{className:"btn-icon",children:"ðŸ’¾"}),"ç«‹å³ç¼“å­˜é¢˜ç›®"]})}),(0,p.jsxs)("button",{onClick:b,disabled:!c.hasCache,className:"cache-action-btn secondary",children:[(0,p.jsx)("span",{className:"btn-icon",children:"ðŸ—‘ï¸"}),"æ¸…ç†ç¼“å­˜"]}),(0,p.jsxs)("button",{onClick:()=>v(!0),className:"cache-action-btn outline",children:[(0,p.jsx)("span",{className:"btn-icon",children:"âš™ï¸"}),"ç¼“å­˜è®¾ç½®"]})]})]}),c.hasCache&&(0,p.jsxs)("div",{className:"cache-preview",children:[(0,p.jsx)("h3",{children:"ç¼“å­˜é¢„è§ˆ"}),(0,p.jsxs)("div",{className:"preview-content",children:[(0,p.jsxs)("p",{children:["å·²ç¼“å­˜ ",c.count," é“é¢˜ç›®ï¼Œç‚¹å‡»æŸ¥çœ‹ç¦»çº¿é¢˜ç›®ï¼š"]}),(0,p.jsxs)("button",{onClick:()=>n("/offline/questions"),className:"view-offline-btn",children:["ðŸ“š æŸ¥çœ‹ç¦»çº¿é¢˜ç›® (",c.count,")"]})]})]}),(0,p.jsxs)("div",{className:"cache-tips",children:[(0,p.jsx)("h3",{children:"ä½¿ç”¨æç¤º"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"ðŸ’¡ ç¼“å­˜é¢˜ç›®åŽå¯åœ¨æ— ç½‘ç»œçŽ¯å¢ƒä¸‹æŸ¥çœ‹å’Œå¤ä¹ "}),(0,p.jsx)("li",{children:"â° ç¼“å­˜æ•°æ®æœ‰æ•ˆæœŸä¸º7å¤©ï¼Œè¿‡æœŸåŽè‡ªåŠ¨æ¸…ç†"}),(0,p.jsx)("li",{children:"ðŸ“± å»ºè®®åœ¨ç½‘ç»œè‰¯å¥½æ—¶è¿›è¡Œç¼“å­˜æ“ä½œ"}),(0,p.jsx)("li",{children:"ðŸ”„ é¢˜ç›®æ›´æ–°åŽå»ºè®®é‡æ–°ç¼“å­˜ä»¥èŽ·å–æœ€æ–°å†…å®¹"})]})]})]})]}),j&&(0,p.jsx)(S,{})]})};var Y=t(4653),Z=t(630),X=t(3161),ee=t(2050),se=t(8687),te=t(7018),ae=t(8224),ne=t(9107),ie=t(7984),ce=t(3495),re=t(1222);const le=({reviewQuestions:e,setReviewQuestions:s,reviewThreshold:t,setReviewThreshold:n,showReviewSettings:i,setShowReviewSettings:c,onQuestionClick:r,onUpdateQuestionTime:l,questions:o})=>{const[d,h]=(0,a.useState)("all"),[u,m]=(0,a.useState)(""),[g,x]=(0,a.useState)(new Set),[j,v]=(0,a.useState)(N().User.current()),y=e=>{const s=new Date-new Date(e),t=Math.floor(s/864e5),a=Math.floor(t/7),n=Math.floor(t/30);return 0===t?"ä»Šå¤©":1===t?"æ˜¨å¤©":t<7?`${t}å¤©å‰`:a<4?`${a}å‘¨å‰`:`${n}æœˆå‰`},f=e=>{const s=new Date(e.lastReviewedAt||e.createdAt),t=Math.floor((new Date-s)/864e5);return t>=5?"high":t>=3?"medium":"low"},w=e=>{switch(e){case"high":return"æ€¥éœ€å¤ä¹ ";case"medium":return"å»ºè®®å¤ä¹ ";case"low":return"å¯ç¨åŽå¤ä¹ ";default:return"æœªçŸ¥"}},b=e=>{switch(e){case"high":return"5å¤©ä»¥ä¸Šæœªå¤ä¹ ";case"medium":return"3-4å¤©æœªå¤ä¹ ";case"low":return"1-2å¤©æœªå¤ä¹ ";default:return""}},C=e=>{if(!e.category?.id)return console.warn("é¢˜ç›®æ²¡æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œæ— æ³•è·³è½¬"),void alert("è¯¥é¢˜ç›®æ²¡æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œæ— æ³•è·³è½¬");const s=`/category/${e.category.id}`;window.history.pushState?(window.history.pushState(null,"",s),window.dispatchEvent(new PopStateEvent("popstate"))):window.location.href=s,setTimeout(()=>{window.dispatchEvent(new CustomEvent("scrollToQuestion",{detail:{questionId:e.id}}))},100)},S=e.filter(e=>{const s=e.title.toLowerCase().includes(u.toLowerCase())||(e.category?.name||"").toLowerCase().includes(u.toLowerCase());if("all"===d)return s;const t=f(e);return s&&t===d}),k={high:S.filter(e=>"high"===f(e)),medium:S.filter(e=>"medium"===f(e)),low:S.filter(e=>"low"===f(e))},A=()=>{const s=o.length,t=s-e.length;return s>0?t/s*100:0};return j?(0,p.jsx)("section",{className:"review-reminder-section",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"user-welcome-banner",children:[(0,p.jsxs)("h3",{children:["ðŸ“š å¤ä¹ æé†’ - ",j.getUsername()]}),(0,p.jsx)("p",{children:"åŠæ—¶å¤ä¹ æ˜¯å·©å›ºçŸ¥è¯†çš„å…³é”®ï¼Œä»¥ä¸‹æ˜¯éœ€è¦æ‚¨å…³æ³¨çš„é¢˜ç›®"})]}),(0,p.jsxs)("div",{className:"review-header",children:[(0,p.jsxs)("div",{className:"review-stats",children:[(0,p.jsxs)("div",{className:"stat-card urgent",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ”¥"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:k.high.length}),(0,p.jsx)("div",{className:"stat-label",children:"æ€¥éœ€å¤ä¹ "}),(0,p.jsx)("div",{className:"stat-description",children:"5å¤©ä»¥ä¸Š"})]})]}),(0,p.jsxs)("div",{className:"stat-card medium",children:[(0,p.jsx)("div",{className:"stat-icon",children:"âš ï¸"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:k.medium.length}),(0,p.jsx)("div",{className:"stat-label",children:"å»ºè®®å¤ä¹ "}),(0,p.jsx)("div",{className:"stat-description",children:"3-4å¤©"})]})]}),(0,p.jsxs)("div",{className:"stat-card low",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ’¡"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:k.low.length}),(0,p.jsx)("div",{className:"stat-label",children:"å¯ç¨åŽå¤ä¹ "}),(0,p.jsx)("div",{className:"stat-description",children:"1-2å¤©"})]})]}),(0,p.jsxs)("div",{className:"stat-card total",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:e.length}),(0,p.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ é¢˜ç›®"}),(0,p.jsx)("div",{className:"stat-description",children:"æ€»è®¡"})]})]})]}),(0,p.jsxs)("div",{className:"review-progress",children:[(0,p.jsxs)("div",{className:"progress-header",children:[(0,p.jsx)("span",{children:"å¤ä¹ è¿›åº¦"}),(0,p.jsxs)("span",{children:[Math.round(A()),"%"]})]}),(0,p.jsx)("div",{className:"progress-bar",children:(0,p.jsx)("div",{className:"progress-fill",style:{width:`${A()}%`}})}),(0,p.jsx)("div",{className:"progress-stats",children:(0,p.jsxs)("span",{children:[o.length-e.length," / ",o.length," é¢˜ç›®å·²åŠæ—¶å¤ä¹ "]})})]})]}),(0,p.jsxs)("div",{className:"review-controls",children:[(0,p.jsxs)("div",{className:"controls-left",children:[(0,p.jsxs)("div",{className:"search-box",children:[(0,p.jsx)("span",{className:"search-icon",children:"ðŸ”"}),(0,p.jsx)("input",{type:"text",placeholder:"æœç´¢é¢˜ç›®æˆ–åˆ†ç±»...",value:u,onChange:e=>m(e.target.value),className:"search-input"})]}),(0,p.jsxs)("div",{className:"urgency-filter",children:[(0,p.jsx)("button",{className:"urgency-btn "+("all"===d?"active":""),onClick:()=>h("all"),children:"å…¨éƒ¨"}),(0,p.jsx)("button",{className:"urgency-btn high "+("high"===d?"active":""),onClick:()=>h("high"),children:"ðŸ”¥ æ€¥éœ€ (5å¤©+)"}),(0,p.jsx)("button",{className:"urgency-btn medium "+("medium"===d?"active":""),onClick:()=>h("medium"),children:"âš ï¸ å»ºè®® (3-4å¤©)"}),(0,p.jsx)("button",{className:"urgency-btn low "+("low"===d?"active":""),onClick:()=>h("low"),children:"ðŸ’¡ ç¨åŽ (1-2å¤©)"})]})]}),(0,p.jsx)("div",{className:"controls-right",children:(0,p.jsx)("button",{className:"settings-btn",onClick:()=>c(!0),children:"âš™ï¸ å¤ä¹ è®¾ç½®"})})]}),i&&(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"å¤ä¹ æé†’è®¾ç½®"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>c(!1),children:"Ã—"})]}),(0,p.jsxs)("div",{className:"settings-content",children:[(0,p.jsxs)("div",{className:"setting-item",children:[(0,p.jsxs)("label",{htmlFor:"reviewThreshold",children:["å¤ä¹ æé†’é˜ˆå€¼",(0,p.jsx)("span",{className:"hint",children:"ï¼ˆè¶…è¿‡è¿™ä¸ªå¤©æ•°çš„é¢˜ç›®ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­ï¼‰"})]}),(0,p.jsxs)("div",{className:"threshold-control",children:[(0,p.jsx)("input",{id:"reviewThreshold",type:"range",min:"1",max:"30",step:"1",value:t,onChange:e=>n(parseInt(e.target.value)),className:"threshold-slider"}),(0,p.jsxs)("span",{className:"threshold-value",children:[t," å¤©"]})]}),(0,p.jsx)("div",{className:"threshold-presets",children:[1,3,5,7,14,30].map(e=>(0,p.jsxs)("button",{className:"preset-btn "+(t===e?"active":""),onClick:()=>n(e),children:[e,"å¤©"]},e))})]}),(0,p.jsxs)("div",{className:"urgency-explanation",children:[(0,p.jsx)("h4",{children:"ðŸ“‹ ç´§æ€¥ç¨‹åº¦è¯´æ˜Ž"}),(0,p.jsxs)("div",{className:"urgency-levels",children:[(0,p.jsxs)("div",{className:"urgency-level high",children:[(0,p.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#ff6b6b"}}),(0,p.jsxs)("div",{className:"urgency-info",children:[(0,p.jsx)("strong",{children:"æ€¥éœ€å¤ä¹  (çº¢è‰²)"}),(0,p.jsx)("span",{children:"5å¤©ä»¥ä¸Šæœªå¤ä¹ çš„é¢˜ç›®"})]})]}),(0,p.jsxs)("div",{className:"urgency-level medium",children:[(0,p.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#ffa726"}}),(0,p.jsxs)("div",{className:"urgency-info",children:[(0,p.jsx)("strong",{children:"å»ºè®®å¤ä¹  (æ©™è‰²)"}),(0,p.jsx)("span",{children:"3-4å¤©æœªå¤ä¹ çš„é¢˜ç›®"})]})]}),(0,p.jsxs)("div",{className:"urgency-level low",children:[(0,p.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#4ecdc4"}}),(0,p.jsxs)("div",{className:"urgency-info",children:[(0,p.jsx)("strong",{children:"å¯ç¨åŽå¤ä¹  (é’è‰²)"}),(0,p.jsx)("span",{children:"1-2å¤©æœªå¤ä¹ çš„é¢˜ç›®"})]})]})]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"cancel-btn",onClick:()=>c(!1),children:"å–æ¶ˆ"}),(0,p.jsx)("button",{className:"confirm-btn",onClick:()=>c(!1),children:"ç¡®è®¤è®¾ç½®"})]})]})}),(0,p.jsx)("div",{className:"review-questions",children:0===S.length?(0,p.jsxs)("div",{className:"empty-review-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:"ðŸŽ‰"}),(0,p.jsx)("h3",{children:"å¤ªæ£’äº†ï¼æ²¡æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®"}),(0,p.jsx)("p",{children:"ç»§ç»­ä¿æŒè‰¯å¥½çš„å¤ä¹ ä¹ æƒ¯ï¼Œæˆ–è€…è°ƒæ•´å¤ä¹ è®¾ç½®æ¥æŸ¥çœ‹æ›´å¤šé¢˜ç›®"}),(0,p.jsx)("button",{className:"adjust-settings-btn",onClick:()=>c(!0),children:"è°ƒæ•´å¤ä¹ è®¾ç½®"})]}):(0,p.jsx)("div",{className:"questions-grid",children:S.map((e,t)=>{const a=f(e),n=(e=>{switch(e){case"high":return"#ff6b6b";case"medium":return"#ffa726";case"low":return"#4ecdc4";default:return"#95a5a6"}})(a),i=new Date(e.lastReviewedAt||e.createdAt),c=Math.floor((new Date-i)/864e5),d=g.has(e.id);return(0,p.jsxs)("div",{className:"review-question-card "+(d?"updating":""),onClick:()=>C(e),style:{"--urgency-color":n},children:[(0,p.jsxs)("div",{className:"card-header",children:[(0,p.jsx)("div",{className:"urgency-indicator",style:{backgroundColor:n}}),(0,p.jsxs)("div",{className:"question-meta",children:[(0,p.jsx)("span",{className:"urgency-badge",style:{backgroundColor:n},children:w(a)}),(0,p.jsx)("span",{className:"category-tag",children:e.category?.name||"æœªåˆ†ç±»"})]}),(0,p.jsxs)("div",{className:"time-info",children:[(0,p.jsxs)("span",{className:"last-reviewed",children:["ä¸Šæ¬¡å¤ä¹ : ",y(e.lastReviewedAt||e.createdAt)]}),(0,p.jsxs)("span",{className:"days-ago",children:["(",c,"å¤©å‰)"]}),(0,p.jsx)("span",{className:"urgency-description",children:b(a)})]})]}),(0,p.jsxs)("div",{className:"card-content",children:[(0,p.jsx)("h4",{className:"question-title",children:e.title}),e.detailedAnswer&&(0,p.jsxs)("div",{className:"answer-preview",children:[e.detailedAnswer.substring(0,100),"..."]}),(0,p.jsxs)("div",{className:"question-tags",children:[(0,p.jsx)("span",{className:`difficulty-tag difficulty-${e.difficulty}`,children:"easy"===e.difficulty?"ç®€å•":"medium"===e.difficulty?"ä¸­ç­‰":"å›°éš¾"}),e.tags&&e.tags.slice(0,3).map((e,s)=>(0,p.jsxs)("span",{className:"tag",children:["#",e]},s))]})]}),(0,p.jsx)("div",{className:"card-footer",children:(0,p.jsxs)("div",{className:"review-actions",children:[(0,p.jsx)("button",{className:"review-now-btn",onClick:t=>(async(e,t)=>{if(t.stopPropagation(),!j)return void alert("è¯·å…ˆç™»å½•");const a=o.find(s=>s.id===e);if(!a)return console.error("æœªæ‰¾åˆ°é¢˜ç›®:",e),void alert("é¢˜ç›®ä¸å­˜åœ¨ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");x(s=>new Set(s).add(e));try{console.log("å¼€å§‹è°ƒç”¨ onUpdateQuestionTime..."),await l(e),console.log("onUpdateQuestionTime è°ƒç”¨æˆåŠŸ"),s(s=>{const t=s.filter(s=>s.id!==e);return console.log("ä»Žå¤ä¹ åˆ—è¡¨ç§»é™¤åŽ:",t.length),t}),console.log("å‡†å¤‡è·³è½¬åˆ°é¢˜ç›®..."),a&&a.category?(console.log("è·³è½¬åˆ°åˆ†ç±»:",a.category.id),r?r(e):C(a)):(console.warn("æ— æ³•æ‰¾åˆ°é¢˜ç›®å¯¹åº”çš„åˆ†ç±»ä¿¡æ¯"),alert("å¤ä¹ æ—¶é—´å·²æ›´æ–°ï¼Œä½†æ— æ³•è·³è½¬åˆ°é¢˜ç›®ä½ç½®"))}catch(s){console.error("æ›´æ–°å¤ä¹ æ—¶é—´å¤±è´¥:",s),console.error("é”™è¯¯è¯¦æƒ…:",{questionId:e,currentUser:j?.id,errorMessage:s.message});let t="æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•";s.message.includes("permission")?t="æ›´æ–°å¤±è´¥ï¼šæ²¡æœ‰æƒé™ä¿®æ”¹æ­¤é¢˜ç›®":s.message.includes("Object not found")?t="æ›´æ–°å¤±è´¥ï¼šé¢˜ç›®ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤":s.message.includes("æœªæ‰¾åˆ°å¯¹åº”çš„é¢˜ç›®")?t="æ›´æ–°å¤±è´¥ï¼šæœ¬åœ°æ•°æ®ä¸­æœªæ‰¾åˆ°è¯¥é¢˜ç›®":s.message.includes("reserved")&&(t="æ›´æ–°å¤±è´¥ï¼šæ•°æ®å­—æ®µå†²çªï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"),alert(t)}finally{x(s=>{const t=new Set(s);return t.delete(e),t})}})(e.id,t),disabled:d,children:d?"ðŸ”„ æ›´æ–°ä¸­...":"ðŸ” ç«‹å³å¤ä¹ "}),(0,p.jsx)("button",{className:"postpone-btn",onClick:s=>((e,s)=>{s.stopPropagation(),alert("å·²æŽ¨è¿Ÿæé†’ï¼Œè¯¥é¢˜ç›®å°†åœ¨æ˜Žå¤©å†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­")})(e.id,s),disabled:d,children:"â° ç¨åŽæé†’"})]})}),d&&(0,p.jsxs)("div",{className:"updating-overlay",children:[(0,p.jsx)("div",{className:"updating-spinner"}),(0,p.jsx)("span",{children:"æ›´æ–°ä¸­..."})]})]},e.id)})})})]})}):(0,p.jsx)("section",{className:"review-reminder-section",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å¤ä¹ æé†’"}),(0,p.jsx)("div",{className:"auth-required-actions",children:(0,p.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"})})]})})})};var oe=t(7286),de=t(2181);const he=a.memo(({question:e,index:s})=>{return(0,p.jsx)("div",{className:"question-item",children:(0,p.jsxs)("div",{className:"question-main",children:[(0,p.jsx)("div",{className:"question-header",children:(0,p.jsxs)("div",{className:"question-meta",children:[(0,p.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(e=>{switch(e){case"easy":return"#10b981";case"medium":return"#f59e0b";case"hard":return"#ef4444";default:return"#6b7280"}})(e.difficulty),color:"white"},children:(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return"æœªçŸ¥"}})(e.difficulty)}),(0,p.jsx)("span",{className:"question-time",children:(t=e.createdAt,new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}))})]})}),(0,p.jsx)("h4",{className:"question-title",children:e.title}),(0,p.jsx)("div",{className:"question-category",children:(0,p.jsx)("span",{className:"category-tag",children:e.category?.name||"æœªåˆ†ç±»"})})]})});var t});he.displayName="QuestionItem";const ue=({dayData:e,position:s,onClose:t,isVisible:n})=>{const i=(0,a.useRef)(null),c=(0,r.jE)(),[l,o]=(0,a.useState)([]),[d,h]=(0,a.useState)(new Map),{data:u,isLoading:m}=(0,oe.I)({queryKey:["day-questions-batch",e?.date?.toISOString(),e?.questions?.map(e=>e.id).join(",")],queryFn:async()=>{if(!e?.questions?.length)return[];const s=[],t=[];if(e.questions.forEach(e=>{const a=c.getQueryData(["question",e.id]);a?s.push(a):t.push(e.id)}),t.length>0)try{const e=await(async e=>{if(!e||0===e.length)return[];if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šä»Žç¼“å­˜æ‰¹é‡èŽ·å–é¢˜ç›®"),(await T.getCachedQuestions()).questions.filter(s=>e.includes(s.id)||e.includes(s.objectId));const s=[];for(let t=0;t<e.length;t+=10)s.push(e.slice(t,t+10));const t=[];for(const e of s){await B(1e3);try{const s=F(),a=new(N().Query)("Question");a.containedIn("objectId",e),a.equalTo("createdBy",s),a.include("category");const n=await a.find();t.push(...n.map(e=>M(e)))}catch(e){console.error("æ‰¹é‡èŽ·å–é¢˜ç›®å¤±è´¥:",e)}}return t})(t);return e.forEach(e=>{c.setQueryData(["question",e.id],e)}),[...s,...e]}catch(s){return console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ•°æ®:",s),e.questions.map(e=>c.getQueryData(["question",e.id])||e)}return s},enabled:n&&!!e?.questions?.length,staleTime:6e5,cacheTime:18e5,retry:1,retryDelay:1e3});(0,a.useEffect)(()=>{u&&u.length>0?o(u):e?.questions&&o(e.questions)},[u,e?.questions]);const g=(0,a.useRef)(null),x=(0,de.Te)({count:l.length,getScrollElement:()=>g.current,estimateSize:()=>140,overscan:5}),j=(0,a.useCallback)(e=>{i.current&&!i.current.contains(e.target)&&t()},[t]);(0,a.useEffect)(()=>{if(n)return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[n,j]);const v=(0,a.useCallback)(e=>{"Escape"===e.key&&t()},[t]);if((0,a.useEffect)(()=>{if(n)return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[n,v]),!n||!e)return null;const f=x.getVirtualItems(),w=e.questions?.length||0;return(0,p.jsxs)("div",{ref:i,className:"calendar-tooltip",style:{left:`${Math.min(s.x,window.innerWidth-500)}px`,top:`${s.y}px`,transform:"translateX(-50%)"},children:[(0,p.jsxs)("div",{className:"tooltip-header",children:[(0,p.jsxs)("div",{className:"header-content",children:[(0,p.jsxs)("div",{className:"date-display",children:[(0,p.jsx)("span",{className:"date-day",children:e.date.getDate()}),(0,p.jsxs)("div",{className:"date-info",children:[(0,p.jsx)("span",{className:"date-weekday",children:e.date.toLocaleDateString("zh-CN",{weekday:"long"})}),(0,p.jsx)("span",{className:"date-full",children:e.date.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})]})]}),(0,p.jsxs)("div",{className:"stats-badge",children:[(0,p.jsx)("span",{className:"stat-icon",children:"ðŸ“š"}),(0,p.jsx)("span",{className:"stat-count",children:w}),(0,p.jsx)("span",{className:"stat-label",children:"é“é¢˜ç›®"})]})]}),(0,p.jsx)("button",{className:"tooltip-close-btn",onClick:t,"aria-label":"å…³é—­",children:(0,p.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"currentColor",children:(0,p.jsx)("path",{d:"M12.707 3.293a1 1 0 00-1.414 0L8 6.586 4.707 3.293a1 1 0 00-1.414 1.414L6.586 8l-3.293 3.293a1 1 0 101.414 1.414L8 9.414l3.293 3.293a1 1 0 001.414-1.414L9.414 8l3.293-3.293a1 1 0 000-1.414z"})})})]}),(0,p.jsx)("div",{className:"tooltip-content",children:m?(0,p.jsxs)("div",{className:"loading-state",children:[(0,p.jsx)("div",{className:"loading-spinner"}),(0,p.jsx)("span",{className:"loading-text",children:"åŠ è½½é¢˜ç›®ä¸­..."})]}):l.length>0?(0,p.jsx)("div",{ref:g,className:"questions-virtual-container",style:{height:"500px",overflow:"auto"},children:(0,p.jsx)("div",{style:{height:`${x.getTotalSize()}px`,width:"100%",position:"relative"},children:f.map(e=>{const s=l[e.index];return(0,p.jsx)("div",{className:"question-virtual-item",style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:(0,p.jsx)(he,{question:s,index:e.index})},s.id)})})}):(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:"ðŸ“"}),(0,p.jsx)("h4",{className:"empty-title",children:"è¿™ä¸€å¤©æ²¡æœ‰å­¦ä¹ è®°å½•"}),(0,p.jsx)("p",{className:"empty-description",children:"å¼€å§‹è®°å½•ä½ çš„å­¦ä¹ è¿›åº¦å§"})]})}),l.length>0&&(0,p.jsx)("div",{className:"tooltip-footer",children:(0,p.jsxs)("div",{className:"footer-stats",children:[(0,p.jsxs)("span",{className:"virtual-info",children:["æ˜¾ç¤º ",f.length," / ",w," é“é¢˜ç›®"]}),(0,p.jsx)("span",{className:"scroll-hint",children:"æ»šåŠ¨æŸ¥çœ‹æ›´å¤š"})]})}),(0,p.jsx)("div",{className:"tooltip-arrow"})]})},me=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(0),r=[{text:"ä»»ä½•è¶³å¤Ÿå…ˆè¿›çš„æŠ€æœ¯éƒ½ä¸Žé­”æ³•æ— å¼‚ã€‚",author:"äºšç‘ŸÂ·CÂ·å…‹æ‹‰å…‹",category:"ç§‘æŠ€å“²å­¦"},{text:"ä»£ç å°±åƒæ˜¯å¹½é»˜ï¼Œå½“ä½ éœ€è¦è§£é‡Šå®ƒæ—¶ï¼Œå®ƒå°±ä¸å†æœ‰è¶£äº†ã€‚",author:"Cory House",category:"ç¼–ç¨‹"},{text:"é¦–å…ˆï¼Œè§£å†³é—®é¢˜ã€‚ç„¶åŽï¼Œç¼–å†™ä»£ç ã€‚",author:"John Johnson",category:"å¼€å‘æ–¹æ³•"},{text:"ç¼–ç¨‹ä¸æ˜¯å…³äºŽä½ çŸ¥é“ä»€ä¹ˆï¼Œè€Œæ˜¯å…³äºŽä½ èƒ½å¼„æ¸…æ¥šä»€ä¹ˆã€‚",author:"Chris Pine",category:"å­¦ä¹ "},{text:"ç®€å•æ€§æ˜¯å¯é æ€§çš„å…ˆå†³æ¡ä»¶ã€‚",author:"Edsger W. Dijkstra",category:"è½¯ä»¶å·¥ç¨‹"},{text:"æµ‹è¯•åªèƒ½è¯æ˜Ž bug çš„å­˜åœ¨ï¼Œè€Œä¸èƒ½è¯æ˜Žå®ƒä»¬çš„ä¸å­˜åœ¨ã€‚",author:"Edsger W. Dijkstra",category:"æµ‹è¯•"},{text:"æœ€å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¯æ ¹æœ¬ä¸éœ€è¦é”™è¯¯ä¿¡æ¯ã€‚",author:"Jef Raskin",category:"ç”¨æˆ·ä½“éªŒ"},{text:"è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚",author:"Donald Knuth",category:"æ€§èƒ½ä¼˜åŒ–"},{text:"ä»£ç çš„é˜…è¯»æ¬¡æ•°è¿œå¤šäºŽç¼–å†™æ¬¡æ•°ã€‚",author:"Guido van Rossum",category:"ä»£ç è´¨é‡"},{text:"å®Œç¾Žä¸æ˜¯åœ¨æ²¡æœ‰ä¸œè¥¿å¯åŠ æ—¶è¾¾åˆ°çš„ï¼Œè€Œæ˜¯åœ¨æ²¡æœ‰ä¸œè¥¿å¯æ‹¿èµ°æ—¶è¾¾åˆ°çš„ã€‚",author:"Antoine de Saint-ExupÃ©ry",category:"è®¾è®¡"},{text:"è®¡ç®—æœºç§‘å­¦çš„æ ¸å¿ƒæ˜¯è§£å†³é—®é¢˜ã€‚",author:"Abelson and Sussman",category:"è®¡ç®—æœºç§‘å­¦"},{text:"æœªæ¥å·²ç»åˆ°æ¥ï¼Œåªæ˜¯åˆ†å¸ƒä¸å‡ã€‚",author:"William Gibson",category:"ç§‘æŠ€åˆ›æ–°"},{text:"æœ€å±é™©çš„ä»£ç æ˜¯ä½ çœ‹ä¸åˆ°é—®é¢˜çš„ä»£ç ã€‚",author:"Douglas Crockford",category:"ä»£ç å®‰å…¨"},{text:"ç¼–ç¨‹æ˜¯ç†è§£çš„è‰ºæœ¯ã€‚",author:"Kristen Nygaard",category:"ç¼–ç¨‹å“²å­¦"},{text:"æŠ€æœ¯åº”è¯¥æ”¹å–„ç”Ÿæ´»ï¼Œè€Œä¸æ˜¯æ”¯é…ç”Ÿæ´»ã€‚",author:"Tim Cook",category:"ç§‘æŠ€ä¼¦ç†"}];(0,a.useEffect)(()=>{const e=setInterval(()=>{c(e=>e===r.length-1?0:e+1)},5e3);return()=>clearInterval(e)},[r.length]);const l=[{id:1,title:"React å®˜æ–¹æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“",category:"å‰ç«¯æ¡†æž¶",url:"https://react.dev",icon:"âš›ï¸"},{id:2,title:"Vue.js æ–‡æ¡£",description:"æ¸è¿›å¼ JavaScript æ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://vuejs.org",icon:"ðŸŸ¢"},{id:3,title:"Angular æ–‡æ¡£",description:"Google å¼€å‘çš„å‰ç«¯æ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://angular.io",icon:"ðŸ…°ï¸"},{id:4,title:"Svelte æ–‡æ¡£",description:"ç¼–è¯‘æ—¶æ¡†æž¶ï¼Œæ— è™šæ‹ŸDOM",category:"å‰ç«¯æ¡†æž¶",url:"https://svelte.dev",icon:"âš¡"},{id:5,title:"SolidJS æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºç”¨æˆ·ç•Œé¢çš„å£°æ˜Žå¼ JavaScript åº“",category:"å‰ç«¯æ¡†æž¶",url:"https://solidjs.com",icon:"ðŸ”·"},{id:6,title:"Next.js æ–‡æ¡£",description:"React å…¨æ ˆæ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://nextjs.org",icon:"â­ï¸"},{id:7,title:"Nuxt.js æ–‡æ¡£",description:"Vue.js å…¨æ ˆæ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://nuxtjs.org",icon:"ðŸ”¥"},{id:8,title:"Redux æ–‡æ¡£",description:"JavaScript åº”ç”¨çŠ¶æ€å®¹å™¨",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://redux.js.org",icon:"ðŸ“¦"},{id:9,title:"Zustand æ–‡æ¡£",description:"å°åž‹ã€å¿«é€Ÿã€å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://github.com/pmndrs/zustand",icon:"ðŸ»"},{id:10,title:"MobX æ–‡æ¡£",description:"ç®€å•ã€å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://mobx.js.org",icon:"ðŸ”„"},{id:11,title:"Vuex æ–‡æ¡£",description:"Vue.js çš„çŠ¶æ€ç®¡ç†åº“",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://vuex.vuejs.org",icon:"ðŸª"},{id:12,title:"Tailwind CSS æ–‡æ¡£",description:"å®žç”¨ä¼˜å…ˆçš„ CSS æ¡†æž¶",category:"CSS æ¡†æž¶",url:"https://tailwindcss.com",icon:"ðŸŽ¨"},{id:13,title:"Bootstrap æ–‡æ¡£",description:"æœ€æµè¡Œçš„å‰ç«¯æ¡†æž¶",category:"CSS æ¡†æž¶",url:"https://getbootstrap.com",icon:"ðŸŽ¯"},{id:14,title:"Sass æ–‡æ¡£",description:"ä¸“ä¸šçº§ CSS æ‰©å±•è¯­è¨€",category:"CSS æ¡†æž¶",url:"https://sass-lang.com",icon:"ðŸ’Ž"},{id:15,title:"Less æ–‡æ¡£",description:"CSS é¢„å¤„ç†å™¨",category:"CSS æ¡†æž¶",url:"http://lesscss.org",icon:"âž–"},{id:16,title:"Styled Components",description:"CSS-in-JS æ ·å¼åº“",category:"CSS æ¡†æž¶",url:"https://styled-components.com",icon:"ðŸ’…"},{id:17,title:"Webpack æ–‡æ¡£",description:"æ¨¡å—æ‰“åŒ…å·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://webpack.js.org",icon:"ðŸ“¦"},{id:18,title:"Vite æ–‡æ¡£",description:"ä¸‹ä¸€ä»£å‰ç«¯æž„å»ºå·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://vitejs.dev",icon:"âš¡"},{id:19,title:"Parcel æ–‡æ¡£",description:"é›¶é…ç½®æž„å»ºå·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://parceljs.org",icon:"ðŸ“®"},{id:20,title:"Rollup æ–‡æ¡£",description:"JavaScript æ¨¡å—æ‰“åŒ…å™¨",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://rollupjs.org",icon:"ðŸ”„"},{id:21,title:"Jest æ–‡æ¡£",description:"JavaScript æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://jestjs.io",icon:"ðŸŽ­"},{id:22,title:"Cypress æ–‡æ¡£",description:"ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://docs.cypress.io",icon:"ðŸŽ¯"},{id:23,title:"Testing Library",description:"DOM æµ‹è¯•å·¥å…·åº“",category:"å‰ç«¯æµ‹è¯•",url:"https://testing-library.com",icon:"ðŸ§ª"},{id:24,title:"Vitest æ–‡æ¡£",description:"åŸºäºŽ Vite çš„æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://vitest.dev",icon:"âš¡"},{id:25,title:"Express.js æ–‡æ¡£",description:"Node.js Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://expressjs.com",icon:"ðŸš‚"},{id:26,title:"Koa æ–‡æ¡£",description:"ä¸‹ä¸€ä»£ Node.js æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://koajs.com",icon:"ðŸŽ‹"},{id:27,title:"NestJS æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„æœåŠ¡å™¨ç«¯åº”ç”¨",category:"åŽç«¯æ¡†æž¶",url:"https://nestjs.com",icon:"ðŸªº"},{id:28,title:"Fastify æ–‡æ¡£",description:"å¿«é€Ÿä¸”ä½Žå¼€é”€çš„ Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://fastify.io",icon:"ðŸš€"},{id:29,title:"Hapi æ–‡æ¡£",description:"ä¸°å¯Œçš„æ¡†æž¶ç”¨äºŽæž„å»ºåº”ç”¨å’ŒæœåŠ¡",category:"åŽç«¯æ¡†æž¶",url:"https://hapi.dev",icon:"ðŸŽ¯"},{id:30,title:"Django æ–‡æ¡£",description:"Python Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://docs.djangoproject.com",icon:"ðŸŽ¸"},{id:31,title:"Flask æ–‡æ¡£",description:"Python å¾®æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://flask.palletsprojects.com",icon:"ðŸ¶"},{id:32,title:"FastAPI æ–‡æ¡£",description:"çŽ°ä»£ã€å¿«é€Ÿçš„ Python Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://fastapi.tiangolo.com",icon:"âš¡"},{id:33,title:"Spring æ–‡æ¡£",description:"Java åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://spring.io/docs",icon:"ðŸŒ±"},{id:34,title:"Spring Boot æ–‡æ¡£",description:"ç®€åŒ– Spring åº”ç”¨å¼€å‘",category:"åŽç«¯æ¡†æž¶",url:"https://spring.io/projects/spring-boot",icon:"ðŸ‘¢"},{id:35,title:"Laravel æ–‡æ¡£",description:"PHP Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://laravel.com/docs",icon:"ðŸ”¨"},{id:36,title:"Ruby on Rails æ–‡æ¡£",description:"Ruby Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://rubyonrails.org",icon:"ðŸ’Ž"},{id:37,title:"ASP.NET Core æ–‡æ¡£",description:".NET Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://docs.microsoft.com/aspnet/core",icon:"ðŸŒ"},{id:38,title:"Gin æ–‡æ¡£",description:"Go è¯­è¨€ Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://gin-gonic.com",icon:"ðŸ¸"},{id:39,title:"MySQL æ–‡æ¡£",description:"MySQL æ•°æ®åº“å®˜æ–¹æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://dev.mysql.com/doc",icon:"ðŸ¬"},{id:40,title:"PostgreSQL æ–‡æ¡£",description:"PostgreSQL æ•°æ®åº“æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://www.postgresql.org/docs",icon:"ðŸ˜"},{id:41,title:"MongoDB æ–‡æ¡£",description:"MongoDB NoSQL æ•°æ®åº“æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://docs.mongodb.com",icon:"ðŸƒ"},{id:42,title:"Redis æ–‡æ¡£",description:"Redis å†…å­˜æ•°æ®ç»“æž„å­˜å‚¨",category:"æ•°æ®åº“",url:"https://redis.io/documentation",icon:"ðŸ”´"},{id:43,title:"Prisma æ–‡æ¡£",description:"ä¸‹ä¸€ä»£ Node.js TypeScript ORM",category:"æ•°æ®åº“",url:"https://www.prisma.io",icon:"ðŸ›¡ï¸"},{id:44,title:"Sequelize æ–‡æ¡£",description:"Node.js çš„ ORM",category:"æ•°æ®åº“",url:"https://sequelize.org",icon:"ðŸ—„ï¸"},{id:45,title:"Mongoose æ–‡æ¡£",description:"MongoDB å¯¹è±¡å»ºæ¨¡å·¥å…·",category:"æ•°æ®åº“",url:"https://mongoosejs.com",icon:"ðŸ"},{id:46,title:"GraphQL æ–‡æ¡£",description:"API æŸ¥è¯¢è¯­è¨€",category:"API å’Œå¾®æœåŠ¡",url:"https://graphql.org",icon:"ðŸ“ˆ"},{id:47,title:"Apollo æ–‡æ¡£",description:"GraphQL å¹³å°",category:"API å’Œå¾®æœåŠ¡",url:"https://www.apollographql.com",icon:"ðŸš€"},{id:48,title:"Swagger æ–‡æ¡£",description:"API è®¾è®¡å’Œæ–‡æ¡£å·¥å…·",category:"API å’Œå¾®æœåŠ¡",url:"https://swagger.io",icon:"ðŸ“"},{id:49,title:"gRPC æ–‡æ¡£",description:"é«˜æ€§èƒ½ RPC æ¡†æž¶",category:"API å’Œå¾®æœåŠ¡",url:"https://grpc.io",icon:"ðŸ”§"},{id:50,title:"RESTful API æŒ‡å—",description:"REST API æœ€ä½³å®žè·µ",category:"API å’Œå¾®æœåŠ¡",url:"https://restfulapi.net",icon:"ðŸŒ"},{id:51,title:"JWT æ–‡æ¡£",description:"JSON Web Tokens å®˜æ–¹æ–‡æ¡£",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://jwt.io",icon:"ðŸ”"},{id:52,title:"OAuth 2.0 æŒ‡å—",description:"OAuth 2.0 æŽˆæƒæ¡†æž¶",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://oauth.net/2",icon:"ðŸ”‘"},{id:53,title:"Passport.js æ–‡æ¡£",description:"Node.js è®¤è¯ä¸­é—´ä»¶",category:"è®¤è¯å’ŒæŽˆæƒ",url:"http://www.passportjs.org",icon:"ðŸ›‚"},{id:54,title:"Auth0 æ–‡æ¡£",description:"èº«ä»½éªŒè¯å’ŒæŽˆæƒå¹³å°",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://auth0.com/docs",icon:"ðŸ”’"},{id:55,title:"Docker æ–‡æ¡£",description:"å®¹å™¨åŒ–å¹³å°æ–‡æ¡£",category:"éƒ¨ç½²å’Œ DevOps",url:"https://docs.docker.com",icon:"ðŸ³"},{id:56,title:"Kubernetes æ–‡æ¡£",description:"å®¹å™¨ç¼–æŽ’ç³»ç»Ÿæ–‡æ¡£",category:"éƒ¨ç½²å’Œ DevOps",url:"https://kubernetes.io/docs",icon:"âš“"},{id:57,title:"PM2 æ–‡æ¡£",description:"Node.js è¿›ç¨‹ç®¡ç†å™¨",category:"éƒ¨ç½²å’Œ DevOps",url:"https://pm2.keymetrics.io",icon:"ðŸ”„"},{id:58,title:"Nginx æ–‡æ¡£",description:"Web æœåŠ¡å™¨å’Œåå‘ä»£ç†",category:"éƒ¨ç½²å’Œ DevOps",url:"https://nginx.org/en/docs",icon:"ðŸ”§"},{id:59,title:"TypeScript æ–‡æ¡£",description:"TypeScript è¯­è¨€æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://www.typescriptlang.org",icon:"ðŸ”·"},{id:60,title:"JavaScript MDN",description:"JavaScript è¯­è¨€å‚è€ƒæ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://developer.mozilla.org/javascript",icon:"ðŸ“œ"},{id:61,title:"Python å®˜æ–¹æ–‡æ¡£",description:"Python ç¼–ç¨‹è¯­è¨€å®˜æ–¹æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://docs.python.org",icon:"ðŸ"},{id:62,title:"Node.js æ–‡æ¡£",description:"Node.js è¿è¡Œæ—¶æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://nodejs.org",icon:"ðŸ“¦"},{id:63,title:"Git æ–‡æ¡£",description:"åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿ",category:"å¼€å‘å·¥å…·",url:"https://git-scm.com/doc",icon:"ðŸ“š"},{id:64,title:"NPM æ–‡æ¡£",description:"Node åŒ…ç®¡ç†å™¨æ–‡æ¡£",category:"å¼€å‘å·¥å…·",url:"https://docs.npmjs.com",icon:"ðŸ“¦"},{id:65,title:"Yarn æ–‡æ¡£",description:"å¿«é€Ÿã€å¯é ã€å®‰å…¨çš„ä¾èµ–ç®¡ç†",category:"å¼€å‘å·¥å…·",url:"https://yarnpkg.com",icon:"ðŸ§¶"},{id:66,title:"VS Code æ–‡æ¡£",description:"Visual Studio Code ç¼–è¾‘å™¨æ–‡æ¡£",category:"å¼€å‘å·¥å…·",url:"https://code.visualstudio.com/docs",icon:"ðŸ’»"},{id:67,title:"Lighthouse æ–‡æ¡£",description:"è‡ªåŠ¨åŒ–ç½‘ç«™è´¨é‡è¯„ä¼°å·¥å…·",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://developers.google.com/web/tools/lighthouse",icon:"ðŸ’¡"},{id:68,title:"Web Vitals",description:"ç½‘ç«™ç”¨æˆ·ä½“éªŒè´¨é‡æŒ‡æ ‡",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://web.dev/vitals",icon:"ðŸ“Š"},{id:69,title:"Bundlephobia",description:"æ£€æŸ¥ npm åŒ…å¤§å°å¯¹æ€§èƒ½çš„å½±å“",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://bundlephobia.com",icon:"ðŸ“¦"}],o=[...new Set(l.map(e=>e.category))],d=l.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.description.toLowerCase().includes(t.toLowerCase())||e.category.toLowerCase().includes(t.toLowerCase())),h=()=>{s(null)};return(0,p.jsxs)("div",{className:"documents-container",children:[(0,p.jsxs)("div",{className:"quotes-carousel",children:[(0,p.jsxs)("div",{className:"carousel-container",children:[(0,p.jsx)("button",{className:"carousel-btn prev-btn",onClick:()=>{c(e=>0===e?r.length-1:e-1)},children:"â€¹"}),(0,p.jsx)("div",{className:"quote-slide",children:(0,p.jsxs)("div",{className:"quote-content",children:[(0,p.jsx)("div",{className:"quote-icon",children:"ðŸ’­"}),(0,p.jsxs)("div",{className:"quote-text",children:[(0,p.jsxs)("p",{className:"quote-main",children:['"',r[i].text,'"']}),(0,p.jsxs)("div",{className:"quote-meta",children:[(0,p.jsxs)("span",{className:"quote-author",children:["â€” ",r[i].author]}),(0,p.jsx)("span",{className:"quote-category",children:r[i].category})]})]})]})}),(0,p.jsx)("button",{className:"carousel-btn next-btn",onClick:()=>{c(e=>e===r.length-1?0:e+1)},children:"â€º"})]}),(0,p.jsx)("div",{className:"carousel-indicators",children:r.map((e,s)=>(0,p.jsx)("button",{className:"indicator "+(s===i?"active":""),onClick:()=>c(s)},s))})]}),(0,p.jsxs)("div",{className:"documents-header",children:[(0,p.jsx)("h1",{children:"ðŸ“š å¼€å‘æ–‡æ¡£åº“"}),(0,p.jsxs)("p",{children:["ä¸“æ³¨äºŽå‰ç«¯å’ŒåŽç«¯å¼€å‘æ–‡æ¡£ - å…± ",l.length," ä¸ªèµ„æº"]}),(0,p.jsx)("div",{className:"search-section",children:(0,p.jsxs)("div",{className:"search-box",children:[(0,p.jsx)("span",{className:"search-icon",children:"ðŸ”"}),(0,p.jsx)("input",{type:"text",placeholder:"æœç´¢æ–‡æ¡£åç§°ã€æè¿°æˆ–ç±»åˆ«...",value:t,onChange:e=>n(e.target.value),className:"search-input"}),t&&(0,p.jsx)("button",{className:"clear-search",onClick:()=>n(""),children:"âœ•"})]})})]}),(0,p.jsxs)("div",{className:"documents-content",children:[o.map(e=>{const t=d.filter(s=>s.category===e);return 0===t.length?null:(0,p.jsxs)("div",{className:"category-section",children:[(0,p.jsxs)("h2",{className:"category-title",children:[e,(0,p.jsxs)("span",{className:"category-count",children:["(",t.length,")"]})]}),(0,p.jsx)("div",{className:"documents-grid",children:t.map(e=>(0,p.jsxs)("div",{className:"document-card",onClick:()=>(e=>{s(e)})(e),children:[(0,p.jsxs)("div",{className:"doc-header",children:[(0,p.jsx)("div",{className:"doc-icon",children:e.icon}),(0,p.jsxs)("div",{className:"doc-info",children:[(0,p.jsx)("h3",{className:"doc-title",children:e.title}),(0,p.jsx)("p",{className:"doc-description",children:e.description}),(0,p.jsx)("div",{className:"doc-category",children:e.category})]})]}),(0,p.jsx)("div",{className:"doc-footer",children:(0,p.jsx)("button",{className:"visit-button",children:"è®¿é—®ç½‘ç«™ â†’"})})]},e.id))})]},e)}),0===d.length&&(0,p.jsxs)("div",{className:"no-results",children:[(0,p.jsx)("div",{className:"no-results-icon",children:"ðŸ”"}),(0,p.jsx)("h3",{children:"æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£"}),(0,p.jsx)("p",{children:"å°è¯•è°ƒæ•´æœç´¢å…³é”®è¯"}),(0,p.jsx)("button",{className:"clear-search-btn",onClick:()=>n(""),children:"æ¸…é™¤æœç´¢"})]})]}),e&&(0,p.jsx)("div",{className:"modal-overlay",onClick:h,children:(0,p.jsxs)("div",{className:"modal-content doc-modal",onClick:e=>e.stopPropagation(),children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsxs)("div",{className:"modal-title-section",children:[(0,p.jsx)("span",{className:"doc-modal-icon",children:e.icon}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{children:e.title}),(0,p.jsx)("span",{className:"doc-category-badge",children:e.category})]})]}),(0,p.jsx)("button",{className:"close-btn",onClick:h,children:"Ã—"})]}),(0,p.jsxs)("div",{className:"modal-body",children:[(0,p.jsx)("p",{className:"doc-modal-description",children:e.description}),(0,p.jsxs)("div",{className:"doc-url-section",children:[(0,p.jsx)("label",{children:"ç½‘ç«™åœ°å€:"}),(0,p.jsx)("div",{className:"url-display",children:(0,p.jsx)("span",{className:"url-text",children:e.url})})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"cancel-btn",onClick:h,children:"å…³é—­"}),(0,p.jsx)("button",{className:"visit-site-btn",onClick:()=>{e&&window.open(e.url,"_blank")},children:"ðŸŒ è®¿é—®ç½‘ç«™"})]})]})})]})};class ge{static async getPosts(e={}){const{page:s=1,pageSize:t=20,sortBy:a="createdAt",sortOrder:n="desc",keyword:i="",tag:c="",authorId:r=""}=e,l=new(N().Query)("Post");if(l.equalTo("isPublic",!0),l.equalTo("status","published"),i){const e=new(N().Query)("Post");e.contains("title",i);const s=new(N().Query)("Post");s.contains("content",i),l=N().Query.or(e,s)}if(c&&l.equalTo("tags",c),r){const e=N().Object.createWithoutData("_User",r);l.equalTo("author",e)}return l.include("author"),l.limit(t),l.skip((s-1)*t),l.descending(a),l.find()}static async createPost(e){const s=N().User.current();if(!s)throw new Error("è¯·å…ˆç™»å½•");const t=new(N().Object.extend("Post"));return t.set("title",e.title),t.set("content",e.content),t.set("author",s),t.set("tags",e.tags||[]),t.set("isPublic",!1!==e.isPublic),t.set("status","published"),t.set("likes",0),t.set("views",0),t.set("commentCount",0),t.save()}static async getPostById(e){const s=new(N().Query)("Post");s.include("author");const t=await s.get(e);return t.increment("views",1),await t.save(),t}static async getComments(e,s={}){const{page:t=1,pageSize:a=50}=s,n=new(N().Query)("Comment"),i=N().Object.createWithoutData("Post",e);return n.equalTo("post",i),n.include("author"),n.include("parent"),n.ascending("createdAt"),n.limit(a),n.skip((t-1)*a),n.find()}static async addComment(e,s,t=null){const a=N().User.current();if(!a)throw new Error("è¯·å…ˆç™»å½•");const n=new(N().Object.extend("Comment")),i=N().Object.createWithoutData("Post",e);if(n.set("post",i),n.set("author",a),n.set("content",s),n.set("likes",0),t){const e=N().Object.createWithoutData("Comment",t);n.set("parent",e)}return i.increment("commentCount",1),i.set("lastCommentedAt",new Date),await i.save(),n.save()}static async toggleLike(e){const s=N().User.current();if(!s)throw new Error("è¯·å…ˆç™»å½•");const t=N().Object.extend("Like"),a=new(N().Query)("Like"),n=N().Object.createWithoutData("Post",e);a.equalTo("user",s),a.equalTo("post",n);const i=await a.first();if(i){await i.destroy();const s=await new(N().Query)("Post").get(e);return s.increment("likes",-1),await s.save(),{liked:!1}}{const a=new t;a.set("user",s),a.set("post",n),await a.save();const i=await new(N().Query)("Post").get(e);return i.increment("likes",1),await i.save(),{liked:!0}}}static async getPopularTags(e=10){const s=new(N().Query)("Post");s.equalTo("isPublic",!0),s.equalTo("status","published");const t=await s.find(),a={};return t.forEach(e=>{(e.get("tags")||[]).forEach(e=>{a[e]=(a[e]||0)+1})}),Object.entries(a).sort(([,e],[,s])=>s-e).slice(0,e).map(([e,s])=>({tag:e,count:s}))}}const xe=({onClose:e,onSuccess:s})=>{const[t,n]=(0,a.useState)({title:"",content:"",tags:"",isPublic:!0}),[i,c]=(0,a.useState)(!1),[r,l]=(0,a.useState)({}),[o,d]=(0,a.useState)({title:0,content:0}),[h,u]=(0,a.useState)([]),m=(0,a.useRef)(null),g=100,x=5e3,j=["JavaScript","React","ç®—æ³•","LeetCode","å‰ç«¯","é¢è¯•","TypeScript","Vue","CSS","Node.js","æ•°æ®åº“","è®¡ç®—æœºç½‘ç»œ","æ“ä½œç³»ç»Ÿ","æ•°æ®ç»“æž„"];(0,a.useEffect)(()=>{m.current&&(m.current.style.height="auto",m.current.style.height=m.current.scrollHeight+"px")},[t.content]),(0,a.useEffect)(()=>{if(t.title.length>5){const e=j.filter(e=>t.title.toLowerCase().includes(e.toLowerCase()));u(e.slice(0,3))}else u([])},[t.title]);const v=(e,s)=>{n(t=>({...t,[e]:s})),d(t=>({...t,[e]:s.length})),r[e]&&l(s=>({...s,[e]:""}))};return(0,p.jsx)("div",{className:"modal-overlay",onClick:e,children:(0,p.jsxs)("div",{className:"create-post-modal",onClick:e=>e.stopPropagation(),children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsxs)("div",{className:"header-content",children:[(0,p.jsx)("h3",{children:"âœï¸ å‘å¸ƒæ–°å¸–å­"}),(0,p.jsx)("p",{children:"åˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—å’Œç»éªŒ"})]}),(0,p.jsx)("button",{className:"close-btn",onClick:e,children:"âœ•"})]}),(0,p.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return t.title.trim()?t.title.length<5?e.title="æ ‡é¢˜è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦":t.title.length>g&&(e.title="æ ‡é¢˜ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦"):e.title="è¯·è¾“å…¥å¸–å­æ ‡é¢˜",t.content.trim()?t.content.length<10?e.content="å†…å®¹è‡³å°‘éœ€è¦10ä¸ªå­—ç¬¦":t.content.length>x&&(e.content="å†…å®¹ä¸èƒ½è¶…è¿‡5000ä¸ªå­—ç¬¦"):e.content="è¯·è¾“å…¥å¸–å­å†…å®¹",l(e),0===Object.keys(e).length})())if(N().User.current()){c(!0);try{const e=t.tags.split(",").map(e=>e.trim()).filter(e=>e).slice(0,5),a={title:t.title.trim(),content:t.content.trim(),tags:e,isPublic:t.isPublic},n=await ge.createPost(a);c(!1),s(n)}catch(e){console.error("å‘å¸ƒå¤±è´¥:",e),l({submit:e.message||"å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•"}),c(!1)}}else alert("è¯·å…ˆç™»å½•")},className:"post-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"post-title",children:["å¸–å­æ ‡é¢˜ *",(0,p.jsxs)("span",{className:"char-count",style:{color:(()=>{const e=o.title/g;return e>.9?"#ff6b6b":e>.7?"#ffa726":"#4ecdc4"})()},children:[o.title,"/",g]})]}),(0,p.jsx)("input",{id:"post-title",type:"text",placeholder:"è¯·è¾“å…¥æœ‰å¸å¼•åŠ›çš„æ ‡é¢˜...",value:t.title,onChange:e=>v("title",e.target.value),className:r.title?"error":"",maxLength:g}),r.title&&(0,p.jsx)("span",{className:"error-message",children:r.title})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"post-content",children:["å¸–å­å†…å®¹ *",(0,p.jsxs)("span",{className:"char-count",style:{color:(()=>{const e=o.content/x;return e>.9?"#ff6b6b":e>.7?"#ffa726":"#4ecdc4"})()},children:[o.content,"/",x]})]}),(0,p.jsx)("textarea",{ref:m,id:"post-content",placeholder:"è¯¦ç»†æè¿°ä½ çš„é—®é¢˜æˆ–åˆ†äº«ä½ çš„ç»éªŒ...ï¼ˆæ”¯æŒ Markdown æ ¼å¼ï¼‰",value:t.content,onChange:e=>v("content",e.target.value),className:r.content?"error":"",maxLength:x,rows:"6"}),r.content&&(0,p.jsx)("span",{className:"error-message",children:r.content}),(0,p.jsxs)("div",{className:"format-tips",children:[(0,p.jsx)("span",{className:"tip-title",children:"æ ¼å¼æç¤ºï¼š"}),(0,p.jsx)("span",{className:"tip-item",children:"**ç²—ä½“**"}),(0,p.jsx)("span",{className:"tip-item",children:"*æ–œä½“*"}),(0,p.jsx)("span",{className:"tip-item",children:"`ä»£ç `"}),(0,p.jsx)("span",{className:"tip-item",children:"- åˆ—è¡¨é¡¹"})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"post-tags",children:["æ ‡ç­¾",(0,p.jsx)("span",{className:"optional",children:"ï¼ˆå¯é€‰ï¼‰"})]}),(0,p.jsx)("input",{id:"post-tags",type:"text",placeholder:"è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆä¾‹å¦‚ï¼šJavaScript,ç®—æ³•,LeetCodeï¼‰",value:t.tags,onChange:e=>v("tags",e.target.value)}),h.length>0&&(0,p.jsxs)("div",{className:"tag-suggestions",children:[(0,p.jsx)("span",{className:"suggestions-label",children:"æŽ¨èæ ‡ç­¾ï¼š"}),h.map(e=>(0,p.jsx)("button",{type:"button",className:"tag-suggestion",onClick:()=>(e=>{const s=t.tags.split(",").map(e=>e.trim()).filter(e=>e);if(!s.includes(e)){const t=[...s,e].join(", ");v("tags",t)}})(e),children:e},e))]}),(0,p.jsx)("div",{className:"tags-hint",children:"æœ€å¤š5ä¸ªæ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ã€‚åˆé€‚çš„æ ‡ç­¾æœ‰åŠ©äºŽæ›´å¤šäººçœ‹åˆ°ä½ çš„å¸–å­ã€‚"})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{className:"checkbox-label",children:[(0,p.jsx)("input",{type:"checkbox",checked:t.isPublic,onChange:e=>v("isPublic",e.target.checked)}),(0,p.jsx)("span",{className:"checkmark"}),"å…¬å¼€å¸–å­ï¼ˆæ‰€æœ‰äººå¯è§ï¼‰"]}),(0,p.jsx)("div",{className:"privacy-hint",children:t.isPublic?"âœ… ä½ çš„å¸–å­å°†å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§":"ðŸ”’ åªæœ‰ä½ è‡ªå·±å¯ä»¥çœ‹åˆ°æ­¤å¸–å­"})]}),r.submit&&(0,p.jsxs)("div",{className:"submit-error",children:[(0,p.jsx)("span",{className:"error-icon",children:"âš ï¸"}),r.submit]}),(0,p.jsxs)("div",{className:"form-actions",children:[(0,p.jsx)("button",{type:"button",onClick:e,className:"cancel-btn",disabled:i,children:"å–æ¶ˆ"}),(0,p.jsx)("button",{type:"submit",className:"submit-btn",disabled:i,children:i?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"submit-spinner"}),"å‘å¸ƒä¸­..."]}):"ðŸš€ å‘å¸ƒå¸–å­"})]})]})]})})},pe=({onSearch:e,placeholder:s="æœç´¢å¸–å­æ ‡é¢˜æˆ–å†…å®¹..."})=>{const[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[r,l]=(0,a.useState)(!1),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{const s=setTimeout(()=>{e(t)},300);return()=>clearTimeout(s)},[t,e]);const d=s=>{n(s),l(!1),e(s)};return(0,p.jsxs)("div",{className:"search-bar",children:[(0,p.jsxs)("div",{className:"search-input-container "+(i?"focused":""),children:[(0,p.jsx)("div",{className:"search-icon",children:"ðŸ”"}),(0,p.jsx)("input",{ref:o,type:"text",placeholder:s,value:t,onChange:e=>{return s=e.target.value,n(s),void l(s.length>0);var s},onFocus:()=>{c(!0),t.length>0&&l(!0)},onBlur:()=>{c(!1),setTimeout(()=>l(!1),200)},onKeyDown:s=>{"Escape"===s.key?(l(!1),o.current?.blur()):"Enter"===s.key&&(l(!1),e(t))},className:"search-input"}),t&&(0,p.jsx)("button",{className:"clear-search",onClick:()=>{n(""),l(!1),e(""),o.current?.focus()},type:"button",children:"âœ•"}),r&&(0,p.jsxs)("div",{className:"search-suggestions",children:[(0,p.jsxs)("div",{className:"suggestions-header",children:[(0,p.jsx)("span",{className:"suggestions-title",children:"æœç´¢å»ºè®®"}),(0,p.jsx)("button",{className:"close-suggestions",onClick:()=>l(!1),children:"âœ•"})]}),(0,p.jsxs)("div",{className:"suggestions-list",children:[t.length>0&&(0,p.jsxs)("div",{className:"suggestion-item exact-match",onClick:()=>d(t),children:[(0,p.jsx)("span",{className:"suggestion-icon",children:"ðŸ”"}),(0,p.jsxs)("span",{className:"suggestion-text",children:['æœç´¢: "',t,'"']})]}),(0,p.jsxs)("div",{className:"suggestions-section",children:[(0,p.jsx)("div",{className:"section-title",children:"çƒ­é—¨æœç´¢"}),["JavaScript","React","ç®—æ³•","LeetCode","å‰ç«¯","é¢è¯•","TypeScript","Vue"].filter(e=>e.toLowerCase().includes(t.toLowerCase())).map((e,s)=>(0,p.jsxs)("div",{className:"suggestion-item",onClick:()=>d(e),children:[(0,p.jsx)("span",{className:"suggestion-icon",children:"ðŸ”¥"}),(0,p.jsx)("span",{className:"suggestion-text",children:e})]},s))]}),(0,p.jsxs)("div",{className:"search-tips",children:[(0,p.jsx)("div",{className:"tips-title",children:"æœç´¢æç¤º"}),(0,p.jsxs)("div",{className:"tips-list",children:[(0,p.jsxs)("div",{className:"tip-item",children:[(0,p.jsx)("span",{className:"tip-icon",children:"ðŸ’¡"}),(0,p.jsx)("span",{children:"æ”¯æŒæœç´¢å¸–å­æ ‡é¢˜ã€å†…å®¹å’Œæ ‡ç­¾"})]}),(0,p.jsxs)("div",{className:"tip-item",children:[(0,p.jsx)("span",{className:"tip-icon",children:"âŽ"}),(0,p.jsx)("span",{children:"æŒ‰ Enter é”®å¿«é€Ÿæœç´¢"})]}),(0,p.jsxs)("div",{className:"tip-item",children:[(0,p.jsx)("span",{className:"tip-icon",children:"âŽ‹"}),(0,p.jsx)("span",{children:"æŒ‰ ESC é”®æ¸…é™¤æœç´¢"})]})]})]})]})]})]}),t&&(0,p.jsxs)("div",{className:"search-stats",children:[(0,p.jsxs)("span",{className:"stats-text",children:["æ­£åœ¨æœç´¢: ",(0,p.jsxs)("strong",{children:['"',t,'"']})]}),(0,p.jsx)("button",{className:"advanced-search-btn",onClick:()=>l(!0),children:"é«˜çº§æœç´¢"})]})]})},je=({onTagClick:e,maxTags:s=20})=>{const[t,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[r,l]=(0,a.useState)(""),o=[{tag:"JavaScript",count:25,color:"#f7df1e"},{tag:"React",count:18,color:"#61dafb"},{tag:"ç®—æ³•",count:22,color:"#4ecdc4"},{tag:"LeetCode",count:20,color:"#ff6b6b"},{tag:"å‰ç«¯",count:15,color:"#667eea"},{tag:"é¢è¯•",count:12,color:"#f093fb"},{tag:"TypeScript",count:10,color:"#3178c6"},{tag:"Vue",count:8,color:"#41b883"},{tag:"CSS",count:6,color:"#264de4"},{tag:"Node.js",count:5,color:"#68a063"},{tag:"æ•°æ®åº“",count:7,color:"#ffa726"},{tag:"è®¡ç®—æœºç½‘ç»œ",count:4,color:"#26c6da"},{tag:"æ“ä½œç³»ç»Ÿ",count:3,color:"#ab47bc"},{tag:"æ•°æ®ç»“æž„",count:9,color:"#ec407a"},{tag:"Git",count:5,color:"#f4511e"}];(0,a.useEffect)(()=>{d()},[]);const d=async()=>{c(!0);try{const e=await ge.getPopularTags(s);if(e&&e.length>0){const s=e.map((e,s)=>({...e,color:h(s)}));n(s)}else n(o.slice(0,s))}catch(e){console.error("åŠ è½½çƒ­é—¨æ ‡ç­¾å¤±è´¥:",e),n(o.slice(0,s))}finally{c(!1)}},h=e=>{const s=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#f368e0","#ff9f43","#a55eea","#fd79a8","#e17055","#00b894","#00cec9","#0984e3","#6c5ce7","#b2bec3"];return s[e%s.length]},u=()=>{l(""),e("")};if(i)return(0,p.jsxs)("div",{className:"tag-cloud-loading",children:[(0,p.jsx)("div",{className:"loading-spinner"}),(0,p.jsx)("span",{children:"åŠ è½½æ ‡ç­¾ä¸­..."})]});const m=Math.max(...t.map(e=>e.count)),g=t.reduce((e,s)=>e+s.count,0);return(0,p.jsxs)("div",{className:"tag-cloud-container",children:[(0,p.jsx)("div",{className:"tag-cloud-header",children:(0,p.jsxs)("div",{className:"tag-cloud-stats",children:[(0,p.jsxs)("span",{className:"stats-text",children:[t.length," ä¸ªæ ‡ç­¾ â€¢ ",g," ä¸ªå¸–å­"]}),r&&(0,p.jsx)("button",{className:"clear-filter-btn",onClick:u,children:"æ¸…é™¤ç­›é€‰"})]})}),(0,p.jsx)("div",{className:"tag-cloud",children:t.map(({tag:s,count:t,color:a})=>{const n=((e,s)=>{const t=["xs","sm","md","lg","xl"],a=e/s;return a>.8?t[4]:a>.6?t[3]:a>.4?t[2]:a>.2?t[1]:t[0]})(t,m),i=s===r;return(0,p.jsxs)("span",{className:`tag ${n} ${i?"selected":""}`,style:{"--tag-color":a,"--tag-bg-color":i?a:`${a}20`,"--tag-border-color":i?a:`${a}40`},onClick:()=>(s=>{l(s===r?"":s),e(s===r?"":s)})(s),title:`${s} - ${t} ä¸ªå¸–å­`,children:[(0,p.jsx)("span",{className:"tag-text",children:s}),(0,p.jsx)("span",{className:"tag-count",children:t})]},s)})}),r&&(0,p.jsx)("div",{className:"selected-tag-info",children:(0,p.jsxs)("span",{className:"selected-tag-badge",children:[(0,p.jsxs)("span",{className:"selected-tag-text",children:["å·²é€‰æ‹©: ",r]}),(0,p.jsx)("button",{className:"remove-selection",onClick:u,children:"âœ•"})]})}),(0,p.jsx)("div",{className:"tag-cloud-footer",children:(0,p.jsxs)("div",{className:"tag-cloud-tips",children:[(0,p.jsx)("span",{className:"tip-icon",children:"ðŸ’¡"}),(0,p.jsx)("span",{className:"tip-text",children:"ç‚¹å‡»æ ‡ç­¾ç­›é€‰ç›¸å…³å¸–å­"})]})})]})},ve=()=>{const[e,s]=(0,a.useState)({totalPosts:0,totalComments:0,totalLikes:0,activeUsers:0,todayPosts:0,trendingTags:[]}),[t,n]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null);(0,a.useEffect)(()=>{r();const e=setInterval(r,3e5);return()=>clearInterval(e)},[]);const r=async()=>{n(!0);try{const e=await new(N().Query)("Post").equalTo("status","published").count().catch(()=>0),t=await new(N().Query)("Comment").count().catch(()=>0),a=await new(N().Query)("Like").count().catch(()=>0),n=new Date;n.setHours(0,0,0,0);const i=await new(N().Query)("Post").greaterThanOrEqualTo("createdAt",n).count().catch(()=>0),r=new Date;r.setDate(r.getDate()-7);const l=await new(N().Query)("Post").greaterThanOrEqualTo("createdAt",r).distinct("author").count().catch(()=>0),o=new(N().Query)("Post"),d=await o.equalTo("status","published").limit(1e3).find().catch(()=>[]),h={};d.forEach(e=>{(e.get("tags")||[]).forEach(e=>{h[e]=(h[e]||0)+1})});const u=Object.entries(h).sort(([,e],[,s])=>s-e).slice(0,5).map(([e,s])=>({tag:e,count:s}));s({totalPosts:e,totalComments:t,totalLikes:a,activeUsers:l,todayPosts:i,trendingTags:u}),c(new Date)}catch(e){console.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",e),s({totalPosts:0,totalComments:0,totalLikes:0,activeUsers:0,todayPosts:0,trendingTags:[]})}finally{n(!1)}},l=e=>e>=1e4?(e/1e4).toFixed(1)+"ä¸‡":e>=1e3?(e/1e3).toFixed(1)+"åƒ":e.toString();return t?(0,p.jsxs)("div",{className:"community-stats",children:[(0,p.jsxs)("div",{className:"stats-header",children:[(0,p.jsx)("h4",{children:"ðŸ“Š ç¤¾åŒºç»Ÿè®¡"}),(0,p.jsx)("button",{className:"refresh-btn",onClick:r,children:"ðŸ”„"})]}),(0,p.jsxs)("div",{className:"stats-loading",children:[(0,p.jsx)("div",{className:"loading-spinner"}),(0,p.jsx)("span",{children:"åŠ è½½ç»Ÿè®¡ä¸­..."})]})]}):(0,p.jsxs)("div",{className:"community-stats",children:[(0,p.jsxs)("div",{className:"stats-header",children:[(0,p.jsx)("h4",{children:"ðŸ“Š ç¤¾åŒºç»Ÿè®¡"}),(0,p.jsxs)("div",{className:"header-actions",children:[i&&(0,p.jsxs)("span",{className:"update-time",children:["æ›´æ–°äºŽ ",i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),(0,p.jsx)("button",{className:"refresh-btn",onClick:r,title:"åˆ·æ–°æ•°æ®",children:"ðŸ”„"})]})]}),(0,p.jsxs)("div",{className:"stats-grid",children:[(0,p.jsxs)("div",{className:"stat-card primary",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:l(e.totalPosts)}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»å¸–å­"}),(0,p.jsxs)("div",{className:"stat-subtext",children:["+",e.todayPosts," ä»Šæ—¥"]})]})]}),(0,p.jsxs)("div",{className:"stat-card success",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ’¬"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:l(e.totalComments)}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»è¯„è®º"}),(0,p.jsx)("div",{className:"stat-subtext",children:"äº’åŠ¨æ´»è·ƒ"})]})]}),(0,p.jsxs)("div",{className:"stat-card warning",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ‘"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:l(e.totalLikes)}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»ç‚¹èµž"}),(0,p.jsx)("div",{className:"stat-subtext",children:"ç¤¾åŒºè®¤å¯"})]})]}),(0,p.jsxs)("div",{className:"stat-card info",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ‘¥"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:l(e.activeUsers)}),(0,p.jsx)("div",{className:"stat-label",children:"æ´»è·ƒç”¨æˆ·"}),(0,p.jsx)("div",{className:"stat-subtext",children:"æœ€è¿‘7å¤©"})]})]})]}),e.trendingTags.length>0&&(0,p.jsxs)("div",{className:"trending-tags",children:[(0,p.jsx)("h5",{children:"ðŸ”¥ çƒ­é—¨æ ‡ç­¾"}),(0,p.jsx)("div",{className:"tags-list",children:e.trendingTags.map(({tag:e,count:s},t)=>(0,p.jsxs)("div",{className:"trending-tag",children:[(0,p.jsxs)("span",{className:"tag-rank",children:["#",t+1]}),(0,p.jsx)("span",{className:"tag-name",children:e}),(0,p.jsx)("span",{className:"tag-count",children:s})]},e))})]}),(0,p.jsx)("div",{className:"community-health",children:(0,p.jsxs)("div",{className:"health-indicator",children:[(0,p.jsx)("div",{className:"health-label",children:"ç¤¾åŒºæ´»è·ƒåº¦"}),(0,p.jsx)("div",{className:"health-bar",children:(0,p.jsx)("div",{className:"health-fill",style:{width:`${Math.min(e.todayPosts/10*100,100)}%`,backgroundColor:e.todayPosts>=5?"#4ecdc4":e.todayPosts>=2?"#ffa726":"#ff6b6b"}})}),(0,p.jsx)("div",{className:"health-status",children:e.todayPosts>=5?"ðŸ”¥ éžå¸¸æ´»è·ƒ":e.todayPosts>=2?"ðŸ’ª æ´»è·ƒ":"ðŸ˜´ å®‰é™"})]})})]})},Ne=e=>{if(!e)return"åˆšåˆš";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"åˆšåˆš":t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<7?`${n}å¤©å‰`:new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})},ye=({comment:e,onReply:s,onUpdate:t})=>{const[n,i]=(0,a.useState)(e.get("likes")||0),[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)(e.get("content")||""),[g,x]=(0,a.useState)(!1),j=()=>{const s=N().User.current();return s&&e.get("author")?.id===s.id},v=()=>{s(e)};return(0,p.jsxs)("div",{className:"comment-item",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,p.jsxs)("div",{className:"comment-header",children:[(0,p.jsxs)("div",{className:"comment-author",children:[(0,p.jsx)("img",{src:e.get("author")?.get("avatar")||"/default-avatar.png",alt:"ç”¨æˆ·å¤´åƒ",className:"comment-avatar"}),(0,p.jsxs)("div",{className:"author-info",children:[(0,p.jsx)("span",{className:"author-name",children:e.get("author")?.get("username")||"åŒ¿åç”¨æˆ·"}),j()&&(0,p.jsx)("span",{className:"author-badge",children:"ä½œè€…"}),(0,p.jsx)("span",{className:"comment-time",children:Ne(e.get("createdAt"))})]})]}),l&&(0,p.jsxs)("div",{className:"comment-actions",children:[(0,p.jsx)("button",{className:"action-btn reply-btn",onClick:v,title:"å›žå¤",children:"â†©ï¸"}),j()&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{className:"action-btn edit-btn",onClick:()=>{h(!0),m(e.get("content")||"")},title:"ç¼–è¾‘",children:"âœï¸"}),(0,p.jsx)("button",{className:"action-btn delete-btn",onClick:async()=>{if(window.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{t()}catch(e){console.error("åˆ é™¤è¯„è®ºå¤±è´¥:",e),alert("åˆ é™¤è¯„è®ºå¤±è´¥: "+e.message)}},title:"åˆ é™¤",children:"ðŸ—‘ï¸"})]})]})]}),(0,p.jsx)("div",{className:"comment-content",children:d?(0,p.jsxs)("div",{className:"edit-comment",children:[(0,p.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),rows:"3",className:"edit-textarea",maxLength:"1000"}),(0,p.jsxs)("div",{className:"edit-actions",children:[(0,p.jsx)("button",{onClick:()=>{h(!1),m(e.get("content")||"")},className:"cancel-edit-btn",disabled:g,children:"å–æ¶ˆ"}),(0,p.jsx)("button",{onClick:async()=>{if(u.trim()){x(!0);try{h(!1),t()}catch(e){console.error("æ›´æ–°è¯„è®ºå¤±è´¥:",e),alert("æ›´æ–°è¯„è®ºå¤±è´¥: "+e.message)}finally{x(!1)}}},className:"save-edit-btn",disabled:!u.trim()||g,children:g?"ä¿å­˜ä¸­...":"ä¿å­˜"})]})]}):(0,p.jsx)("div",{className:"comment-text",dangerouslySetInnerHTML:{__html:(e.get("content")||"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}})}),(0,p.jsxs)("div",{className:"comment-footer",children:[(0,p.jsxs)("button",{className:"like-btn "+(c?"liked":""),onClick:async()=>{try{const s=await ge.toggleLike(e.id,"comment");i(s.liked?n+1:Math.max(0,n-1)),r(s.liked)}catch(e){console.error("ç‚¹èµžè¯„è®ºå¤±è´¥:",e)}},children:[(0,p.jsx)("span",{className:"like-icon",children:"ðŸ‘"}),(0,p.jsx)("span",{className:"like-count",children:n})]}),(0,p.jsx)("button",{className:"reply-footer-btn",onClick:v,children:"å›žå¤"})]}),e.get("parent")&&(0,p.jsxs)("div",{className:"reply-indicator",children:["å›žå¤ ",(0,p.jsxs)("span",{className:"reply-to",children:["@",e.get("parent")?.get("author")?.get("username")||"ç”¨æˆ·"]})]})]})},fe=({postId:e})=>{const[s,t]=(0,a.useState)([]),[n,i]=(0,a.useState)(""),[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),[d,h]=(0,a.useState)("newest"),[u,m]=(0,a.useState)(null),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{x()},[e,d]);const x=async()=>{r(!0);try{const s=[...await ge.getComments(e)].sort((e,s)=>{switch(d){case"oldest":return new Date(e.get("createdAt"))-new Date(s.get("createdAt"));case"popular":return(s.get("likes")||0)-(e.get("likes")||0);default:return new Date(s.get("createdAt"))-new Date(e.get("createdAt"))}});t(s)}catch(e){console.error("åŠ è½½è¯„è®ºå¤±è´¥:",e)}finally{r(!1)}},j=async()=>{if(n.trim())if(N().User.current()){o(!0);try{let s=null;u&&(s=u.id),await ge.addComment(e,n,s),i(""),m(null),await x(),y("è¯„è®ºå‘å¸ƒæˆåŠŸï¼")}catch(e){console.error("å‘å¸ƒè¯„è®ºå¤±è´¥:",e),alert("å‘å¸ƒè¯„è®ºå¤±è´¥: "+e.message)}finally{o(!1)}}else alert("è¯·å…ˆç™»å½•åŽå†è¯„è®º")},v=e=>{m(e),i(`@${e.get("author")?.get("username")||"ç”¨æˆ·"} `),g.current?.focus()},y=e=>{console.log(e)};return(0,p.jsxs)("div",{className:"comment-section",children:[(0,p.jsxs)("div",{className:"comment-header",children:[(0,p.jsxs)("h4",{className:"comment-title",children:["ðŸ’¬ ",(()=>{const e=s.length;return 0===e?"æš‚æ— è¯„è®º":1===e?"1 æ¡è¯„è®º":`${e} æ¡è¯„è®º`})()]}),(0,p.jsxs)("div",{className:"comment-controls",children:[(0,p.jsxs)("select",{value:d,onChange:e=>h(e.target.value),className:"sort-select",children:[(0,p.jsx)("option",{value:"newest",children:"æœ€æ–°"}),(0,p.jsx)("option",{value:"oldest",children:"æœ€æ—©"}),(0,p.jsx)("option",{value:"popular",children:"æœ€çƒ­"})]}),(0,p.jsx)("button",{className:"refresh-comments",onClick:x,disabled:c,children:"ðŸ”„"})]})]}),(0,p.jsxs)("div",{className:"comment-input-section",children:[u&&(0,p.jsxs)("div",{className:"reply-indicator",children:[(0,p.jsxs)("span",{children:["å›žå¤ @",u.get("author")?.get("username")||"ç”¨æˆ·"]}),(0,p.jsx)("button",{onClick:()=>{m(null),i("")},children:"å–æ¶ˆ"})]}),(0,p.jsxs)("div",{className:"comment-input-wrapper",children:[(0,p.jsx)("textarea",{ref:g,value:n,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&j()},placeholder:u?"å†™ä¸‹ä½ çš„å›žå¤...":"å†™ä¸‹ä½ çš„è¯„è®º...",rows:"3",className:"comment-textarea",maxLength:"1000"}),(0,p.jsxs)("div",{className:"comment-input-footer",children:[(0,p.jsxs)("div",{className:"char-count",children:[n.length,"/1000"]}),(0,p.jsx)("button",{onClick:j,disabled:!n.trim()||l,className:"submit-comment-btn",children:l?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"submit-spinner"}),"å‘å¸ƒä¸­..."]}):"å‘å¸ƒè¯„è®º"})]})]}),(0,p.jsxs)("div",{className:"comment-tips",children:[(0,p.jsx)("span",{className:"tip",children:"ðŸ’¡ æ”¯æŒ Markdown è¯­æ³•"}),(0,p.jsx)("span",{className:"tip",children:"âŽ + Ctrl å¿«é€Ÿå‘å¸ƒ"})]})]}),(0,p.jsx)("div",{className:"comments-list",children:c?(0,p.jsxs)("div",{className:"comments-loading",children:[(0,p.jsx)("div",{className:"loading-spinner"}),(0,p.jsx)("span",{children:"åŠ è½½è¯„è®ºä¸­..."})]}):0===s.length?(0,p.jsxs)("div",{className:"no-comments",children:[(0,p.jsx)("div",{className:"no-comments-icon",children:"ðŸ’¬"}),(0,p.jsx)("h5",{children:"è¿˜æ²¡æœ‰è¯„è®º"}),(0,p.jsx)("p",{children:"æˆä¸ºç¬¬ä¸€ä¸ªè¯„è®ºçš„äººå§ï¼"})]}):s.map(e=>(0,p.jsx)(ye,{comment:e,onReply:v,onUpdate:x},e.id))})]})},we=e=>{if(!e)return"åˆšåˆš";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"åˆšåˆš":t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<7?`${n}å¤©å‰`:new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},be=({post:e})=>{const[s,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(e.get("likes")||0),[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(e.get("views")||0),d=e=>{const s=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43"];return s[e%s.length]};return(0,p.jsxs)("div",{className:"post-card",children:[(0,p.jsxs)("div",{className:"post-header",children:[(0,p.jsxs)("div",{className:"author-section",children:[(0,p.jsx)("img",{src:e.get("author")?.get("avatar")||"/default-avatar.png",alt:"ç”¨æˆ·å¤´åƒ",className:"author-avatar",style:{width:"40px",height:"40px"}}),(0,p.jsxs)("div",{className:"author-info",children:[(0,p.jsx)("div",{className:"author-name",children:e.get("author")?.get("username")||"åŒ¿åç”¨æˆ·"}),(0,p.jsxs)("div",{className:"post-meta",children:[(0,p.jsx)("span",{className:"post-time",children:we(e.get("createdAt"))}),e.get("isPinned")&&(0,p.jsx)("span",{className:"pinned-badge",children:"ðŸ“Œ ç½®é¡¶"})]})]})]}),(0,p.jsx)("div",{className:"post-status",children:e.get("difficulty")&&(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(()=>{switch(e.get("difficulty")||"medium"){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}})()},children:"easy"===e.get("difficulty")?"ç®€å•":"medium"===e.get("difficulty")?"ä¸­ç­‰":"å›°éš¾"})})]}),(0,p.jsxs)("div",{className:"post-content",children:[(0,p.jsx)("h3",{className:"post-title",children:e.get("title")}),(0,p.jsx)("div",{className:"post-body",dangerouslySetInnerHTML:{__html:(e.get("content")||"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}}),(e.get("content")||"").length>150&&!s&&(0,p.jsx)("button",{className:"read-more-btn",onClick:()=>t(!0),children:"é˜…è¯»å…¨æ–‡"})]}),e.get("tags")&&e.get("tags").length>0&&(0,p.jsx)("div",{className:"post-tags",children:e.get("tags").map((e,s)=>(0,p.jsxs)("span",{className:"post-tag",style:{backgroundColor:d(s)+"20",color:d(s),borderColor:d(s)+"40"},children:["#",e]},e))}),(0,p.jsxs)("div",{className:"post-footer",children:[(0,p.jsxs)("div",{className:"post-stats",children:[(0,p.jsxs)("button",{className:"stat-btn like-btn "+(c?"liked":""),onClick:async()=>{try{const s=await ge.toggleLike(e.id);i(s.liked?n+1:Math.max(0,n-1)),r(s.liked)}catch(e){console.error("ç‚¹èµžå¤±è´¥:",e)}},children:[(0,p.jsx)("span",{className:"stat-icon",children:"ðŸ‘"}),(0,p.jsx)("span",{className:"stat-count",children:n})]}),(0,p.jsxs)("button",{className:"stat-btn comment-btn "+(s?"active":""),onClick:()=>{t(!s),s||o(e=>e+1)},children:[(0,p.jsx)("span",{className:"stat-icon",children:"ðŸ’¬"}),(0,p.jsx)("span",{className:"stat-count",children:e.get("commentCount")||0})]}),(0,p.jsxs)("div",{className:"stat-btn view-btn",children:[(0,p.jsx)("span",{className:"stat-icon",children:"ðŸ‘ï¸"}),(0,p.jsx)("span",{className:"stat-count",children:l})]})]}),(0,p.jsxs)("div",{className:"post-actions",children:[(0,p.jsx)("button",{className:"action-btn share-btn",children:"ðŸ”— åˆ†äº«"}),(0,p.jsx)("button",{className:"action-btn bookmark-btn",children:"ðŸ“Œ æ”¶è—"})]})]}),s&&(0,p.jsx)(fe,{postId:e.id})]})},Ce=()=>{const[e,s]=(0,a.useState)("latest"),[t,n]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[r,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)(""),[m,g]=(0,a.useState)({page:1,pageSize:20,hasMore:!0});(0,a.useEffect)(()=>{x(!0)},[e]),(0,a.useEffect)(()=>{if(""===h.trim())n(i);else{const e=i.filter(e=>e.get("title")?.toLowerCase().includes(h.toLowerCase()));n(e)}},[h,i]);const x=async(s=!1)=>{if(!r){l(!0);try{const t=s?1:m.page,a={page:t,pageSize:m.pageSize,sortBy:"latest"===e?"createdAt":"likes",sortOrder:"desc"},r=await ge.getPosts(a);if(s)c(r),n(r);else{const e=[...i,...r];if(c(e),""===h.trim())n(e);else{const s=e.filter(e=>e.get("title")?.toLowerCase().includes(h.toLowerCase()));n(s)}}g(e=>({...e,page:t,hasMore:r.length===m.pageSize}))}catch(e){console.error("åŠ è½½å¸–å­å¤±è´¥:",e)}finally{l(!1)}}},j=e=>{u(e)};return(0,p.jsx)("section",{className:"community-section",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsx)("div",{className:"community-header",children:(0,p.jsxs)("div",{className:"header-content",children:[(0,p.jsxs)("div",{className:"header-text",children:[(0,p.jsx)("h2",{children:"å­¦ä¹ ç¤¾åŒº"}),(0,p.jsx)("p",{children:"ä¸Žå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«åˆ·é¢˜ç»éªŒ"})]}),(0,p.jsxs)("button",{className:"create-post-btn modern-btn primary",onClick:()=>d(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"âœï¸"}),"å‘å¸ƒå¸–å­"]})]})}),(0,p.jsxs)("div",{className:"community-toolbar",children:[(0,p.jsx)("div",{className:"toolbar-left",children:(0,p.jsx)(pe,{onSearch:j,placeholder:"æœç´¢å¸–å­æ ‡é¢˜..."})}),(0,p.jsx)("div",{className:"toolbar-right",children:(0,p.jsx)(ve,{})})]}),h&&(0,p.jsx)("div",{className:"search-results-info",children:(0,p.jsxs)("div",{className:"results-stats",children:[(()=>{if(""===h.trim())return`å…± ${i.length} ä¸ªå¸–å­`;{const e=i.filter(e=>e.get("title")?.toLowerCase().includes(h.toLowerCase())).length;return`æ‰¾åˆ° ${t.length} ä¸ªåŒ¹é…æ ‡é¢˜çš„å¸–å­ï¼ˆå…± ${e} ä¸ªï¼‰`}})(),h&&(0,p.jsxs)("span",{className:"search-keyword",children:["æœç´¢å…³é”®è¯: ",(0,p.jsxs)("strong",{children:['"',h,'"']})]})]})}),(0,p.jsxs)("div",{className:"community-layout",children:[(0,p.jsxs)("aside",{className:"community-sidebar",children:[(0,p.jsxs)("div",{className:"sidebar-section",children:[(0,p.jsx)("h3",{children:"çƒ­é—¨æ ‡ç­¾"}),(0,p.jsx)(je,{onTagClick:e=>j(e)})]}),(0,p.jsxs)("div",{className:"sidebar-section",children:[(0,p.jsx)("h3",{children:"ç¤¾åŒºæŒ‡å—"}),(0,p.jsxs)("div",{className:"community-guidelines",children:[(0,p.jsx)("p",{children:"ðŸ’¡ åˆ†äº«å­¦ä¹ å¿ƒå¾—"}),(0,p.jsx)("p",{children:"ðŸ¤ äº’ç›¸å¸®åŠ©è§£ç­”"}),(0,p.jsx)("p",{children:"ðŸŽ¯ ä¿æŒå†…å®¹ç›¸å…³"}),(0,p.jsx)("p",{children:"ðŸ‘ å°Šé‡ä»–äººè§‚ç‚¹"})]})]})]}),(0,p.jsxs)("main",{className:"community-main",children:[(0,p.jsxs)("div",{className:"community-tabs",children:[(0,p.jsxs)("button",{className:"modern-tab "+("latest"===e?"active":""),onClick:()=>s("latest"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ†•"}),(0,p.jsx)("span",{className:"tab-text",children:"æœ€æ–°å¸–å­"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("popular"===e?"active":""),onClick:()=>s("popular"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ”¥"}),(0,p.jsx)("span",{className:"tab-text",children:"çƒ­é—¨å†…å®¹"})]})]}),(0,p.jsxs)("div",{className:"post-list",children:[r&&(0,p.jsxs)("div",{className:"loading",children:[(0,p.jsx)("div",{className:"spinner"}),(0,p.jsx)("span",{children:"åŠ è½½ä¸­..."})]}),t.map(e=>(0,p.jsx)(be,{post:e},e.id)),!r&&0===t.length&&(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:h?"ðŸ”":"ðŸ’¬"}),(0,p.jsx)("h3",{children:h?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¸–å­":"æš‚æ— å¸–å­"}),(0,p.jsx)("p",{children:h?`æ²¡æœ‰æ ‡é¢˜åŒ…å« "${h}" çš„å¸–å­ï¼Œå°è¯•è°ƒæ•´æœç´¢å…³é”®è¯`:"æˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«å­¦ä¹ å¿ƒå¾—çš„äººå§ï¼"}),h&&(0,p.jsx)("button",{onClick:()=>j(""),className:"clear-search-btn",children:"æ˜¾ç¤ºæ‰€æœ‰å¸–å­"})]})]}),m.hasMore&&t.length>0&&""===h&&(0,p.jsx)("div",{className:"load-more-section",children:(0,p.jsx)("button",{onClick:()=>{!r&&m.hasMore&&x(!1)},disabled:r,className:"load-more-btn",children:r?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤š"})})]})]}),o&&(0,p.jsx)(xe,{onClose:()=>d(!1),onSuccess:e=>{c(s=>[e,...s]),(""===h.trim()||e.get("title")?.toLowerCase().includes(h.toLowerCase()))&&n(s=>[e,...s]),d(!1)}})]})})},Se=new c.E({defaultOptions:{queries:{staleTime:3e5,cacheTime:6e5,retry:1}}}),ke=()=>{const e=(0,i.Zp)(),[s,t]=(0,a.useState)(""),[n,c]=(0,a.useState)([]),[l,o]=(0,a.useState)([]),[d,h]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[g,x]=(0,a.useState)(!1),[v,C]=(0,a.useState)(""),[S,k]=(0,a.useState)("categories"),[A,E]=(0,a.useState)(new Date),[q,$]=(0,a.useState)(!1),[P,I]=(0,a.useState)(""),[Q,O]=(0,a.useState)(""),[R,U]=(0,a.useState)(!1),[M,B]=(0,a.useState)(!1),[F,_]=(0,a.useState)(null),[W,z]=(0,a.useState)(!1),[K,oe]=(0,a.useState)(7),[de,he]=(0,a.useState)([]),[ge,xe]=(0,a.useState)(!1),[pe,je]=(0,a.useState)(null),[ve,Ne]=(0,a.useState)(null),[ye,fe]=(0,a.useState)({x:0,y:0}),[we,be]=(0,a.useState)(!1),ke=(0,a.useRef)(null),[Ae,Ee]=(0,a.useState)(!0),[qe,Le]=(0,a.useState)({}),[De,Te]=(0,a.useState)([]),[$e,Pe]=(0,a.useState)(!1),[Ie,Qe]=(0,a.useState)({supported:!1,activated:!1,error:null}),[Oe,Re]=(0,a.useState)({cacheLimit:T.getCacheLimit(),autoCache:!0}),Ue=(0,a.useRef)({}),Me=(0,a.useCallback)(async()=>{if(pe)try{if(console.log("ðŸ”„ é€šè¿‡ Service Worker ç¼“å­˜é¢˜ç›®..."),x(!0),T.setCacheLimit(Oe.cacheLimit),await T.cacheQuestions(l)){const e=await T.getCacheStatus();Le(e),setTimeout(()=>C(""),3e3)}}catch(e){console.error("é¢„ç¼“å­˜å¤±è´¥:",e),C("ç¼“å­˜å¤±è´¥: "+e.message)}finally{x(!1)}},[pe,l,Oe.cacheLimit]),Be=()=>(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"ðŸ“¦ ç¦»çº¿ç¼“å­˜è®¾ç½®"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>_e(!1),children:"Ã—"})]}),(0,p.jsxs)("div",{className:"cache-settings-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"cacheLimit",children:["ç¼“å­˜é¢˜ç›®æ•°é‡: ",Oe.cacheLimit," é¢˜"]}),(0,p.jsx)("input",{id:"cacheLimit",type:"range",min:"10",max:"100",step:"10",value:Oe.cacheLimit,onChange:e=>Re(s=>({...s,cacheLimit:parseInt(e.target.value)})),className:"cache-limit-slider"}),(0,p.jsxs)("div",{className:"range-labels",children:[(0,p.jsx)("span",{children:"10é¢˜"}),(0,p.jsx)("span",{children:"100é¢˜"})]}),(0,p.jsxs)("div",{className:"cache-hint",children:["å½“å‰é…ç½®: æœ€å¤šç¼“å­˜ ",Oe.cacheLimit," é“é¢˜ç›®ä¾›ç¦»çº¿ä½¿ç”¨"]})]}),(0,p.jsxs)("div",{className:"form-actions",children:[(0,p.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>_e(!1),children:"å–æ¶ˆ"}),(0,p.jsx)("button",{type:"button",className:"submit-btn",onClick:()=>{T.setCacheLimit(Oe.cacheLimit),_e(!1),setTimeout(()=>C(""),3e3)},children:"ä¿å­˜è®¾ç½®"})]})]})]})}),[Fe,_e]=(0,a.useState)(!1),We=(0,a.useCallback)(async()=>{try{const e=await T.getCachedQuestions();Te(e.questions),Pe(!0),console.log("ðŸ“¦ åŠ è½½ç¦»çº¿æ•°æ®:",e.questions.length)}catch(e){console.error("åŠ è½½ç¦»çº¿æ•°æ®å¤±è´¥:",e)}},[]),ze=(0,a.useCallback)(async()=>{x(!0),C("æ­£åœ¨ç¼“å­˜é¢˜ç›®æ•°æ®...");try{await Me(),Le(T.getCacheStatus())}catch(e){C("ç¼“å­˜å¤±è´¥: "+e.message)}finally{x(!1)}},[Me]);(0,a.useEffect)(()=>{const e=()=>{Ee(!0),Pe(!1)},s=()=>{Ee(!1),T.getCacheStatus().hasCache&&We()};return y.addEventListener("online",e),y.addEventListener("offline",s),Ee(y.isOnlineMode()),Le(T.getCacheStatus()),()=>{y.removeEventListener("online",e),y.removeEventListener("offline",s)}},[We]),(0,a.useEffect)(()=>{const e=N().User.current();je(e),e?y.shouldUseOfflineData()?(console.log("ðŸš€ å¯åŠ¨ç¦»çº¿æ¨¡å¼"),Pe(!0),We(),h(!1)):Ze():h(!1)},[]),(0,a.useEffect)(()=>{if(!T.isSupported)return;const e=e=>{const{count:s,timestamp:t}=e.detail;C(""),Le(e=>({...e,hasCache:!0,count:s}))},s=e=>{Qe(s=>({...s,activated:!0,version:e.detail.version})),console.log("ðŸš€ Service Worker å·²æ¿€æ´»:",e.detail.version)};return T.addEventListener("cacheUpdated",e),T.addEventListener("swActivated",s),Qe(e=>({...e,supported:T.isSupported})),()=>{T.removeEventListener("cacheUpdated",e),T.removeEventListener("swActivated",s)}},[]),(0,a.useEffect)(()=>{if(pe&&l.length>0){const e=setTimeout(()=>{Me()},3e3);return()=>clearTimeout(e)}},[pe,l,Me]);const Ve=(0,a.useCallback)(async()=>{console.log("ðŸ”„ æ‰‹åŠ¨åˆ·æ–°æ•°æ®..."),C("åˆ·æ–°æ•°æ®ä¸­...");try{console.log("æ¸…ç†æ‰€æœ‰ç¼“å­˜"),console.log("æ¸…ç†åˆ†ç±»ç¼“å­˜"),await Ze(),C("æ•°æ®åˆ·æ–°æˆåŠŸï¼"),setTimeout(()=>C(""),3e3)}catch(e){console.error("åˆ·æ–°æ•°æ®å¤±è´¥:",e),C("åˆ·æ–°å¤±è´¥: "+e.message),setTimeout(()=>C(""),5e3)}},[]);(0,a.useEffect)(()=>{const e=()=>{console.log("ðŸ“ æ£€æµ‹åˆ°é¢˜ç›®åˆ›å»ºï¼Œè‡ªåŠ¨åˆ·æ–°æ•°æ®..."),setTimeout(()=>{Ve()},1e3)};return window.addEventListener("questionCreated",e),()=>{window.removeEventListener("questionCreated",e)}},[Ve]),(0,a.useEffect)(()=>{const e=N().User.current();je(e),e?Ze():h(!1)},[]);const Je=async e=>{if(e.preventDefault(),pe)if(P.trim()){U(!0);try{const e=await D({name:P.trim(),description:Q.trim()||void 0});c(s=>[e,...s]),I(""),O(""),$(!1),C(`åˆ†ç±» "${e.name}" åˆ›å»ºæˆåŠŸï¼`),setTimeout(()=>C(""),3e3)}catch(e){console.error("åˆ›å»ºåˆ†ç±»å¤±è´¥:",e),C("åˆ›å»ºåˆ†ç±»å¤±è´¥: "+(e.message||"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"))}finally{U(!1)}}else alert("è¯·è¾“å…¥åˆ†ç±»åç§°");else alert("è¯·å…ˆç™»å½•")},Ke=(0,a.useCallback)((e,s)=>{s.stopPropagation(),_(e),B(!0)},[]),He=async()=>{if(F){z(!0);try{await(async e=>{if(y.shouldUseOfflineData())throw new Error("ç¦»çº¿æ¨¡å¼ä¸‹æ— æ³•åˆ é™¤åˆ†ç±»");try{const s=N().Object.createWithoutData("Category",e),t=new(N().Query)("Question");t.equalTo("category",s);const a=await t.find();let n=0;return a.length>0&&(await N().Object.destroyAll(a),n=a.length),await s.destroy(),(e=>{e&&(b.categoryDetails.delete(e),b.questionCounts.delete(e)),b.categories.data=null,b.categories.timestamp=0})(e),{success:!0,message:`ç±»åˆ«åŠå…³è”çš„ ${n} ä¸ªé¢˜ç›®å·²åˆ é™¤`,deletedQuestions:n}}catch(e){throw console.error("åˆ é™¤ç±»åˆ«å¤±è´¥:",e),new Error(`åˆ é™¤å¤±è´¥: ${e.message}`)}})(F.id),c(e=>e.filter(e=>e.id!==F.id)),B(!1),_(null),C(`åˆ†ç±» "${F.name}" åˆ é™¤æˆåŠŸï¼`),setTimeout(()=>C(""),3e3)}catch(e){console.error("åˆ é™¤åˆ†ç±»å¤±è´¥:",e),C("åˆ é™¤åˆ†ç±»å¤±è´¥: "+(e.message||"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"))}finally{z(!1)}}},Ge=(0,a.useCallback)(()=>{B(!1),_(null)},[]),Ye=async e=>{try{if(console.log("æ›´æ–°é¢˜ç›®å¤ä¹ æ—¶é—´:",e),!l.find(s=>s.id===e))throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„é¢˜ç›®");const s=new Date;return await J(e,{lastReviewedAt:s}),console.log("LeanCloud æ›´æ–°æˆåŠŸï¼Œå¼€å§‹æ›´æ–°æœ¬åœ°çŠ¶æ€"),o(t=>t.map(t=>t.id===e?{...t,lastReviewedAt:s.toISOString()}:t)),console.log(`é¢˜ç›® ${e} å¤ä¹ æ—¶é—´å·²æ›´æ–°`),!0}catch(s){throw console.error("æ›´æ–°é¢˜ç›®æ—¶é—´å¤±è´¥:",s),console.error("é”™è¯¯è¯¦æƒ…:",{questionId:e,errorMessage:s.message,errorStack:s.stack}),s}};(0,a.useEffect)(()=>{const e=e=>{e.error&&(e.error.message.includes("network")||e.error.message.includes("offline")||e.error.message.includes("CORS")||e.error.message.includes("LeanCloud"))&&(console.log("ðŸŒ æ•èŽ·åˆ°ç½‘ç»œé”™è¯¯ï¼Œåˆ‡æ¢åˆ°ç¦»çº¿æ¨¡å¼"),Pe(!0),e.preventDefault())};return window.addEventListener("error",e),()=>{window.removeEventListener("error",e)}},[]),(0,a.useEffect)(()=>{l.length>0&&(()=>{const e=new Date,s=24*K*60*60*1e3,t=l.filter(t=>{const a=new Date(t.lastReviewedAt||t.createdAt);return e-a>=s}).sort((e,s)=>new Date(e.lastReviewedAt||e.createdAt)-new Date(s.lastReviewedAt||s.createdAt));he(t)})()},[l,K]);const Ze=async()=>{try{y.shouldUseOfflineData()||f(),console.log("ðŸ”„ å¼€å§‹åŠ è½½æ•°æ®...");const[e,s]=await Promise.all([L({page:1,pageSize:50,sortBy:w.SORT_BY_UPDATED_AT,sortOrder:"desc"}),V()]);console.log("âœ… æ•°æ®åŠ è½½å®Œæˆ:",{åˆ†ç±»æ•°æ®:e.data.length,é¢˜ç›®æ•°æ®:s.length,æ¨¡å¼:y.shouldUseOfflineData()?"ç¦»çº¿":"åœ¨çº¿"}),c(e.data),o(s),h(!1)}catch(e){if(console.error("âŒ åˆå§‹åŒ–æ•°æ®å¤±è´¥:",e),e.message.includes("offline")||e.message.includes("network")){console.log("ðŸŒ ç½‘ç»œé”™è¯¯ï¼Œåˆ‡æ¢åˆ°å®Œå…¨ç¦»çº¿æ¨¡å¼"),Pe(!0);try{const e=await T.getCachedQuestions();return Te(e.questions),c([]),o([]),void h(!1)}catch(e){console.error("åŠ è½½ç¦»çº¿æ•°æ®ä¹Ÿå¤±è´¥:",e)}}m(e.message),h(!1)}},Xe=(0,a.useMemo)(()=>n.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())),[n,s]),es=(0,a.useMemo)(()=>{if(!n.length)return{totalCategories:0,totalQuestions:0,categoriesWithQuestions:0};const e=n.reduce((e,s)=>e+(s.questionCount||0),0),s=n.filter(e=>(e.questionCount||0)>0).length;return console.log("ðŸ” è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯:",{åˆ†ç±»æ€»æ•°:n.length,åŸºäºŽåˆ†ç±»çš„é¢˜ç›®æ€»æ•°:e,åŸºäºŽæ‰€æœ‰é¢˜ç›®çš„é¢˜ç›®æ€»æ•°:l.length,å·®å¼‚:Math.abs(e-l.length),æœ‰é¢˜ç›®çš„åˆ†ç±»æ•°:s,å¯¹è±¡:l,å„åˆ†ç±»è¯¦æƒ…:n.map(e=>({åˆ†ç±»åç§°:e.name,æœåŠ¡å±‚é¢˜ç›®æ•°:e.questionCount,å‰ç«¯è®¡ç®—é¢˜ç›®æ•°:l.filter(s=>s.category?.id===e.id).length,æ˜¯å¦åŒ¹é…:e.questionCount===l.filter(s=>s.category?.id===e.id).length}))}),{totalCategories:n.length,totalQuestions:e,categoriesWithQuestions:s}},[n,l]),ss=(0,a.useCallback)(e=>{const s=e.toISOString().split("T")[0];return l.filter(e=>new Date(e.createdAt).toISOString().split("T")[0]===s).sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))},[l]),ts=(0,a.useCallback)(e=>0===e?"#f8f9fa":e<=1?"#4CAF50":e<=3?"#8BC34A":e<=5?"#FFC107":e<=8?"#FF9800":"#F44336",[]),as=(0,a.useCallback)(()=>{const e=new Date(A.getFullYear(),A.getMonth(),1),s=new Date(A.getFullYear(),A.getMonth()+1,0),t={};l.forEach(a=>{const n=new Date(a.createdAt);if(n>=e&&n<=s){const e=n.toISOString().split("T")[0];t[e]=(t[e]||0)+1}});const a=[],n=new Date(e);for(;n<=s;){const e=n.toISOString().split("T")[0],s=ss(n),t=s.length;a.push({date:new Date(n),count:t,day:n.getDate(),isToday:e===(new Date).toISOString().split("T")[0],questions:s,color:ts(t)}),n.setDate(n.getDate()+1)}return a},[A,l,ss,ts]),ns=(0,a.useCallback)((e,s)=>{if(Ne(e),be(!0),ke.current){const e=ke.current.getBoundingClientRect(),t=s.currentTarget.getBoundingClientRect();fe({x:t.left+t.width/2-e.left,y:t.top-e.top-10})}be(!0)},[]),is=(0,a.useCallback)(()=>{setTimeout(()=>{document.querySelector(".calendar-tooltip:hover")||be(!1)},100)},[]),cs=(0,a.useCallback)(()=>{be(!1),Ne(null)},[]),rs=(0,a.useCallback)(e=>{const s=new Date(A);"prev"===e?s.setMonth(s.getMonth()-1):s.setMonth(s.getMonth()+1),E(s)},[A]),ls=(0,a.useCallback)(()=>{const e=as();return{daysWithQuestions:e.filter(e=>e.count>0).length,totalQuestions:e.reduce((e,s)=>e+s.count,0),maxDaily:Math.max(...e.map(e=>e.count))}},[as]),os=(0,a.useCallback)(()=>{const e={};return l.forEach(s=>{const t=s.category?.name||"æœªåˆ†ç±»";e[t]=(e[t]||0)+1}),Object.entries(e).map(([e,s])=>({name:e.length>8?e.substring(0,8)+"...":e,fullName:e,value:s,percentage:(s/l.length*100).toFixed(1)})).sort((e,s)=>s.value-e.value)},[l]),ds=(0,a.useCallback)(()=>{const e={};return l.forEach(s=>{const t=s.difficulty||"unknown";e[t]=(e[t]||0)+1}),Object.entries(e).map(([e,s])=>({name:us(e),value:s,color:hs(e)}))},[l]),hs=(0,a.useCallback)(e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}},[]),us=(0,a.useCallback)(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return"æœªçŸ¥"}},[]),ms=(0,a.useCallback)(()=>new Set(l.map(e=>new Date(e.createdAt).toDateString())).size,[l]),gs=(0,a.useCallback)(s=>{y.shouldUseOfflineData()?alert("ç¦»çº¿æ¨¡å¼ä¸‹æ— æ³•æŸ¥çœ‹åˆ†ç±»è¯¦æƒ…ï¼Œè¯·è¿žæŽ¥ç½‘ç»œåŽé‡è¯•"):e(`/category/${s}`)},[e]),xs=(0,a.useCallback)(s=>{const t=l.find(e=>e.id===s);t&&t.category&&e(`/category/${t.category.id}`)},[l,e]),ps=(0,a.useCallback)(e=>{alert(`ç¦»çº¿æ¨¡å¼ï¼šæŸ¥çœ‹ ${e.name} åˆ†ç±»çš„ ${e.questions.length} é“é¢˜ç›®\n\nè¯·è¿žæŽ¥ç½‘ç»œåŽæŸ¥çœ‹å®Œæ•´åŠŸèƒ½`)},[]),js=(0,a.useCallback)(e=>{if(!e)return"æš‚æ— ";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<30?`${n}å¤©å‰`:new Date(e).toLocaleDateString()},[]),vs=(0,a.useCallback)(e=>{if(!n.length)return 0;const s=Math.max(...n.map(e=>e.questionCount||0));return s>0?e/s*100:0},[n]),Ns=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43"],ys=(0,a.useMemo)(()=>os(),[os]),fs=(0,a.useMemo)(()=>ds(),[ds]),ws=(0,a.useMemo)(()=>as(),[as]),bs=(0,a.useMemo)(()=>ms(),[ms]),Cs=(0,a.useMemo)(()=>ls(),[ls]),Ss=(0,a.useMemo)(()=>A.toLocaleDateString("zh-CN",{year:"numeric",month:"long"}),[A]),ks=(0,a.useCallback)(()=>{const s={};De.forEach(e=>{const t=e.category?.name||"æœªåˆ†ç±»";s[t]||(s[t]={name:t,questions:[],questionCount:0,id:`offline-${t}`}),s[t].questions.push(e),s[t].questionCount++});const t=Object.values(s);return(0,p.jsx)("section",{className:"categories-section",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"offline-header",children:[(0,p.jsx)("h3",{style:{color:"#666666"},children:"ðŸ“¦ ç¦»çº¿æ¨¡å¼"}),(0,p.jsx)("p",{style:{color:"#666666"},children:"å½“å‰å¤„äºŽç¦»çº¿çŠ¶æ€ï¼Œæ˜¾ç¤ºç¼“å­˜çš„é¢˜ç›®æ•°æ®"}),(0,p.jsxs)("div",{className:"cache-stats",style:{color:"#666666"},children:["å·²ç¼“å­˜ ",De.length," é“é¢˜ç›®ï¼Œ",t.length," ä¸ªåˆ†ç±»"]}),(0,p.jsxs)("div",{className:"offline-global-actions",children:[(0,p.jsxs)("button",{onClick:()=>e("/offline/questions"),className:"view-all-offline-btn",style:{color:"#333333"},children:["ðŸ“š æŸ¥çœ‹æ‰€æœ‰ç¦»çº¿é¢˜ç›® (",De.length,")"]}),(0,p.jsx)("button",{onClick:()=>window.location.reload(),className:"refresh-network-btn",style:{color:"#333333"},children:"ðŸ”„ æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"})]}),(0,p.jsx)("div",{className:"cache-progress-fill",style:{width:De.length/T.getCacheLimit()*100+"%"}})]}),(0,p.jsx)("div",{className:"categories-grid",children:t.map((e,s)=>{const t=Ns[s%Ns.length];return(0,p.jsxs)("div",{className:"category-card offline-card",onClick:()=>ps(e),style:{"--accent-color":t},children:[(0,p.jsxs)("div",{className:"card-header",children:[(0,p.jsx)("div",{className:"category-icon",style:{backgroundColor:t},children:e.name.charAt(0)}),(0,p.jsxs)("div",{className:"category-info",children:[(0,p.jsx)("h3",{className:"category-name",children:e.name}),(0,p.jsxs)("span",{className:"question-count",children:[e.questionCount,"é¢˜"]})]}),(0,p.jsx)("div",{className:"offline-badge",children:"ç¦»çº¿"})]}),(0,p.jsxs)("div",{className:"card-footer",children:[(0,p.jsx)("div",{className:"progress-info",children:(0,p.jsx)("div",{className:"progress-stats",children:(0,p.jsx)("span",{children:"ç¦»çº¿ç¼“å­˜æ•°æ®"})})}),(0,p.jsx)("button",{className:"explore-btn",children:"æŸ¥çœ‹é¢˜ç›® â†’"})]})]},e.id)})})]})})},[De,ps,e]);return pe?d?(0,p.jsx)("div",{className:"homepage",children:(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"modern-spinner"}),(0,p.jsx)("p",{children:"åŠ è½½çŸ¥è¯†åº“ä¸­..."})]})}):u?(0,p.jsx)("div",{className:"homepage",children:(0,p.jsxs)("div",{className:"error-container",children:[(0,p.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,p.jsx)("p",{children:u}),(0,p.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"é‡è¯•"})]})}):(0,p.jsx)(r.Ht,{client:Se,children:(0,p.jsxs)("div",{className:"homepage",children:[(0,p.jsx)(H,{}),(0,p.jsx)("header",{className:"hero-section",children:(0,p.jsxs)("div",{className:"hero-content",children:[(0,p.jsxs)("div",{className:"user-welcome",children:[(0,p.jsx)("h1",{className:"hero-title",children:"æˆ‘çš„çŸ¥è¯†é¢˜åº“"}),(0,p.jsxs)("p",{className:"hero-subtitle",children:["æ¬¢è¿Žå›žæ¥, ",pe.getUsername(),"ï¼",!Ae&&(0,p.jsx)("span",{className:"offline-status",children:" â€¢ ç¦»çº¿æ¨¡å¼"})]}),(0,p.jsx)("div",{className:"cache-actions"})]}),(0,p.jsxs)("div",{className:"header-actions",children:[(0,p.jsx)("div",{className:"search-container"}),Fe&&(0,p.jsx)(Be,{})]})]})}),(0,p.jsx)("section",{className:"modern-tabs-section",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)("div",{className:"modern-tabs",children:[(0,p.jsxs)("button",{className:"modern-tab "+("categories"===S?"active":""),onClick:()=>k("categories"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ“š"}),(0,p.jsx)("span",{className:"tab-text",children:"åˆ†ç±»æµè§ˆ"}),"categories"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("review"===S?"active":""),onClick:()=>k("review"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ”„"}),(0,p.jsxs)("span",{className:"tab-text",children:["å¤ä¹ æé†’",de.length>0&&(0,p.jsx)("span",{className:"tab-badge",children:de.length})]}),"review"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("stats"===S?"active":""),onClick:()=>k("stats"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ“Š"}),(0,p.jsx)("span",{className:"tab-text",children:"æ•°æ®ç»Ÿè®¡"}),"stats"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("calendar"===S?"active":""),onClick:()=>k("calendar"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ—“ï¸"}),(0,p.jsx)("span",{className:"tab-text",children:"å­¦ä¹ æ—¥åŽ†"}),"calendar"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("documents"===S?"active":""),onClick:()=>k("documents"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ“–"}),(0,p.jsx)("span",{className:"tab-text",children:"å¼€å‘æ–‡æ¡£"}),"documents"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("community"===S?"active":""),onClick:()=>k("community"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ‘¥"}),(0,p.jsx)("span",{className:"tab-text",children:"å­¦ä¹ ç¤¾åŒº"}),"community"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]}),(0,p.jsxs)("button",{className:"modern-tab "+("cache"===S?"active":""),onClick:()=>k("cache"),children:[(0,p.jsx)("span",{className:"tab-icon",children:"ðŸ’¾"}),(0,p.jsxs)("span",{className:"tab-text",children:["ç¼“å­˜ç®¡ç†",qe.hasCache&&(0,p.jsx)("span",{className:"tab-badge",children:qe.count})]}),"cache"===S&&(0,p.jsx)("div",{className:"tab-indicator"})]})]})})}),v&&(0,p.jsx)("div",{className:"sync-message",children:v}),(()=>{if($e)return ks();switch(S){case"categories":default:return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("section",{className:"filters-section",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)("div",{className:"filters",children:[(0,p.jsxs)("div",{className:"stats",children:["æ‰¾åˆ° ",Xe.length," ä¸ªç±»åˆ«",n.length>0&&` â€¢ æ€»è®¡ ${l.length} é“é¢˜ç›®`]}),(0,p.jsxs)("button",{className:"add-category-btn",onClick:()=>$(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"æ–°å»ºåˆ†ç±»"]})]})})}),q&&(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"åˆ›å»ºæ–°åˆ†ç±»"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>$(!1),children:"Ã—"})]}),(0,p.jsxs)("form",{onSubmit:Je,className:"category-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"categoryName",children:"åˆ†ç±»åç§° *"}),(0,p.jsx)("input",{id:"categoryName",type:"text",value:P,onChange:e=>I(e.target.value),placeholder:"è¯·è¾“å…¥åˆ†ç±»åç§°",maxLength:50,autoFocus:!0,style:{color:"black"}})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"categoryDescription",children:"åˆ†ç±»æè¿°"}),(0,p.jsx)("textarea",{id:"categoryDescription",value:Q,onChange:e=>O(e.target.value),placeholder:"è¯·è¾“å…¥åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰",rows:"3",maxLength:200,style:{color:"black"}})]}),(0,p.jsxs)("div",{className:"form-actions",children:[(0,p.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>$(!1),children:"å–æ¶ˆ"}),(0,p.jsx)("button",{type:"submit",className:"submit-btn",disabled:R||!P.trim(),children:R?"åˆ›å»ºä¸­...":"åˆ›å»ºåˆ†ç±»"})]})]})]})}),M&&F&&(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content delete-confirm-modal",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"ç¡®è®¤åˆ é™¤"}),(0,p.jsx)("button",{className:"close-btn",onClick:Ge,children:"Ã—"})]}),(0,p.jsxs)("div",{className:"delete-content",children:[(0,p.jsx)("div",{className:"delete-icon",children:"ðŸ—‘ï¸"}),(0,p.jsxs)("div",{className:"delete-message",children:[(0,p.jsxs)("p",{children:["ç¡®å®šè¦åˆ é™¤åˆ†ç±» ",(0,p.jsxs)("strong",{children:['"',F.name,'"']})," å—ï¼Ÿ"]}),F.questionCount>0&&(0,p.jsxs)("p",{className:"warning-text",children:["âš ï¸ æ­¤åˆ†ç±»åŒ…å« ",F.questionCount," ","é“é¢˜ç›®ï¼Œåˆ é™¤åŽè¿™äº›é¢˜ç›®å°†å˜ä¸ºæœªåˆ†ç±»çŠ¶æ€ï¼"]}),(0,p.jsx)("p",{className:"delete-hint",children:"æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…Žæ“ä½œã€‚"})]}),(0,p.jsxs)("div",{className:"delete-actions",children:[(0,p.jsx)("button",{className:"cancel-delete-btn",onClick:Ge,disabled:W,children:"å–æ¶ˆ"}),(0,p.jsx)("button",{className:"confirm-delete-btn",onClick:He,disabled:W,children:W?"åˆ é™¤ä¸­...":"ç¡®è®¤åˆ é™¤"})]})]})]})}),(0,p.jsx)("section",{className:"categories-section",children:(0,p.jsx)("div",{className:"container",children:0===Xe.length?(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:"ðŸ“š"}),(0,p.jsx)("h3",{children:"æš‚æ— ç±»åˆ«æ•°æ®"}),(0,p.jsx)("p",{children:"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç±»åˆ«ï¼Œå°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–åˆ›å»ºæ–°åˆ†ç±»"}),(0,p.jsx)("button",{className:"create-first-category-btn",onClick:()=>$(!0),children:"+ åˆ›å»ºç¬¬ä¸€ä¸ªåˆ†ç±»"})]}):(0,p.jsx)("div",{className:"categories-grid",children:Xe.map((e,s)=>{const t=Ns[s%Ns.length],a=l.filter(s=>s.category?.id===e.id).length,n=a>0?a:e.questionCount||0;return(0,p.jsxs)("div",{ref:s=>Ue.current[`category-${e.id}`]=s,className:"category-card",onClick:()=>gs(e.id),style:{"--accent-color":t},children:[(0,p.jsxs)("div",{className:"card-header",children:[(0,p.jsx)("div",{className:"category-icon",style:{backgroundColor:t},children:e.name.charAt(0)}),(0,p.jsxs)("div",{className:"category-info",children:[(0,p.jsx)("h3",{className:"category-name",children:e.name}),e.description&&(0,p.jsx)("p",{className:"category-description",children:e.description}),(0,p.jsxs)("span",{className:"question-count",children:[n,"é¢˜"]})]}),(0,p.jsx)("button",{className:"delete-category-btn",onClick:s=>Ke(e,s),title:"åˆ é™¤åˆ†ç±»",children:"Ã—"})]}),(0,p.jsxs)("div",{className:"card-footer",children:[(0,p.jsxs)("div",{className:"progress-info",children:[(0,p.jsx)("div",{className:"progress-stats",children:(0,p.jsxs)("span",{children:["æœ€è¿‘æ›´æ–°: ",js(e.updatedAt)]})}),(0,p.jsx)("div",{className:"progress-bar",children:(0,p.jsx)("div",{className:"progress-fill",style:{width:`${vs(e.questionCount)}%`,backgroundColor:t}})})]}),(0,p.jsx)("button",{className:"explore-btn",children:"æŸ¥çœ‹é¢˜ç›® â†’"})]})]},e.id)})})})})]});case"review":return(0,p.jsx)(le,{reviewQuestions:de,setReviewQuestions:he,reviewThreshold:K,setReviewThreshold:oe,showReviewSettings:ge,setShowReviewSettings:xe,onQuestionClick:xs,onUpdateQuestionTime:Ye,questions:l});case"stats":return(0,p.jsx)("section",{className:"stats-section",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"stats-overview",children:[(0,p.jsxs)("div",{className:"modern-stat-card primary",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:es.totalCategories}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»åˆ†ç±»æ•°"})]})]}),(0,p.jsxs)("div",{className:"modern-stat-card success",children:[(0,p.jsx)("div",{className:"stat-icon",children:"â“"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:l.length}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]})]}),(0,p.jsxs)("div",{className:"modern-stat-card warning",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“…"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:bs}),(0,p.jsx)("div",{className:"stat-label",children:"æ´»è·ƒå¤©æ•°"})]})]}),(0,p.jsxs)("div",{className:"modern-stat-card info",children:[(0,p.jsx)("div",{className:"stat-icon",children:"âš¡"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:es.totalQuestions>0?(es.totalQuestions/bs).toFixed(1):0}),(0,p.jsx)("div",{className:"stat-label",children:"æ—¥å‡é¢˜ç›®"})]})]})]}),(0,p.jsxs)("div",{className:"charts-grid",children:[(0,p.jsxs)("div",{className:"modern-chart-card",children:[(0,p.jsxs)("div",{className:"chart-header",children:[(0,p.jsx)("h3",{children:"ðŸ“Š åˆ†ç±»é¢˜ç›®åˆ†å¸ƒ"}),(0,p.jsx)("span",{className:"chart-subtitle",children:"å„åˆ†ç±»é¢˜ç›®æ•°é‡å æ¯”"})]}),(0,p.jsx)("div",{className:"chart-container",children:(0,p.jsx)(Y.u,{width:"100%",height:300,children:(0,p.jsxs)(Z.r,{children:[(0,p.jsx)(X.F,{data:ys,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:s})=>`${e} ${s}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:ys.map((e,s)=>(0,p.jsx)(ee.f,{fill:Ns[s%Ns.length]},`cell-${s}`))}),(0,p.jsx)(se.m,{formatter:(e,s)=>[`${e} é¢˜`,s]}),(0,p.jsx)(te.s,{})]})})})]}),(0,p.jsxs)("div",{className:"modern-chart-card",children:[(0,p.jsxs)("div",{className:"chart-header",children:[(0,p.jsx)("h3",{children:"ðŸŽ¯ éš¾åº¦åˆ†å¸ƒ"}),(0,p.jsx)("span",{className:"chart-subtitle",children:"é¢˜ç›®éš¾åº¦ç­‰çº§ç»Ÿè®¡"})]}),(0,p.jsx)("div",{className:"chart-container",children:(0,p.jsx)(Y.u,{width:"100%",height:300,children:(0,p.jsxs)(ae.E,{data:fs,children:[(0,p.jsx)(ne.d,{strokeDasharray:"3 3"}),(0,p.jsx)(ie.W,{dataKey:"name"}),(0,p.jsx)(ce.h,{}),(0,p.jsx)(se.m,{formatter:e=>[`${e} é¢˜`,"æ•°é‡"]}),(0,p.jsx)(re.y,{dataKey:"value",name:"é¢˜ç›®æ•°é‡",children:fs.map((e,s)=>(0,p.jsx)(ee.f,{fill:e.color},`cell-${s}`))})]})})})]})]})]})});case"calendar":return(0,p.jsx)("section",{className:"modern-calendar-section",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"calendar-header",children:[(0,p.jsx)("h3",{children:"ðŸ—“ï¸ å­¦ä¹ æ—¥åŽ†"}),(0,p.jsx)("p",{children:"æŸ¥çœ‹æ¯æœˆçš„å­¦ä¹ æ´»åŠ¨åˆ†å¸ƒ"})]}),(0,p.jsxs)("div",{className:"modern-calendar-card",ref:ke,children:[(0,p.jsxs)("div",{className:"calendar-controls",children:[(0,p.jsx)("button",{onClick:()=>rs("prev"),className:"month-nav-btn",children:"â† ä¸Šä¸ªæœˆ"}),(0,p.jsx)("h4",{className:"current-month",children:Ss}),(0,p.jsx)("button",{onClick:()=>rs("next"),className:"month-nav-btn",children:"ä¸‹ä¸ªæœˆ â†’"})]}),(0,p.jsxs)("div",{className:"monthly-calendar",children:[(0,p.jsx)("div",{className:"calendar-weekdays",children:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].map(e=>(0,p.jsx)("div",{className:"weekday",children:e},e))}),(0,p.jsx)("div",{className:"calendar-days",children:ws.map((e,s)=>(0,p.jsxs)("div",{className:`calendar-day ${e.count>0?"has-questions":""} ${e.isToday?"today":""}`,style:{backgroundColor:e.color},onMouseEnter:s=>ns(e,s),onMouseLeave:is,"data-count":e.count,children:[(0,p.jsx)("span",{className:"day-number",children:e.day}),e.count>0&&(0,p.jsx)("div",{className:"question-count-badge",children:e.count})]},s))}),(0,p.jsx)(ue,{dayData:ve,position:ye,isVisible:we,onClose:cs})]}),(0,p.jsxs)("div",{className:"calendar-stats",children:[(0,p.jsxs)("div",{className:"calendar-stat",children:[(0,p.jsx)("span",{className:"stat-value",children:Cs.totalQuestions}),(0,p.jsx)("span",{className:"stat-label",children:"æœ¬æœˆé¢˜ç›®"})]}),(0,p.jsxs)("div",{className:"calendar-stat",children:[(0,p.jsx)("span",{className:"stat-value",children:Cs.daysWithQuestions}),(0,p.jsx)("span",{className:"stat-label",children:"å­¦ä¹ å¤©æ•°"})]}),(0,p.jsxs)("div",{className:"calendar-stat",children:[(0,p.jsx)("span",{className:"stat-value",children:Cs.maxDaily}),(0,p.jsx)("span",{className:"stat-label",children:"å•æ—¥æœ€é«˜"})]})]}),(0,p.jsxs)("div",{className:"calendar-legend",children:[(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#f8f9fa"}}),(0,p.jsx)("span",{children:"æ— é¢˜ç›®"})]}),(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#4CAF50"}}),(0,p.jsx)("span",{children:"1é¢˜"})]}),(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#8BC34A"}}),(0,p.jsx)("span",{children:"2-3é¢˜"})]}),(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#FFC107"}}),(0,p.jsx)("span",{children:"4-5é¢˜"})]}),(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#FF9800"}}),(0,p.jsx)("span",{children:"6-8é¢˜"})]}),(0,p.jsxs)("div",{className:"legend-item",children:[(0,p.jsx)("div",{className:"legend-color",style:{backgroundColor:"#F44336"}}),(0,p.jsx)("span",{children:"9é¢˜ä»¥ä¸Š"})]})]})]})]})});case"documents":return(0,p.jsx)("section",{className:"documents-tab-section",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsx)(me,{})})});case"community":return(0,p.jsx)(Ce,{});case"cache":return(0,p.jsx)(G,{questions:l,onCacheUpdate:Le,currentUser:pe})}})(),(0,p.jsx)("footer",{className:"footer-section",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)("div",{className:"footer-stats",children:[(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("div",{className:"stat-number",children:es.totalCategories}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»ç±»åˆ«æ•°"})]}),(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("div",{className:"stat-number",children:l.length}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]}),(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("div",{className:"stat-number",children:qe.count||0}),(0,p.jsx)("div",{className:"stat-label",children:"ç¼“å­˜é¢˜ç›®"})]})]})})}),(0,p.jsx)(j,{onNavigate:s=>{switch(console.log("å¯¼èˆªåˆ°:",s),s){case"categories":default:k("categories");break;case"review":k("review");break;case"stats":k("stats");break;case"calendar":k("calendar");break;case"community":k("community");break;case"documents":k("documents");break;case"createCategory":$(!0);break;case"cacheQuestions":ze();break;case"offlineMode":e("/offline/questions")}window.scrollTo({top:0,behavior:"smooth"})},onTriggerCategory:(e,s)=>{console.log(`ðŸŽ¯ è§¦å‘åˆ†ç±»: ${e}, æŒ‰é’®ID: ${s}`),console.log("ðŸ“Š å½“å‰åˆ†ç±»åˆ—è¡¨:",n.map(e=>e.name)),k("categories"),setTimeout(()=>{const s=n.find(s=>{const t=s.name.toLowerCase(),a=e.toLowerCase(),n=t===a,i=t.includes(a)||a.includes(t),c=t.replace(/\s+/g,"")===a.replace(/\s+/g,"");return console.log(`ðŸ” åŒ¹é…æ£€æŸ¥: ${s.name}`,{exactMatch:n,containsMatch:i,fuzzyMatch:c,catNameLower:t,searchNameLower:a}),n||i||c});if(s){console.log(`âœ… æ‰¾åˆ°åˆ†ç±»: ${s.name}`,s);const e=`category-${s.id}`;Ue.current[e]?(console.log(`ðŸ–±ï¸ æ¨¡æ‹Ÿç‚¹å‡»åˆ†ç±»å¡ç‰‡: ${s.name}`),Ue.current[e].click()):(console.log(`ðŸ”— ç›´æŽ¥å¯¼èˆªåˆ°åˆ†ç±»: ${s.name}`),gs(s.id)),C(`å·²ä¸ºæ‚¨æ‰“å¼€ ${s.name} åˆ†ç±»`),setTimeout(()=>C(""),3e3)}else{console.log(`âŒ æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†ç±»: ${e}`),console.log("ðŸ’¡ å¯ç”¨çš„åˆ†ç±»:",n.map(e=>e.name));const s=n.find(s=>s.name.toLowerCase().includes(e.toLowerCase().substring(0,3)));if(s){console.log(`ðŸ” å®½æ¾åŒ¹é…æ‰¾åˆ°: ${s.name}`);const e=`category-${s.id}`;Ue.current[e]?(Ue.current[e].click(),C(`å·²ä¸ºæ‚¨æ‰“å¼€ç›¸è¿‘åˆ†ç±»: ${s.name}`)):gs(s.id)}else C(`æœªæ‰¾åˆ°"${e}"åˆ†ç±»ï¼Œè¯·æ£€æŸ¥åˆ†ç±»åç§°`);setTimeout(()=>C(""),3e3)}},100)},categories:n,questions:l,currentUser:pe,cacheStatus:qe,isOnline:Ae})]})}):(0,p.jsx)("div",{className:"homepage",children:(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„åˆ·é¢˜æ•°æ®"}),(0,p.jsxs)("div",{className:"auth-required-actions",children:[(0,p.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"login"}}))},className:"login-btn primary",children:"ðŸš€ ç«‹å³ç™»å½•"}),(0,p.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"register"}}))},className:"login-btn secondary",children:"ðŸ“ æ³¨å†Œè´¦å·"})]}),(0,p.jsx)("div",{className:"auth-features",children:(0,p.jsxs)("div",{className:"feature-list",children:[(0,p.jsxs)("div",{className:"feature-item",children:[(0,p.jsx)("span",{className:"feature-icon",children:"ðŸ“š"}),(0,p.jsx)("span",{children:"ç®¡ç†æ‚¨çš„åˆ·é¢˜åˆ†ç±»"})]}),(0,p.jsxs)("div",{className:"feature-item",children:[(0,p.jsx)("span",{className:"feature-icon",children:"ðŸ“Š"}),(0,p.jsx)("span",{children:"æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡"})]}),(0,p.jsxs)("div",{className:"feature-item",children:[(0,p.jsx)("span",{className:"feature-icon",children:"ðŸ”„"}),(0,p.jsx)("span",{children:"ä½¿ç”¨å¤ä¹ æé†’åŠŸèƒ½"})]}),(0,p.jsxs)("div",{className:"feature-item",children:[(0,p.jsx)("span",{className:"feature-icon",children:"ðŸ—“ï¸"}),(0,p.jsx)("span",{children:"è®°å½•å­¦ä¹ æ—¥åŽ†"})]}),(0,p.jsxs)("div",{className:"feature-item",children:[(0,p.jsx)("span",{className:"feature-icon",children:"ðŸ“¦"}),(0,p.jsx)("span",{children:"ç¦»çº¿ç¼“å­˜é¢˜ç›®"})]})]})})]})})};N().init({appId:"JjTQ2R5rn16RRhUdrcjUSBxW-gzGzoHsz",appKey:"UkvR0e4OPaeW5rYMQwNTvD7Z",serverURL:"https://jjtq2r5r.lc-cn-n1-shared.com"});const Ae="Post",Ee="Comment",qe="Like",Le="Follow",De="published",Te=["Title","é¢˜ç›®","Name","åç§°"],$e=["Difficulty","éš¾åº¦"],Pe=["Category","ç±»åˆ«","åˆ†ç±»"],Ie=["Tags","æ ‡ç­¾"],Qe=["Content","å†…å®¹","Answer","ç­”æ¡ˆ"],Oe=["CompletionTime","å®Œæˆæ—¶é—´","æ—¶é—´"],Re=async()=>{try{return{Post:await Ue(),Comment:await Me(),Like:await Be(),Follow:await Fe()}}catch(e){throw new Error(`åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨å¤±è´¥: ${e.message}`)}},Ue=async()=>{try{const e=new(N().Query)(Ae);if(await e.first().catch(()=>null))return{exists:!0,message:"Post class already exists"};const s=new(N().Object.extend(Ae));s.set("title","æµ‹è¯•å¸–å­æ ‡é¢˜"),s.set("content","è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¸–å­çš„å†…å®¹ï¼Œç”¨äºŽéªŒè¯ Post ç±»çš„åˆ›å»ºã€‚"),s.set("author",N().User.current()),s.set("tags",["æµ‹è¯•","ç¤ºä¾‹"]),s.set("likes",0),s.set("views",0),s.set("commentCount",0),s.set("isPublic",!0),s.set("isPinned",!1),s.set("status",De);const t=new(N().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),N().User.current()&&t.setWriteAccess(N().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Post ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Post class created successfully"}}catch(e){return console.error("åˆ›å»º Post ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Me=async()=>{try{const e=new(N().Query)(Ee);if(await e.first().catch(()=>null))return console.log("ðŸ“ Comment ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Comment class already exists"};const s=new(N().Object.extend(Ee));s.set("content","è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯„è®ºå†…å®¹ã€‚"),s.set("author",N().User.current()),s.set("likes",0);const t=new(N().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),N().User.current()&&t.setWriteAccess(N().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Comment ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Comment class created successfully"}}catch(e){return console.error("åˆ›å»º Comment ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Be=async()=>{try{const e=new(N().Query)(qe);if(await e.first().catch(()=>null))return console.log("ðŸ“ Like ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Like class already exists"};const s=new(N().Object.extend(qe));s.set("user",N().User.current());const t=new(N().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),N().User.current()&&t.setWriteAccess(N().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Like ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Like class created successfully"}}catch(e){return console.error("åˆ›å»º Like ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Fe=async()=>{try{const e=new(N().Query)(Le);if(await e.first().catch(()=>null))return console.log("ðŸ“ Follow ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Follow class already exists"};const s=new(N().Object.extend(Le));s.set("follower",N().User.current());const t=new(N().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),N().User.current()&&t.setWriteAccess(N().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Follow ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Follow class created successfully"}}catch(e){return console.error("åˆ›å»º Follow ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},_e=async()=>{try{console.log("ðŸš€ å¼€å§‹ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®..."),await Re();const e={posts:await We(),comments:await ze(),likes:await Ve()};return console.log("âœ… ç¤¾åŒºç¤ºä¾‹æ•°æ®ç”Ÿæˆå®Œæˆ:",e),{success:!0,...e,message:`æˆåŠŸç”Ÿæˆ ${e.posts.length} ä¸ªå¸–å­, ${e.comments.length} æ¡è¯„è®º, ${e.likes.length} ä¸ªç‚¹èµž`}}catch(e){throw console.error("âŒ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥:",e),new Error(`ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥: ${e.message}`)}},We=async()=>{const e=N().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹å¸–å­"),[];const s=N().Object.extend(Ae),t=[{title:"æ¬¢è¿Žæ¥åˆ°å­¦ä¹ ç¤¾åŒºï¼",content:"å¤§å®¶å¥½ï¼æ¬¢è¿Žæ¥åˆ°æˆ‘ä»¬çš„å­¦ä¹ ç¤¾åŒºã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªåˆ†äº«ç¼–ç¨‹å­¦ä¹ å¿ƒå¾—ã€äº¤æµåˆ·é¢˜ç»éªŒçš„åœ°æ–¹ã€‚\n\n## ç¤¾åŒºè§„åˆ™ï¼š\n1. å‹å–„äº¤æµï¼Œäº’ç›¸å¸®åŠ©\n2. åˆ†äº«æœ‰ä»·å€¼çš„å†…å®¹\n3. å°Šé‡ä»–äººè§‚ç‚¹\n4. ä¿æŒå†…å®¹ç›¸å…³æ€§\n\nå¸Œæœ›å¤§å®¶éƒ½èƒ½åœ¨è¿™é‡Œæœ‰æ‰€æ”¶èŽ·ï¼ðŸŽ‰",tags:["æ¬¢è¿Ž","å…¬å‘Š","ç¤¾åŒº"],isPublic:!0,isPinned:!0},{title:"JavaScript é—­åŒ…çš„ç†è§£ä¸Žå®žè·µ",content:"ä»Šå¤©æ¥åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹ JavaScript é—­åŒ…çš„ç†è§£...\n\n## ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ\né—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚\n\n## å®žé™…åº”ç”¨åœºæ™¯ï¼š\n1. æ¨¡å—åŒ–å¼€å‘\n2. ç§æœ‰å˜é‡\n3. å‡½æ•°æŸ¯é‡ŒåŒ–\n\nå¤§å®¶æœ‰ä»€ä¹ˆè¡¥å……çš„å—ï¼Ÿ",tags:["JavaScript","é—­åŒ…","å‰ç«¯"],isPublic:!0,isPinned:!1},{title:"React Hooks ä½¿ç”¨å¿ƒå¾—",content:"ä½¿ç”¨ React Hooks æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œåˆ†äº«ä¸€äº›å®žè·µç»éªŒï¼š\n\n- useState: çŠ¶æ€ç®¡ç†\n- useEffect: å‰¯ä½œç”¨å¤„ç†\n- useContext: ä¸Šä¸‹æ–‡ä¼ é€’\n- useMemo: æ€§èƒ½ä¼˜åŒ–\n\nä½ ä»¬è§‰å¾—å“ªä¸ª Hook æœ€å®žç”¨ï¼Ÿ",tags:["React","Hooks","å‰ç«¯"],isPublic:!0,isPinned:!1}],a=[];for(const n of t){const t=new s;t.set("title",n.title),t.set("content",n.content),t.set("author",e),t.set("tags",n.tags),t.set("likes",Math.floor(10*Math.random())),t.set("views",Math.floor(50*Math.random())),t.set("commentCount",Math.floor(5*Math.random())),t.set("isPublic",n.isPublic),t.set("isPinned",n.isPinned),t.set("status",De);const i=new(N().ACL);i.setPublicReadAccess(!0),i.setPublicWriteAccess(!1),i.setWriteAccess(e,!0),t.setACL(i);const c=await t.save();a.push(c),console.log(`âœ… åˆ›å»ºå¸–å­: "${n.title}"`)}return a},ze=async()=>{const e=N().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹è¯„è®º"),[];const s=new(N().Query)(Ae),t=await s.find();if(0===t.length)return console.log("âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¸–å­ï¼Œè·³è¿‡åˆ›å»ºè¯„è®º"),[];const a=N().Object.extend(Ee),n=[{content:"æ¬¢è¿Žæ¬¢è¿Žï¼æœŸå¾…æ›´å¤šç²¾å½©å†…å®¹ï¼ðŸŽŠ"},{content:"é—­åŒ…çš„è®²è§£å¾ˆæ¸…æ™°ï¼Œæ„Ÿè°¢åˆ†äº«ï¼"},{content:"æˆ‘è§‰å¾— useEffect æœ€å®žç”¨ï¼Œèƒ½å¤„ç†å„ç§å‰¯ä½œç”¨ã€‚"},{content:"æ–°äººæŠ¥é“ï¼Œè¯·å¤šæŒ‡æ•™ï¼"},{content:"Hooks ç¡®å®žè®© React å¼€å‘æ›´ç®€æ´äº†ã€‚"}],i=[];for(let s=0;s<n.length;s++){const c=new a;c.set("content",n[s].content),c.set("author",e),c.set("post",t[s%t.length]),c.set("likes",Math.floor(5*Math.random()));const r=new(N().ACL);r.setPublicReadAccess(!0),r.setPublicWriteAccess(!1),r.setWriteAccess(e,!0),c.setACL(r);const l=await c.save();i.push(l),console.log(`âœ… åˆ›å»ºè¯„è®º: "${n[s].content.substring(0,20)}..."`)}return i},Ve=async()=>{const e=N().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹ç‚¹èµž"),[];const s=new(N().Query)(Ae),t=await s.find(),a=new(N().Query)(Ee),n=await a.find(),i=N().Object.extend(qe),c=[];if(t.length>0){const s=new i;s.set("user",e),s.set("post",t[0]);const a=new(N().ACL);a.setPublicReadAccess(!0),a.setWriteAccess(e,!0),s.setACL(a);const n=await s.save();c.push(n),console.log("âœ… åˆ›å»ºå¸–å­ç‚¹èµž")}if(n.length>0){const s=new i;s.set("user",e),s.set("comment",n[0]);const t=new(N().ACL);t.setPublicReadAccess(!0),t.setWriteAccess(e,!0),s.setACL(t);const a=await s.save();c.push(a),console.log("âœ… åˆ›å»ºè¯„è®ºç‚¹èµž")}return c},Je=async()=>{try{let e={posts:0,comments:0,likes:0,follows:0};try{const s=new(N().Query)(qe),t=await s.find();t.length>0&&(await N().Object.destroyAll(t),e.likes=t.length)}catch(e){}try{const s=new(N().Query)(Ee),t=await s.find();t.length>0&&(await N().Object.destroyAll(t),e.comments=t.length)}catch(e){}try{const s=new(N().Query)(Ae),t=await s.find();t.length>0&&(await N().Object.destroyAll(t),e.posts=t.length)}catch(e){}try{const s=new(N().Query)(Le),t=await s.find();t.length>0&&(await N().Object.destroyAll(t),e.follows=t.length)}catch(e){}const s=`ç¤¾åŒºæ•°æ®æ¸…é™¤å®Œæˆ: ${e.posts} å¸–å­, ${e.comments} è¯„è®º, ${e.likes} ç‚¹èµž, ${e.follows} å…³æ³¨`;return{success:!0,...e,message:s}}catch(e){throw console.error("âŒ æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥:",e),new Error(`æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥: ${e.message}`)}},Ke=async()=>{try{if(!"MISSING_ENV_VAR".REACT_APP_NOTION_TOKEN||!"MISSING_ENV_VAR".REACT_APP_NOTION_DATABASE_ID)throw new Error("Notion çŽ¯å¢ƒå˜é‡æœªé…ç½®ï¼Œè¯·æ£€æŸ¥ REACT_APP_NOTION_TOKEN å’Œ REACT_APP_NOTION_DATABASE_ID");try{return await N().Cloud.run("syncProblemsFromNotion")}catch(e){return await He()}}catch(e){throw console.error("âŒ Notion åŒæ­¥å¤±è´¥:",e),new Error(`åŒæ­¥å¤±è´¥: ${e.message}`)}},He=async()=>{try{return console.log("ðŸ“ ä½¿ç”¨å®¢æˆ·ç«¯åŒæ­¥æ¨¡å¼ï¼ˆéœ€è¦é…ç½®äº‘å‡½æ•°ï¼‰"),await new Promise(e=>setTimeout(e,2e3)),{success:!0,message:"åŒæ­¥åŠŸèƒ½éœ€è¦éƒ¨ç½²äº‘å‡½æ•°ã€‚è¯·å‚è€ƒä»¥ä¸‹æ­¥éª¤ï¼š\n1. åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½² syncProblemsFromNotion äº‘å‡½æ•°\n2. é…ç½® NOTION_INTEGRATION_TOKEN å’Œ NOTION_DATABASE_ID çŽ¯å¢ƒå˜é‡",data:{synced:0,mode:"client_fallback"}}}catch(e){throw new Error(`å®¢æˆ·ç«¯åŒæ­¥å¤±è´¥: ${e.message}`)}},Ge=e=>{try{const s=e.properties,t=Ye(s,Te,"title");if(!t)return console.warn("è·³è¿‡æ— æ ‡é¢˜çš„è®°å½•:",e.id),null;const a=Ye(s,$e,"select"),n=Ye(s,Pe,"select"),i=Ye(s,Ie,"multi_select")||[],c=Ye(s,Qe,"rich_text"),r=Ye(s,Oe,"number");return{title:t,difficulty:a||"medium",category:n||"æœªåˆ†ç±»",tags:Array.isArray(i)?i:[i],content:c||"",completionTime:r||15,notionPageId:e.id,notionUrl:e.url,lastEditedTime:new Date(e.last_edited_time),isActive:!0}}catch(e){return console.error("è§£æž Notion é¡µé¢å¤±è´¥:",e),null}},Ye=(e,s,t)=>{for(const a of s){const s=e[a];if(s&&s.type===t)switch(t){case"title":return s.title[0]?.text?.content;case"rich_text":return s.rich_text[0]?.text?.content;case"select":return s.select?.name;case"multi_select":return s.multi_select?.map(e=>e.name);case"number":return s.number;default:return null}}return null},Ze=async e=>{const s=N().Object.extend("Question");let t=0;for(const a of e)try{const e=await Xe(a.category),n=new(N().Query)("Question");n.equalTo("notionPageId",a.notionPageId);const i=await n.first()||new s;i.set("title",a.title),i.set("content",a.content),i.set("difficulty",a.difficulty),i.set("tags",a.tags),i.set("completionTime",a.completionTime),i.set("category",e),i.set("notionPageId",a.notionPageId),i.set("notionUrl",a.notionUrl),i.set("isActive",!0);const c=new(N().ACL);c.setPublicReadAccess(!0),c.setPublicWriteAccess(!0),i.setACL(c),await i.save(),t++,console.log(`âœ… ä¿å­˜é¢˜ç›®: "${a.title}" â†’ åˆ†ç±» "${a.category}"`)}catch(e){console.error(`ä¿å­˜é¢˜ç›®å¤±è´¥: ${a.title}`,e)}return await is(),t},Xe=async e=>{const s=N().Object.extend("Category"),t=new(N().Query)("Category");t.equalTo("name",e);let a=await t.first();if(!a){a=new s,a.set("name",e),a.set("questionCount",0);const t=new(N().ACL);t.setPublicReadAccess(!0),t.setPublicWriteAccess(!0),a.setACL(t),await a.save()}return a},es=async()=>{try{return await N().Cloud.run("checkNotionConnection")}catch(e){return{success:!1,connected:!1,error:e.message,message:"è¯·ç¡®ä¿å·²éƒ¨ç½²äº‘å‡½æ•°å¹¶é…ç½®çŽ¯å¢ƒå˜é‡"}}},ss=async()=>{try{console.log("å¼€å§‹ç”Ÿæˆç¤ºä¾‹æ•°æ®..."),await cs();const e=await ts(),s=await as(e);return await ns(e),console.log("ðŸŽ‰ ç¤ºä¾‹æ•°æ®ç”Ÿæˆå®Œæˆï¼"),{success:!0,categoriesCount:e.length,questionsCount:s.length,message:`æˆåŠŸç”Ÿæˆ ${e.length} ä¸ªåˆ†ç±»å’Œ ${s.length} ä¸ªé¢˜ç›®`}}catch(e){throw console.error("âŒ ç”Ÿæˆç¤ºä¾‹æ•°æ®å¤±è´¥:",e),new Error(`ç”Ÿæˆå¤±è´¥: ${e.message}`)}},ts=async()=>{const e=N().Object.extend("Category"),s=[{name:"JavaScript æ ¸å¿ƒæ¦‚å¿µ"},{name:"React æ¡†æž¶åŽŸç†"},{name:"ç®—æ³•ä¸Žæ•°æ®ç»“æž„"},{name:"è®¡ç®—æœºç½‘ç»œ"},{name:"æ•°æ®åº“ç³»ç»Ÿ"},{name:"æ“ä½œç³»ç»Ÿ"},{name:"å‰ç«¯å·¥ç¨‹åŒ–"},{name:"TypeScript è¿›é˜¶"}],t=[];for(const a of s){const s=new e;s.set("name",a.name),s.set("questionCount",0);const n=new(N().ACL);n.setPublicReadAccess(!0),n.setPublicWriteAccess(!0),s.setACL(n);const i=await s.save();t.push(i),console.log(`âœ… åˆ›å»ºåˆ†ç±»: ${a.name}`)}return t},as=async e=>{const s=N().Object.extend("Question"),t=[],a=[];for(const n of t){const t=new s;t.set("title",n.title),t.set("answer",n.answer),t.set("tags",n.tags),t.set("difficulty",n.difficulty),t.set("completionTime",n.completionTime),t.set("proficiency",n.proficiency),t.set("category",e[n.categoryIndex]),t.set("isActive",!0);const i=new(N().ACL);i.setPublicReadAccess(!0),i.setPublicWriteAccess(!0),t.setACL(i);const c=await t.save();a.push(c),console.log(`âœ… åˆ›å»ºé¢˜ç›®: "${n.title}" â†’ å±žäºŽ "${e[n.categoryIndex].get("name")}"`)}return a},ns=async e=>{for(const s of e){const e=new(N().Query)("Question");e.equalTo("category",s);const t=await e.count();s.set("questionCount",t),await s.save(),console.log(`ðŸ“Š åˆ†ç±» "${s.get("name")}" æœ‰ ${t} ä¸ªé¢˜ç›®`)}},is=async()=>{const e=new(N().Query)("Category"),s=await e.find();for(const e of s){const s=new(N().Query)("Question");s.equalTo("category",e);const t=await s.count();e.set("questionCount",t),await e.save()}console.log(`ðŸ“Š æ›´æ–°äº† ${s.length} ä¸ªåˆ†ç±»çš„é¢˜ç›®è®¡æ•°`)},cs=async()=>{try{console.log("å¼€å§‹æ¸…é™¤æ‰€æœ‰æ•°æ®...");let e=0,s=0;try{const s=new(N().Query)("Question"),t=await s.find();t.length>0&&(await N().Object.destroyAll(t),e=t.length,console.log(`ðŸ—‘ï¸ åˆ é™¤äº† ${e} ä¸ªé¢˜ç›®`))}catch(e){console.log("æ²¡æœ‰é¢˜ç›®éœ€è¦åˆ é™¤æˆ–åˆ é™¤å¤±è´¥:",e.message)}try{const e=new(N().Query)("Category"),t=await e.find();t.length>0&&(await N().Object.destroyAll(t),s=t.length,console.log(`ðŸ—‘ï¸ åˆ é™¤äº† ${s} ä¸ªåˆ†ç±»`))}catch(e){console.log("æ²¡æœ‰åˆ†ç±»éœ€è¦åˆ é™¤æˆ–åˆ é™¤å¤±è´¥:",e.message)}const t=`æ¸…é™¤å®Œæˆ: ${s} ä¸ªåˆ†ç±», ${e} ä¸ªé¢˜ç›®`;return console.log("âœ… "+t),{success:!0,deletedCategories:s,deletedQuestions:e,message:t}}catch(e){throw console.error("âŒ æ¸…é™¤æ•°æ®å¤±è´¥:",e),new Error(`æ¸…é™¤å¤±è´¥: ${e.message}`)}},rs=async()=>{try{let e=0,s=0;try{const s=new(N().Query)("Category");e=await s.count()}catch(s){e=0}try{const e=new(N().Query)("Question");s=await e.count()}catch(e){s=0}const t={categoryCount:e,questionCount:s,hasData:e>0||s>0};return console.log("ðŸ“Š æ•°æ®çŠ¶æ€:",t),t}catch(e){throw console.error("æ£€æŸ¥æ•°æ®çŠ¶æ€å¤±è´¥:",e),e}};"undefined"!=typeof window&&(window.generateSampleData=ss,window.clearAllData=cs,window.checkDataStatus=rs,window.syncProblemsFromNotion=Ke,window.checkNotionConnection=es,window.defineNotionCloudFunctions=()=>{void 0!==N().Cloud&&(N().Cloud.define("syncProblemsFromNotion",async e=>{const{Client:s}=t(1007),a=new s({auth:"MISSING_ENV_VAR".NOTION_INTEGRATION_TOKEN});try{console.log("å¼€å§‹ä»Ž Notion æ•°æ®åº“åŒæ­¥æ•°æ®...");const e=await a.databases.query({database_id:"MISSING_ENV_VAR".NOTION_DATABASE_ID,sorts:[{timestamp:"last_edited_time",direction:"descending"}]});console.log(`ä»Ž Notion èŽ·å–åˆ° ${e.results.length} æ¡è®°å½•`);const s=[];let t=0;for(const t of e.results){const e=Ge(t);e&&s.push(e)}return t=await Ze(s),{success:!0,message:`åŒæ­¥å®Œæˆï¼å¤„ç† ${e.results.length} æ¡è®°å½•ï¼ŒæˆåŠŸä¿å­˜ ${t} é“é¢˜ç›®`,data:{fetched:e.results.length,saved:t,problems:s.slice(0,5)}}}catch(e){throw console.error("Notion åŒæ­¥é”™è¯¯:",e),new(N().Cloud.Error)(`åŒæ­¥å¤±è´¥: ${e.message}`)}}),N().Cloud.define("checkNotionConnection",async e=>{const{Client:s}=t(1007);try{const e=new s({auth:"MISSING_ENV_VAR".NOTION_INTEGRATION_TOKEN}),t=await e.databases.retrieve({database_id:"MISSING_ENV_VAR".NOTION_DATABASE_ID});return{success:!0,connected:!0,database:{title:t.title[0]?.plain_text||"æœªå‘½å",properties:Object.keys(t.properties),url:t.url}}}catch(e){return{success:!1,connected:!1,error:e.message}}}))},window.createCommunityClasses=Re,window.generateCommunitySampleData=_e,window.clearCommunityData=Je,console.log("\nðŸŽ¯ æ•°æ®åº“ç®¡ç†å·¥å…·å·²åŠ è½½ï¼\n\nðŸ“š æ•°æ®ç®¡ç†:\n1. generateSampleData()          - ç”Ÿæˆç¤ºä¾‹æ•°æ®\n2. clearAllData()                - æ¸…é™¤æ‰€æœ‰æ•°æ®\n3. checkDataStatus()             - æ£€æŸ¥æ•°æ®çŠ¶æ€\n\nðŸ”„ Notion åŒæ­¥:\n4. syncProblemsFromNotion()      - ä»Ž Notion å¯¼å…¥é¢˜ç›®\n5. checkNotionConnection()       - æ£€æŸ¥ Notion è¿žæŽ¥çŠ¶æ€\n6. defineNotionCloudFunctions()  - å®šä¹‰äº‘å‡½æ•°ï¼ˆç”¨äºŽäº‘å¼•æ“Žï¼‰\n\nðŸ‘¥ ç¤¾åŒºåŠŸèƒ½:\n7. createCommunityClasses()      - åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨\n8. generateCommunitySampleData() - ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®\n9. clearCommunityData()          - æ¸…é™¤ç¤¾åŒºæ•°æ®\n\nðŸ’¡ ä½¿ç”¨æç¤º:\n- é¦–æ¬¡ä½¿ç”¨è¯·è¿è¡Œ generateSampleData() åˆ›å»ºç¤ºä¾‹æ•°æ®\n- ä½¿ç”¨ç¤¾åŒºåŠŸèƒ½å‰è¿è¡Œ createCommunityClasses() åˆ›å»ºæ•°æ®è¡¨\n- é…ç½® Notion çŽ¯å¢ƒå˜é‡åŽä½¿ç”¨ syncProblemsFromNotion() åŒæ­¥\n- äº‘å‡½æ•°éœ€è¦åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½²\n  "));const ls=()=>{const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(null),[r,l]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[h,u]=(0,a.useState)(null),[m,g]=(0,a.useState)("notion"),x=async()=>{s(!0);try{const e=await rs();c(e),n(`ðŸ“Š å½“å‰æ•°æ®: ${e.categoryCount} ä¸ªåˆ†ç±», ${e.questionCount} ä¸ªé¢˜ç›®`)}catch(e){n(`âŒ æ£€æŸ¥å¤±è´¥: ${e.message}`)}finally{s(!1)}},j=async()=>{s(!0);try{const e={postCount:0,commentCount:0,likeCount:0,followCount:0,hasData:!1};try{e.postCount=0,e.commentCount=0,e.likeCount=0,e.followCount=0,e.hasData=!1,n("ðŸ“Š ç¤¾åŒºæ•°æ®çŠ¶æ€å·²æ£€æŸ¥ï¼Œè¯·å…ˆåˆ›å»ºç¤¾åŒºæ•°æ®è¡¨")}catch(e){n('ðŸ“Š ç¤¾åŒºæ•°æ®è¡¨å°šæœªåˆ›å»ºï¼Œè¯·å…ˆç‚¹å‡»"åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨"')}u(e)}catch(e){n(`âŒ æ£€æŸ¥ç¤¾åŒºçŠ¶æ€å¤±è´¥: ${e.message}`)}finally{s(!1)}};return(0,p.jsxs)("div",{className:"init-page",children:[(0,p.jsxs)("header",{className:"page-header",children:[(0,p.jsx)("h1",{children:"ðŸŽ¯ æ•°æ®åº“ç®¡ç†å·¥å…·"}),(0,p.jsx)("p",{children:"ç®¡ç† Categoryã€Question å’Œç¤¾åŒºæ•°æ®ï¼Œæ”¯æŒ Notion åŒæ­¥"})]}),(0,p.jsx)("section",{className:"tab-navigation",children:(0,p.jsxs)("div",{className:"tabs",children:[(0,p.jsx)("button",{className:"tab "+("notion"===m?"active":""),onClick:()=>g("notion"),children:"ðŸ”„ Notion åŒæ­¥"}),(0,p.jsx)("button",{className:"tab "+("data"===m?"active":""),onClick:()=>g("data"),children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,p.jsx)("button",{className:"tab "+("community"===m?"active":""),onClick:()=>g("community"),children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"})]})}),"notion"===m&&(0,p.jsxs)("section",{className:"notion-section",children:[(0,p.jsx)("h2",{children:"ðŸ”„ Notion æ•°æ®åŒæ­¥"}),(0,p.jsxs)("div",{className:"action-buttons",children:[(0,p.jsx)("button",{onClick:async()=>{s(!0),n(""),l(null);try{const e=await es();l(e),e.success&&e.connected?n(`âœ… Notion è¿žæŽ¥æ­£å¸¸ï¼æ•°æ®åº“: ${e.database.title}`):n(`âš ï¸ Notion è¿žæŽ¥å¼‚å¸¸: ${e.error||"è¯·æ£€æŸ¥é…ç½®"}`)}catch(e){n(`âŒ æ£€æŸ¥ Notion è¿žæŽ¥å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-notion",children:"ðŸ”— æ£€æŸ¥ Notion è¿žæŽ¥"}),(0,p.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦ä»Ž Notion å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™ä¼šæ·»åŠ æ–°é¢˜ç›®åˆ°çŽ°æœ‰æ•°æ®ä¸­ã€‚")){s(!0),n(""),d(null);try{const e=await Ke();d(e),e.success?(n(`âœ… ${e.message}`),await x()):n(`âš ï¸ ${e.message}`)}catch(e){n(`âŒ åŒæ­¥å¤±è´¥: ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-sync",children:"ðŸ“¥ ä»Ž Notion å¯¼å…¥"})]}),r&&(0,p.jsxs)("div",{className:"notion-status",children:[(0,p.jsx)("h4",{children:"Notion è¿žæŽ¥çŠ¶æ€"}),(0,p.jsxs)("div",{className:"status-card "+(r.connected?"connected":"disconnected"),children:[(0,p.jsxs)("div",{className:"status-header",children:[(0,p.jsx)("span",{className:"status-indicator",children:r.connected?"ðŸŸ¢":"ðŸ”´"}),(0,p.jsx)("strong",{children:r.connected?"è¿žæŽ¥æ­£å¸¸":"è¿žæŽ¥å¼‚å¸¸"})]}),r.connected&&r.database&&(0,p.jsxs)("div",{className:"database-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"æ•°æ®åº“:"})," ",r.database.title]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"å±žæ€§å­—æ®µ:"})," ",r.database.properties.length," ä¸ª"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"URL:"}),(0,p.jsx)("a",{href:r.database.url,target:"_blank",rel:"noopener noreferrer",children:"æŸ¥çœ‹æ•°æ®åº“"})]})]}),!r.connected&&(0,p.jsxs)("div",{className:"error-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"é”™è¯¯ä¿¡æ¯:"})," ",r.error]}),(0,p.jsx)("p",{className:"help-text",children:"ðŸ’¡ è¯·ç¡®ä¿å·²éƒ¨ç½²äº‘å‡½æ•°å¹¶é…ç½®çŽ¯å¢ƒå˜é‡"})]})]})]}),o&&(0,p.jsxs)("div",{className:"sync-result",children:[(0,p.jsx)("h4",{children:"åŒæ­¥ç»“æžœ"}),(0,p.jsxs)("div",{className:"result-card",children:[(0,p.jsxs)("div",{className:"result-stats",children:[(0,p.jsxs)("div",{className:"stat",children:[(0,p.jsx)("span",{className:"stat-label",children:"èŽ·å–è®°å½•:"}),(0,p.jsx)("span",{className:"stat-value",children:o.data?.fetched||0})]}),(0,p.jsxs)("div",{className:"stat",children:[(0,p.jsx)("span",{className:"stat-label",children:"æˆåŠŸä¿å­˜:"}),(0,p.jsx)("span",{className:"stat-value",children:o.data?.saved||0})]}),(0,p.jsxs)("div",{className:"stat",children:[(0,p.jsx)("span",{className:"stat-label",children:"åŒæ­¥æ¨¡å¼:"}),(0,p.jsx)("span",{className:"stat-value",children:o.data?.mode||"cloud"})]})]}),o.data?.problems&&o.data.problems.length>0&&(0,p.jsxs)("div",{className:"synced-problems",children:[(0,p.jsx)("h5",{children:"æœ€è¿‘åŒæ­¥çš„é¢˜ç›®:"}),(0,p.jsx)("ul",{children:o.data.problems.slice(0,3).map((e,s)=>(0,p.jsxs)("li",{children:[(0,p.jsx)("span",{className:"problem-title",children:e.title}),(0,p.jsx)("span",{className:"problem-category",children:e.category})]},s))})]})]})]})]}),"data"===m&&(0,p.jsxs)("section",{className:"data-management-section",children:[(0,p.jsx)("h2",{children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,p.jsxs)("div",{className:"action-buttons",children:[(0,p.jsx)("button",{onClick:x,disabled:e,className:"btn btn-info",children:"ðŸ” æ£€æŸ¥çŠ¶æ€"}),(0,p.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await ss();n(`âœ… ${e.message}`),await x()}catch(e){n(`âŒ ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-success",children:"ðŸš€ ç”Ÿæˆç¤ºä¾‹æ•°æ®"}),(0,p.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")){s(!0),n("");try{const e=await cs();n(`âœ… ${e.message}`),await x()}catch(e){n(`âŒ ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-danger",children:"ðŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®"})]}),i&&(0,p.jsxs)("div",{className:"status-info",children:[(0,p.jsx)("h4",{children:"ðŸ“ˆ æ•°æ®çŠ¶æ€"}),(0,p.jsxs)("div",{className:"status-grid",children:[(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"åˆ†ç±»æ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:i.categoryCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"é¢˜ç›®æ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:i.questionCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"æ•°æ®çŠ¶æ€:"}),(0,p.jsx)("span",{className:"value "+(i.hasData?"has-data":"no-data"),children:i.hasData?"æœ‰æ•°æ®":"æ— æ•°æ®"})]})]})]})]}),"community"===m&&(0,p.jsxs)("section",{className:"community-management-section",children:[(0,p.jsx)("h2",{children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"}),(0,p.jsx)("p",{className:"section-description",children:"ç®¡ç†å­¦ä¹ ç¤¾åŒºçš„å¸–å­ã€è¯„è®ºã€ç‚¹èµžç­‰ç¤¾äº¤åŠŸèƒ½æ•°æ®"}),(0,p.jsxs)("div",{className:"action-buttons",children:[(0,p.jsx)("button",{onClick:j,disabled:e,className:"btn btn-info",children:"ðŸ” æ£€æŸ¥ç¤¾åŒºçŠ¶æ€"}),(0,p.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await Re();if(e.Post.success&&e.Comment.success&&e.Like.success&&e.Follow.success)n("âœ… ç¤¾åŒºæ•°æ®è¡¨åˆ›å»ºæˆåŠŸï¼æ‰€æœ‰è¡¨éƒ½å·²å°±ç»ª");else{const s=[];e.Post.success||s.push("Post"),e.Comment.success||s.push("Comment"),e.Like.success||s.push("Like"),e.Follow.success||s.push("Follow"),s.length>0?n(`âš ï¸ éƒ¨åˆ†è¡¨åˆ›å»ºå¤±è´¥: ${s.join(", ")}ã€‚å¯èƒ½è¡¨å·²å­˜åœ¨æˆ–æƒé™ä¸è¶³`):n("âœ… ç¤¾åŒºæ•°æ®è¡¨åˆ›å»ºå®Œæˆ")}await j()}catch(e){n(`âŒ åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-primary",children:"ðŸ—ï¸ åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨"}),(0,p.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await _e();n(`âœ… ${e.message}`),await j()}catch(e){n(`âŒ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-success",children:"ðŸš€ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®"}),(0,p.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¤¾åŒºæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")){s(!0),n("");try{const e=await Je();n(`âœ… ${e.message}`),await j()}catch(e){n(`âŒ æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥: ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-danger",children:"ðŸ—‘ï¸ æ¸…é™¤ç¤¾åŒºæ•°æ®"})]}),h&&(0,p.jsxs)("div",{className:"status-info",children:[(0,p.jsx)("h4",{children:"ðŸ“ˆ ç¤¾åŒºæ•°æ®çŠ¶æ€"}),(0,p.jsxs)("div",{className:"status-grid",children:[(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"å¸–å­æ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:h.postCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"è¯„è®ºæ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:h.commentCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"ç‚¹èµžæ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:h.likeCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"å…³æ³¨æ•°é‡:"}),(0,p.jsx)("span",{className:"value",children:h.followCount})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"æ•°æ®çŠ¶æ€:"}),(0,p.jsx)("span",{className:"value "+(h.hasData?"has-data":"no-data"),children:h.hasData?"æœ‰æ•°æ®":"æ— æ•°æ®"})]})]})]}),(0,p.jsxs)("div",{className:"community-classes-info",children:[(0,p.jsx)("h4",{children:"ðŸ—ï¸ ç¤¾åŒºæ•°æ®è¡¨ç»“æž„"}),(0,p.jsxs)("div",{className:"classes-grid",children:[(0,p.jsxs)("div",{className:"class-card",children:[(0,p.jsx)("h5",{children:"ðŸ“ Post (å¸–å­)"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"title - å¸–å­æ ‡é¢˜"}),(0,p.jsx)("li",{children:"content - å¸–å­å†…å®¹"}),(0,p.jsx)("li",{children:"author - ä½œè€…"}),(0,p.jsx)("li",{children:"tags - æ ‡ç­¾æ•°ç»„"}),(0,p.jsx)("li",{children:"likes - ç‚¹èµžæ•°"}),(0,p.jsx)("li",{children:"views - æµè§ˆæ•°"}),(0,p.jsx)("li",{children:"commentCount - è¯„è®ºæ•°"}),(0,p.jsx)("li",{children:"isPublic - æ˜¯å¦å…¬å¼€"}),(0,p.jsx)("li",{children:"status - å¸–å­çŠ¶æ€"})]})]}),(0,p.jsxs)("div",{className:"class-card",children:[(0,p.jsx)("h5",{children:"ðŸ’¬ Comment (è¯„è®º)"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"content - è¯„è®ºå†…å®¹"}),(0,p.jsx)("li",{children:"author - è¯„è®ºä½œè€…"}),(0,p.jsx)("li",{children:"post - æ‰€å±žå¸–å­"}),(0,p.jsx)("li",{children:"parent - çˆ¶è¯„è®º"}),(0,p.jsx)("li",{children:"likes - ç‚¹èµžæ•°"})]})]}),(0,p.jsxs)("div",{className:"class-card",children:[(0,p.jsx)("h5",{children:"ðŸ‘ Like (ç‚¹èµž)"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"user - ç‚¹èµžç”¨æˆ·"}),(0,p.jsx)("li",{children:"post - è¢«ç‚¹èµžå¸–å­"}),(0,p.jsx)("li",{children:"comment - è¢«ç‚¹èµžè¯„è®º"})]})]}),(0,p.jsxs)("div",{className:"class-card",children:[(0,p.jsx)("h5",{children:"ðŸ‘¥ Follow (å…³æ³¨)"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"follower - å…³æ³¨è€…"}),(0,p.jsx)("li",{children:"following - è¢«å…³æ³¨è€…"})]})]})]})]})]}),e&&(0,p.jsxs)("div",{className:"loading-state",children:[(0,p.jsx)("div",{className:"spinner"}),(0,p.jsx)("span",{children:"æ‰§è¡Œä¸­..."})]}),t&&(0,p.jsx)("div",{className:"message "+(t.includes("âŒ")?"error":t.includes("âš ï¸")?"warning":"success"),children:t}),(0,p.jsxs)("div",{className:"instructions",children:[(0,p.jsx)("h3",{children:"ðŸ“– ä½¿ç”¨è¯´æ˜Ž"}),"notion"===m&&(0,p.jsxs)("div",{className:"instruction-item",children:[(0,p.jsx)("h4",{children:"ðŸ”„ Notion åŒæ­¥"}),(0,p.jsxs)("ul",{children:[(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ£€æŸ¥è¿žæŽ¥:"})," éªŒè¯ Notion API è¿žæŽ¥çŠ¶æ€"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"ä»Ž Notion å¯¼å…¥:"})," å°† Notion æ•°æ®åº“ä¸­çš„é¢˜ç›®åŒæ­¥åˆ°æœ¬åœ°"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ™ºèƒ½åŒ¹é…:"})," è‡ªåŠ¨è¯†åˆ«åˆ†ç±»ã€éš¾åº¦ã€æ ‡ç­¾ç­‰å­—æ®µ"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"åŽ»é‡æœºåˆ¶:"})," åŸºäºŽ Notion Page ID é¿å…é‡å¤å¯¼å…¥"]})]})]}),"data"===m&&(0,p.jsxs)("div",{className:"instruction-item",children:[(0,p.jsx)("h4",{children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,p.jsxs)("ul",{children:[(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"ç”Ÿæˆç¤ºä¾‹æ•°æ®:"})," åˆ›å»ºåˆ†ç±»å’Œé¢˜ç›®ç¤ºä¾‹æ•°æ®"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ£€æŸ¥çŠ¶æ€:"})," æŸ¥çœ‹å½“å‰æ•°æ®ç»Ÿè®¡"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ¸…é™¤æ•°æ®:"})," åˆ é™¤æ‰€æœ‰é¢˜ç›®å’Œåˆ†ç±»æ•°æ®"]})]})]}),"community"===m&&(0,p.jsxs)("div",{className:"instruction-item",children:[(0,p.jsx)("h4",{children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"}),(0,p.jsxs)("ul",{children:[(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"åˆ›å»ºæ•°æ®è¡¨:"})," åˆå§‹åŒ–ç¤¾åŒºåŠŸèƒ½æ‰€éœ€çš„æ•°æ®è¡¨ï¼ˆPostã€Commentã€Likeã€Followï¼‰"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"ç”Ÿæˆç¤ºä¾‹æ•°æ®:"})," åˆ›å»ºç¤ºä¾‹å¸–å­ã€è¯„è®ºå’Œç‚¹èµžæ•°æ®"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ£€æŸ¥çŠ¶æ€:"})," æŸ¥çœ‹ç¤¾åŒºæ•°æ®ç»Ÿè®¡"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"æ¸…é™¤æ•°æ®:"})," åˆ é™¤æ‰€æœ‰ç¤¾åŒºç›¸å…³æ•°æ®"]})]}),(0,p.jsxs)("div",{className:"community-features",children:[(0,p.jsx)("h5",{children:"ç¤¾åŒºåŠŸèƒ½ç‰¹æ€§:"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"ðŸ“ å‘å¸–å’Œå†…å®¹ç®¡ç†"}),(0,p.jsx)("li",{children:"ðŸ’¬ è¯„è®ºå’Œå›žå¤ç³»ç»Ÿ"}),(0,p.jsx)("li",{children:"ðŸ‘ ç‚¹èµžäº’åŠ¨åŠŸèƒ½"}),(0,p.jsx)("li",{children:"ðŸ‘¥ ç”¨æˆ·å…³æ³¨ç³»ç»Ÿ"}),(0,p.jsx)("li",{children:"ðŸ” å®Œå–„çš„æƒé™æŽ§åˆ¶"})]})]})]}),(0,p.jsxs)("div",{className:"instruction-item",children:[(0,p.jsx)("h4",{children:"ðŸ”§ çŽ¯å¢ƒé…ç½®è¦æ±‚"}),(0,p.jsxs)("div",{className:"config-requirements",children:[(0,p.jsxs)("div",{className:"config-item",children:[(0,p.jsx)("strong",{children:"Notion é›†æˆ:"}),(0,p.jsx)("span",{children:"éœ€è¦é…ç½® NOTION_INTEGRATION_TOKEN å’Œ NOTION_DATABASE_ID"})]}),(0,p.jsxs)("div",{className:"config-item",children:[(0,p.jsx)("strong",{children:"äº‘å‡½æ•°éƒ¨ç½²:"}),(0,p.jsx)("span",{children:"éœ€è¦åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½²åŒæ­¥å‡½æ•°"})]}),(0,p.jsxs)("div",{className:"config-item",children:[(0,p.jsx)("strong",{children:"æ•°æ®åº“æƒé™:"}),(0,p.jsx)("span",{children:"Notion æ•°æ®åº“éœ€è¦åˆ†äº«ç»™é›†æˆ"})]})]})]})]})]})};var os=t(6475),ds=t(7097);const hs=({question:e,onSave:s,onCancel:t,defaultCategoryId:n,onCategoryChange:i})=>{const[c,r]=(0,a.useState)({title:"",detailedAnswer:"",oralAnswer:"",code:"",url:"",tags:[],difficulty:$,proficiency:P,appearanceLevel:50,categoryId:"",images:[]}),[l,o]=(0,a.useState)([]),[d,h]=(0,a.useState)(""),[u,m]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[j,v]=(0,a.useState)({}),[y,f]=(0,a.useState)("detailed"),[w,b]=(0,a.useState)([]),C=N().User.current(),S=(0,a.useRef)(null),k=(0,a.useRef)(null),A=(0,a.useRef)(null),E=!!e;(0,a.useEffect)(()=>{N().User.current()&&(L(),e?r({title:e.title||"",detailedAnswer:e.detailedAnswer||"",oralAnswer:e.oralAnswer||"",code:e.code||"",url:e.url||"",tags:e.tags||[],difficulty:e.difficulty||$,proficiency:e.proficiency||P,appearanceLevel:e.appearanceLevel||50,categoryId:e.category?.id||"",images:e.images||[]}):n&&r(e=>({...e,categoryId:n})))},[e,n]);const L=async()=>{if(C){x(!0);try{const e=await q(),s=e.filter(e=>{const s=e.createdBy;return s&&s.id===C.id});o(s),console.log("åŠ è½½åˆ°çš„åˆ†ç±»:",{æ€»æ•°:e.length,ç”¨æˆ·åˆ†ç±»:s.length,å½“å‰ç”¨æˆ·:C.id,åˆ†ç±»è¯¦æƒ…:s.map(e=>({id:e.id,name:e.name,createdBy:e.createdBy?.id}))}),!E&&!n&&s.length>0&&!c.categoryId&&(r(e=>({...e,categoryId:s[0].id})),console.log("è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªåˆ†ç±»:",s[0].id))}catch(e){console.error("åŠ è½½ç±»åˆ«å¤±è´¥:",e),v({categories:"åŠ è½½ç±»åˆ«å¤±è´¥: "+e.message})}finally{x(!1)}}},D=async(e,s)=>{const t=e.filter(e=>"image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type);if(0!==t.length)for(const e of t)await T(e,s);else alert("è¯·é€‰æ‹© JPG æˆ– PNG æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶")},T=async(e,s)=>{const t=Date.now().toString();try{b(e=>[...e,t]);const a=new(N().File)(e.name,e),n=await a.save(),i={id:t,objectId:n.id,url:n.url(),name:e.name,size:e.size,type:e.type,answerType:s};r(e=>({...e,images:[...e.images,i]})),I(i,s)}catch(e){console.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",e),alert(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${e.message}`)}finally{b(e=>e.filter(e=>e!==t))}},I=(e,s)=>{const t=`![${e.name}](${e.url})`,a="detailed"===s?"detailedAnswer":"oralAnswer";r(e=>{const s=e[a],n=s?`${s}\n${t}`:t;return{...e,[a]:n}})},Q=(e,s)=>{r(t=>({...t,[e]:s})),j[e]&&v(s=>({...s,[e]:""}))},O=()=>{const e=d.trim();if(e&&!c.tags.includes(e)){if(c.tags.length>=10)return void v({tags:"æ ‡ç­¾æ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ª"});r(s=>({...s,tags:[...s.tags,e]})),h(""),j.tags&&v(e=>({...e,tags:""}))}},R=(e,s,t)=>{const a=(n=e,c.images.filter(e=>e.answerType===n));var n;const i=w.length>0,l="detailed"===e?"detailedAnswer":"oralAnswer",o="detailed"===e?k:A;return(0,p.jsxs)("div",{className:"tab-panel",children:[(0,p.jsxs)("div",{className:"answer-textarea-container",onDragOver:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?k.current:A.current;t&&t.classList.add("drag-over")})(s,e),onDragLeave:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?k.current:A.current;t&&t.classList.remove("drag-over")})(s,e),onDrop:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?k.current:A.current;t&&t.classList.remove("drag-over");const a=Array.from(e.dataTransfer.files);D(a,s)})(s,e),children:[(0,p.jsx)("textarea",{ref:o,value:c[l],onChange:e=>Q(l,e.target.value),placeholder:s,rows:"detailed"===e?"6":"4",disabled:u,className:j.answer&&!c[l].trim()?"error":""}),(0,p.jsx)("div",{className:"upload-hint",children:(0,p.jsxs)("div",{className:"upload-hint-text",children:["ðŸ’¡ æ”¯æŒæ‹–æ‹½ JPG/PNG å›¾ç‰‡åˆ°æ­¤åŒºåŸŸï¼Œæˆ–",(0,p.jsx)("button",{type:"button",className:"upload-trigger-btn",onClick:()=>(e=>{S.current&&(S.current.setAttribute("data-answer-type",e),S.current.click())})(e),disabled:u||i,children:"ç‚¹å‡»ä¸Šä¼ "})]})})]}),a.length>0&&(0,p.jsxs)("div",{className:"uploaded-images",children:[(0,p.jsxs)("div",{className:"images-title",children:["å·²ä¸Šä¼ å›¾ç‰‡ (",a.length,"):"]}),(0,p.jsx)("div",{className:"images-grid",children:a.map(e=>(0,p.jsxs)("div",{className:"image-item",children:[(0,p.jsx)("img",{src:e.url,alt:e.name}),(0,p.jsxs)("div",{className:"image-info",children:[(0,p.jsx)("span",{className:"image-name",children:e.name}),(0,p.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>{return s=e.id,void r(e=>({...e,images:e.images.filter(e=>e.id!==s)}));var s},disabled:u,children:"Ã—"})]})]},e.id))})]}),(0,p.jsx)("div",{className:"tab-hint",children:t})]})};return C?(0,p.jsx)("div",{className:"question-form-overlay",children:(0,p.jsxs)("div",{className:"question-form-dialog",children:[(0,p.jsxs)("div",{className:"question-form-header",children:[(0,p.jsx)("h3",{children:E?"ç¼–è¾‘é¢˜ç›®":"æ·»åŠ æ–°é¢˜ç›®"}),(0,p.jsx)("div",{className:"user-info",children:(0,p.jsxs)("span",{className:"user-badge",children:["ðŸ‘¤ ",C.getUsername()]})}),(0,p.jsx)("button",{type:"button",className:"close-button",onClick:t,disabled:u,children:"Ã—"})]}),(0,p.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),C){if((()=>{const e={};return c.title.trim()?c.title.trim().length<2&&(e.title="é—®é¢˜æ ‡é¢˜è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦"):e.title="é—®é¢˜æ ‡é¢˜ä¸èƒ½ä¸ºç©º",c.detailedAnswer.trim()||c.oralAnswer.trim()||(e.answer="è‡³å°‘éœ€è¦å¡«å†™ä¸€ä¸ªç­”æ¡ˆç‰ˆæœ¬ï¼ˆè¯¦ç»†ç‰ˆæœ¬æˆ–å£è¿°ç‰ˆæœ¬ï¼‰"),c.categoryId||(e.categoryId="è¯·é€‰æ‹©ç±»åˆ«"),c.tags.length>10&&(e.tags="æ ‡ç­¾æ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ª"),c.url&&!(e=>{try{return new URL(e),!0}catch(e){return!1}})(c.url)&&(e.url="è¯·è¾“å…¥æœ‰æ•ˆçš„URLé“¾æŽ¥"),v(e),0===Object.keys(e).length})()){m(!0);try{if(E){const s=e.category,t=l.find(e=>e.id===c.categoryId),a=s?.id!==t?.id;await J(e.id,c),a&&i&&i({questionId:e.id,oldCategoryId:s?.id,newCategoryId:t?.id,question:{...e,...c,category:t}})}else await W(c);s(),window.dispatchEvent(new CustomEvent("questionCreated",{detail:{question:result}}))}catch(e){console.error("ä¿å­˜é¢˜ç›®å¤±è´¥:",e),v({submit:e.message})}finally{m(!1)}}}else alert("è¯·å…ˆç™»å½•")},className:"question-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"title",children:"é—®é¢˜æ ‡é¢˜ *"}),(0,p.jsx)("input",{id:"title",type:"text",value:c.title,onChange:e=>Q("title",e.target.value),placeholder:"è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜",disabled:u,className:j.title?"error":""}),j.title&&(0,p.jsx)("span",{className:"error-message",children:j.title})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"é—®é¢˜ç­”æ¡ˆ *"}),(0,p.jsxs)("div",{className:"answer-tabs-container",children:[(0,p.jsxs)("div",{className:"answer-tab-buttons",children:[(0,p.jsx)("button",{type:"button",className:"answer-tab-button "+("detailed"===y?"active":""),onClick:()=>f("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,p.jsx)("button",{type:"button",className:"answer-tab-button "+("oral"===y?"active":""),onClick:()=>f("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,p.jsxs)("div",{className:"answer-tab-content",children:["detailed"===y&&R("detailed","è¯·è¾“å…¥è¯¦ç»†çš„ç­”æ¡ˆè§£é‡Šï¼ŒåŒ…å«æŠ€æœ¯ç»†èŠ‚ã€åŽŸç†åˆ†æžç­‰","é€‚åˆè®°å½•å®Œæ•´çš„æŠ€æœ¯è§£æžå’Œè¯¦ç»†è¯´æ˜Ž"),"oral"===y&&R("oral","è¯·è¾“å…¥ç®€æ´çš„å£è¿°ç‰ˆæœ¬ç­”æ¡ˆï¼Œé€‚åˆé¢è¯•åœºæ™¯è¡¨è¾¾","é€‚åˆè®°å½•ç®€æ´çš„å£å¤´è¡¨è¾¾ç‰ˆæœ¬ï¼Œä¾¿äºŽé¢è¯•æ—¶å¿«é€Ÿå›žå¿†")]})]}),j.answer&&(0,p.jsx)("span",{className:"error-message",children:j.answer})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"code",children:"ç›¸å…³ä»£ç ï¼ˆå¯é€‰ï¼‰"}),(0,p.jsx)("textarea",{id:"code",value:c.code,onChange:e=>Q("code",e.target.value),placeholder:"è¯·è¾“å…¥ä¸Žè¯¥é¢˜ç›®ç›¸å…³çš„ä»£ç ç‰‡æ®µï¼Œå°†ä¿æŒåŽŸæ ¼å¼æ˜¾ç¤º",rows:"8",disabled:u,className:"code-textarea"}),(0,p.jsx)("div",{className:"field-hint",children:"ä»£ç å°†ä¿æŒåŽŸæ ¼å¼æ˜¾ç¤ºï¼Œé€‚åˆå±•ç¤ºç®—æ³•å®žçŽ°ã€ç»„ä»¶ä»£ç ç­‰"})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"url",children:"ç›¸å…³é“¾æŽ¥ï¼ˆå¯é€‰ï¼‰"}),(0,p.jsx)("input",{id:"url",type:"url",value:c.url,onChange:e=>Q("url",e.target.value),placeholder:"https://example.com",disabled:u,className:j.url?"error":""}),j.url&&(0,p.jsx)("span",{className:"error-message",children:j.url}),(0,p.jsx)("div",{className:"field-hint",children:"å¯æ·»åŠ ç›¸å…³çš„æ–‡æ¡£ã€æ–‡ç« æˆ–å‚è€ƒé“¾æŽ¥"})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"tags",children:"æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰"}),(0,p.jsxs)("div",{className:"tags-input-container",children:[(0,p.jsx)("input",{id:"tags",type:"text",value:d,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),O())},placeholder:"è¾“å…¥æ ‡ç­¾åŽæŒ‰å›žè½¦æˆ–ç‚¹å‡»æ·»åŠ ",disabled:u,maxLength:20}),(0,p.jsx)("button",{type:"button",onClick:O,disabled:u||!d.trim(),className:"add-tag-button",children:"æ·»åŠ "})]}),j.tags&&(0,p.jsx)("span",{className:"error-message",children:j.tags}),c.tags.length>0&&(0,p.jsxs)("div",{className:"tags-list",children:[(0,p.jsx)("div",{className:"tags-header",children:(0,p.jsxs)("span",{children:["å·²æ·»åŠ æ ‡ç­¾ (",c.tags.length,"/10):"]})}),(0,p.jsx)("div",{className:"tags-container",children:c.tags.map((e,s)=>(0,p.jsxs)("span",{className:"tag",children:[e,(0,p.jsx)("button",{type:"button",onClick:()=>{return s=e,void r(e=>({...e,tags:e.tags.filter(e=>e!==s)}));var s},disabled:u,className:"remove-tag-button",children:"Ã—"})]},s))})]})]}),(0,p.jsxs)("div",{className:"form-row",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"difficulty",children:"éš¾åº¦"}),(0,p.jsxs)("select",{id:"difficulty",value:c.difficulty,onChange:e=>Q("difficulty",e.target.value),disabled:u,children:[(0,p.jsx)("option",{value:"easy",children:"ç®€å•"}),(0,p.jsx)("option",{value:$,children:"ä¸­ç­‰"}),(0,p.jsx)("option",{value:"hard",children:"å›°éš¾"})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"proficiency",children:"æŽŒæ¡ç¨‹åº¦"}),(0,p.jsxs)("select",{id:"proficiency",value:c.proficiency,onChange:e=>Q("proficiency",e.target.value),disabled:u,children:[(0,p.jsx)("option",{value:P,children:"åˆçº§"}),(0,p.jsx)("option",{value:"intermediate",children:"ä¸­çº§"}),(0,p.jsx)("option",{value:"advanced",children:"é«˜çº§"}),(0,p.jsx)("option",{value:"master",children:"ç²¾é€š"})]})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsxs)("label",{htmlFor:"appearanceLevel",children:["å‡ºçŽ°é¢‘çŽ‡: ",c.appearanceLevel,"%",(0,p.jsx)("span",{className:"field-hint",children:"ï¼ˆæ•°å€¼è¶Šé«˜ï¼Œåœ¨å¤ä¹ æ—¶å‡ºçŽ°çš„æ¦‚çŽ‡è¶Šå¤§ï¼‰"})]}),(0,p.jsx)("input",{id:"appearanceLevel",type:"range",min:"0",max:"100",value:c.appearanceLevel,onChange:e=>Q("appearanceLevel",parseInt(e.target.value)),disabled:u,className:"appearance-slider"}),(0,p.jsxs)("div",{className:"slider-labels",children:[(0,p.jsx)("span",{children:"ä½Žé¢‘"}),(0,p.jsx)("span",{children:"ä¸­é¢‘"}),(0,p.jsx)("span",{children:"é«˜é¢‘"})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"category",children:"ç±»åˆ« *"}),g?(0,p.jsx)("div",{className:"loading-categories",children:"åŠ è½½ç±»åˆ«ä¸­..."}):0===l.length?(0,p.jsxs)("div",{className:"no-categories",children:[(0,p.jsx)("div",{className:"no-categories-icon",children:"ðŸ“"}),(0,p.jsx)("p",{children:"æš‚æ— ç±»åˆ«ï¼Œè¯·å…ˆåˆ›å»ºç±»åˆ«"}),(0,p.jsx)("button",{type:"button",className:"create-category-btn",onClick:()=>{t(),window.dispatchEvent(new CustomEvent("showCategoryManagement"))},children:"ðŸš€ åŽ»åˆ›å»ºåˆ†ç±»"})]}):(0,p.jsxs)("select",{id:"category",value:c.categoryId,onChange:e=>Q("categoryId",e.target.value),disabled:u,className:j.categoryId?"error":"",children:[(0,p.jsx)("option",{value:"",children:"è¯·é€‰æ‹©ç±»åˆ«"}),l.map(e=>(0,p.jsxs)("option",{value:e.id,children:[e.name," (",e.questionCount||0,"é¢˜)"]},e.id))]}),j.categoryId&&(0,p.jsx)("span",{className:"error-message",children:j.categoryId})]}),j.submit&&(0,p.jsx)("div",{className:"submit-error",children:j.submit}),(0,p.jsxs)("div",{className:"form-actions",children:[(0,p.jsx)("button",{type:"button",onClick:t,disabled:u,className:"btn-secondary",children:"å–æ¶ˆ"}),(0,p.jsx)("button",{type:"submit",disabled:u,className:"btn-primary",children:u?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{className:"loading-spinner"}),E?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­..."]}):E?"æ›´æ–°é¢˜ç›®":"æ·»åŠ é¢˜ç›®"})]})]}),(0,p.jsx)("input",{type:"file",ref:S,style:{display:"none"},accept:".jpg,.jpeg,.png",multiple:!0,onChange:e=>{const s=e.target.getAttribute("data-answer-type");((e,s)=>{const t=Array.from(e.target.files);D(t,s),e.target.value=""})(e,s)}})]})}):(0,p.jsx)("div",{className:"question-form-overlay",children:(0,p.jsxs)("div",{className:"question-form-dialog",children:[(0,p.jsxs)("div",{className:"question-form-header",children:[(0,p.jsx)("h3",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("button",{type:"button",className:"close-button",onClick:t,children:"Ã—"})]}),(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯æ·»åŠ æˆ–ç¼–è¾‘é¢˜ç›®"}),(0,p.jsxs)("div",{className:"auth-required-actions",children:[(0,p.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"}),(0,p.jsx)("button",{onClick:t,className:"btn-secondary",children:"å–æ¶ˆ"})]})]})]})})},us=({question:e,onDelete:s,isExpandedView:t=!1,onUpdateField:n,onEdit:i,showQuestionForm:c,setShowQuestionForm:r,editingQuestion:l,setEditingQuestion:o})=>{const[d,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)(t),[g,x]=(0,a.useState)(!1),[j,v]=(0,a.useState)(!1),[y,f]=(0,a.useState)("oral"),[w,b]=(0,a.useState)(e?.appearanceLevel||50),[C,S]=(0,a.useState)(!1),[k,A]=(0,a.useState)(!1),[E,q]=(0,a.useState)(7),[L,D]=(0,a.useState)(!1),[T,$]=(0,a.useState)(!1),[P,I]=(0,a.useState)(7),[Q,O]=(0,a.useState)(!1),[R,U]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=N().User.current();U(e)},[]),(0,a.useEffect)(()=>{console.log("question.appearanceLevel å˜åŒ–:",e?.appearanceLevel),b(e?.appearanceLevel)},[e?.appearanceLevel]),(0,a.useEffect)(()=>{console.log("localAppearanceLevel çŠ¶æ€å˜åŒ–:",w)},[w]);const M=e=>e>=80?"#ff6b6b":e>=60?"#ffa726":e>=40?"#4ecdc4":"#95a5a6",B=e=>(e=>{if(!e||""===e.trim())return(0,p.jsx)("span",{className:"no-content",children:"æš‚æ— å†…å®¹"});const s=e.split("\n"),t=[];let a=!1,n=[],i="";return s.forEach((e,s)=>{if(e.trim().startsWith("```"))return a?(a=!1,void t.push((0,p.jsx)("pre",{className:"code-block",children:(0,p.jsx)("code",{className:`language-${i}`,children:n.join("\n")})},`code-${s}`))):(a=!0,i=e.trim().substring(3).trim()||"text",void(n=[]));if(a)return void n.push(e);if(""===e.trim())return void t.push((0,p.jsx)("br",{},`br-${s}`));const c=e.match(/!\[(.*?)\]\((.*?)\)/);if(c){const e=c[1],a=c[2];return void t.push((0,p.jsxs)("div",{className:"markdown-image-container",children:[(0,p.jsx)("img",{src:a,alt:e,className:"markdown-image-preview",onClick:e=>{e.stopPropagation(),window.open(a,"_blank")}}),e&&""!==e&&(0,p.jsx)("div",{className:"image-alt-text",children:e})]},`img-${s}`))}let r=e;if(e.startsWith("### "))return void t.push((0,p.jsx)("h3",{className:"md-h3",children:e.substring(4)},`h3-${s}`));if(e.startsWith("## "))return void t.push((0,p.jsx)("h2",{className:"md-h2",children:e.substring(3)},`h2-${s}`));if(e.startsWith("# "))return void t.push((0,p.jsx)("h1",{className:"md-h1",children:e.substring(2)},`h1-${s}`));if(r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r=r.replace(/__(.*?)__/g,"<strong>$1</strong>"),r=r.replace(/\*(.*?)\*/g,"<em>$1</em>"),r=r.replace(/_(.*?)_/g,"<em>$1</em>"),r=r.replace(/`(.*?)`/g,'<code class="inline-code">$1</code>'),r=r.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="md-link">$1</a>'),e.trim().startsWith("- ")||e.trim().startsWith("* ")){const a=e.trim().substring(2);return void t.push((0,p.jsxs)("div",{className:"md-list-item",children:["â€¢ ",a]},`li-${s}`))}const l=e.trim().match(/^(\d+)\.\s+(.*)$/);l?t.push((0,p.jsxs)("div",{className:"md-list-item",children:[l[1],". ",l[2]]},`oli-${s}`)):e.trim().startsWith("> ")?t.push((0,p.jsx)("blockquote",{className:"md-blockquote",children:e.substring(2)},`blockquote-${s}`)):t.push((0,p.jsx)("div",{className:"md-paragraph",dangerouslySetInnerHTML:{__html:r}},`p-${s}`))}),a&&n.length>0&&t.push((0,p.jsx)("pre",{className:"code-block",children:(0,p.jsx)("code",{className:`language-${i}`,children:n.join("\n")})},"code-final")),(0,p.jsx)("div",{className:"markdown-content",children:t})})(e),F=()=>{R?i?i(e):h(!0):alert("è¯·å…ˆç™»å½•")},_=async()=>{if(R){if(!g&&window.confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${e.title}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)){x(!0);try{await s(e.id)}catch(e){console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e)}finally{x(!1)}}}else alert("è¯·å…ˆç™»å½•")};if(!R)return(0,p.jsx)("div",{className:"question-detail-card "+(t?"expanded-view":""),children:(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("h3",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…"}),(0,p.jsx)("div",{className:"auth-required-actions",children:(0,p.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"})})]})});if(d&&!i)return(0,p.jsx)("div",{className:"question-edit-container "+(t?"expanded-view":""),children:(0,p.jsx)(hs,{question:e,onSave:()=>{h(!1)},onCancel:()=>{h(!1)}})});const W=e?.detailedAnswer||"",z=e?.oralAnswer||"",V=e?.code||"",J=e?.url||"",K=w;return(0,p.jsxs)("div",{className:"question-detail-card "+(t?"expanded-view":""),children:[!t&&(0,p.jsxs)("div",{className:"question-header",children:[(0,p.jsxs)("div",{className:"question-title-section",children:[(0,p.jsx)("h3",{className:"question-title",children:e?.title||"æ— æ ‡é¢˜"}),(0,p.jsxs)("div",{className:"question-meta-badges",children:[(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}})(e?.difficulty)},children:(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return e}})(e?.difficulty)}),(0,p.jsx)("span",{className:"proficiency-badge",children:(e=>{switch(e){case"beginner":return"åˆçº§";case"intermediate":return"ä¸­çº§";case"advanced":return"é«˜çº§";case"master":return"ç²¾é€š";default:return e}})(e?.proficiency)})]})]}),(0,p.jsxs)("div",{className:"question-actions",children:[(0,p.jsx)("button",{onClick:F,className:"btn-edit",title:"ç¼–è¾‘é¢˜ç›®",disabled:g,children:j?"ç¼–è¾‘ä¸­...":"âœï¸ ç¼–è¾‘"}),(0,p.jsx)("button",{onClick:()=>$(!0),className:"btn-remove-review",title:"æš‚æ—¶ç§»é™¤å¤ä¹ ",children:"â¸ï¸ æš‚åœå¤ä¹ "}),(0,p.jsx)("button",{onClick:_,className:"btn-delete",title:"åˆ é™¤é¢˜ç›®",disabled:g,children:g?"åˆ é™¤ä¸­...":"ðŸ—‘ï¸ åˆ é™¤"})]})]}),(0,p.jsxs)("div",{className:"appearance-level-display",children:[(0,p.jsxs)("div",{className:"appearance-header",children:[(0,p.jsx)("span",{className:"appearance-label",children:"å‡ºçŽ°é¢‘çŽ‡"}),(0,p.jsx)("span",{className:"appearance-value "+(C?"updating":""),children:C?"ä¿å­˜ä¸­...":`${K}%`})]}),(0,p.jsx)("div",{className:"appearance-slider-container",children:(0,p.jsx)("input",{type:"range",min:"0",max:"100",value:K,onChange:s=>{(async s=>{if(R)if(console.log("å¼€å§‹æ›´æ–°å‡ºçŽ°é¢‘çŽ‡:",{æ–°å€¼:s,å½“å‰propå€¼:e?.appearanceLevel,å½“å‰æœ¬åœ°çŠ¶æ€å€¼:w}),b(s),n&&e?.id){S(!0);try{await n(e.id,"appearanceLevel",s),console.log("å‡ºçŽ°é¢‘çŽ‡æ›´æ–°æˆåŠŸï¼Œç­‰å¾…çˆ¶ç»„ä»¶æ•°æ®æ›´æ–°")}catch(s){console.error("æ›´æ–°å‡ºçŽ°é¢‘çŽ‡å¤±è´¥:",s),b(e?.appearanceLevel||50)}finally{S(!1)}}else console.warn("ç¼ºå°‘ onUpdateField æˆ– question.id");else alert("è¯·å…ˆç™»å½•")})(parseInt(s.target.value))},className:"appearance-slider-editable",disabled:C,style:{background:`linear-gradient(90deg, \n                ${M(0)} 0%, \n                ${M(50)} 50%, \n                ${M(100)} 100%)`}})}),(0,p.jsxs)("div",{className:"appearance-labels",children:[(0,p.jsx)("span",{className:"appearance-label-low",children:"ä½Žé¢‘"}),(0,p.jsx)("span",{className:"appearance-label-high",children:"é«˜é¢‘"})]}),(0,p.jsxs)("div",{className:"appearance-hint",children:["æ‹–åŠ¨æ»‘å—è°ƒæ•´å‡ºçŽ°é¢‘çŽ‡ï¼Œæ•°å€¼è¶Šé«˜åœ¨å¤ä¹ æ—¶å‡ºçŽ°çš„æ¦‚çŽ‡è¶Šå¤§",C&&(0,p.jsx)("span",{className:"saving-indicator",children:" â€¢ ä¿å­˜ä¸­..."})]})]}),(0,p.jsxs)("div",{className:"answer-section",children:[!t&&(0,p.jsxs)("div",{className:"answer-header",children:[(0,p.jsx)("h4",{children:"ç­”æ¡ˆ"}),(0,p.jsxs)("div",{className:"answer-controls",children:[(0,p.jsxs)("div",{className:"answer-tabs",children:[(0,p.jsx)("button",{className:"tab-button "+("detailed"===y?"active":""),onClick:()=>f("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,p.jsx)("button",{className:"tab-button "+("oral"===y?"active":""),onClick:()=>f("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,p.jsx)("button",{onClick:()=>{m(!u)},className:"toggle-answer-btn",children:u?"æ”¶èµ·":"å±•å¼€"})]})]}),(0,p.jsx)("div",{className:"answer-content "+(u||t?"expanded":"collapsed"),children:t?(0,p.jsxs)("div",{className:"expanded-answer-tabs",children:[(0,p.jsxs)("div",{className:"expanded-tab-buttons",children:[(0,p.jsx)("button",{className:"expanded-tab-button "+("detailed"===y?"active":""),onClick:()=>f("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,p.jsx)("button",{className:"expanded-tab-button "+("oral"===y?"active":""),onClick:()=>f("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,p.jsx)("div",{className:"expanded-tab-content",children:"detailed"===y?(0,p.jsxs)("div",{className:"detailed-answer",children:[(0,p.jsx)("h5",{children:"è¯¦ç»†ç­”æ¡ˆ"}),(0,p.jsx)("div",{className:"answer-text markdown-enabled",children:B(W)})]}):(0,p.jsxs)("div",{className:"oral-answer",children:[(0,p.jsx)("h5",{children:"å£è¿°ç­”æ¡ˆ"}),(0,p.jsx)("div",{className:"answer-text markdown-enabled",children:B(z)})]})})]}):(0,p.jsx)("div",{className:"answer-text markdown-enabled",children:B("detailed"===y?W:z)})}),V&&V.trim()&&(0,p.jsxs)("div",{className:"code-section",children:[(0,p.jsx)("h5",{children:"ç›¸å…³ä»£ç "}),(e=>e&&""!==e.trim()?(0,p.jsx)("pre",{className:"code-block",children:(0,p.jsx)("code",{children:e})}):null)(V)]}),J&&J.trim()&&(0,p.jsxs)("div",{className:"url-section",children:[(0,p.jsx)("h5",{children:"ç›¸å…³é“¾æŽ¥"}),(0,p.jsxs)("a",{href:J,target:"_blank",rel:"noopener noreferrer",className:"question-link",children:["ðŸ”— ",J]})]})]}),(0,p.jsxs)("div",{className:"review-confirm-section",children:[(0,p.jsx)("button",{className:"confirm-review-btn",onClick:()=>A(!0),children:"âœ… ç¡®è®¤å·²å¤ä¹ "}),(0,p.jsx)("p",{className:"review-hint",children:"ç‚¹å‡»ç¡®è®¤åŽï¼Œè¯¥é¢˜ç›®å°†åœ¨ä¸€æ®µæ—¶é—´å†…ä¸ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­"})]}),k&&(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content review-confirm-modal",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"ç¡®è®¤å¤ä¹ å®Œæˆ"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>A(!1),children:"Ã—"})]}),(0,p.jsxs)("div",{className:"modal-body",children:[(0,p.jsx)("p",{children:"è¯·é€‰æ‹©åœ¨å¤šå°‘å¤©å†…ä¸å†æé†’å¤ä¹ è¿™é“é¢˜ç›®ï¼š"}),(0,p.jsxs)("div",{className:"review-days-selector",children:[(0,p.jsx)("div",{className:"days-presets",children:[1,3,7,14,30].map(e=>(0,p.jsxs)("button",{className:"days-preset-btn "+(E===e?"active":""),onClick:()=>q(e),children:[e,"å¤©"]},e))}),(0,p.jsxs)("div",{className:"custom-days-input",children:[(0,p.jsx)("label",{htmlFor:"customDays",children:"è‡ªå®šä¹‰å¤©æ•°ï¼š"}),(0,p.jsx)("input",{id:"customDays",type:"number",min:"1",max:"365",value:E,onChange:e=>q(parseInt(e.target.value)||1),className:"days-input"})]})]}),(0,p.jsxs)("div",{className:"review-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"é¢˜ç›®ï¼š"}),e?.title]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"ä¸‹æ¬¡æé†’æ—¶é—´ï¼š"}),new Date(Date.now()+24*E*60*60*1e3).toLocaleDateString()]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"cancel-btn",onClick:()=>A(!1),disabled:L,children:"å–æ¶ˆ"}),(0,p.jsx)("button",{className:"confirm-btn",onClick:async()=>{if(R){if(!L){D(!0);try{const s=new Date;s.setDate(s.getDate()+E),n&&e?.id&&(await n(e.id,"nextReviewDate",s.toISOString()),console.log(`é¢˜ç›®å°†åœ¨ ${E} å¤©åŽå†æ¬¡æé†’å¤ä¹ `),alert(`å·²ç¡®è®¤å¤ä¹ ï¼è¯¥é¢˜ç›®å°†åœ¨ ${E} å¤©åŽå†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­`),A(!1))}catch(e){console.error("ç¡®è®¤å¤ä¹ å¤±è´¥:",e),alert("ç¡®è®¤å¤ä¹ å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{D(!1)}}}else alert("è¯·å…ˆç™»å½•")},disabled:L,children:L?"ç¡®è®¤ä¸­...":"ç¡®è®¤å¤ä¹ "})]})]})}),T&&(0,p.jsx)("div",{className:"modal-overlay",children:(0,p.jsxs)("div",{className:"modal-content remove-review-modal",children:[(0,p.jsxs)("div",{className:"modal-header",children:[(0,p.jsx)("h3",{children:"æš‚åœå¤ä¹ æé†’"}),(0,p.jsx)("button",{className:"close-btn",onClick:()=>$(!1),children:"Ã—"})]}),(0,p.jsxs)("div",{className:"modal-body",children:[(0,p.jsx)("p",{children:"é€‰æ‹©åœ¨å¤šå°‘å¤©å†…ä¸å†æé†’å¤ä¹ è¿™é“é¢˜ç›®ï¼š"}),(0,p.jsxs)("div",{className:"remove-days-selector",children:[(0,p.jsx)("div",{className:"days-presets",children:[1,3,7,14,30,90].map(e=>(0,p.jsxs)("button",{className:"days-preset-btn "+(P===e?"active":""),onClick:()=>I(e),children:[e,"å¤©"]},e))}),(0,p.jsxs)("div",{className:"custom-days-input",children:[(0,p.jsx)("label",{htmlFor:"customRemoveDays",children:"è‡ªå®šä¹‰å¤©æ•°ï¼š"}),(0,p.jsx)("input",{id:"customRemoveDays",type:"number",min:"1",max:"365",value:P,onChange:e=>I(parseInt(e.target.value)||1),className:"days-input"})]})]}),(0,p.jsxs)("div",{className:"remove-review-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"é¢˜ç›®ï¼š"}),e?.title]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"ä¸‹æ¬¡æé†’æ—¶é—´ï¼š"}),new Date(Date.now()+24*P*60*60*1e3).toLocaleDateString()]}),(0,p.jsx)("p",{className:"info-text",children:"ðŸ’¡ åœ¨æ­¤æœŸé—´ï¼Œè¯¥é¢˜ç›®ä¸ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­"})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"cancel-btn",onClick:()=>$(!1),disabled:Q,children:"å–æ¶ˆ"}),(0,p.jsx)("button",{className:"confirm-btn",onClick:async()=>{if(R){if(!Q){O(!0);try{const s=new Date;s.setDate(s.getDate()+P),n&&e?.id&&(await n(e.id,"nextReviewDate",s.toISOString()),console.log(`é¢˜ç›®å°†åœ¨ ${P} å¤©åŽå†æ¬¡æé†’å¤ä¹ `),alert(`å·²æš‚åœå¤ä¹ ï¼è¯¥é¢˜ç›®å°†åœ¨ ${P} å¤©åŽå†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­`),$(!1))}catch(e){console.error("ç§»é™¤å¤ä¹ å¤±è´¥:",e),alert("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{O(!1)}}}else alert("è¯·å…ˆç™»å½•")},disabled:Q,children:Q?"å¤„ç†ä¸­...":"ç¡®è®¤æš‚åœ"})]})]})}),(0,p.jsxs)("div",{className:"card-details",children:[!t&&(0,p.jsxs)("div",{className:"category-info",children:[(0,p.jsx)("span",{className:"category-label",children:"æ‰€å±žåˆ†ç±»:"}),(0,p.jsx)("span",{className:"category-name",children:e?.category?.name||"æœªåˆ†ç±»"})]}),e?.tags&&e.tags.length>0&&(0,p.jsxs)("div",{className:"tags-section",children:[(0,p.jsx)("h4",{children:"æ ‡ç­¾"}),(0,p.jsx)("div",{className:"tags-container",children:e.tags.map((e,s)=>(0,p.jsxs)("span",{className:"tag",children:["#",e]},s))})]}),(0,p.jsxs)("div",{className:"time-info",children:[(0,p.jsxs)("span",{className:"create-time",children:["åˆ›å»º: ",e?.createdAt?new Date(e.createdAt).toLocaleDateString():"æœªçŸ¥"]}),(0,p.jsxs)("span",{className:"update-time",children:["æ›´æ–°: ",e?.updatedAt?new Date(e.updatedAt).toLocaleDateString():"æœªçŸ¥"]})]})]}),t&&(0,p.jsxs)("div",{className:"expanded-actions",children:[(0,p.jsx)("button",{onClick:F,className:"btn-edit primary",disabled:g,children:"âœï¸ ç¼–è¾‘é¢˜ç›®"}),(0,p.jsx)("button",{onClick:()=>$(!0),className:"btn-remove-review secondary",children:"â¸ï¸ æš‚åœå¤ä¹ "}),(0,p.jsx)("button",{onClick:_,className:"btn-delete secondary",disabled:g,children:"ðŸ—‘ï¸ åˆ é™¤é¢˜ç›®"})]}),c&&l&&l.id===e.id&&(0,p.jsx)("div",{className:"form-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,padding:"20px"},children:(0,p.jsx)(hs,{question:l,onSave:()=>{r(!1),o(null)},onCancel:()=>{r(!1),o(null)},defaultCategoryId:e?.category?.id})})]})},ms=({question:e,index:s,isExpanded:t,onToggle:a,onDelete:n,onEdit:i,onUpdateField:c,viewMode:r,isDragging:l,isDragOver:o,onDragStart:d,onDragOver:h,onDragLeave:u,onDrop:m,onDragEnd:g,canDrag:x,showQuestionForm:j,setShowQuestionForm:v,editingQuestion:N,setEditingQuestion:y})=>{const f=e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}},w=e=>{switch(e){case"easy":return"#b7eb8f";case"medium":return"#ffe58f";case"hard":return"#ffa39e";default:return"#d9d9d9"}},b=e=>{switch(e){case"easy":return"#f6ffed";case"medium":return"#fffbe6";case"hard":return"#fff2f0";default:return"#fafafa"}},C=e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return e}},S=e=>{switch(e){case"beginner":return"#ff6b6b";case"intermediate":return"#4ecdc4";case"advanced":return"#45b7d1";case"master":return"#96ceb4";default:return"#95a5a6"}},k=e=>{switch(e){case"beginner":return"ðŸŽ€";case"intermediate":return"ðŸŽ—ï¸";case"advanced":return"ðŸ…";case"master":return"ðŸ‘‘";default:return"ðŸŽ¯"}},A=e=>{switch(e){case"beginner":return"åˆçº§";case"intermediate":return"ä¸­çº§";case"advanced":return"é«˜çº§";case"master":return"ç²¾é€š";default:return e}},E=e=>new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),q=()=>{const s=e.oralAnswer||e.detailedAnswer;return s?s.substring(0,150)+(s.length>150?"...":""):"æš‚æ— ç­”æ¡ˆå†…å®¹"};return t?(0,p.jsxs)("div",{className:"expanded-question-view","data-question-id":e.id,children:[(0,p.jsxs)("div",{className:"expanded-header",children:[(0,p.jsxs)("button",{onClick:a,className:"back-to-list-btn",children:[(0,p.jsx)("span",{className:"back-icon",children:"â†"}),"è¿”å›žåˆ—è¡¨"]}),(0,p.jsxs)("div",{className:"expanded-title",children:[(0,p.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,p.jsx)("h3",{children:e.title})]}),(0,p.jsx)("div",{className:"expanded-actions",children:(0,p.jsx)("button",{onClick:()=>i(e),className:"btn-edit",children:"âœï¸ ç¼–è¾‘"})})]}),(0,p.jsx)("div",{className:"expanded-content",children:(0,p.jsx)(us,{question:e,onDelete:n,onUpdateField:c,isExpandedView:!0,onEdit:i,showQuestionForm:j,setShowQuestionForm:v,editingQuestion:N,setEditingQuestion:y})})]}):"grid"===r?(0,p.jsxs)("div",{className:`question-grid-card ${l?"dragging":""} ${o?"drag-over":""}`,onClick:a,draggable:x,onDragStart:d,onDragOver:h,onDragLeave:u,onDrop:m,onDragEnd:g,"data-question-id":e.id,style:{borderLeft:`4px solid ${f(e.difficulty)}`,backgroundColor:b(e.difficulty),border:`1px solid ${w(e.difficulty)}`},children:[(0,p.jsxs)("div",{className:"proficiency-ribbon",style:{backgroundColor:S(e.proficiency)},children:[(0,p.jsx)("span",{className:"ribbon-icon",children:k(e.proficiency)}),(0,p.jsx)("span",{className:"ribbon-text",children:A(e.proficiency)})]}),(0,p.jsxs)("div",{className:"grid-header",children:[(0,p.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,p.jsx)("span",{className:"difficulty-tag",style:{backgroundColor:f(e.difficulty)},children:C(e.difficulty)})]}),(0,p.jsx)("h4",{className:"grid-title",children:e.title}),(0,p.jsxs)("div",{className:"appearance-level-indicator",children:[(0,p.jsx)("div",{className:"appearance-bar",style:{width:`${e.appearanceLevel||50}%`,backgroundColor:(L=e.appearanceLevel||50,L>=80?"#ff6b6b":L>=60?"#ffa726":L>=40?"#4ecdc4":"#95a5a6")}}),(0,p.jsxs)("span",{className:"appearance-text",children:[e.appearanceLevel||50,"%"]})]}),(0,p.jsx)("div",{className:"grid-meta",children:(0,p.jsxs)("span",{className:"update-time",children:["æ›´æ–°: ",E(e.updatedAt)]})}),(0,p.jsx)("div",{className:"grid-preview",children:(0,p.jsx)("div",{className:"preview-content",children:q()})}),x&&(0,p.jsx)("div",{className:"drag-handle",children:"â‹®â‹®"})]}):(0,p.jsxs)("div",{className:`modern-accordion ${t?"expanded":""} ${l?"dragging":""} ${o?"drag-over":""}`,draggable:x,onDragStart:d,onDragOver:h,onDragLeave:u,onDrop:m,onDragEnd:g,"data-question-id":e.id,style:{borderLeft:`4px solid ${f(e.difficulty)}`,backgroundColor:b(e.difficulty),border:`1px solid ${w(e.difficulty)}`},children:[(0,p.jsxs)("div",{className:"proficiency-ribbon",style:{backgroundColor:S(e.proficiency)},children:[(0,p.jsx)("span",{className:"ribbon-icon",children:k(e.proficiency)}),(0,p.jsx)("span",{className:"ribbon-text",children:A(e.proficiency)})]}),(0,p.jsxs)("div",{className:"accordion-header",onClick:a,children:[(0,p.jsxs)("div",{className:"header-main",children:[(0,p.jsxs)("div",{className:"question-meta",children:[(0,p.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:f(e.difficulty)},children:C(e.difficulty)}),(0,p.jsxs)("span",{className:"appearance-badge",children:["ðŸ“Š ",e.appearanceLevel||50,"%"]}),(0,p.jsxs)("span",{className:"time-badge",children:["â±ï¸ ",E(e.updatedAt)]})]}),(0,p.jsx)("h3",{className:"question-title",children:e.title}),(0,p.jsx)("div",{className:"question-preview",children:q()})]}),(0,p.jsxs)("div",{className:"header-actions",children:[x&&(0,p.jsx)("div",{className:"drag-handle",onClick:e=>e.stopPropagation(),children:"â‹®â‹®"}),(0,p.jsx)("span",{className:"accordion-icon",children:t?"â–¼":"â–º"})]})]})]});var L},gs=()=>{const{categoryId:e}=(0,i.g)(),s=(0,i.Zp)(),t=(0,r.jE)(),[n,c]=(0,a.useState)(null),[l,o]=(0,a.useState)([]),[d,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[g,x]=(0,a.useState)(""),[j,v]=(0,a.useState)("createdAt"),[w,C]=(0,a.useState)(new Set),[S,k]=(0,a.useState)("accordion"),[A,E]=(0,a.useState)(null),[L,D]=(0,a.useState)(null),[T,$]=(0,a.useState)(""),[P,I]=(0,a.useState)(null),Q=(0,a.useRef)(null),O=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=N().User.current();I(e),e&&R()},[e]),(0,a.useEffect)(()=>{const e=e=>{const{questionId:s}=e.detail,t=document.querySelector(`[data-question-id="${s}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.boxShadow="0 0 0 3px #667eea",setTimeout(()=>{t.style.boxShadow=""},2e3),w.has(s)||ae(s))};return window.addEventListener("scrollToQuestion",e),()=>{window.removeEventListener("scrollToQuestion",e)}},[w]);const R=async()=>{try{f(),await U(),await new Promise(e=>setTimeout(e,300)),await M()}catch(e){console.error("åˆå§‹åŒ–å¤±è´¥:",e),(429===e.code||e.message.includes("Too many requests"))&&($("è¯·æ±‚è¿‡äºŽé¢‘ç¹ï¼Œè¯·ç¨åŽé‡è¯•"),setTimeout(()=>$(""),5e3))}},U=async()=>{try{const s=await(async e=>{if(y.shouldUseOfflineData())throw console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šæ— æ³•èŽ·å–åˆ†ç±»é¢˜ç›®åˆ—è¡¨"),new Error("ç¦»çº¿æ¨¡å¼ä¸‹æ— æ³•èŽ·å–åˆ†ç±»é¢˜ç›®åˆ—è¡¨");try{const s=N().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(N().Query)("Category"),a=await t.get(e);if(a.get("createdBy").id!==s.id)throw new Error("æ— æƒè®¿é—®æ­¤åˆ†ç±»");const n=new(N().Query)("Question");n.equalTo("category",a),n.equalTo("createdBy",s),n.include("category"),n.descending("updatedAt");const i=await n.find(),c=i.map(e=>({id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),difficulty:e.get("difficulty"),appearanceLevel:e.get("appearanceLevel"),proficiency:e.get("proficiency"),tags:e.get("tags")||[],category:{id:e.get("category").id,name:e.get("category").get("name")},createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")})),r={category:{id:a.id,name:a.get("name"),description:a.get("description"),questionCount:i.length,createdAt:a.get("createdAt"),updatedAt:a.get("updatedAt")},questions:c},l=Date.now();return b.questionCounts.set(e,{count:i.length,timestamp:l}),r}catch(e){throw console.error("èŽ·å–åˆ†ç±»è¯¦æƒ…å¤±è´¥:",e),e}})(e);c(s.category)}catch(e){console.error("åŠ è½½åˆ†ç±»ä¿¡æ¯å¤±è´¥:",e)}},M=async()=>{try{const e=(await q()).filter(e=>{const s=e.createdBy;return s&&s.id===P?.id});o(e)}catch(e){console.error("åŠ è½½æ‰€æœ‰åˆ†ç±»å¤±è´¥:",e),(429===e.code||e.message.includes("Too many requests"))&&($("æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åŽé‡è¯•"),setTimeout(()=>$(""),5e3))}},{data:B,fetchNextPage:F,hasNextPage:_,isFetchingNextPage:W,isLoading:V,error:K,refetch:H}=(0,os.q)({queryKey:["questions",e,j],queryFn:async({pageParam:s=0})=>{console.log("æ­£åœ¨èŽ·å–ç¬¬",s+1,"é¡µæ•°æ®");const t=await(async(e,s={})=>{if(y.shouldUseOfflineData())return console.log("ðŸ“¦ ç¦»çº¿æ¨¡å¼ï¼šæ— æ³•èŽ·å–åˆ†ç±»é¢˜ç›®"),{data:[]};try{const t=N().User.current();if(!t)throw new Error("ç”¨æˆ·æœªç™»å½•");const{page:a=1,pageSize:n=20,sortBy:i="updatedAt",sortOrder:c="desc"}=s,r=N().Object.createWithoutData("Category",e),l=new(N().Query)("Question");return l.equalTo("category",r),l.equalTo("createdBy",t),l.include("category"),"asc"===c?l.addAscending(i):l.addDescending(i),l.limit(n),l.skip((a-1)*n),{data:(await l.find()).map(e=>{const s=e.get("category");return{id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),url:e.get("url"),tags:e.get("tags")||[],difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel")||50,category:s?{id:s.id,objectId:s.id,name:s.get("name"),description:s.get("description"),questionCount:s.get("questionCount")||0}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),lastReviewedAt:e.get("lastReviewedAt")}})}}catch(e){throw console.error("èŽ·å–åˆ†ç±»é¢˜ç›®å¤±è´¥:",e),new Error(`èŽ·å–é¢˜ç›®å¤±è´¥: ${e.message}`)}})(e,{page:s,pageSize:20,sortBy:j,sortOrder:"desc"});return console.log("ç¬¬",s+1,"é¡µè¿”å›žæ•°æ®:",{dataLength:t.data?.length,hasMore:20===t.data?.length,total:t.total}),{questions:t.data||[],total:t.total,nextPage:20===t.data?.length?s+1:void 0}},getNextPageParam:(e,s)=>e.nextPage,enabled:!!e&&!!P,staleTime:3e5,initialPageParam:0}),G=(0,a.useMemo)(()=>(B?.pages.flatMap(e=>e.questions)||[]).reduce((e,s)=>(e.find(e=>e.id===s.id)?console.warn("å‘çŽ°é‡å¤é¢˜ç›®:",s.id,s.title):e.push(s),e),[]),[B]),Y=(0,a.useMemo)(()=>{if(!g)return G;const e=G.filter(e=>e.title.toLowerCase().includes(g.toLowerCase())||e.detailedAnswer&&e.detailedAnswer.toLowerCase().includes(g.toLowerCase())||e.oralAnswer&&e.oralAnswer.toLowerCase().includes(g.toLowerCase())||e.code&&e.code.toLowerCase().includes(g.toLowerCase())||e.tags&&e.tags.some(e=>e.toLowerCase().includes(g.toLowerCase())));return Array.from(new Map(e.map(e=>[e.id,e])).values())},[G,g]),Z=(0,a.useMemo)(()=>{const e=[...Y].sort((e,s)=>{switch(j){case"title":return e.title.localeCompare(s.title);case"difficulty":const t={easy:1,medium:2,hard:3};return t[e.difficulty]-t[s.difficulty];case"appearanceLevel":default:return(s.appearanceLevel||50)-(e.appearanceLevel||50);case"createdAt":return new Date(s.createdAt)-new Date(e.createdAt);case"updatedAt":return new Date(s.updatedAt)-new Date(e.createdAt)}});return Array.from(new Map(e.map(e=>[e.id,e])).values())},[Y,j]),X=(0,de.Te)({count:Z.length,getScrollElement:()=>O.current,estimateSize:()=>"grid"===S?200:120,overscan:10}),ee=(0,a.useCallback)(()=>{const e=O.current;if(!e||!_||W)return;const{scrollTop:s,scrollHeight:t,clientHeight:a}=e,n=t-s-a;console.log("æ»šåŠ¨æ£€æŸ¥:",{distanceFromBottom:n,shouldLoad:n<100,hasNextPage:_,isFetchingNextPage:W}),n<100&&(console.log("ðŸŽ¯ è§¦å‘åŠ è½½æ›´å¤šï¼å½“å‰é¡µæ•°:",B?.pages?.length||0),F())},[_,W,F,B]);(0,a.useEffect)(()=>{const e=O.current;if(!e)return void console.log("âŒ æœªæ‰¾åˆ°æ»šåŠ¨å®¹å™¨");console.log("âœ… ç»‘å®šæ»šåŠ¨ç›‘å¬å™¨");const s=(e=>{let s;return function(...t){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...t)},50)}})(ee);return e.addEventListener("scroll",s),()=>{e.removeEventListener("scroll",s)}},[ee]),(0,a.useEffect)(()=>{if(!Q.current||!_||W)return;console.log("ðŸ” è®¾ç½® Intersection Observer");const e=new IntersectionObserver(e=>{e[0].isIntersecting&&(console.log("ðŸŽ¯ Intersection Observer è§¦å‘åŠ è½½æ›´å¤šï¼"),F())},{threshold:.1,root:O.current,rootMargin:"100px"});return e.observe(Q.current),()=>{e.disconnect()}},[_,W,F,Z.length]);const se=(0,ds.n)({mutationFn:z,onSuccess:()=>{t.invalidateQueries(["questions",e]),$("é¢˜ç›®åˆ é™¤æˆåŠŸ"),setTimeout(()=>$(""),3e3)},onError:e=>{console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e),alert("åˆ é™¤å¤±è´¥: "+e.message)}}),te=(0,ds.n)({mutationFn:({questionId:e,data:s})=>J(e,s),onSuccess:()=>{t.invalidateQueries(["questions",e])},onError:e=>{throw console.error("æ›´æ–°é¢˜ç›®å¤±è´¥:",e),new Error("æ›´æ–°å¤±è´¥: "+e.message)}}),ae=e=>{C(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},ne=()=>{P?(m(null),h(!0)):alert("è¯·å…ˆç™»å½•")},ie=e=>{P?(m(e),h(!0)):alert("è¯·å…ˆç™»å½•")},ce=async e=>{if(!P)return void alert("è¯·å…ˆç™»å½•");const s=Z.find(s=>s.id===e);if(!s)throw new Error("æœªæ‰¾åˆ°è¦åˆ é™¤çš„é¢˜ç›®");const t=`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${s.title}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`;window.confirm(t)&&(se.mutate(e),C(s=>{const t=new Set(s);return t.delete(e),t}))},re=async(e,s,t)=>{if(P)try{await te.mutateAsync({questionId:e,data:{[s]:t}})}catch(e){throw console.error("æ›´æ–°é¢˜ç›®å­—æ®µå¤±è´¥:",e),new Error("æ›´æ–°å¤±è´¥: "+e.message)}else alert("è¯·å…ˆç™»å½•")},le=()=>{s("/")},oe=e=>{D(null)},he=e=>{E(null),D(null),e.currentTarget.style.opacity="1"};return(0,a.useEffect)(()=>{console.log("åˆ†é¡µçŠ¶æ€:",{hasNextPage:_,isFetchingNextPage:W,totalQuestions:G.length,pages:B?.pages?.length||0})},[_,W,G.length,B]),P?V&&!n?(0,p.jsx)("div",{className:"category-detail-page",children:(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"modern-spinner"}),(0,p.jsx)("p",{children:"åŠ è½½é¢˜ç›®ä¸­..."})]})}):K&&!n?(0,p.jsx)("div",{className:"category-detail-page",children:(0,p.jsxs)("div",{className:"error-container",children:[(0,p.jsx)("div",{className:"error-icon",children:"âš ï¸"}),(0,p.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,p.jsx)("p",{children:K.message}),(0,p.jsxs)("div",{className:"error-actions",children:[(0,p.jsx)("button",{onClick:()=>{H()},className:"btn-retry",children:"é‡æ–°åŠ è½½"}),(0,p.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})]})}):n?(0,p.jsxs)("div",{className:"category-detail-page",children:[(0,p.jsx)("header",{className:"modern-header",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)("div",{className:"header-content",children:[(0,p.jsxs)("button",{onClick:le,className:"back-button",style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"10px 20px",backgroundColor:"transparent",color:"#667eea",border:"2px solid #667eea",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer",transition:"all 0.3s ease",textDecoration:"none",fontFamily:"inherit"},onMouseEnter:e=>{e.target.style.backgroundColor="#667eea",e.target.style.color="white",e.target.style.transform="translateY(-2px)",e.target.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseLeave:e=>{e.target.style.backgroundColor="transparent",e.target.style.color="#667eea",e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},children:[(0,p.jsx)("span",{className:"back-icon",style:{fontSize:"18px",fontWeight:"bold",transition:"transform 0.3s ease"},children:"â†"}),"è¿”å›žçŸ¥è¯†åº“"]}),(0,p.jsxs)("div",{className:"category-hero",children:[(0,p.jsxs)("div",{className:"category-badge",children:[(0,p.jsx)("span",{className:"category-emoji",children:"ðŸ“š"}),(0,p.jsx)("span",{className:"category-name",children:n.name})]}),(0,p.jsx)("div",{className:"user-welcome",children:(0,p.jsxs)("span",{className:"welcome-text",children:["æ¬¢è¿Ž, ",P.getUsername(),"!"]})}),(0,p.jsxs)("div",{className:"hero-stats",children:[(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("span",{className:"stat-number",children:n.questionCount}),(0,p.jsx)("span",{className:"stat-label",children:"æ€»é¢˜ç›®"})]}),(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("span",{className:"stat-number",children:G.length}),(0,p.jsx)("span",{className:"stat-label",children:"å·²åŠ è½½"})]}),(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("span",{className:"stat-number",children:w.size}),(0,p.jsx)("span",{className:"stat-label",children:"å·²å±•å¼€"})]})]})]})]})})}),T&&(0,p.jsx)("div",{className:"sync-message",children:T}),(0,p.jsx)("section",{className:"control-panel",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsxs)("div",{className:"panel-grid",children:[(0,p.jsx)("div",{className:"search-panel",children:(0,p.jsxs)("div",{className:"search-wrapper",children:[(0,p.jsx)("div",{className:"search-icon",children:"ðŸ”"}),(0,p.jsx)("input",{type:"text",placeholder:"æœç´¢é¢˜ç›®ã€ç­”æ¡ˆæˆ–æ ‡ç­¾...",value:g,onChange:e=>x(e.target.value),className:"modern-search",style:{color:"#333",backgroundColor:"#fff"}}),g&&(0,p.jsx)("button",{onClick:()=>x(""),className:"clear-search",children:"âœ•"})]})}),(0,p.jsxs)("div",{className:"controls-panel",children:[(0,p.jsxs)("div",{className:"controls-group",children:[(0,p.jsx)("label",{children:"æŽ’åºæ–¹å¼"}),(0,p.jsxs)("select",{value:j,onChange:e=>v(e.target.value),className:"modern-select",style:{color:"#333",backgroundColor:"#fff"},children:[(0,p.jsx)("option",{value:"appearanceLevel",children:"å‡ºçŽ°é¢‘çŽ‡"}),(0,p.jsx)("option",{value:"updatedAt",children:"æœ€è¿‘æ›´æ–°"}),(0,p.jsx)("option",{value:"createdAt",children:"åˆ›å»ºæ—¶é—´"}),(0,p.jsx)("option",{value:"title",children:"æ ‡é¢˜é¡ºåº"}),(0,p.jsx)("option",{value:"difficulty",children:"éš¾åº¦ç­‰çº§"})]})]}),(0,p.jsxs)("div",{className:"controls-group",children:[(0,p.jsx)("label",{children:"æ‰¹é‡æ“ä½œ"}),(0,p.jsxs)("div",{className:"batch-actions",children:[(0,p.jsx)("button",{onClick:()=>{const e=new Set(Z.map(e=>e.id));C(e)},className:"action-btn expand-btn",disabled:0===Z.length,children:"ðŸ“– å±•å¼€å…¨éƒ¨"}),(0,p.jsx)("button",{onClick:()=>{C(new Set)},className:"action-btn collapse-btn",disabled:0===w.size,children:"ðŸ“• æŠ˜å å…¨éƒ¨"})]})]}),(0,p.jsxs)("button",{className:"add-question-btn primary",onClick:ne,children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"æ·»åŠ é¢˜ç›®"]})]})]}),(0,p.jsxs)("div",{className:"debug-controls",style:{marginTop:"10px",padding:"10px",background:"#f0f0f0",borderRadius:"4px"},children:[(0,p.jsx)("button",{onClick:()=>{console.log("ðŸ”„ æ‰‹åŠ¨è§¦å‘åŠ è½½æ›´å¤š"),F()},disabled:!_||W,style:{padding:"5px 10px",fontSize:"12px",background:_?"#1890ff":"#ccc",color:"white",border:"none",borderRadius:"3px"},children:W?"åŠ è½½ä¸­...":_?"æ‰‹åŠ¨åŠ è½½æ›´å¤š":"å·²æ— æ›´å¤š"}),(0,p.jsxs)("span",{style:{marginLeft:"10px",fontSize:"12px",color:"#666"},children:["çŠ¶æ€: ",_?`æœ‰æ›´å¤š (${G.length}/?)`:"å·²åŠ è½½å…¨éƒ¨"]})]})]})}),(0,p.jsx)("section",{className:"content-section",children:(0,p.jsx)("div",{className:"container",children:0===Z.length?(0,p.jsxs)("div",{className:"modern-empty",children:[(0,p.jsx)("div",{className:"empty-illustration",children:g?"ðŸ”":"ðŸ“"}),(0,p.jsx)("h3",{children:g?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢˜ç›®":"æ­¤åˆ†ç±»ä¸‹æš‚æ— é¢˜ç›®"}),(0,p.jsx)("p",{children:g?"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ¸…é™¤æœç´¢æ¡†æ¥æŸ¥çœ‹æ‰€æœ‰é¢˜ç›®":'ç‚¹å‡»"æ·»åŠ é¢˜ç›®"æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªé¢˜ç›®ï¼Œå¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…'}),g?(0,p.jsx)("button",{onClick:()=>x(""),className:"clear-search-btn",children:"æ¸…é™¤æœç´¢æ¡ä»¶"}):(0,p.jsx)("button",{onClick:ne,className:"add-first-btn",children:"ðŸš€ åˆ›å»ºç¬¬ä¸€ä¸ªé¢˜ç›®"})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"results-stats",children:[(0,p.jsxs)("span",{className:"results-count",children:["æ‰¾åˆ° ",Z.length," ä¸ªé¢˜ç›®",g&&(0,p.jsxs)("span",{children:['ï¼ˆæœç´¢å…³é”®è¯: "',g,'"ï¼‰']}),_&&(0,p.jsx)("span",{children:" - æ»šåŠ¨åŠ è½½æ›´å¤š"})]}),(0,p.jsxs)("span",{className:"expand-count",children:[w.size," / ",Z.length," å·²å±•å¼€"]}),0===w.size&&(0,p.jsx)("span",{className:"drag-hint",children:"ðŸŽ¯ æç¤º: å¯ä»¥æ‹–æ‹½é¢˜ç›®è°ƒæ•´é¡ºåº"})]}),(0,p.jsxs)("div",{className:"debug-info",style:{fontSize:"12px",color:"#666",padding:"8px",background:"#f5f5f5",borderRadius:"4px",marginBottom:"10px"},children:["åˆ†é¡µçŠ¶æ€: å·²åŠ è½½ ",G.length," é¢˜, è¿˜æœ‰æ›´å¤š: ",_?"æ˜¯":"å¦",", æ­£åœ¨åŠ è½½: ",W?"æ˜¯":"å¦"]}),(0,p.jsxs)("div",{ref:O,className:`questions-container ${S}`,style:{height:"calc(100vh - 400px)",overflow:"auto",position:"relative",border:"1px solid #e1e5e9",borderRadius:"8px"},children:[(0,p.jsx)("div",{style:{height:`${X.getTotalSize()}px`,width:"100%",position:"relative"},children:X.getVirtualItems().map(e=>{const s=Z[e.index];return(0,p.jsx)("div",{"data-index":e.index,ref:X.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:(0,p.jsx)(ms,{question:s,index:e.index,isExpanded:w.has(s.id),onToggle:()=>ae(s.id),onDelete:ce,onEdit:ie,onUpdateField:re,viewMode:S,isDragging:A===s.id,isDragOver:L===s.id,onDragStart:e=>((e,s)=>{w.size>0||(E(s),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",s),e.currentTarget.style.opacity="0.4")})(e,s.id),onDragOver:e=>((e,s)=>{w.size>0||!A||(e.preventDefault(),e.dataTransfer.dropEffect="move",D(s))})(e,s.id),onDragLeave:oe,onDrop:e=>(async(e,s)=>{if(!(w.size>0)&&A){if(e.preventDefault(),A!==s){const e=Z.findIndex(e=>e.id===A),t=Z.findIndex(e=>e.id===s),a=[...Z],[n]=a.splice(e,1);a.splice(t,0,n);try{await te.mutateAsync({questionId:n.id,data:{appearanceLevel:n.appearanceLevel}}),console.log("æŽ’åºä¿å­˜æˆåŠŸ")}catch(e){console.error("ä¿å­˜æŽ’åºå¤±è´¥:",e),H()}}E(null),D(null)}})(e,s.id),onDragEnd:he,canDrag:0===w.size,showQuestionForm:d,setShowQuestionForm:h,editingQuestion:u,setEditingQuestion:m})},s.id)})}),_&&(0,p.jsx)("div",{ref:Q,style:{height:"60px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",background:"transparent"},children:W?(0,p.jsxs)("div",{className:"loading-more",children:[(0,p.jsx)("div",{className:"modern-spinner small"}),(0,p.jsx)("span",{children:"åŠ è½½æ›´å¤šé¢˜ç›®..."})]}):(0,p.jsx)("div",{className:"load-more-trigger",style:{padding:"10px",color:"#666"},children:(0,p.jsx)("span",{children:"â†“ ç»§ç»­æ»šåŠ¨åŠ è½½æ›´å¤š"})})}),!_&&G.length>0&&(0,p.jsxs)("div",{style:{textAlign:"center",padding:"20px",color:"#999",fontStyle:"italic"},children:["å·²åŠ è½½å…¨éƒ¨ ",G.length," ä¸ªé¢˜ç›®"]})]})]})})}),d&&(0,p.jsx)("div",{className:"form-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,padding:"20px"},children:(0,p.jsx)(hs,{question:u,onSave:()=>{h(!1),m(null),t.invalidateQueries(["questions",e])},onCancel:()=>{h(!1),m(null)},defaultCategoryId:e,onCategoryChange:({questionId:s,oldCategoryId:a,newCategoryId:i,question:c})=>{if(a===n.id){t.invalidateQueries(["questions",e]),C(e=>{const t=new Set(e);return t.delete(s),t});const a=l.find(e=>e.id===i);$(`é¢˜ç›®å·²ç§»åŠ¨åˆ°åˆ†ç±»: ${a?.name||"å…¶ä»–åˆ†ç±»"}`),setTimeout(()=>$(""),3e3)}}})})]}):(0,p.jsx)("div",{className:"category-detail-page",children:(0,p.jsxs)("div",{className:"error-container",children:[(0,p.jsx)("div",{className:"error-icon",children:"ðŸ“"}),(0,p.jsx)("h2",{children:"åˆ†ç±»ä¸å­˜åœ¨"}),(0,p.jsx)("p",{children:"æœªæ‰¾åˆ°æŒ‡å®šçš„åˆ†ç±»ï¼Œå¯èƒ½å·²è¢«åˆ é™¤"}),(0,p.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})}):(0,p.jsx)("div",{className:"category-detail-page",children:(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å’Œç®¡ç†é¢˜ç›®"}),(0,p.jsxs)("div",{className:"auth-required-actions",children:[(0,p.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"}),(0,p.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})]})})},xs=async(e,s,t)=>{try{const a=new(N().User);a.setUsername(e),a.setPassword(s),a.setEmail(t);const n=await a.signUp();return console.log("æ³¨å†ŒæˆåŠŸ:",n),n}catch(e){throw console.error("æ³¨å†Œå¤±è´¥:",e),e}},ps=async(e,s)=>{try{const t=await N().User.logIn(e,s);return console.log("ç™»å½•æˆåŠŸ:",t),t}catch(e){throw console.error("ç™»å½•å¤±è´¥:",e),e}},js=()=>N().User.current(),vs=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1),[i,c]=(0,a.useState)(""),[r,l]=(0,a.useState)({register:{username:"",password:"",email:"",nickname:""},login:{username:"",password:""},category:{name:"",description:""},question:{title:"",detailedAnswer:"",categoryId:""}});(0,a.useEffect)(()=>{o()},[]);const o=()=>{const e=js();s(e),console.log("å½“å‰ç”¨æˆ·:",e)},d=(e,s,t)=>{l(a=>({...a,[e]:{...a[e],[s]:t}}))};return(0,p.jsxs)("div",{className:"user-test-panel",children:[(0,p.jsx)("h2",{children:"ðŸ§ª ç”¨æˆ·ç³»ç»Ÿæµ‹è¯•é¢æ¿"}),(0,p.jsxs)("div",{className:"user-status",children:[(0,p.jsx)("h3",{children:"å½“å‰çŠ¶æ€"}),e?(0,p.jsxs)("div",{className:"user-info",children:[(0,p.jsx)("p",{children:"âœ… å·²ç™»å½•"}),(0,p.jsxs)("p",{children:["ç”¨æˆ·å: ",e.username]}),(0,p.jsxs)("p",{children:["é‚®ç®±: ",e.email]}),(0,p.jsxs)("p",{children:["ç”¨æˆ·ID: ",e.id]}),(0,p.jsx)("button",{onClick:async()=>{n(!0);try{await(async()=>{try{await N().User.logOut(),console.log("é€€å‡ºæˆåŠŸ")}catch(e){throw console.error("é€€å‡ºå¤±è´¥:",e),e}})(),c("âœ… å·²é€€å‡ºç™»å½•"),s(null)}catch(e){c(`âŒ ç™»å‡ºå¤±è´¥: ${e.message}`)}finally{n(!1)}},disabled:t,children:"é€€å‡ºç™»å½•"})]}):(0,p.jsx)("p",{children:"âŒ æœªç™»å½•"})]}),i&&(0,p.jsx)("div",{className:"test-message "+(i.includes("âœ…")?"success":"error"),children:i}),(0,p.jsxs)("div",{className:"test-sections",children:[(0,p.jsxs)("div",{className:"test-section",children:[(0,p.jsx)("h3",{children:"1. ç”¨æˆ·æ³¨å†Œæµ‹è¯•"}),(0,p.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),n(!0),c("");try{const e=await xs(r.register);c(`âœ… æ³¨å†ŒæˆåŠŸï¼ç”¨æˆ·ID: ${e.id}`),s(e),l(e=>({...e,register:{username:"",password:"",email:"",nickname:""}}))}catch(e){c(`âŒ æ³¨å†Œå¤±è´¥: ${e.message}`)}finally{n(!1)}},children:[(0,p.jsx)("input",{type:"text",placeholder:"ç”¨æˆ·å",value:r.register.username,onChange:e=>d("register","username",e.target.value),required:!0}),(0,p.jsx)("input",{type:"password",placeholder:"å¯†ç ",value:r.register.password,onChange:e=>d("register","password",e.target.value),required:!0}),(0,p.jsx)("input",{type:"email",placeholder:"é‚®ç®±",value:r.register.email,onChange:e=>d("register","email",e.target.value),required:!0}),(0,p.jsx)("input",{type:"text",placeholder:"æ˜µç§° (å¯é€‰)",value:r.register.nickname,onChange:e=>d("register","nickname",e.target.value)}),(0,p.jsx)("button",{type:"submit",disabled:t,children:t?"æ³¨å†Œä¸­...":"æ³¨å†Œ"})]})]}),(0,p.jsxs)("div",{className:"test-section",children:[(0,p.jsx)("h3",{children:"2. ç”¨æˆ·ç™»å½•æµ‹è¯•"}),(0,p.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),n(!0),c("");try{const e=await ps(r.login.username,r.login.password);c(`âœ… ç™»å½•æˆåŠŸï¼æ¬¢è¿Ž ${e.username}`),s(e),l(e=>({...e,login:{username:"",password:""}}))}catch(e){c(`âŒ ç™»å½•å¤±è´¥: ${e.message}`)}finally{n(!1)}},children:[(0,p.jsx)("input",{type:"text",placeholder:"ç”¨æˆ·å",value:r.login.username,onChange:e=>d("login","username",e.target.value),required:!0}),(0,p.jsx)("input",{type:"password",placeholder:"å¯†ç ",value:r.login.password,onChange:e=>d("login","password",e.target.value),required:!0}),(0,p.jsx)("button",{type:"submit",disabled:t,children:t?"ç™»å½•ä¸­...":"ç™»å½•"})]})]}),e&&(0,p.jsxs)("div",{className:"test-section",children:[(0,p.jsx)("h3",{children:"3. åˆ›å»ºæµ‹è¯•åˆ†ç±»"}),(0,p.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e){n(!0);try{const e=await D(r.category);c(`âœ… åˆ†ç±»åˆ›å»ºæˆåŠŸï¼ID: ${e.id}`),l(s=>({...s,question:{...s.question,categoryId:e.id},category:{name:"",description:""}}))}catch(e){c(`âŒ åˆ›å»ºåˆ†ç±»å¤±è´¥: ${e.message}`)}finally{n(!1)}}else c("âŒ è¯·å…ˆç™»å½•")},children:[(0,p.jsx)("input",{type:"text",placeholder:"åˆ†ç±»åç§°",value:r.category.name,onChange:e=>d("category","name",e.target.value),required:!0}),(0,p.jsx)("input",{type:"text",placeholder:"åˆ†ç±»æè¿° (å¯é€‰)",value:r.category.description,onChange:e=>d("category","description",e.target.value)}),(0,p.jsx)("button",{type:"submit",disabled:t,children:t?"åˆ›å»ºä¸­...":"åˆ›å»ºåˆ†ç±»"})]})]}),e&&r.question.categoryId&&(0,p.jsxs)("div",{className:"test-section",children:[(0,p.jsx)("h3",{children:"4. åˆ›å»ºæµ‹è¯•é¢˜ç›®"}),(0,p.jsxs)("p",{children:["åˆ†ç±»ID: ",r.question.categoryId]}),(0,p.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e){n(!0);try{const e=await W({...r.question,categoryId:r.question.categoryId,oralAnswer:"è¿™æ˜¯å£è¿°ç‰ˆæœ¬çš„ç­”æ¡ˆ",tags:["æµ‹è¯•","ç¤ºä¾‹"],difficulty:"medium",proficiency:"intermediate"});c(`âœ… é¢˜ç›®åˆ›å»ºæˆåŠŸï¼ID: ${e.id}`),l(e=>({...e,question:{title:"",detailedAnswer:"",categoryId:e.question.categoryId}}))}catch(e){c(`âŒ åˆ›å»ºé¢˜ç›®å¤±è´¥: ${e.message}`)}finally{n(!1)}}else c("âŒ è¯·å…ˆç™»å½•")},children:[(0,p.jsx)("input",{type:"text",placeholder:"é¢˜ç›®æ ‡é¢˜",value:r.question.title,onChange:e=>d("question","title",e.target.value),required:!0}),(0,p.jsx)("textarea",{placeholder:"è¯¦ç»†ç­”æ¡ˆ",value:r.question.detailedAnswer,onChange:e=>d("question","detailedAnswer",e.target.value),required:!0}),(0,p.jsx)("button",{type:"submit",disabled:t,children:t?"åˆ›å»ºä¸­...":"åˆ›å»ºé¢˜ç›®"})]})]})]}),(0,p.jsxs)("div",{className:"quick-test",children:[(0,p.jsx)("h3",{children:"ðŸš€ å¿«é€Ÿæµ‹è¯•"}),(0,p.jsx)("button",{onClick:()=>{l({register:{username:`testuser_${Date.now()}`,password:"123456",email:`test_${Date.now()}@example.com`,nickname:"æµ‹è¯•ç”¨æˆ·"},login:{username:"",password:""},category:{name:"æµ‹è¯•åˆ†ç±»",description:"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ†ç±»"},question:{title:"",detailedAnswer:"",categoryId:""}})},children:"å¡«å……æµ‹è¯•æ•°æ®"})]})]})},Ns={setupAdminUser:async()=>{try{console.log("è®¾ç½®å½“å‰ç”¨æˆ·ä¸ºç®¡ç†å‘˜...");const e=N().User.current();if(!e)throw new Error("è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜");return console.log("ä½¿ç”¨å½“å‰ç”¨æˆ·ä½œä¸ºç®¡ç†å‘˜:",e.id),{id:e.id,username:e.getUsername(),email:e.getEmail(),nickname:e.get("nickname")}}catch(e){throw console.error("è®¾ç½®ç®¡ç†å‘˜å¤±è´¥:",e),e}},migrateCategoriesToCurrentUser:async()=>{try{console.log("å¼€å§‹è¿ç§»åˆ†ç±»æ•°æ®...");const e=N().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(N().Query)("Category");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦è¿ç§»çš„åˆ†ç±»`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(N().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!0),s.setACL(t),await s.save(),a++,console.log(`âœ… è¿ç§»åˆ†ç±»: ${s.get("name")}`)}catch(e){console.error(`è¿ç§»åˆ†ç±»å¤±è´¥ ${s.id}:`,e)}return console.log(`åˆ†ç±»è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§»åˆ†ç±»æ•°æ®å¤±è´¥:",e),e}},migrateQuestionsToCurrentUser:async()=>{try{console.log("å¼€å§‹è¿ç§»é¢˜ç›®æ•°æ®...");const e=N().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(N().Query)("Question");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦è¿ç§»çš„é¢˜ç›®`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(N().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!0),s.setACL(t),await s.save(),a++,console.log(`âœ… è¿ç§»é¢˜ç›®: ${s.get("title")}`)}catch(e){console.error(`è¿ç§»é¢˜ç›®å¤±è´¥ ${s.id}:`,e)}return console.log(`é¢˜ç›®è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§»é¢˜ç›®æ•°æ®å¤±è´¥:",e),e}},performFullMigration:async()=>{try{console.log("ðŸš€ å¼€å§‹å®Œæ•´æ•°æ®è¿ç§»...");const e=await Ns.setupAdminUser(),s=await Ns.migrateCategoriesToCurrentUser(),t=await Ns.migrateQuestionsToCurrentUser();return console.log("ðŸŽ‰ æ•°æ®è¿ç§»å®Œæˆï¼"),{success:!0,adminUser:e,categories:s,questions:t,message:`è¿ç§»å®Œæˆ: ${s.migrated}ä¸ªåˆ†ç±», ${t.migrated}ä¸ªé¢˜ç›®`}}catch(e){return console.error("æ•°æ®è¿ç§»å¤±è´¥:",e),{success:!1,error:e.message}}},checkMigrationStatus:async()=>{try{const e=new(N().Query)("Category");e.doesNotExist("createdBy");const s=await e.count(),t=new(N().Query)("Question");t.doesNotExist("createdBy");const a=await t.count();return{orphanCategories:s,orphanQuestions:a,totalCategories:await new(N().Query)("Category").count(),totalQuestions:await new(N().Query)("Question").count(),migrationNeeded:s>0||a>0}}catch(e){throw console.error("æ£€æŸ¥è¿ç§»çŠ¶æ€å¤±è´¥:",e),e}},migrateQuestionCreatedBy:async()=>{try{console.log("å¼€å§‹ä¸“é—¨è¿ç§» Question çš„ createdBy å±žæ€§...");const e=N().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(N().Query)("Question");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦æ·»åŠ  createdBy çš„é¢˜ç›®`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(N().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!1),s.setACL(t),await s.save(),a++,console.log(`âœ… ä¸ºé¢˜ç›®æ·»åŠ  createdBy: ${s.get("title")}`)}catch(e){console.error(`è¿ç§»é¢˜ç›®å¤±è´¥ ${s.id}:`,e)}return console.log(`Question createdBy è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§» Question createdBy å¤±è´¥:",e),e}},performQuestionMigrationOnly:async()=>{try{if(console.log("ðŸš€ å¼€å§‹ä¸“é—¨è¿ç§» Question æ•°æ®..."),!N().User.current())throw new Error("è¯·å…ˆç™»å½•");const e=await Ns.migrateQuestionCreatedBy();return console.log("ðŸŽ‰ Question è¿ç§»å®Œæˆï¼"),{success:!0,questions:e,message:`Question è¿ç§»å®Œæˆ: ${e.migrated}ä¸ªé¢˜ç›®`}}catch(e){return console.error("Question è¿ç§»å¤±è´¥:",e),{success:!1,error:e.message}}}},ys=()=>{const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[r,l]=(0,a.useState)(null);(0,a.useEffect)(()=>{o(),d()},[]);const o=()=>{const e=js();l(e)},d=async()=>{try{const e=await Ns.checkMigrationStatus();n(e)}catch(e){console.error("æ£€æŸ¥è¿ç§»çŠ¶æ€å¤±è´¥:",e)}};return(0,p.jsxs)("div",{className:"data-migration-panel",children:[(0,p.jsx)("h2",{children:"ðŸ”„ æ•°æ®è¿ç§»å·¥å…·"}),(0,p.jsx)("p",{children:"å°†çŽ°æœ‰åˆ†ç±»å’Œé¢˜ç›®æ•°æ®å…³è”åˆ°å½“å‰ç™»å½•ç”¨æˆ·"}),(0,p.jsxs)("div",{className:"user-status-section",children:[(0,p.jsx)("h3",{children:"å½“å‰ç”¨æˆ·çŠ¶æ€"}),r?(0,p.jsxs)("div",{className:"user-info",children:[(0,p.jsxs)("p",{children:["âœ… å·²ç™»å½•: ",(0,p.jsx)("strong",{children:r.username})]}),(0,p.jsxs)("p",{children:["é‚®ç®±: ",r.email]}),(0,p.jsxs)("p",{children:["ç”¨æˆ·ID: ",r.id]}),(0,p.jsx)("p",{className:"admin-note",children:"æ­¤ç”¨æˆ·å°†è¢«è®¾ç½®ä¸ºæ‰€æœ‰çŽ°æœ‰æ•°æ®çš„ç®¡ç†å‘˜"})]}):(0,p.jsxs)("div",{className:"user-info not-logged-in",children:[(0,p.jsx)("p",{children:"âŒ æœªç™»å½•"}),(0,p.jsx)("p",{className:"login-required",children:"è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜"})]})]}),t&&(0,p.jsxs)("div",{className:"migration-status",children:[(0,p.jsx)("h3",{children:"å½“å‰æ•°æ®çŠ¶æ€"}),(0,p.jsxs)("div",{className:"status-grid",children:[(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"æ€»åˆ†ç±»æ•°:"}),(0,p.jsx)("span",{className:"value",children:t.totalCategories})]}),(0,p.jsxs)("div",{className:"status-item",children:[(0,p.jsx)("span",{className:"label",children:"æ€»é¢˜ç›®æ•°:"}),(0,p.jsx)("span",{className:"value",children:t.totalQuestions})]}),(0,p.jsxs)("div",{className:"status-item warning",children:[(0,p.jsx)("span",{className:"label",children:"æœªå…³è”åˆ†ç±»:"}),(0,p.jsx)("span",{className:"value",children:t.orphanCategories})]}),(0,p.jsxs)("div",{className:"status-item warning",children:[(0,p.jsx)("span",{className:"label",children:"æœªå…³è”é¢˜ç›®:"}),(0,p.jsx)("span",{className:"value",children:t.orphanQuestions})]})]}),t.migrationNeeded?(0,p.jsx)("div",{className:"migration-needed",children:"âš ï¸ æ£€æµ‹åˆ°æœªå…³è”çš„æ•°æ®ï¼Œéœ€è¦æ‰§è¡Œè¿ç§»"}):(0,p.jsx)("div",{className:"migration-complete",children:"âœ… æ‰€æœ‰æ•°æ®éƒ½å·²å…³è”åˆ°ç”¨æˆ·"})]}),(0,p.jsxs)("div",{className:"migration-actions",children:[(0,p.jsx)("button",{onClick:async()=>{if(r){if(window.confirm(`ç¡®å®šè¦å°†æ‰€æœ‰çŽ°æœ‰æ•°æ®å…³è”åˆ°å½“å‰ç”¨æˆ· "${r.username}" å—ï¼Ÿ`)){s(!0),c(null);try{const e=await Ns.performFullMigration();c(e),await d()}catch(e){c({success:!1,error:e.message})}finally{s(!1)}}}else alert("è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜")},disabled:e||!r||!t?.migrationNeeded,className:"migrate-btn",children:e?"è¿ç§»ä¸­...":"æ‰§è¡Œæ•°æ®è¿ç§»"}),(0,p.jsx)("button",{onClick:d,disabled:e,className:"refresh-btn",children:"åˆ·æ–°çŠ¶æ€"})]}),i&&(0,p.jsxs)("div",{className:"migration-result "+(i.success?"success":"error"),children:[(0,p.jsx)("h4",{children:i.success?"âœ… è¿ç§»æˆåŠŸ":"âŒ è¿ç§»å¤±è´¥"}),i.success?(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:i.message}),i.adminUser&&(0,p.jsxs)("div",{className:"admin-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"ç®¡ç†å‘˜è´¦æˆ·:"})," ",i.adminUser.username]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"ç”¨æˆ·ID:"})," ",i.adminUser.id]})]})]}):(0,p.jsxs)("p",{children:["é”™è¯¯: ",i.error]})]}),(0,p.jsxs)("div",{className:"migration-instructions",children:[(0,p.jsx)("h3",{children:"ðŸ“– ä½¿ç”¨è¯´æ˜Ž"}),(0,p.jsxs)("ol",{children:[(0,p.jsxs)("li",{children:[(0,p.jsx)("strong",{children:"é¦–å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·"}),"ï¼ˆå¯ä»¥æ˜¯æ–°æ³¨å†Œçš„æˆ–çŽ°æœ‰çš„ï¼‰"]}),(0,p.jsx)("li",{children:"ç¡®è®¤ä¸Šæ–¹æ˜¾ç¤ºæœ‰æœªå…³è”çš„æ•°æ®"}),(0,p.jsx)("li",{children:'ç‚¹å‡»"æ‰§è¡Œæ•°æ®è¿ç§»"æŒ‰é’®'}),(0,p.jsx)("li",{children:"è¿ç§»å®ŒæˆåŽï¼Œæ‰€æœ‰çŽ°æœ‰æ•°æ®å°†å…³è”åˆ°å½“å‰ç™»å½•ç”¨æˆ·"}),(0,p.jsx)("li",{children:"ä¹‹åŽå¯ä»¥ä½¿ç”¨æ­¤è´¦æˆ·ç™»å½•ç³»ç»Ÿç®¡ç†æ‰€æœ‰æ•°æ®"})]}),(0,p.jsxs)("div",{className:"important-notes",children:[(0,p.jsx)("h4",{children:"âš ï¸ é‡è¦æç¤º"}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"è¿ç§»è¿‡ç¨‹ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹çŽ°æœ‰æ•°æ®å†…å®¹"}),(0,p.jsx)("li",{children:"åªä¼šæ·»åŠ  createdBy å­—æ®µå’Œæ›´æ–°æƒé™"}),(0,p.jsx)("li",{children:"è¿ç§»åŽï¼Œåªæœ‰å½“å‰ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ‰€æœ‰çŽ°æœ‰æ•°æ®"}),(0,p.jsx)("li",{children:"æ–°æ³¨å†Œçš„ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„æ•°æ®"}),(0,p.jsx)("li",{children:(0,p.jsx)("strong",{children:"å»ºè®®ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„è´¦æˆ·ä½œä¸ºç®¡ç†å‘˜"})})]})]})]})]})},fs=()=>(0,p.jsx)("div",{className:"test-page",children:(0,p.jsxs)("div",{className:"container",children:[(0,p.jsx)("h1",{children:"ç”¨æˆ·ç³»ç»Ÿæµ‹è¯•ä¸Žæ•°æ®è¿ç§»"}),(0,p.jsxs)("div",{className:"test-sections",children:[(0,p.jsxs)("section",{className:"test-section",children:[(0,p.jsx)("h2",{children:"ðŸ”„ æ•°æ®è¿ç§»"}),(0,p.jsx)(ys,{})]}),(0,p.jsxs)("section",{className:"test-section",children:[(0,p.jsx)("h2",{children:"ðŸ§ª ç”¨æˆ·åŠŸèƒ½æµ‹è¯•"}),(0,p.jsx)(vs,{})]})]})]})}),ws=({onShowAuthModal:e})=>{const[s,t]=(0,a.useState)(null),[n,c]=(0,a.useState)(!1),r=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=N().User.current();t(e)},[]),(0,a.useEffect)(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.useEffect)(()=>{const e=async()=>{console.log("æ”¶åˆ°å¤´åƒæ›´æ–°äº‹ä»¶ï¼Œé‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®");const e=N().User.current();if(e)try{const s=await e.fetch();t(s)}catch(e){console.error("é‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}};return window.addEventListener("userAvatarUpdated",e),()=>{window.removeEventListener("userAvatarUpdated",e)}},[]);const l=()=>!!s&&"wu1149823510@outlook.com"===s.getEmail(),o=({user:e,size:s="normal"})=>{const t=e.get("avatar"),a=e.getUsername()?.charAt(0).toUpperCase(),n=(()=>{if(!t)return null;if("string"==typeof t){const e=(new Date).getTime();return`${t}?t=${e}`}return"function"==typeof t.get?t.get("url"):null})();return(0,p.jsx)("div",{className:"user-avatar "+("large"===s?"user-avatar-large":""),children:n?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("img",{src:n,alt:"ç”¨æˆ·å¤´åƒ",onLoad:()=>console.log("âœ… Navigation å¤´åƒåŠ è½½æˆåŠŸ"),onError:e=>{console.error("âŒ Navigation å¤´åƒåŠ è½½å¤±è´¥:",n),e.target.style.display="none";const s=e.target.nextSibling;s&&(s.style.display="flex")},style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}),(0,p.jsx)("div",{className:"avatar-fallback "+("large"===s?"avatar-fallback-large":""),style:{display:"none"},children:a})]}):(0,p.jsx)("div",{className:"avatar-fallback "+("large"===s?"avatar-fallback-large":""),children:a})})};return(0,p.jsx)("nav",{className:"modern-nav",children:(0,p.jsxs)("div",{className:"nav-container",children:[(0,p.jsxs)("div",{className:"nav-left",children:[(0,p.jsxs)(i.N_,{to:"/",className:"nav-brand",children:[(0,p.jsx)("span",{className:"brand-icon",children:"ðŸ“š"}),(0,p.jsx)("span",{className:"brand-text",children:"çŸ¥è¯†é¢˜åº“"})]}),(0,p.jsxs)("div",{className:"nav-links",children:[(0,p.jsxs)(i.N_,{to:"/",className:"nav-link",children:[(0,p.jsx)("span",{className:"link-icon",children:"ðŸ "}),"é¦–é¡µ"]}),s&&l()&&(0,p.jsxs)(i.N_,{to:"/init",className:"nav-link",children:[(0,p.jsx)("span",{className:"link-icon",children:"âš™ï¸"}),"åˆå§‹åŒ–æ•°æ®åº“"]})]})]}),(0,p.jsx)("div",{className:"nav-right",children:s?(0,p.jsxs)("div",{className:"user-section",ref:r,children:[(0,p.jsxs)("button",{className:"user-menu-trigger",onClick:()=>{c(!n)},children:[(0,p.jsx)(o,{user:s}),(0,p.jsx)("span",{className:"user-name",children:s.getUsername()}),l()&&(0,p.jsx)("span",{className:"admin-badge",title:"ç®¡ç†å‘˜",children:"âš¡"}),(0,p.jsx)("span",{className:"dropdown-arrow "+(n?"open":""),children:"â–¼"})]}),n&&(0,p.jsxs)("div",{className:"user-dropdown-menu",children:[(0,p.jsx)("div",{className:"dropdown-header",children:(0,p.jsxs)("div",{className:"user-info-card",children:[(0,p.jsx)(o,{user:s,size:"large"}),(0,p.jsxs)("div",{className:"user-details",children:[(0,p.jsxs)("div",{className:"user-display-name",children:[s.get("nickname")||s.getUsername(),l()&&(0,p.jsx)("span",{className:"admin-tag",children:"ç®¡ç†å‘˜"})]}),(0,p.jsx)("div",{className:"user-email",children:s.getEmail()||"æœªè®¾ç½®é‚®ç®±"})]})]})}),(0,p.jsx)("div",{className:"dropdown-divider"}),(0,p.jsxs)("div",{className:"dropdown-items",children:[(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings"))},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ‘¤"}),(0,p.jsx)("span",{className:"item-text",children:"è´¦æˆ·è®¾ç½®"})]}),(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings",{detail:{tab:"stats"}}))},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ“Š"}),(0,p.jsx)("span",{className:"item-text",children:"å­¦ä¹ ç»Ÿè®¡"})]}),(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings",{detail:{tab:"preferences"}}))},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ””"}),(0,p.jsx)("span",{className:"item-text",children:"é€šçŸ¥è®¾ç½®"})]})]}),l()&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"dropdown-divider"}),(0,p.jsxs)("div",{className:"dropdown-section",children:[(0,p.jsx)("div",{className:"section-label",children:"ç®¡ç†å‘˜åŠŸèƒ½"}),(0,p.jsxs)("div",{className:"dropdown-items",children:[(0,p.jsxs)(i.N_,{to:"/init",className:"dropdown-item",onClick:()=>c(!1),children:[(0,p.jsx)("span",{className:"item-icon",children:"âš™ï¸"}),(0,p.jsx)("span",{className:"item-text",children:"åˆå§‹åŒ–æ•°æ®åº“"})]}),(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),console.log("ç®¡ç†å‘˜åŠŸèƒ½")},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ”§"}),(0,p.jsx)("span",{className:"item-text",children:"ç³»ç»Ÿç®¡ç†"})]})]})]})]}),(0,p.jsx)("div",{className:"dropdown-divider"}),(0,p.jsxs)("div",{className:"dropdown-items",children:[(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.open("/help","_blank")},children:[(0,p.jsx)("span",{className:"item-icon",children:"â“"}),(0,p.jsx)("span",{className:"item-text",children:"å¸®åŠ©æ–‡æ¡£"})]}),(0,p.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.open("mailto:support@example.com","_blank")},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ’¬"}),(0,p.jsx)("span",{className:"item-text",children:"æ„è§åé¦ˆ"})]})]}),(0,p.jsx)("div",{className:"dropdown-divider"}),(0,p.jsx)("div",{className:"dropdown-items",children:(0,p.jsxs)("button",{className:"dropdown-item logout-item",onClick:async()=>{try{await N().User.logOut(),t(null),c(!1),window.location.reload()}catch(e){console.error("é€€å‡ºå¤±è´¥:",e),alert("é€€å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•")}},children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸšª"}),(0,p.jsx)("span",{className:"item-text",children:"é€€å‡ºç™»å½•"})]})})]})]}):(0,p.jsxs)("div",{className:"auth-buttons",children:[(0,p.jsx)("button",{className:"auth-btn login-btn",onClick:()=>e("login"),children:"ç™»å½•"}),(0,p.jsx)("button",{className:"auth-btn login-btn",onClick:()=>e("register"),children:"æ³¨å†Œ"})]})})]})})},bs=({isOpen:e,onClose:s,defaultTab:t="login",onAuthSuccess:n})=>{const[i,c]=(0,a.useState)(t),[r,l]=(0,a.useState)({loginUsername:"",loginPassword:"",registerUsername:"",registerEmail:"",registerPassword:"",registerConfirmPassword:""}),[o,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&(c(t),l({loginUsername:"",loginPassword:"",registerUsername:"",registerEmail:"",registerPassword:"",registerConfirmPassword:""}))},[e,t]);const h=e=>{const{id:s,value:t}=e.target;l(e=>({...e,[s]:t}))};return e?(0,p.jsx)("div",{className:"auth-modal",onClick:s,children:(0,p.jsxs)("div",{className:"auth-content",onClick:e=>e.stopPropagation(),children:[(0,p.jsxs)("div",{className:"auth-header",children:[(0,p.jsx)("h3",{children:"login"===i?"ç”¨æˆ·ç™»å½•":"ç”¨æˆ·æ³¨å†Œ"}),(0,p.jsx)("button",{className:"close-btn",onClick:s,children:"Ã—"})]}),(0,p.jsxs)("div",{className:"auth-tabs",children:[(0,p.jsx)("button",{className:"auth-tab "+("login"===i?"active":""),onClick:()=>c("login"),children:"ç™»å½•"}),(0,p.jsx)("button",{className:"auth-tab "+("register"===i?"active":""),onClick:()=>c("register"),children:"æ³¨å†Œ"})]}),(0,p.jsxs)("form",{className:"auth-form "+("login"===i?"active":""),onSubmit:async e=>{e.preventDefault();try{await ps(r.loginUsername,r.loginPassword),n&&n(),s()}catch(e){alert(`ç™»å½•å¤±è´¥: ${e.message}`)}},children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"loginUsername",children:"ç”¨æˆ·å"}),(0,p.jsx)("input",{type:"text",id:"loginUsername",value:r.loginUsername,onChange:h,required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"loginPassword",children:"å¯†ç "}),(0,p.jsx)("input",{type:"password",id:"loginPassword",value:r.loginPassword,onChange:h,required:!0})]}),(0,p.jsx)("button",{type:"submit",className:"auth-btn primary",children:"ç™»å½•"})]}),(0,p.jsxs)("form",{className:"auth-form "+("register"===i?"active":""),onSubmit:async e=>{if(e.preventDefault(),r.registerPassword===r.registerConfirmPassword)try{await xs(r.registerUsername,r.registerPassword,r.registerEmail),n&&n(),s()}catch(e){alert(`æ³¨å†Œå¤±è´¥: ${e.message}`)}else alert("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")},children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"registerUsername",children:"ç”¨æˆ·å"}),(0,p.jsx)("input",{type:"text",id:"registerUsername",value:r.registerUsername,onChange:h,required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"registerEmail",children:"é‚®ç®±"}),(0,p.jsx)("input",{type:"email",id:"registerEmail",value:r.registerEmail,onChange:h,required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"registerPassword",children:"å¯†ç "}),(0,p.jsx)("input",{type:"password",id:"registerPassword",value:r.registerPassword,onChange:h,required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{htmlFor:"registerConfirmPassword",children:"ç¡®è®¤å¯†ç "}),(0,p.jsx)("input",{type:"password",id:"registerConfirmPassword",value:r.registerConfirmPassword,onChange:h,required:!0})]}),(0,p.jsx)("button",{type:"submit",className:"auth-btn secondary",children:"æ³¨å†Œ"})]})]})}):null},Cs=({isOpen:e,onClose:s})=>{const[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)("profile"),[r,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)({type:"",text:""}),[m,g]=(0,a.useState)(null),[x,j]=(0,a.useState)(""),[v,y]=(0,a.useState)({totalCategories:0,totalQuestions:0,reviewQuestions:0,todayReviewed:0}),[f,w]=(0,a.useState)({username:"",email:"",nickname:"",bio:""}),[b,C]=(0,a.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[S,k]=(0,a.useState)({theme:"light",language:"zh-CN",notifications:!0,emailUpdates:!1}),[A,E]=(0,a.useState)({emailVerified:!1});(0,a.useEffect)(()=>{if(e){const e=N().User.current();n(e),e&&(q(e),L(e))}},[e]);const q=async e=>{try{const s=await e.fetch();w({username:s.getUsername()||"",email:s.getEmail()||"",nickname:s.get("nickname")||"",bio:s.get("bio")||""}),k({theme:s.get("theme")||"light",language:s.get("language")||"zh-CN",notifications:!1!==s.get("notifications"),emailUpdates:s.get("emailUpdates")||!1}),E({emailVerified:s.get("emailVerified")||!1});const t=s.get("avatar");if(t&&"string"==typeof t){const e=(new Date).getTime();j(`${t}?t=${e}`)}else j("")}catch(e){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},L=async e=>{try{const s=new(N().Query)("Category");s.equalTo("createdBy",e);const t=await s.find(),a=new(N().Query)("Question");a.equalTo("createdBy",e);const n=await a.find(),i=new Date,c=1,r=n.filter(e=>{const s=new Date(e.get("lastReviewedAt")||e.get("createdAt"));return Math.floor((i-s)/864e5)>=c}),l=new Date;l.setHours(0,0,0,0);const o=n.filter(e=>new Date(e.get("lastReviewedAt"))>=l).length;y({totalCategories:t.length,totalQuestions:n.length,reviewQuestions:r.length,todayReviewed:o})}catch(e){console.error("åŠ è½½å­¦ä¹ ç»Ÿè®¡å¤±è´¥:",e),y({totalCategories:0,totalQuestions:0,reviewQuestions:0,todayReviewed:0})}},D=(e,s,t=3e3)=>{u({type:e,text:s}),setTimeout(()=>u({type:"",text:""}),t)},T=(e,s,t)=>{switch(e){case"profile":w(e=>({...e,[s]:t}));break;case"password":C(e=>({...e,[s]:t}));break;case"preferences":k(e=>({...e,[s]:t}))}};return e?(0,p.jsx)("div",{className:"user-settings-overlay",children:(0,p.jsxs)("div",{className:"user-settings-modal",children:[(0,p.jsxs)("div",{className:"settings-header",children:[(0,p.jsxs)("div",{className:"header-content",children:[(0,p.jsx)("h2",{children:"è´¦æˆ·è®¾ç½®"}),(0,p.jsx)("p",{children:"ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œåå¥½è®¾ç½®"})]}),(0,p.jsx)("button",{className:"close-button",onClick:s,disabled:o,children:"Ã—"})]}),h.text&&(0,p.jsx)("div",{className:`message ${h.type}`,children:h.text}),(0,p.jsxs)("div",{className:"settings-content",children:[(0,p.jsxs)("div",{className:"settings-sidebar",children:[(0,p.jsxs)("button",{className:"sidebar-item "+("profile"===i?"active":""),onClick:()=>c("profile"),children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ‘¤"}),(0,p.jsx)("span",{className:"item-text",children:"ä¸ªäººä¿¡æ¯"})]}),(0,p.jsxs)("button",{className:"sidebar-item "+("security"===i?"active":""),onClick:()=>c("security"),children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ”’"}),(0,p.jsx)("span",{className:"item-text",children:"å®‰å…¨è®¾ç½®"})]}),(0,p.jsxs)("button",{className:"sidebar-item "+("preferences"===i?"active":""),onClick:()=>c("preferences"),children:[(0,p.jsx)("span",{className:"item-icon",children:"âš™ï¸"}),(0,p.jsx)("span",{className:"item-text",children:"åå¥½è®¾ç½®"})]}),(0,p.jsxs)("button",{className:"sidebar-item "+("data"===i?"active":""),onClick:()=>c("data"),children:[(0,p.jsx)("span",{className:"item-icon",children:"ðŸ“Š"}),(0,p.jsx)("span",{className:"item-text",children:"å­¦ä¹ ç»Ÿè®¡"})]})]}),(0,p.jsxs)("div",{className:"settings-main",children:["profile"===i&&(0,p.jsxs)("div",{className:"tab-content",children:[(0,p.jsx)("h3",{children:"ä¸ªäººä¿¡æ¯"}),(0,p.jsxs)("div",{className:"avatar-section",children:[(0,p.jsxs)("div",{className:"avatar-upload",children:[(0,p.jsx)("div",{className:"avatar-preview",children:x?(0,p.jsx)("img",{src:x,alt:"å¤´åƒé¢„è§ˆ",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"},onLoad:()=>console.log("âœ… å¤´åƒé¢„è§ˆåŠ è½½æˆåŠŸ"),onError:e=>{console.error("âŒ å¤´åƒé¢„è§ˆåŠ è½½å¤±è´¥:",x),e.target.style.display="none"}}):(0,p.jsx)("div",{className:"avatar-placeholder",children:f.username?.charAt(0).toUpperCase()})}),(0,p.jsxs)("div",{className:"avatar-controls",children:[(0,p.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(!s)return;if(!s.type.startsWith("image/"))return void D("error","è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼ˆJPGã€PNGã€GIFï¼‰");if(s.size>2097152)return void D("error","å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB");g(s);const t=new FileReader;t.onload=e=>{j(e.target.result)},t.readAsDataURL(s)},className:"avatar-input"}),(0,p.jsx)("label",{htmlFor:"avatar-upload",className:"avatar-upload-btn",children:"é€‰æ‹©å›¾ç‰‡"}),m&&(0,p.jsx)("button",{className:"avatar-save-btn",onClick:async()=>{if(m&&t){d(!0);try{j("");const e=await new Promise((e,s)=>{const t=new FileReader;t.onload=s=>{const t=s.target.result.split(",")[1];e(t)},t.onerror=()=>s(new Error("æ–‡ä»¶è¯»å–å¤±è´¥")),t.readAsDataURL(m)}),s=await N().Cloud.run("updateUserAvatar",{fileData:e,fileName:m.name,mimeType:m.type});if(!s.success)throw new Error(s.message||"å¤´åƒä¸Šä¼ å¤±è´¥");{D("success","å¤´åƒä¸Šä¼ æˆåŠŸï¼");const e=(new Date).getTime(),t=`${s.avatarUrl}?t=${e}`;console.log("è®¾ç½®å¸¦æ—¶é—´æˆ³çš„å¤´åƒURL:",t),j(t),g(null),setTimeout(async()=>{try{const e=await N().User.current().fetch();n(e),console.log("ç”¨æˆ·æ•°æ®å·²æ›´æ–°"),window.dispatchEvent(new CustomEvent("userAvatarUpdated"))}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},1e3)}}catch(e){console.error("âŒ å¤´åƒä¸Šä¼ å¤±è´¥:",e),D("error",`ä¸Šä¼ å¤±è´¥: ${e.message}`)}finally{d(!1)}}else D("error","è¯·å…ˆé€‰æ‹©å›¾ç‰‡")},disabled:o,children:o?"ä¸Šä¼ ä¸­...":"ä¿å­˜å¤´åƒ"})]})]}),(0,p.jsx)("div",{className:"avatar-hint",children:"æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡ 2MB"})]}),(0,p.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t){d(!0);try{console.log("å¼€å§‹æ›´æ–°ä¸ªäººä¿¡æ¯...",{nickname:f.nickname,bio:f.bio});const e=await N().Cloud.run("updateUserProfile",{nickname:f.nickname,bio:f.bio});if(!e.success)throw new Error(e.message||"æ›´æ–°å¤±è´¥");D("success","ä¸ªäººä¿¡æ¯æ›´æ–°æˆåŠŸï¼"),setTimeout(async()=>{try{const e=await N().User.current().fetch();n(e),console.log("ç”¨æˆ·æ•°æ®å·²æ›´æ–°")}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},500)}catch(e){console.error("æ›´æ–°ä¸ªäººä¿¡æ¯å¤±è´¥:",e);let s="æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•";s=401===e.code?"è¯·å…ˆç™»å½•":e.message.includes("network")?"ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ":`æ›´æ–°å¤±è´¥: ${e.message}`,D("error",s)}finally{d(!1)}}},className:"settings-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"ç”¨æˆ·å"}),(0,p.jsx)("input",{type:"text",value:f.username,disabled:!0,className:"disabled-input"}),(0,p.jsx)("div",{className:"field-hint",children:"ç”¨æˆ·ååˆ›å»ºåŽä¸å¯ä¿®æ”¹"})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"é‚®ç®±åœ°å€"}),(0,p.jsx)("input",{type:"email",value:f.email,disabled:!0,className:"disabled-input"}),(0,p.jsx)("div",{className:"field-hint",children:f.email?"é‚®ç®±å·²éªŒè¯":"æœªè®¾ç½®é‚®ç®±"})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"æ˜µç§°"}),(0,p.jsx)("input",{type:"text",value:f.nickname,onChange:e=>T("profile","nickname",e.target.value),placeholder:"è¯·è¾“å…¥æ‚¨çš„æ˜µç§°",maxLength:20})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"ä¸ªäººç®€ä»‹"}),(0,p.jsx)("textarea",{value:f.bio,onChange:e=>T("profile","bio",e.target.value),placeholder:"ä»‹ç»ä¸€ä¸‹æ‚¨è‡ªå·±...",rows:"3",maxLength:200}),(0,p.jsxs)("div",{className:"char-count",children:[f.bio.length,"/200"]})]}),(0,p.jsx)("div",{className:"form-actions",children:(0,p.jsx)("button",{type:"submit",className:"save-button",disabled:o,children:o?"ä¿å­˜ä¸­...":"ä¿å­˜æ›´æ”¹"})})]})]}),"security"===i&&(0,p.jsxs)("div",{className:"tab-content",children:[(0,p.jsx)("h3",{children:"å®‰å…¨è®¾ç½®"}),(0,p.jsxs)("div",{className:"security-section",children:[(0,p.jsx)("h4",{children:"é‚®ç®±éªŒè¯"}),(0,p.jsxs)("div",{className:"security-item",children:[(0,p.jsxs)("div",{className:"security-info",children:[(0,p.jsx)("span",{className:"security-label",children:"é‚®ç®±çŠ¶æ€"}),(0,p.jsx)("span",{className:"security-status "+(A.emailVerified?"verified":"unverified"),children:A.emailVerified?"å·²éªŒè¯":"æœªéªŒè¯"})]}),!A.emailVerified&&(0,p.jsx)("button",{className:"security-action-btn",onClick:async()=>{if(t&&t.getEmail()){l(!0);try{await N().User.requestEmailVerify(t.getEmail()),D("success","éªŒè¯é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±")}catch(e){console.error("å‘é€éªŒè¯é‚®ä»¶å¤±è´¥:",e),D("error",`å‘é€éªŒè¯é‚®ä»¶å¤±è´¥: ${e.message}`)}finally{l(!1)}}else D("error","è¯·å…ˆè®¾ç½®é‚®ç®±åœ°å€")},disabled:r||!f.email,children:r?"å‘é€ä¸­...":"å‘é€éªŒè¯é‚®ä»¶"})]})]}),(0,p.jsxs)("div",{className:"security-section",children:[(0,p.jsx)("h4",{children:"ä¿®æ”¹å¯†ç "}),(0,p.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),b.newPassword===b.confirmPassword)if(b.newPassword.length<6)D("error","æ–°å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦");else{d(!0);try{await t.updatePassword(b.currentPassword,b.newPassword),D("success","å¯†ç ä¿®æ”¹æˆåŠŸï¼"),C({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){console.error("ä¿®æ”¹å¯†ç å¤±è´¥:",e),D("error",`å¯†ç ä¿®æ”¹å¤±è´¥: ${e.message}`)}finally{d(!1)}}else D("error","æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸ä¸€è‡´")},className:"settings-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"å½“å‰å¯†ç "}),(0,p.jsx)("input",{type:"password",value:b.currentPassword,onChange:e=>T("password","currentPassword",e.target.value),placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ",required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"æ–°å¯†ç "}),(0,p.jsx)("input",{type:"password",value:b.newPassword,onChange:e=>T("password","newPassword",e.target.value),placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",minLength:6,required:!0})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"ç¡®è®¤æ–°å¯†ç "}),(0,p.jsx)("input",{type:"password",value:b.confirmPassword,onChange:e=>T("password","confirmPassword",e.target.value),placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",minLength:6,required:!0})]}),(0,p.jsxs)("div",{className:"password-strength",children:[(0,p.jsx)("div",{className:"strength-bar",children:(0,p.jsx)("div",{className:"strength-fill "+(b.newPassword.length>=6?"strong":"weak"),style:{width:`${Math.min(b.newPassword.length/6*100,100)}%`}})}),(0,p.jsx)("div",{className:"strength-text",children:b.newPassword.length>=6?"å¯†ç å¼ºåº¦è¶³å¤Ÿ":"å¯†ç è‡³å°‘éœ€è¦6ä½"})]}),(0,p.jsx)("div",{className:"form-actions",children:(0,p.jsx)("button",{type:"submit",className:"save-button",disabled:o,children:o?"æ›´æ–°ä¸­...":"ä¿®æ”¹å¯†ç "})})]})]}),(0,p.jsxs)("div",{className:"security-section",children:[(0,p.jsx)("h4",{children:"å¯†ç é‡ç½®"}),(0,p.jsxs)("div",{className:"security-item",children:[(0,p.jsxs)("div",{className:"security-info",children:[(0,p.jsx)("span",{className:"security-label",children:"å¿˜è®°å¯†ç ï¼Ÿ"}),(0,p.jsx)("span",{className:"security-description",children:"é€šè¿‡é‚®ç®±é‡ç½®æ‚¨çš„å¯†ç "})]}),(0,p.jsx)("button",{className:"security-action-btn secondary",onClick:async()=>{if(t&&t.getEmail()){l(!0);try{await N().User.requestPasswordReset(t.getEmail()),D("success","å¯†ç é‡ç½®é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±")}catch(e){console.error("å‘é€é‡ç½®é‚®ä»¶å¤±è´¥:",e),D("error",`å‘é€é‡ç½®é‚®ä»¶å¤±è´¥: ${e.message}`)}finally{l(!1)}}else D("error","è¯·å…ˆè®¾ç½®é‚®ç®±åœ°å€")},disabled:r||!f.email,children:r?"å‘é€ä¸­...":"å‘é€é‡ç½®é‚®ä»¶"})]})]})]}),"preferences"===i&&(0,p.jsxs)("div",{className:"tab-content",children:[(0,p.jsx)("h3",{children:"åå¥½è®¾ç½®"}),(0,p.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t){d(!0);try{console.log("å¼€å§‹æ›´æ–°åå¥½è®¾ç½®...",S);const e=await N().Cloud.run("updateUserPreferences",{theme:S.theme,language:S.language,notifications:S.notifications,emailUpdates:S.emailUpdates});if(!e.success)throw new Error(e.message||"æ›´æ–°å¤±è´¥");D("success","åå¥½è®¾ç½®æ›´æ–°æˆåŠŸï¼"),setTimeout(async()=>{try{const e=await N().User.current().fetch();n(e)}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},500)}catch(e){console.error("æ›´æ–°åå¥½è®¾ç½®å¤±è´¥:",e),D("error",`æ›´æ–°å¤±è´¥: ${e.message}`)}finally{d(!1)}}},className:"settings-form",children:[(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"ä¸»é¢˜æ¨¡å¼"}),(0,p.jsxs)("div",{className:"radio-group",children:[(0,p.jsxs)("label",{className:"radio-option",children:[(0,p.jsx)("input",{type:"radio",name:"theme",value:"light",checked:"light"===S.theme,onChange:e=>T("preferences","theme",e.target.value)}),(0,p.jsxs)("span",{className:"radio-label",children:[(0,p.jsx)("span",{className:"radio-icon",children:"ðŸŒž"}),"æµ…è‰²æ¨¡å¼"]})]}),(0,p.jsxs)("label",{className:"radio-option",children:[(0,p.jsx)("input",{type:"radio",name:"theme",value:"dark",checked:"dark"===S.theme,onChange:e=>T("preferences","theme",e.target.value)}),(0,p.jsxs)("span",{className:"radio-label",children:[(0,p.jsx)("span",{className:"radio-icon",children:"ðŸŒ™"}),"æ·±è‰²æ¨¡å¼"]})]})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"è¯­è¨€"}),(0,p.jsxs)("select",{value:S.language,onChange:e=>T("preferences","language",e.target.value),children:[(0,p.jsx)("option",{value:"zh-CN",children:"ç®€ä½“ä¸­æ–‡"}),(0,p.jsx)("option",{value:"en-US",children:"English"})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"é€šçŸ¥è®¾ç½®"}),(0,p.jsxs)("div",{className:"switch-group",children:[(0,p.jsxs)("label",{className:"switch",children:[(0,p.jsx)("input",{type:"checkbox",checked:S.notifications,onChange:e=>T("preferences","notifications",e.target.checked)}),(0,p.jsx)("span",{className:"slider"})]}),(0,p.jsx)("span",{className:"switch-label",children:"å¯ç”¨æµè§ˆå™¨é€šçŸ¥"})]})]}),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{children:"é‚®ä»¶æ›´æ–°"}),(0,p.jsxs)("div",{className:"switch-group",children:[(0,p.jsxs)("label",{className:"switch",children:[(0,p.jsx)("input",{type:"checkbox",checked:S.emailUpdates,onChange:e=>T("preferences","emailUpdates",e.target.checked)}),(0,p.jsx)("span",{className:"slider"})]}),(0,p.jsx)("span",{className:"switch-label",children:"æŽ¥æ”¶äº§å“æ›´æ–°é‚®ä»¶"})]})]}),(0,p.jsx)("div",{className:"form-actions",children:(0,p.jsx)("button",{type:"submit",className:"save-button",disabled:o,children:o?"ä¿å­˜ä¸­...":"ä¿å­˜è®¾ç½®"})})]})]}),"data"===i&&(0,p.jsxs)("div",{className:"tab-content",children:[(0,p.jsx)("h3",{children:"å­¦ä¹ ç»Ÿè®¡"}),(0,p.jsx)("div",{className:"stats-overview",children:(0,p.jsxs)("div",{className:"stats-grid",children:[(0,p.jsxs)("div",{className:"stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:v.totalCategories}),(0,p.jsx)("div",{className:"stat-label",children:"çŸ¥è¯†åˆ†ç±»"})]})]}),(0,p.jsxs)("div",{className:"stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"â“"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:v.totalQuestions}),(0,p.jsx)("div",{className:"stat-label",children:"é¢˜ç›®æ€»æ•°"})]})]}),(0,p.jsxs)("div",{className:"stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"ðŸ“–"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:v.reviewQuestions}),(0,p.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ "})]})]}),(0,p.jsxs)("div",{className:"stat-card",children:[(0,p.jsx)("div",{className:"stat-icon",children:"âš¡"}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("div",{className:"stat-number",children:v.todayReviewed}),(0,p.jsx)("div",{className:"stat-label",children:"ä»Šæ—¥å¤ä¹ "})]})]})]})}),(0,p.jsx)("div",{className:"progress-section",children:(0,p.jsxs)("div",{className:"progress-item",children:[(0,p.jsxs)("div",{className:"progress-header",children:[(0,p.jsx)("span",{className:"progress-label",children:"å¤ä¹ è¿›åº¦"}),(0,p.jsxs)("span",{className:"progress-percent",children:[v.totalQuestions>0?Math.round((v.totalQuestions-v.reviewQuestions)/v.totalQuestions*100):0,"%"]})]}),(0,p.jsx)("div",{className:"progress-bar",children:(0,p.jsx)("div",{className:"progress-fill",style:{width:(v.totalQuestions>0?(v.totalQuestions-v.reviewQuestions)/v.totalQuestions*100:0)+"%"}})}),(0,p.jsxs)("div",{className:"progress-text",children:["å·²å¤ä¹  ",v.totalQuestions-v.reviewQuestions," / ",v.totalQuestions," é¢˜ç›®"]})]})}),(0,p.jsxs)("div",{className:"data-section",children:[(0,p.jsx)("h4",{children:"æ•°æ®å¯¼å‡º"}),(0,p.jsxs)("div",{className:"data-item",children:[(0,p.jsxs)("div",{className:"data-info",children:[(0,p.jsx)("span",{className:"data-label",children:"å¯¼å‡ºå­¦ä¹ æ•°æ®"}),(0,p.jsx)("span",{className:"data-description",children:"å¯¼å‡ºæ‚¨çš„æ‰€æœ‰åˆ†ç±»å’Œé¢˜ç›®æ•°æ®ä¸º JSON æ ¼å¼"})]}),(0,p.jsx)("button",{className:"data-action-btn",onClick:async()=>{l(!0);try{const[e,s]=await Promise.all([new(N().Query)("Category").equalTo("createdBy",t).find(),new(N().Query)("Question").equalTo("createdBy",t).include("category").find()]),a={exportTime:(new Date).toISOString(),user:{username:t.getUsername(),email:t.getEmail(),nickname:t.get("nickname")},categories:e.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")})),questions:s.map(e=>({id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel"),tags:e.get("tags")||[],category:e.get("category")?{id:e.get("category").id,name:e.get("category").get("name")}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")}))},n=JSON.stringify(a,null,2),i=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(i),r=document.createElement("a");r.href=c,r.download=`knowledge-base-export-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(c),D("success","æ•°æ®å¯¼å‡ºæˆåŠŸï¼")}catch(e){console.error("æ•°æ®å¯¼å‡ºå¤±è´¥:",e),D("error",`æ•°æ®å¯¼å‡ºå¤±è´¥: ${e.message}`)}finally{l(!1)}},disabled:r,children:r?"å¯¼å‡ºä¸­...":"å¯¼å‡ºæ•°æ®"})]})]}),(0,p.jsxs)("div",{className:"data-section",children:[(0,p.jsx)("h4",{children:"æ•°æ®æ¸…ç†"}),(0,p.jsxs)("div",{className:"data-item danger",children:[(0,p.jsxs)("div",{className:"data-info",children:[(0,p.jsx)("span",{className:"data-label",children:"åˆ é™¤è´¦æˆ·æ•°æ®"}),(0,p.jsx)("span",{className:"data-description",children:"æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰å­¦ä¹ æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€"})]}),(0,p.jsx)("button",{className:"data-action-btn danger",disabled:!0,children:"å³å°†å¼€æ”¾"})]})]})]})]})]})]})}):null},Ss=new c.E({defaultOptions:{queries:{staleTime:3e5,cacheTime:6e5,retry:1}}}),ks=()=>{const e=(0,i.Zp)(),[s,t]=(0,a.useState)([]),[n,c]=(0,a.useState)(!0),[l,o]=(0,a.useState)(null),[d,h]=(0,a.useState)(7),[u,m]=(0,a.useState)([]),[g,x]=(0,a.useState)(!1),[j,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=N().User.current();v(e),e?y():c(!1)},[]);const y=async()=>{try{const e=await V();t(e),c(!1)}catch(e){o(e.message),c(!1)}};return(0,a.useEffect)(()=>{s.length>0&&(()=>{const e=new Date,t=24*d*60*60*1e3,a=s.filter(s=>{const a=new Date(s.updatedAt||s.createdAt);return e-a>=t}).sort((e,s)=>new Date(e.updatedAt||e.createdAt)-new Date(s.updatedAt||s.createdAt));m(a)})()},[s,d]),j?n?(0,p.jsx)("div",{className:"review-page",children:(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"modern-spinner"}),(0,p.jsx)("p",{children:"åŠ è½½å¤ä¹ æ•°æ®ä¸­..."})]})}):l?(0,p.jsx)("div",{className:"review-page",children:(0,p.jsxs)("div",{className:"error-container",children:[(0,p.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,p.jsx)("p",{children:l}),(0,p.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"é‡è¯•"})]})}):(0,p.jsx)(r.Ht,{client:Ss,children:(0,p.jsxs)("div",{className:"review-page",children:[(0,p.jsx)("header",{className:"review-hero-section",children:(0,p.jsxs)("div",{className:"hero-content",children:[(0,p.jsxs)("div",{className:"user-welcome",children:[(0,p.jsx)("h1",{className:"hero-title",children:"ðŸ“š å¤ä¹ æé†’"}),(0,p.jsxs)("p",{className:"hero-subtitle",children:["æ™ºèƒ½ç®¡ç†æ‚¨çš„å­¦ä¹ è¿›åº¦ï¼Œ",u.length>0?`æœ‰ ${u.length} é“é¢˜ç›®éœ€è¦å¤ä¹ `:"æ‰€æœ‰é¢˜ç›®éƒ½å·²åŠæ—¶å¤ä¹ "]})]}),(0,p.jsxs)("div",{className:"review-stats-overview",children:[(0,p.jsxs)("div",{className:"stat-card",children:[(0,p.jsx)("div",{className:"stat-number",children:s.length}),(0,p.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]}),(0,p.jsxs)("div",{className:"stat-card warning",children:[(0,p.jsx)("div",{className:"stat-number",children:u.length}),(0,p.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ "})]}),(0,p.jsxs)("div",{className:"stat-card success",children:[(0,p.jsx)("div",{className:"stat-number",children:s.length-u.length}),(0,p.jsx)("div",{className:"stat-label",children:"å·²å¤ä¹ "})]})]})]})}),(0,p.jsx)(le,{reviewQuestions:u,setReviewQuestions:m,reviewThreshold:d,setReviewThreshold:h,showReviewSettings:g,setShowReviewSettings:x,onQuestionClick:t=>{const a=s.find(e=>e.id===t);a&&a.category&&e(`/category/${a.category.id}`)},onUpdateQuestionTime:async e=>{try{console.log("æ›´æ–°é¢˜ç›®å¤ä¹ æ—¶é—´:",e);const s=(new Date).toISOString();return await J(e,{updatedAt:s}),t(t=>t.map(t=>t.id===e?{...t,updatedAt:s}:t)),console.log(`é¢˜ç›® ${e} å¤ä¹ æ—¶é—´å·²æ›´æ–°`),!0}catch(e){throw console.error("æ›´æ–°é¢˜ç›®æ—¶é—´å¤±è´¥:",e),e}},questions:s}),(0,p.jsx)("footer",{className:"review-footer",children:(0,p.jsxs)("div",{className:"footer-actions",children:[(0,p.jsx)("button",{onClick:()=>e("/"),className:"back-to-home-btn",children:"â† è¿”å›žé¦–é¡µ"}),(0,p.jsx)("div",{className:"footer-info",children:"åŸºäºŽé—´éš”é‡å¤åŽŸç†ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆè®°å¿†"})]})})]})}):(0,p.jsx)("div",{className:"review-page",children:(0,p.jsxs)("div",{className:"auth-required-container",children:[(0,p.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,p.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,p.jsx)("p",{children:"ç™»å½•åŽå³å¯ä½¿ç”¨å¤ä¹ æé†’åŠŸèƒ½"}),(0,p.jsxs)("div",{className:"auth-required-actions",children:[(0,p.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"login"}}))},className:"login-btn primary",children:"ðŸš€ ç«‹å³ç™»å½•"}),(0,p.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"register"}}))},className:"login-btn secondary",children:"ðŸ“ æ³¨å†Œè´¦å·"})]})]})})},As=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{const e=e=>{e.preventDefault(),s(e),n(!0)};return window.addEventListener("beforeinstallprompt",e),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]),t?(0,p.jsxs)("div",{style:{position:"fixed",bottom:"20px",right:"20px",background:"white",padding:"16px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,maxWidth:"300px"},children:[(0,p.jsx)("h4",{children:"å®‰è£…åº”ç”¨"}),(0,p.jsx)("p",{children:"å°†æ­¤åº”ç”¨å®‰è£…åˆ°æ‚¨çš„è®¾å¤‡ä¸Šä»¥èŽ·å¾—æ›´å¥½çš„ä½“éªŒ"}),(0,p.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[(0,p.jsx)("button",{onClick:async()=>{if(!e)return;e.prompt();const{outcome:t}=await e.userChoice;"accepted"===t?console.log("ç”¨æˆ·æŽ¥å—äº†å®‰è£…"):console.log("ç”¨æˆ·æ‹’ç»äº†å®‰è£…"),s(null),n(!1)},style:{background:"#007bff",color:"white",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"å®‰è£…"}),(0,p.jsx)("button",{onClick:()=>{s(null),n(!1)},style:{background:"transparent",border:"1px solid #ccc",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"ç¨åŽ"})]})]}):null},Es=({questionId:e,onBack:s,onNavigateToQuestion:t})=>{const[n,i]=(0,a.useState)(null),[c,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)(null),[d,h]=(0,a.useState)([]),[u,m]=(0,a.useState)(0);(0,a.useEffect)(()=>{g()},[e]);const g=async()=>{try{r(!0);const s=(await T.getCachedQuestions()).questions||[];h(s);let t=null,a=0;e?(t=s.find(s=>s.id===e),a=s.findIndex(s=>s.id===e)):(t=s[0]||null,a=0),t?(i(t),m(a)):o("æœªæ‰¾åˆ°è¯¥é¢˜ç›®æˆ–é¢˜ç›®ä¸åœ¨ç¼“å­˜ä¸­")}catch(e){console.error("åŠ è½½ç¦»çº¿é¢˜ç›®å¤±è´¥:",e),o("åŠ è½½ç¦»çº¿é¢˜ç›®å¤±è´¥: "+e.message)}finally{r(!1)}},x=()=>{if(u>0){const e=u-1;m(e),i(d[e]),t&&t(d[e].id)}},j=()=>{if(u<d.length-1){const e=u+1;m(e),i(d[e]),t&&t(d[e].id)}};return c?(0,p.jsx)("div",{className:"offline-detail-container",children:(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"modern-spinner"}),(0,p.jsx)("p",{children:"åŠ è½½ç¦»çº¿é¢˜ç›®..."})]})}):l?(0,p.jsx)("div",{className:"offline-detail-container",children:(0,p.jsxs)("div",{className:"error-container",children:[(0,p.jsx)("div",{className:"error-icon",children:"âŒ"}),(0,p.jsx)("h3",{children:"åŠ è½½å¤±è´¥"}),(0,p.jsx)("p",{children:l}),(0,p.jsx)("button",{onClick:s,className:"back-btn",children:"è¿”å›žåˆ—è¡¨"})]})}):n?(0,p.jsxs)("div",{className:"offline-detail-container",children:[(0,p.jsxs)("div",{className:"offline-detail-header",children:[(0,p.jsxs)("div",{className:"header-left",children:[(0,p.jsx)("button",{onClick:s,className:"back-button",children:"â† è¿”å›ž"}),(0,p.jsx)("div",{className:"offline-badge",children:"ç¦»çº¿æ¨¡å¼"})]}),(0,p.jsxs)("div",{className:"header-center",children:[(0,p.jsx)("h3",{children:"é¢˜ç›®è¯¦æƒ…"}),(0,p.jsxs)("span",{className:"question-counter",children:[u+1," / ",d.length]})]}),(0,p.jsxs)("div",{className:"header-right",children:[(0,p.jsx)("button",{onClick:x,disabled:0===u,className:"nav-button",children:"â† ä¸Šä¸€é¢˜"}),(0,p.jsx)("button",{onClick:j,disabled:u===d.length-1,className:"nav-button",children:"ä¸‹ä¸€é¢˜ â†’"})]})]}),(0,p.jsxs)("div",{className:"offline-notice",children:[(0,p.jsx)("div",{className:"notice-icon",children:"ðŸ“¶"}),(0,p.jsxs)("div",{className:"notice-content",children:[(0,p.jsx)("strong",{children:"ç¦»çº¿æ¨¡å¼"}),(0,p.jsx)("span",{children:"å½“å‰å¤„äºŽç¦»çº¿çŠ¶æ€ï¼Œéƒ¨åˆ†åŠŸèƒ½å—é™"})]})]}),(0,p.jsx)("div",{className:"question-card-wrapper",children:(0,p.jsxs)("div",{className:"offline-question-card",children:[(0,p.jsxs)("div",{className:"question-header",children:[(0,p.jsx)("h2",{className:"question-title",children:n.title}),(0,p.jsxs)("div",{className:"question-meta",children:[(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:qs(n.difficulty)},children:Ls(n.difficulty)}),(0,p.jsx)("span",{className:"category-tag",children:n.category?.name||"æœªåˆ†ç±»"})]})]}),(0,p.jsxs)("div",{className:"question-content",children:[(0,p.jsxs)("div",{className:"answer-section",children:[(0,p.jsx)("h4",{children:"è¯¦ç»†ç­”æ¡ˆ"}),(0,p.jsx)("div",{className:"answer-text",children:n.detailedAnswer||n.oralAnswer||"æš‚æ— ç­”æ¡ˆ"})]}),n.code&&(0,p.jsxs)("div",{className:"code-section",children:[(0,p.jsx)("h4",{children:"ä»£ç "}),(0,p.jsx)("pre",{className:"code-block",children:(0,p.jsx)("code",{children:n.code})})]})]})]})}),(0,p.jsxs)("div",{className:"offline-detail-footer",children:[(0,p.jsx)("button",{onClick:x,disabled:0===u,className:"footer-nav-button",children:"â† ä¸Šä¸€é¢˜"}),(0,p.jsxs)("div",{className:"progress-info",children:[(0,p.jsx)("div",{className:"progress-bar",children:(0,p.jsx)("div",{className:"progress-fill",style:{width:(u+1)/d.length*100+"%"}})}),(0,p.jsxs)("span",{children:["è¿›åº¦: ",u+1," / ",d.length]})]}),(0,p.jsx)("button",{onClick:j,disabled:u===d.length-1,className:"footer-nav-button",children:"ä¸‹ä¸€é¢˜ â†’"})]})]}):(0,p.jsx)("div",{className:"offline-detail-container",children:(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:"ðŸ“­"}),(0,p.jsx)("h3",{children:"é¢˜ç›®ä¸å­˜åœ¨"}),(0,p.jsx)("p",{children:"è¯¥é¢˜ç›®å¯èƒ½å·²è¢«åˆ é™¤æˆ–ä¸åœ¨ç¼“å­˜ä¸­"}),(0,p.jsx)("button",{onClick:s,className:"back-btn",children:"è¿”å›žåˆ—è¡¨"})]})})},qs=e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}},Ls=e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return e}},Ds=e=>{const s=e.oralAnswer||e.detailedAnswer||"";return s.substring(0,120).replace(/[#*`]/g,"")+(s.length>120?"...":"")},Ts=()=>{const{categoryName:e,questionId:s}=(0,i.g)(),t=(0,i.Zp)(),[n,c]=(0,a.useState)([]),[r,l]=(0,a.useState)([]),[o,d]=(0,a.useState)(!0),[h,u]=(0,a.useState)("list");(0,a.useEffect)(()=>{m()},[e,s]);const m=async()=>{try{const t=(await T.getCachedQuestions()).questions||[];if(c(t),e&&"all"!==e){const s=t.filter(s=>s.category?.name===e||"æœªåˆ†ç±»"===e);l(s)}else l(t);s&&u("detail")}catch(e){console.error("åŠ è½½ç¦»çº¿é¢˜ç›®å¤±è´¥:",e)}finally{d(!1)}};return"detail"===h?(0,p.jsx)(Es,{questionId:s,onBack:()=>{u("list"),t("/offline/questions")},onNavigateToQuestion:e=>{t(`/offline/questions/${e}`)}}):o?(0,p.jsx)("div",{className:"offline-page",children:(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"modern-spinner"}),(0,p.jsx)("p",{children:"åŠ è½½ç¦»çº¿æ•°æ®..."})]})}):0===r.length?(0,p.jsx)("div",{className:"offline-page",children:(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)("div",{className:"empty-icon",children:"ðŸ“¦"}),(0,p.jsx)("h3",{children:"æš‚æ— ç¦»çº¿é¢˜ç›®"}),(0,p.jsx)("p",{children:"å½“å‰æ²¡æœ‰ç¼“å­˜çš„é¢˜ç›®æ•°æ®ï¼Œè¯·è¿žæŽ¥ç½‘ç»œåŽç¼“å­˜é¢˜ç›®"}),(0,p.jsx)("button",{onClick:()=>window.history.back(),className:"back-btn",children:"è¿”å›ž"})]})}):(0,p.jsxs)("div",{className:"offline-page",children:[(0,p.jsxs)("div",{className:"offline-header",children:[(0,p.jsx)("button",{onClick:()=>window.history.back(),className:"back-button",children:"â† è¿”å›žä¸»é¡µ"}),(0,p.jsx)("h2",{children:"ðŸ“¦ ç¦»çº¿é¢˜ç›®"}),e&&"all"!==e&&(0,p.jsxs)("p",{children:["åˆ†ç±»: ",e]}),(0,p.jsxs)("div",{className:"offline-stats",children:["å…± ",r.length," é“é¢˜ç›® â€¢ ç¦»çº¿æ¨¡å¼"]})]}),(0,p.jsxs)("div",{className:"offline-actions",children:[(0,p.jsxs)("div",{className:"view-options",children:[(0,p.jsx)("span",{children:"æŽ’åºæ–¹å¼:"}),(0,p.jsxs)("select",{className:"sort-select",children:[(0,p.jsx)("option",{value:"default",children:"é»˜è®¤é¡ºåº"}),(0,p.jsx)("option",{value:"difficulty",children:"æŒ‰éš¾åº¦"}),(0,p.jsx)("option",{value:"title",children:"æŒ‰æ ‡é¢˜"})]})]}),(0,p.jsxs)("div",{className:"cache-info",children:["ç¼“å­˜æ—¶é—´: ",(new Date).toLocaleString()]})]}),(0,p.jsx)("div",{className:"offline-questions-list",children:r.map((e,s)=>(0,p.jsxs)("div",{className:"offline-question-card",onClick:()=>(e=>{u("detail"),t(`/offline/questions/${e.id}`)})(e),children:[(0,p.jsxs)("div",{className:"question-card-header",children:[(0,p.jsx)("h4",{className:"question-title",children:e.title}),(0,p.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:qs(e.difficulty)},children:Ls(e.difficulty)})]}),(0,p.jsxs)("div",{className:"question-card-body",children:[(0,p.jsx)("p",{className:"question-preview",children:Ds(e)}),(0,p.jsxs)("div",{className:"question-meta",children:[(0,p.jsx)("span",{className:"category-tag",children:e.category?.name||"æœªåˆ†ç±»"}),(0,p.jsx)("span",{className:"offline-tag",children:"ç¦»çº¿"})]})]}),(0,p.jsxs)("div",{className:"question-card-footer",children:[(0,p.jsxs)("span",{className:"question-date",children:["åˆ›å»º: ",new Date(e.createdAt).toLocaleDateString()]}),(0,p.jsx)("button",{className:"view-detail-btn",children:"æŸ¥çœ‹è¯¦æƒ… â†’"})]})]},e.id||s))})]})};console.log("Dialogflow Config:",{projectId:"learningassistant-vjfs",clientEmail:"dialogflow-client@learningassistant-vjfs.iam.gserviceaccount.com",hasPrivateKey:!0});const $s=new c.E({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1,staleTime:3e5,gcTime:6e5}}}),Ps=function(){const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)("login"),[c,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)("profile");return(0,a.useEffect)(()=>{const e=e=>{const t=e.detail?.tab||"login";n(t),s(!0)},t=e=>{const s=e.detail?.tab||"profile";d(s),l(!0)};return window.addEventListener("showAuthModal",e),window.addEventListener("showUserSettings",t),()=>{window.removeEventListener("showAuthModal",e),window.removeEventListener("showUserSettings",t)}},[]),(0,p.jsx)(r.Ht,{client:$s,children:(0,p.jsxs)(i.Kd,{children:[(0,p.jsx)(ws,{onShowAuthModal:(e="login")=>{n(e),s(!0)}}),(0,p.jsxs)(i.BV,{children:[(0,p.jsx)(i.qh,{path:"/",element:(0,p.jsx)(ke,{})}),(0,p.jsx)(i.qh,{path:"/init",element:(0,p.jsx)(ls,{})}),(0,p.jsx)(i.qh,{path:"/category/:categoryId",element:(0,p.jsx)(gs,{})}),(0,p.jsx)(i.qh,{path:"/test",element:(0,p.jsx)(fs,{})}),(0,p.jsx)(i.qh,{path:"/review",element:(0,p.jsx)(ks,{})}),(0,p.jsx)(i.qh,{path:"/offline/questions",element:(0,p.jsx)(Ts,{})}),(0,p.jsx)(i.qh,{path:"/offline/questions/:questionId",element:(0,p.jsx)(Ts,{})}),(0,p.jsx)(i.qh,{path:"/offline/category/:categoryName",element:(0,p.jsx)(Ts,{})}),(0,p.jsx)(i.qh,{path:"/offline/category/:categoryName/question/:questionId",element:(0,p.jsx)(Ts,{})})]}),(0,p.jsx)(bs,{isOpen:e,onClose:()=>s(!1),defaultTab:t,onAuthSuccess:()=>{window.location.reload()}}),(0,p.jsx)(Cs,{isOpen:c,onClose:()=>l(!1)}),(0,p.jsx)(As,{})]})})};n.createRoot(document.getElementById("root")).render((0,p.jsx)(a.StrictMode,{children:(0,p.jsx)(Ps,{})})),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=await fetch("/sw.js");if(!e.ok)throw new Error(`sw.js not found: ${e.status}`);const s=e.headers.get("content-type");if(!s||!s.includes("javascript"))throw new Error(`Invalid MIME type: ${s}`);const t=await navigator.serviceWorker.register("/sw.js");console.log("SW registered successfully: ",t)}catch(e){console.log("SW registration failed: ",e),console.log("Error details:",e.message)}})}},e=>{e.O(0,[96],()=>e(e.s=1674)),e.O()}]);
//# sourceMappingURL=main.427aa420.js.map