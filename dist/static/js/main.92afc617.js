"use strict";(self.webpackChunkbagu=self.webpackChunkbagu||[]).push([[792],{8588:(e,s,t)=>{t(9848);var a=t(6540),n=t(5338),i=t(6868),c=t(7865),r=t(7665);const l=new class{constructor(){this.baseUrl="http://localhost:3001",this.sessions=new Map}async checkServerStatus(){try{console.log("ðŸ” æ£€æŸ¥ä»£ç†æœåŠ¡å™¨çŠ¶æ€...");const e=await fetch(`${this.baseUrl}/api/health`),s=await e.json();return console.log("ðŸ“Š æœåŠ¡å™¨çŠ¶æ€:",s),e.ok}catch(e){return console.error("âŒ ä»£ç†æœåŠ¡å™¨æœªå“åº”:",e.message),!1}}async sendWelcome(e){if(console.log("ðŸ”„ å¼€å§‹å‘é€æ¬¢è¿Žæ¶ˆæ¯..."),console.log("ç”¨æˆ·ID:",e),console.log("ç›®æ ‡URL:",`${this.baseUrl}/api/dialogflow/welcome`),!await this.checkServerStatus())return console.error("âŒ ä»£ç†æœåŠ¡å™¨æœªè¿è¡Œ"),this.getFallbackWelcome();try{console.log("ðŸ“¤ å‘é€æ¬¢è¿Žæ¶ˆæ¯è¯·æ±‚...");const s={userId:e};console.log("è¯·æ±‚ä½“:",s);const t=await fetch(`${this.baseUrl}/api/dialogflow/welcome`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("ðŸ“¥ æ”¶åˆ°å“åº”çŠ¶æ€:",t.status,t.statusText),!t.ok){const e=await t.text();throw console.error("âŒ HTTP é”™è¯¯:",t.status,e),new Error(`HTTP error! status: ${t.status}`)}const a=await t.json();return console.log("âœ… æ¬¢è¿Žæ¶ˆæ¯å“åº”æ•°æ®:",a),a.success?(console.log("ðŸŽ‰ æ¬¢è¿Žæ¶ˆæ¯æˆåŠŸ"),{text:a.text,intent:a.intent,success:!0}):(console.warn("âš ï¸ æ¬¢è¿Žæ¶ˆæ¯è¿”å›žå¤±è´¥:",a.error),this.getFallbackWelcome())}catch(e){return console.error("ðŸ’¥ æ¬¢è¿Žæ¶ˆæ¯è¯·æ±‚å¤±è´¥:",e.message),console.error("é”™è¯¯å †æ ˆ:",e.stack),this.getFallbackWelcome()}}async detectIntent(e,s){if(console.log("ðŸ”„ å¼€å§‹æ£€æµ‹æ„å›¾..."),console.log("æ¶ˆæ¯:",e),console.log("ç”¨æˆ·ID:",s),!await this.checkServerStatus())return console.error("âŒ ä»£ç†æœåŠ¡å™¨æœªè¿è¡Œ"),this.getFallbackResponse(e);try{console.log("ðŸ“¤ å‘é€èŠå¤©æ¶ˆæ¯è¯·æ±‚...");const t={message:e,userId:s};console.log("è¯·æ±‚ä½“:",t);const a=await fetch(`${this.baseUrl}/api/dialogflow/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("ðŸ“¥ æ”¶åˆ°å“åº”çŠ¶æ€:",a.status,a.statusText),!a.ok){const e=await a.text();throw console.error("âŒ HTTP é”™è¯¯:",a.status,e),new Error(`HTTP error! status: ${a.status}`)}const n=await a.json();return console.log("âœ… èŠå¤©æ¶ˆæ¯å“åº”æ•°æ®:",n),n.success?(console.log("ðŸŽ‰ èŠå¤©æ¶ˆæ¯æˆåŠŸ"),{text:n.text,intent:n.intent,confidence:n.confidence,parameters:n.parameters,success:!0}):(console.warn("âš ï¸ èŠå¤©æ¶ˆæ¯è¿”å›žå¤±è´¥:",n.error),this.getFallbackResponse(e))}catch(s){return console.error("ðŸ’¥ èŠå¤©æ¶ˆæ¯è¯·æ±‚å¤±è´¥:",s.message),this.getFallbackResponse(e)}}getFallbackWelcome(){return console.log("ðŸ”„ ä½¿ç”¨å›žé€€æ¬¢è¿Žæ¶ˆæ¯"),{text:"ðŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„å­¦ä¹ åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š\n\nðŸ“š ç®¡ç†å­¦ä¹ åˆ†ç±»å’Œé¢˜ç›®\nðŸ” æœç´¢ç‰¹å®šå†…å®¹\nðŸ”„ å®‰æŽ’å¤ä¹ è®¡åˆ’\nðŸ“Š æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡\n\nè¯·é—®éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",intent:"welcome_fallback",success:!0}}getFallbackResponse(e){console.log("ðŸ”„ ä½¿ç”¨å›žé€€å“åº”");const s=e.toLowerCase();return s.includes("åˆ†ç±»")||s.includes("ç±»åˆ«")?{text:"ðŸ“š æ­£åœ¨åŠ è½½å­¦ä¹ åˆ†ç±»...",intent:"categories_fallback",success:!0}:s.includes("æœç´¢")||s.includes("æŸ¥æ‰¾")||s.includes("æ‰¾é¢˜")?{text:"ðŸ” è¯·å‘Šè¯‰æˆ‘ä½ æƒ³æœç´¢ä»€ä¹ˆé¢˜ç›®ï¼Ÿ",intent:"search_fallback",success:!0}:s.includes("å¤ä¹ ")?{text:"ðŸ”„ å¼€å§‹å¤ä¹ ï¼æˆ‘ä¼šå®‰æŽ’åˆé€‚çš„å­¦ä¹ è®¡åˆ’ã€‚",intent:"review_fallback",success:!0}:s.includes("ç»Ÿè®¡")||s.includes("æ•°æ®")?{text:"ðŸ“Š æ­£åœ¨ç”Ÿæˆå­¦ä¹ ç»Ÿè®¡æŠ¥å‘Š...",intent:"stats_fallback",success:!0}:s.includes("ä½ å¥½")||s.includes("hello")||s.includes("hi")?{text:"ðŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯å­¦ä¹ åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ç®¡ç†åˆ†ç±»ã€æœç´¢é¢˜ç›®ã€å®‰æŽ’å¤ä¹ ã€‚",intent:"greeting_fallback",success:!0}:{text:"ðŸ¤” æˆ‘ä¸å¤ªæ˜Žç™½ã€‚ä½ å¯ä»¥é—®æˆ‘å…³äºŽåˆ†ç±»ã€é¢˜ç›®ã€å¤ä¹ æˆ–ç»Ÿè®¡çš„é—®é¢˜ã€‚",intent:"general_fallback",success:!0}}};var o=t(4848);const d=({onNavigate:e,categories:s,questions:t,currentUser:n})=>{const[i,c]=(0,a.useState)(!1),[r,d]=(0,a.useState)([]),[h,u]=(0,a.useState)(""),[m,g]=(0,a.useState)(!1),x=(0,a.useRef)(null);(0,a.useEffect)(()=>{i&&0===r.length&&j()},[i]);const j=async()=>{g(!0);try{const e=await l.sendWelcome(n?.id),s={id:Date.now(),text:e.text,isBot:!0,timestamp:new Date,quickReplies:["æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»","éœ€è¦å¤ä¹ çš„é¢˜ç›®","å­¦ä¹ ç»Ÿè®¡","åˆ›å»ºæ–°åˆ†ç±»"]};d([s])}catch(e){console.error("Welcome message error:",e);const s={id:1,text:`ðŸ‘‹ ä½ å¥½${n?` ${n.getUsername()}`:""}ï¼æˆ‘æ˜¯ä½ çš„å­¦ä¹ åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š\n\nâ€¢ å¯¼èˆªåˆ°ä¸åŒåŠŸèƒ½é¡µé¢\nâ€¢ æŸ¥æ‰¾åˆ†ç±»å’Œé¢˜ç›®\nâ€¢ ç®¡ç†å¤ä¹ è®¡åˆ’\nâ€¢ æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡\n\nè¯·é—®éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ`,isBot:!0,timestamp:new Date,quickReplies:["æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»","éœ€è¦å¤ä¹ çš„é¢˜ç›®","å­¦ä¹ ç»Ÿè®¡","åˆ›å»ºæ–°åˆ†ç±»"]};d([s])}finally{g(!1)}};(0,a.useEffect)(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[r]);const p=async()=>{if(!h.trim())return;const e={id:Date.now(),text:h,isBot:!1,timestamp:new Date};d(s=>[...s,e]),u("");const s=await(async e=>{g(!0);try{const s=await l.detectIntent(e,n?.id);return g(!1),{text:s.text,quickReplies:["æŸ¥çœ‹åˆ†ç±»","æœç´¢é¢˜ç›®","å¼€å§‹å¤ä¹ ","å­¦ä¹ ç»Ÿè®¡"],actions:[]}}catch(e){return console.error("Message processing error:",e),g(!1),{text:"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•ã€‚",quickReplies:["æŸ¥çœ‹åˆ†ç±»","æœç´¢é¢˜ç›®","å¼€å§‹å¤ä¹ ","å­¦ä¹ ç»Ÿè®¡"]}}})(h),t={id:Date.now()+1,text:s.text,isBot:!0,timestamp:new Date,actions:s.actions,quickReplies:s.quickReplies};d(e=>[...e,t])};return(0,o.jsxs)(o.Fragment,{children:[!i&&(0,o.jsxs)("button",{className:"chatbox-floating-btn",onClick:()=>c(!0),title:"AIå­¦ä¹ åŠ©æ‰‹",children:[(0,o.jsx)("span",{className:"chatbot-icon",children:"ðŸ¤–"}),(0,o.jsx)("span",{className:"pulse-dot"})]}),i&&(0,o.jsxs)("div",{className:"chatbox-container",children:[(0,o.jsxs)("div",{className:"chatbox-header",children:[(0,o.jsxs)("div",{className:"chatbox-title",children:[(0,o.jsx)("span",{className:"bot-avatar",children:"ðŸ¤–"}),(0,o.jsxs)("div",{className:"title-text",children:[(0,o.jsx)("h4",{children:"AIå­¦ä¹ åŠ©æ‰‹"}),(0,o.jsx)("span",{className:"status",children:"AIåœ¨çº¿"})]})]}),(0,o.jsxs)("div",{className:"header-actions",children:[(0,o.jsx)("button",{className:"clear-btn",onClick:()=>{d([]),j()},title:"æ¸…é™¤å¯¹è¯",children:"ðŸ—‘ï¸"}),(0,o.jsx)("button",{className:"close-btn",onClick:()=>c(!1),children:"Ã—"})]})]}),(0,o.jsxs)("div",{className:"chatbox-messages",children:[r.map(s=>(0,o.jsx)("div",{className:"message "+(s.isBot?"bot-message":"user-message"),children:(0,o.jsxs)("div",{className:"message-content",children:[(0,o.jsx)("div",{className:"message-text",children:s.text.split("\n").map((e,s)=>(0,o.jsxs)("span",{children:[e,(0,o.jsx)("br",{})]},s))}),(0,o.jsx)("div",{className:"message-time",children:s.timestamp.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),s.quickReplies&&(0,o.jsx)("div",{className:"quick-replies",children:s.quickReplies.map((e,s)=>(0,o.jsx)("button",{className:"quick-reply-btn",onClick:()=>(u(e),void setTimeout(()=>{p()},100)),children:e},s))}),s.actions&&(0,o.jsx)("div",{className:"action-buttons",children:s.actions.map((s,t)=>(0,o.jsx)("button",{className:"action-btn",onClick:()=>(s=>{if("navigate"===s.type&&e){e(s.target);const t={id:Date.now(),text:`âœ… æ­£åœ¨ä¸ºä½ è·³è½¬åˆ° ${s.label}...`,isBot:!0,timestamp:new Date};d(e=>[...e,t])}else"function"===s.type&&(e=>{if("searchQuestions"===e.target){const e={id:Date.now(),text:"è¯·å‘Šè¯‰æˆ‘ä½ æƒ³æœç´¢é¢˜ç›®çš„å…³é”®è¯ï¼š",isBot:!0,timestamp:new Date};d(s=>[...s,e])}else console.log("Function action:",e)})(s)})(s),children:s.label},t))})]})},s.id)),m&&(0,o.jsx)("div",{className:"message bot-message",children:(0,o.jsx)("div",{className:"message-content",children:(0,o.jsxs)("div",{className:"typing-indicator",children:[(0,o.jsx)("span",{children:"AIæ­£åœ¨æ€è€ƒ"}),(0,o.jsxs)("div",{className:"typing-dots",children:[(0,o.jsx)("span",{}),(0,o.jsx)("span",{}),(0,o.jsx)("span",{})]})]})})}),(0,o.jsx)("div",{ref:x})]}),(0,o.jsxs)("div",{className:"chatbox-input",children:[(0,o.jsxs)("div",{className:"input-container",children:[(0,o.jsx)("textarea",{value:h,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:"å‘AIåŠ©æ‰‹æé—®...",rows:"1",className:"message-input"}),(0,o.jsx)("button",{onClick:p,disabled:!h.trim()||m,className:"send-btn",children:m?"â³":"ðŸ“¤"})]}),(0,o.jsx)("div",{className:"input-hint",children:"æŒ‰ Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ"})]})]})]})};var h=t(6068),u=t.n(h);const m=()=>{u().init({appId:"JjTQ2R5rn16RRhUdrcjUSBxW-gzGzoHsz",appKey:"UkvR0e4OPaeW5rYMQwNTvD7Z",serverURL:"https://jjtq2r5r.lc-cn-n1-shared.com"})},g={SORT_BY_NAME:"name",SORT_BY_QUESTION_COUNT:"questionCount",SORT_BY_UPDATED_AT:"updatedAt"},x={categories:{data:null,timestamp:0,ttl:3e5},categoryDetails:new Map,categoryDetailTtl:18e4,questionCounts:new Map,questionCountTtl:12e4},j=(e,s)=>e&&Date.now()-e<s,p=async e=>{try{const s=e.map(e=>e.id),t={},a=Date.now();s.forEach(e=>{t[e]=0});const n=[];if(s.forEach(e=>{const s=x.questionCounts.get(e);s&&j(s.timestamp,x.questionCountTtl)?t[e]=s.count:n.push(e)}),n.length>0)try{const e=n.map(async e=>{try{const s=u().Object.createWithoutData("Category",e),t=new(u().Query)("Question");return t.equalTo("category",s),{categoryId:e,count:await t.count()}}catch(s){return console.warn(`èŽ·å–åˆ†ç±» ${e} é¢˜ç›®æ•°é‡å¤±è´¥:`,s),{categoryId:e,count:0}}}),s=await Promise.all(e);s.forEach(({categoryId:e,count:s})=>{t[e]=s}),s.forEach(({categoryId:e,count:s})=>{x.questionCounts.set(e,{count:s,timestamp:a})})}catch(e){console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®æ•°é‡å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ:",e);try{const e=n.map(e=>u().Object.createWithoutData("Category",e)),s=new(u().Query)("Question");s.containedIn("category",e),s.select(["category"]),(await s.find()).forEach(e=>{const s=e.get("category");if(s){const e=s.id;t[e]=(t[e]||0)+1}}),n.forEach(e=>{const s=t[e]||0;x.questionCounts.set(e,{count:s,timestamp:a})})}catch(e){console.warn("å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥:",e)}}return t}catch(e){return console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®æ•°é‡å¤±è´¥:",e),{}}},v=async()=>{try{const e=u().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=Date.now();if(x.categories.data&&j(x.categories.timestamp,x.categories.ttl))return x.categories.data;const t=new(u().Query)("Category");t.equalTo("createdBy",e),t.include("createdBy"),t.descending("updatedAt");const a=await t.find(),n=await p(a),i=a.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:void 0!==n[e.id]?n[e.id]:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),createdBy:e.get("createdBy")}));return x.categories.data=i,x.categories.timestamp=s,i}catch(e){throw console.error("èŽ·å–æ‰€æœ‰åˆ†ç±»å¤±è´¥:",e),e}},N=async(e={})=>{try{const s=u().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=!(e.page||e.pageSize||e.sortBy&&e.sortBy!==g.SORT_BY_UPDATED_AT),a=Date.now();if(t&&x.categories.data&&j(x.categories.timestamp,x.categories.ttl))return{data:x.categories.data,total:x.categories.data.length,page:1,pageSize:x.categories.data.length};const n=new(u().Query)("Category");if(n.equalTo("createdBy",s),e.sortBy===g.SORT_BY_UPDATED_AT?n.descending("updatedAt"):e.sortBy===g.SORT_BY_CREATED_AT?n.descending("createdAt"):n.descending("updatedAt"),e.page&&e.pageSize){const s=(e.page-1)*e.pageSize;n.limit(e.pageSize),n.skip(s)}const i=await n.find(),c=await p(i),r=i.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:void 0!==c[e.id]?c[e.id]:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),createdBy:e.get("createdBy")})),l={data:r,total:r.length,page:e.page||1,pageSize:e.pageSize||r.length};return t&&(x.categories.data=r,x.categories.timestamp=a),l}catch(e){throw console.error("èŽ·å–åˆ†ç±»å¤±è´¥:",e),e}},y=async e=>{try{const s=u().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(u().Object.extend("Category"));t.set("name",e.name),t.set("description",e.description||""),t.set("createdBy",s);const a=new(u().ACL);return a.setReadAccess(s,!0),a.setWriteAccess(s,!0),a.setPublicReadAccess(!1),t.setACL(a),await t.save(),x.categories.data=null,x.categories.timestamp=0,x.categoryDetails.clear(),x.questionCounts.clear(),{id:t.id,name:t.get("name"),description:t.get("description"),questionCount:0,createdAt:t.get("createdAt"),updatedAt:t.get("updatedAt")}}catch(e){throw console.error("åˆ›å»ºåˆ†ç±»å¤±è´¥:",e),e}},w=new class{constructor(){this.pendingRequests=new Map,this.cache=new Map,this.cacheTimeout=3e5}debounce(e,s,t=300){return new Promise((a,n)=>{this.pendingRequests.has(e)&&clearTimeout(this.pendingRequests.get(e));const i=setTimeout(async()=>{this.pendingRequests.delete(e);try{const e=await s();a(e)}catch(e){n(e)}},t);this.pendingRequests.set(e,i)})}async cachedRequest(e,s,t=!0){if(t){const s=this.cache.get(e);if(s&&Date.now()-s.timestamp<this.cacheTimeout)return s.data}const a=await s();return t&&this.cache.set(e,{data:a,timestamp:Date.now()}),a}clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}},b="medium",f="beginner",C=e=>e&&e.objectId?e.objectId:"string"==typeof e?e:e&&e.id?e.id:null,k=e=>e?u().Object.createWithoutData("Category",e):null;let S=[],A=null;const q=(e,s)=>{const t=C(e);t&&(S.push({categoryId:t,change:s}),A&&clearTimeout(A),A=setTimeout(()=>{const e=[...S];S=[],A=null,(async e=>{if(0!==e.length)try{const s={};e.forEach(({categoryId:e,change:t})=>{e&&!s[e]&&(s[e]=0),e&&(s[e]+=t)});const t=Object.entries(s).map(async([e,s])=>{try{const t=new(u().Query)("Category"),a=await t.get(e),n=a.get("questionCount")||0,i=Math.max(0,n+s);a.set("questionCount",i),await a.save(),console.log(`åˆ†ç±» ${a.get("name")} é¢˜ç›®æ•°é‡æ‰¹é‡æ›´æ–°: ${n} -> ${i}`)}catch(s){console.error(`æ›´æ–°åˆ†ç±» ${e} é¢˜ç›®æ•°é‡å¤±è´¥:`,s)}});await Promise.all(t)}catch(e){console.error("æ‰¹é‡æ›´æ–°åˆ†ç±»é¢˜ç›®æ•°é‡å¤±è´¥:",e)}})(e)},2e3))},D=e=>{const s=e.get("category");return{id:e.id,objectId:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),url:e.get("url"),tags:e.get("tags")||[],difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel")||50,category:s?{id:s.id,objectId:s.id,name:s.get("name"),description:s.get("description"),questionCount:s.get("questionCount")||0}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),lastReviewedAt:e.get("lastReviewedAt")}},E=async e=>{try{const s=u().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(u().Object.extend("Question"));if(t.set("title",e.title||""),t.set("detailedAnswer",e.detailedAnswer||""),t.set("oralAnswer",e.oralAnswer||""),t.set("code",e.code||""),t.set("url",e.url||""),t.set("tags",e.tags||[]),t.set("difficulty",e.difficulty||b),t.set("proficiency",e.proficiency||f),t.set("appearanceLevel",e.appearanceLevel||50),t.set("createdBy",s),e.categoryId){const s=k(e.categoryId);t.set("category",s)}const a=new(u().ACL);return a.setReadAccess(s,!0),a.setWriteAccess(s,!0),a.setPublicReadAccess(!1),t.setACL(a),await t.save(),e.categoryId&&await L(e.categoryId,1),e.categoryId&&w.clearCache(`questions-${e.categoryId}`),w.clearCache("all-questions"),D(t)}catch(e){throw console.error("åˆ›å»ºé¢˜ç›®å¤±è´¥:",e),e}},P=async e=>{try{const s=u().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(u().Query)("Question");t.equalTo("objectId",e),t.equalTo("createdBy",s),t.include("category");const a=await t.first();if(!a)throw new Error("é¢˜ç›®ä¸å­˜åœ¨æˆ–æ— æƒåˆ é™¤");const n=a.get("category");return await a.destroy(),n&&await L(n,-1),w.clearCache(`question-${e}`),w.clearCache("all-questions"),!0}catch(e){throw console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e),e}},T=async(e=!1)=>{if(!e){w.clearCache("all-questions"),await new Promise(e=>setTimeout(e,1e3));try{const e=u().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=[];let t=0;const a=100;let n=!0;for(;n;){const i=new(u().Query)("Question");i.equalTo("createdBy",e),i.include("category"),i.descending("updatedAt"),i.limit(a),i.skip(t);const c=await i.find();s.push(...c),n=c.length===a,t+=a,console.log(`ðŸ“¦ æ‰¹é‡èŽ·å–é¢˜ç›®: ç¬¬ ${t/a} æ‰¹, èŽ·å– ${c.length} æ¡`)}const i=s.map(e=>D(e));return console.log("ðŸ“Š getAllQuestions å®žæ—¶æŸ¥è¯¢ç»“æžœ:",{é¢˜ç›®æ€»æ•°:i.length,æ‰¹æ¬¡:t/a+" æ‰¹",æœ€æ–°é¢˜ç›®:i.slice(0,3).map(e=>({id:e.id,title:e.title}))}),i}catch(e){throw console.error("èŽ·å–æ‰€æœ‰é¢˜ç›®å¤±è´¥:",e),e}}return w.cachedRequest("all-questions",async()=>{const e=[];let s=0,t=!0;for(;t;){const a=new(u().Query)("Question");a.equalTo("createdBy",currentUser),a.include("category"),a.descending("updatedAt"),a.limit(100),a.skip(s);const n=await a.find();e.push(...n),t=100===n.length,s+=100}return e.map(e=>D(e))})},$=async(e,s)=>{try{console.log("questionService: æ›´æ–°é¢˜ç›®",e,s);const t=u().Object.createWithoutData("Question",e);let a=null;s.categoryId&&(a=(await new(u().Query)("Question").include("category").get(e)).get("category")),Object.keys(s).forEach(e=>{if(void 0!==s[e])if("categoryId"===e){const a=k(s[e]);t.set("category",a)}else t.set(e,s[e])});const n=await t.save();if(console.log("questionService: æ›´æ–°æˆåŠŸ",n),s.categoryId&&a){const e=s.categoryId,t=C(a);t!==e&&(t&&q(t,-1),e&&q(e,1))}w.clearCache(`question-${e}`),w.clearCache("all-questions");const i=await new(u().Query)("Question").include("category").get(e);return D(i)}catch(e){throw console.error("questionService: æ›´æ–°é¢˜ç›®å¤±è´¥:",e),e}},L=async(e,s)=>{if(!e)return;const t=C(e);if(t)try{const e=new(u().Query)("Category"),a=await e.get(t),n=a.get("questionCount")||0,i=Math.max(0,n+s);a.set("questionCount",i),await a.save(),console.log(`åˆ†ç±» ${a.get("name")} é¢˜ç›®æ•°é‡ç«‹å³æ›´æ–°: ${n} -> ${i}`),cacheConfig.categories.data=null,cacheConfig.categories.timestamp=0,cacheConfig.questionCounts.delete(t)}catch(e){console.error(`ç«‹å³æ›´æ–°åˆ†ç±» ${t} é¢˜ç›®æ•°é‡å¤±è´¥:`,e)}};var I=t(4653),Q=t(630),R=t(3161),U=t(2050),O=t(8687),M=t(7018),F=t(8224),_=t(9107),B=t(7984),W=t(3495),z=t(1222);const V=({reviewQuestions:e,setReviewQuestions:s,reviewThreshold:t,setReviewThreshold:n,showReviewSettings:i,setShowReviewSettings:c,onQuestionClick:r,onUpdateQuestionTime:l,questions:d})=>{const[h,m]=(0,a.useState)("all"),[g,x]=(0,a.useState)(""),[j,p]=(0,a.useState)(new Set),[v,N]=(0,a.useState)(u().User.current()),y=e=>{const s=new Date-new Date(e),t=Math.floor(s/864e5),a=Math.floor(t/7),n=Math.floor(t/30);return 0===t?"ä»Šå¤©":1===t?"æ˜¨å¤©":t<7?`${t}å¤©å‰`:a<4?`${a}å‘¨å‰`:`${n}æœˆå‰`},w=e=>{const s=new Date(e.lastReviewedAt||e.createdAt),t=Math.floor((new Date-s)/864e5);return t>=5?"high":t>=3?"medium":"low"},b=e=>{switch(e){case"high":return"æ€¥éœ€å¤ä¹ ";case"medium":return"å»ºè®®å¤ä¹ ";case"low":return"å¯ç¨åŽå¤ä¹ ";default:return"æœªçŸ¥"}},f=e=>{switch(e){case"high":return"5å¤©ä»¥ä¸Šæœªå¤ä¹ ";case"medium":return"3-4å¤©æœªå¤ä¹ ";case"low":return"1-2å¤©æœªå¤ä¹ ";default:return""}},C=e=>{if(!e.category?.id)return console.warn("é¢˜ç›®æ²¡æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œæ— æ³•è·³è½¬"),void alert("è¯¥é¢˜ç›®æ²¡æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œæ— æ³•è·³è½¬");const s=`/category/${e.category.id}`;window.history.pushState?(window.history.pushState(null,"",s),window.dispatchEvent(new PopStateEvent("popstate"))):window.location.href=s,setTimeout(()=>{window.dispatchEvent(new CustomEvent("scrollToQuestion",{detail:{questionId:e.id}}))},100)},k=e.filter(e=>{const s=e.title.toLowerCase().includes(g.toLowerCase())||(e.category?.name||"").toLowerCase().includes(g.toLowerCase());if("all"===h)return s;const t=w(e);return s&&t===h}),S={high:k.filter(e=>"high"===w(e)),medium:k.filter(e=>"medium"===w(e)),low:k.filter(e=>"low"===w(e))},A=()=>{const s=d.length,t=s-e.length;return s>0?t/s*100:0};return v?(0,o.jsx)("section",{className:"review-reminder-section",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsxs)("div",{className:"user-welcome-banner",children:[(0,o.jsxs)("h3",{children:["ðŸ“š å¤ä¹ æé†’ - ",v.getUsername()]}),(0,o.jsx)("p",{children:"åŠæ—¶å¤ä¹ æ˜¯å·©å›ºçŸ¥è¯†çš„å…³é”®ï¼Œä»¥ä¸‹æ˜¯éœ€è¦æ‚¨å…³æ³¨çš„é¢˜ç›®"})]}),(0,o.jsxs)("div",{className:"review-header",children:[(0,o.jsxs)("div",{className:"review-stats",children:[(0,o.jsxs)("div",{className:"stat-card urgent",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ”¥"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:S.high.length}),(0,o.jsx)("div",{className:"stat-label",children:"æ€¥éœ€å¤ä¹ "}),(0,o.jsx)("div",{className:"stat-description",children:"5å¤©ä»¥ä¸Š"})]})]}),(0,o.jsxs)("div",{className:"stat-card medium",children:[(0,o.jsx)("div",{className:"stat-icon",children:"âš ï¸"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:S.medium.length}),(0,o.jsx)("div",{className:"stat-label",children:"å»ºè®®å¤ä¹ "}),(0,o.jsx)("div",{className:"stat-description",children:"3-4å¤©"})]})]}),(0,o.jsxs)("div",{className:"stat-card low",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ’¡"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:S.low.length}),(0,o.jsx)("div",{className:"stat-label",children:"å¯ç¨åŽå¤ä¹ "}),(0,o.jsx)("div",{className:"stat-description",children:"1-2å¤©"})]})]}),(0,o.jsxs)("div",{className:"stat-card total",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:e.length}),(0,o.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ é¢˜ç›®"}),(0,o.jsx)("div",{className:"stat-description",children:"æ€»è®¡"})]})]})]}),(0,o.jsxs)("div",{className:"review-progress",children:[(0,o.jsxs)("div",{className:"progress-header",children:[(0,o.jsx)("span",{children:"å¤ä¹ è¿›åº¦"}),(0,o.jsxs)("span",{children:[Math.round(A()),"%"]})]}),(0,o.jsx)("div",{className:"progress-bar",children:(0,o.jsx)("div",{className:"progress-fill",style:{width:`${A()}%`}})}),(0,o.jsx)("div",{className:"progress-stats",children:(0,o.jsxs)("span",{children:[d.length-e.length," / ",d.length," é¢˜ç›®å·²åŠæ—¶å¤ä¹ "]})})]})]}),(0,o.jsxs)("div",{className:"review-controls",children:[(0,o.jsxs)("div",{className:"controls-left",children:[(0,o.jsxs)("div",{className:"search-box",children:[(0,o.jsx)("span",{className:"search-icon",children:"ðŸ”"}),(0,o.jsx)("input",{type:"text",placeholder:"æœç´¢é¢˜ç›®æˆ–åˆ†ç±»...",value:g,onChange:e=>x(e.target.value),className:"search-input"})]}),(0,o.jsxs)("div",{className:"urgency-filter",children:[(0,o.jsx)("button",{className:"urgency-btn "+("all"===h?"active":""),onClick:()=>m("all"),children:"å…¨éƒ¨"}),(0,o.jsx)("button",{className:"urgency-btn high "+("high"===h?"active":""),onClick:()=>m("high"),children:"ðŸ”¥ æ€¥éœ€ (5å¤©+)"}),(0,o.jsx)("button",{className:"urgency-btn medium "+("medium"===h?"active":""),onClick:()=>m("medium"),children:"âš ï¸ å»ºè®® (3-4å¤©)"}),(0,o.jsx)("button",{className:"urgency-btn low "+("low"===h?"active":""),onClick:()=>m("low"),children:"ðŸ’¡ ç¨åŽ (1-2å¤©)"})]})]}),(0,o.jsx)("div",{className:"controls-right",children:(0,o.jsx)("button",{className:"settings-btn",onClick:()=>c(!0),children:"âš™ï¸ å¤ä¹ è®¾ç½®"})})]}),i&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"å¤ä¹ æé†’è®¾ç½®"}),(0,o.jsx)("button",{className:"close-btn",onClick:()=>c(!1),children:"Ã—"})]}),(0,o.jsxs)("div",{className:"settings-content",children:[(0,o.jsxs)("div",{className:"setting-item",children:[(0,o.jsxs)("label",{htmlFor:"reviewThreshold",children:["å¤ä¹ æé†’é˜ˆå€¼",(0,o.jsx)("span",{className:"hint",children:"ï¼ˆè¶…è¿‡è¿™ä¸ªå¤©æ•°çš„é¢˜ç›®ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­ï¼‰"})]}),(0,o.jsxs)("div",{className:"threshold-control",children:[(0,o.jsx)("input",{id:"reviewThreshold",type:"range",min:"1",max:"30",step:"1",value:t,onChange:e=>n(parseInt(e.target.value)),className:"threshold-slider"}),(0,o.jsxs)("span",{className:"threshold-value",children:[t," å¤©"]})]}),(0,o.jsx)("div",{className:"threshold-presets",children:[1,3,5,7,14,30].map(e=>(0,o.jsxs)("button",{className:"preset-btn "+(t===e?"active":""),onClick:()=>n(e),children:[e,"å¤©"]},e))})]}),(0,o.jsxs)("div",{className:"urgency-explanation",children:[(0,o.jsx)("h4",{children:"ðŸ“‹ ç´§æ€¥ç¨‹åº¦è¯´æ˜Ž"}),(0,o.jsxs)("div",{className:"urgency-levels",children:[(0,o.jsxs)("div",{className:"urgency-level high",children:[(0,o.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#ff6b6b"}}),(0,o.jsxs)("div",{className:"urgency-info",children:[(0,o.jsx)("strong",{children:"æ€¥éœ€å¤ä¹  (çº¢è‰²)"}),(0,o.jsx)("span",{children:"5å¤©ä»¥ä¸Šæœªå¤ä¹ çš„é¢˜ç›®"})]})]}),(0,o.jsxs)("div",{className:"urgency-level medium",children:[(0,o.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#ffa726"}}),(0,o.jsxs)("div",{className:"urgency-info",children:[(0,o.jsx)("strong",{children:"å»ºè®®å¤ä¹  (æ©™è‰²)"}),(0,o.jsx)("span",{children:"3-4å¤©æœªå¤ä¹ çš„é¢˜ç›®"})]})]}),(0,o.jsxs)("div",{className:"urgency-level low",children:[(0,o.jsx)("span",{className:"urgency-color",style:{backgroundColor:"#4ecdc4"}}),(0,o.jsxs)("div",{className:"urgency-info",children:[(0,o.jsx)("strong",{children:"å¯ç¨åŽå¤ä¹  (é’è‰²)"}),(0,o.jsx)("span",{children:"1-2å¤©æœªå¤ä¹ çš„é¢˜ç›®"})]})]})]})]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"cancel-btn",onClick:()=>c(!1),children:"å–æ¶ˆ"}),(0,o.jsx)("button",{className:"confirm-btn",onClick:()=>c(!1),children:"ç¡®è®¤è®¾ç½®"})]})]})}),(0,o.jsx)("div",{className:"review-questions",children:0===k.length?(0,o.jsxs)("div",{className:"empty-review-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"ðŸŽ‰"}),(0,o.jsx)("h3",{children:"å¤ªæ£’äº†ï¼æ²¡æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®"}),(0,o.jsx)("p",{children:"ç»§ç»­ä¿æŒè‰¯å¥½çš„å¤ä¹ ä¹ æƒ¯ï¼Œæˆ–è€…è°ƒæ•´å¤ä¹ è®¾ç½®æ¥æŸ¥çœ‹æ›´å¤šé¢˜ç›®"}),(0,o.jsx)("button",{className:"adjust-settings-btn",onClick:()=>c(!0),children:"è°ƒæ•´å¤ä¹ è®¾ç½®"})]}):(0,o.jsx)("div",{className:"questions-grid",children:k.map((e,t)=>{const a=w(e),n=(e=>{switch(e){case"high":return"#ff6b6b";case"medium":return"#ffa726";case"low":return"#4ecdc4";default:return"#95a5a6"}})(a),i=new Date(e.lastReviewedAt||e.createdAt),c=Math.floor((new Date-i)/864e5),h=j.has(e.id);return(0,o.jsxs)("div",{className:"review-question-card "+(h?"updating":""),onClick:()=>C(e),style:{"--urgency-color":n},children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)("div",{className:"urgency-indicator",style:{backgroundColor:n}}),(0,o.jsxs)("div",{className:"question-meta",children:[(0,o.jsx)("span",{className:"urgency-badge",style:{backgroundColor:n},children:b(a)}),(0,o.jsx)("span",{className:"category-tag",children:e.category?.name||"æœªåˆ†ç±»"})]}),(0,o.jsxs)("div",{className:"time-info",children:[(0,o.jsxs)("span",{className:"last-reviewed",children:["ä¸Šæ¬¡å¤ä¹ : ",y(e.lastReviewedAt||e.createdAt)]}),(0,o.jsxs)("span",{className:"days-ago",children:["(",c,"å¤©å‰)"]}),(0,o.jsx)("span",{className:"urgency-description",children:f(a)})]})]}),(0,o.jsxs)("div",{className:"card-content",children:[(0,o.jsx)("h4",{className:"question-title",children:e.title}),e.detailedAnswer&&(0,o.jsxs)("div",{className:"answer-preview",children:[e.detailedAnswer.substring(0,100),"..."]}),(0,o.jsxs)("div",{className:"question-tags",children:[(0,o.jsx)("span",{className:`difficulty-tag difficulty-${e.difficulty}`,children:"easy"===e.difficulty?"ç®€å•":"medium"===e.difficulty?"ä¸­ç­‰":"å›°éš¾"}),e.tags&&e.tags.slice(0,3).map((e,s)=>(0,o.jsxs)("span",{className:"tag",children:["#",e]},s))]})]}),(0,o.jsx)("div",{className:"card-footer",children:(0,o.jsxs)("div",{className:"review-actions",children:[(0,o.jsx)("button",{className:"review-now-btn",onClick:t=>(async(e,t)=>{if(t.stopPropagation(),!v)return void alert("è¯·å…ˆç™»å½•");const a=d.find(s=>s.id===e);if(!a)return console.error("æœªæ‰¾åˆ°é¢˜ç›®:",e),void alert("é¢˜ç›®ä¸å­˜åœ¨ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");p(s=>new Set(s).add(e));try{console.log("å¼€å§‹è°ƒç”¨ onUpdateQuestionTime..."),await l(e),console.log("onUpdateQuestionTime è°ƒç”¨æˆåŠŸ"),s(s=>{const t=s.filter(s=>s.id!==e);return console.log("ä»Žå¤ä¹ åˆ—è¡¨ç§»é™¤åŽ:",t.length),t}),console.log("å‡†å¤‡è·³è½¬åˆ°é¢˜ç›®..."),a&&a.category?(console.log("è·³è½¬åˆ°åˆ†ç±»:",a.category.id),r?r(e):C(a)):(console.warn("æ— æ³•æ‰¾åˆ°é¢˜ç›®å¯¹åº”çš„åˆ†ç±»ä¿¡æ¯"),alert("å¤ä¹ æ—¶é—´å·²æ›´æ–°ï¼Œä½†æ— æ³•è·³è½¬åˆ°é¢˜ç›®ä½ç½®"))}catch(s){console.error("æ›´æ–°å¤ä¹ æ—¶é—´å¤±è´¥:",s),console.error("é”™è¯¯è¯¦æƒ…:",{questionId:e,currentUser:v?.id,errorMessage:s.message});let t="æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•";s.message.includes("permission")?t="æ›´æ–°å¤±è´¥ï¼šæ²¡æœ‰æƒé™ä¿®æ”¹æ­¤é¢˜ç›®":s.message.includes("Object not found")?t="æ›´æ–°å¤±è´¥ï¼šé¢˜ç›®ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤":s.message.includes("æœªæ‰¾åˆ°å¯¹åº”çš„é¢˜ç›®")?t="æ›´æ–°å¤±è´¥ï¼šæœ¬åœ°æ•°æ®ä¸­æœªæ‰¾åˆ°è¯¥é¢˜ç›®":s.message.includes("reserved")&&(t="æ›´æ–°å¤±è´¥ï¼šæ•°æ®å­—æ®µå†²çªï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"),alert(t)}finally{p(s=>{const t=new Set(s);return t.delete(e),t})}})(e.id,t),disabled:h,children:h?"ðŸ”„ æ›´æ–°ä¸­...":"ðŸ” ç«‹å³å¤ä¹ "}),(0,o.jsx)("button",{className:"postpone-btn",onClick:s=>((e,s)=>{s.stopPropagation(),alert("å·²æŽ¨è¿Ÿæé†’ï¼Œè¯¥é¢˜ç›®å°†åœ¨æ˜Žå¤©å†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­")})(e.id,s),disabled:h,children:"â° ç¨åŽæé†’"})]})}),h&&(0,o.jsxs)("div",{className:"updating-overlay",children:[(0,o.jsx)("div",{className:"updating-spinner"}),(0,o.jsx)("span",{children:"æ›´æ–°ä¸­..."})]})]},e.id)})})})]})}):(0,o.jsx)("section",{className:"review-reminder-section",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å¤ä¹ æé†’"}),(0,o.jsx)("div",{className:"auth-required-actions",children:(0,o.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"})})]})})})};var J=t(7286),G=t(2181);const H=a.memo(({question:e,index:s})=>{return(0,o.jsx)("div",{className:"question-item",children:(0,o.jsxs)("div",{className:"question-main",children:[(0,o.jsx)("div",{className:"question-header",children:(0,o.jsxs)("div",{className:"question-meta",children:[(0,o.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,o.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(e=>{switch(e){case"easy":return"#10b981";case"medium":return"#f59e0b";case"hard":return"#ef4444";default:return"#6b7280"}})(e.difficulty),color:"white"},children:(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return"æœªçŸ¥"}})(e.difficulty)}),(0,o.jsx)("span",{className:"question-time",children:(t=e.createdAt,new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}))})]})}),(0,o.jsx)("h4",{className:"question-title",children:e.title}),(0,o.jsx)("div",{className:"question-category",children:(0,o.jsx)("span",{className:"category-tag",children:e.category?.name||"æœªåˆ†ç±»"})})]})});var t});H.displayName="QuestionItem";const K=({dayData:e,position:s,onClose:t,isVisible:n})=>{const i=(0,a.useRef)(null),c=(0,r.jE)(),[l,d]=(0,a.useState)([]),[h,m]=(0,a.useState)(new Map),{data:g,isLoading:x}=(0,J.I)({queryKey:["day-questions-batch",e?.date?.toISOString(),e?.questions?.map(e=>e.id).join(",")],queryFn:async()=>{if(!e?.questions?.length)return[];const s=[],t=[];if(e.questions.forEach(e=>{const a=c.getQueryData(["question",e.id]);a?s.push(a):t.push(e.id)}),t.length>0)try{const e=await(async e=>{if(!e||0===e.length)return[];const s=[];for(let t=0;t<e.length;t+=10)s.push(e.slice(t,t+10));const t=[];for(const e of s){await new Promise(e=>setTimeout(e,1e3));try{const s=u().User.current();if(!s)continue;const a=new(u().Query)("Question");a.containedIn("objectId",e),a.equalTo("createdBy",s),a.include("category");const n=await a.find();t.push(...n.map(e=>D(e)))}catch(e){console.error("æ‰¹é‡èŽ·å–é¢˜ç›®å¤±è´¥:",e)}}return t})(t);return e.forEach(e=>{c.setQueryData(["question",e.id],e)}),[...s,...e]}catch(s){return console.warn("æ‰¹é‡èŽ·å–é¢˜ç›®å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ•°æ®:",s),e.questions.map(e=>c.getQueryData(["question",e.id])||e)}return s},enabled:n&&!!e?.questions?.length,staleTime:6e5,cacheTime:18e5,retry:1,retryDelay:1e3});(0,a.useEffect)(()=>{g&&g.length>0?d(g):e?.questions&&d(e.questions)},[g,e?.questions]);const j=(0,a.useRef)(null),p=(0,G.Te)({count:l.length,getScrollElement:()=>j.current,estimateSize:()=>140,overscan:5}),v=(0,a.useCallback)(e=>{i.current&&!i.current.contains(e.target)&&t()},[t]);(0,a.useEffect)(()=>{if(n)return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[n,v]);const N=(0,a.useCallback)(e=>{"Escape"===e.key&&t()},[t]);if((0,a.useEffect)(()=>{if(n)return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[n,N]),!n||!e)return null;const y=p.getVirtualItems(),w=e.questions?.length||0;return(0,o.jsxs)("div",{ref:i,className:"calendar-tooltip",style:{left:`${Math.min(s.x,window.innerWidth-500)}px`,top:`${s.y}px`,transform:"translateX(-50%)"},children:[(0,o.jsxs)("div",{className:"tooltip-header",children:[(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsxs)("div",{className:"date-display",children:[(0,o.jsx)("span",{className:"date-day",children:e.date.getDate()}),(0,o.jsxs)("div",{className:"date-info",children:[(0,o.jsx)("span",{className:"date-weekday",children:e.date.toLocaleDateString("zh-CN",{weekday:"long"})}),(0,o.jsx)("span",{className:"date-full",children:e.date.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})]})]}),(0,o.jsxs)("div",{className:"stats-badge",children:[(0,o.jsx)("span",{className:"stat-icon",children:"ðŸ“š"}),(0,o.jsx)("span",{className:"stat-count",children:w}),(0,o.jsx)("span",{className:"stat-label",children:"é“é¢˜ç›®"})]})]}),(0,o.jsx)("button",{className:"tooltip-close-btn",onClick:t,"aria-label":"å…³é—­",children:(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"currentColor",children:(0,o.jsx)("path",{d:"M12.707 3.293a1 1 0 00-1.414 0L8 6.586 4.707 3.293a1 1 0 00-1.414 1.414L6.586 8l-3.293 3.293a1 1 0 101.414 1.414L8 9.414l3.293 3.293a1 1 0 001.414-1.414L9.414 8l3.293-3.293a1 1 0 000-1.414z"})})})]}),(0,o.jsx)("div",{className:"tooltip-content",children:x?(0,o.jsxs)("div",{className:"loading-state",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("span",{className:"loading-text",children:"åŠ è½½é¢˜ç›®ä¸­..."})]}):l.length>0?(0,o.jsx)("div",{ref:j,className:"questions-virtual-container",style:{height:"500px",overflow:"auto"},children:(0,o.jsx)("div",{style:{height:`${p.getTotalSize()}px`,width:"100%",position:"relative"},children:y.map(e=>{const s=l[e.index];return(0,o.jsx)("div",{className:"question-virtual-item",style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:(0,o.jsx)(H,{question:s,index:e.index})},s.id)})})}):(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"ðŸ“"}),(0,o.jsx)("h4",{className:"empty-title",children:"è¿™ä¸€å¤©æ²¡æœ‰å­¦ä¹ è®°å½•"}),(0,o.jsx)("p",{className:"empty-description",children:"å¼€å§‹è®°å½•ä½ çš„å­¦ä¹ è¿›åº¦å§"})]})}),l.length>0&&(0,o.jsx)("div",{className:"tooltip-footer",children:(0,o.jsxs)("div",{className:"footer-stats",children:[(0,o.jsxs)("span",{className:"virtual-info",children:["æ˜¾ç¤º ",y.length," / ",w," é“é¢˜ç›®"]}),(0,o.jsx)("span",{className:"scroll-hint",children:"æ»šåŠ¨æŸ¥çœ‹æ›´å¤š"})]})}),(0,o.jsx)("div",{className:"tooltip-arrow"})]})},Y=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(0),r=[{text:"ä»»ä½•è¶³å¤Ÿå…ˆè¿›çš„æŠ€æœ¯éƒ½ä¸Žé­”æ³•æ— å¼‚ã€‚",author:"äºšç‘ŸÂ·CÂ·å…‹æ‹‰å…‹",category:"ç§‘æŠ€å“²å­¦"},{text:"ä»£ç å°±åƒæ˜¯å¹½é»˜ï¼Œå½“ä½ éœ€è¦è§£é‡Šå®ƒæ—¶ï¼Œå®ƒå°±ä¸å†æœ‰è¶£äº†ã€‚",author:"Cory House",category:"ç¼–ç¨‹"},{text:"é¦–å…ˆï¼Œè§£å†³é—®é¢˜ã€‚ç„¶åŽï¼Œç¼–å†™ä»£ç ã€‚",author:"John Johnson",category:"å¼€å‘æ–¹æ³•"},{text:"ç¼–ç¨‹ä¸æ˜¯å…³äºŽä½ çŸ¥é“ä»€ä¹ˆï¼Œè€Œæ˜¯å…³äºŽä½ èƒ½å¼„æ¸…æ¥šä»€ä¹ˆã€‚",author:"Chris Pine",category:"å­¦ä¹ "},{text:"ç®€å•æ€§æ˜¯å¯é æ€§çš„å…ˆå†³æ¡ä»¶ã€‚",author:"Edsger W. Dijkstra",category:"è½¯ä»¶å·¥ç¨‹"},{text:"æµ‹è¯•åªèƒ½è¯æ˜Ž bug çš„å­˜åœ¨ï¼Œè€Œä¸èƒ½è¯æ˜Žå®ƒä»¬çš„ä¸å­˜åœ¨ã€‚",author:"Edsger W. Dijkstra",category:"æµ‹è¯•"},{text:"æœ€å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¯æ ¹æœ¬ä¸éœ€è¦é”™è¯¯ä¿¡æ¯ã€‚",author:"Jef Raskin",category:"ç”¨æˆ·ä½“éªŒ"},{text:"è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚",author:"Donald Knuth",category:"æ€§èƒ½ä¼˜åŒ–"},{text:"ä»£ç çš„é˜…è¯»æ¬¡æ•°è¿œå¤šäºŽç¼–å†™æ¬¡æ•°ã€‚",author:"Guido van Rossum",category:"ä»£ç è´¨é‡"},{text:"å®Œç¾Žä¸æ˜¯åœ¨æ²¡æœ‰ä¸œè¥¿å¯åŠ æ—¶è¾¾åˆ°çš„ï¼Œè€Œæ˜¯åœ¨æ²¡æœ‰ä¸œè¥¿å¯æ‹¿èµ°æ—¶è¾¾åˆ°çš„ã€‚",author:"Antoine de Saint-ExupÃ©ry",category:"è®¾è®¡"},{text:"è®¡ç®—æœºç§‘å­¦çš„æ ¸å¿ƒæ˜¯è§£å†³é—®é¢˜ã€‚",author:"Abelson and Sussman",category:"è®¡ç®—æœºç§‘å­¦"},{text:"æœªæ¥å·²ç»åˆ°æ¥ï¼Œåªæ˜¯åˆ†å¸ƒä¸å‡ã€‚",author:"William Gibson",category:"ç§‘æŠ€åˆ›æ–°"},{text:"æœ€å±é™©çš„ä»£ç æ˜¯ä½ çœ‹ä¸åˆ°é—®é¢˜çš„ä»£ç ã€‚",author:"Douglas Crockford",category:"ä»£ç å®‰å…¨"},{text:"ç¼–ç¨‹æ˜¯ç†è§£çš„è‰ºæœ¯ã€‚",author:"Kristen Nygaard",category:"ç¼–ç¨‹å“²å­¦"},{text:"æŠ€æœ¯åº”è¯¥æ”¹å–„ç”Ÿæ´»ï¼Œè€Œä¸æ˜¯æ”¯é…ç”Ÿæ´»ã€‚",author:"Tim Cook",category:"ç§‘æŠ€ä¼¦ç†"}];(0,a.useEffect)(()=>{const e=setInterval(()=>{c(e=>e===r.length-1?0:e+1)},5e3);return()=>clearInterval(e)},[r.length]);const l=[{id:1,title:"React å®˜æ–¹æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“",category:"å‰ç«¯æ¡†æž¶",url:"https://react.dev",icon:"âš›ï¸"},{id:2,title:"Vue.js æ–‡æ¡£",description:"æ¸è¿›å¼ JavaScript æ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://vuejs.org",icon:"ðŸŸ¢"},{id:3,title:"Angular æ–‡æ¡£",description:"Google å¼€å‘çš„å‰ç«¯æ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://angular.io",icon:"ðŸ…°ï¸"},{id:4,title:"Svelte æ–‡æ¡£",description:"ç¼–è¯‘æ—¶æ¡†æž¶ï¼Œæ— è™šæ‹ŸDOM",category:"å‰ç«¯æ¡†æž¶",url:"https://svelte.dev",icon:"âš¡"},{id:5,title:"SolidJS æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºç”¨æˆ·ç•Œé¢çš„å£°æ˜Žå¼ JavaScript åº“",category:"å‰ç«¯æ¡†æž¶",url:"https://solidjs.com",icon:"ðŸ”·"},{id:6,title:"Next.js æ–‡æ¡£",description:"React å…¨æ ˆæ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://nextjs.org",icon:"â­ï¸"},{id:7,title:"Nuxt.js æ–‡æ¡£",description:"Vue.js å…¨æ ˆæ¡†æž¶",category:"å‰ç«¯æ¡†æž¶",url:"https://nuxtjs.org",icon:"ðŸ”¥"},{id:8,title:"Redux æ–‡æ¡£",description:"JavaScript åº”ç”¨çŠ¶æ€å®¹å™¨",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://redux.js.org",icon:"ðŸ“¦"},{id:9,title:"Zustand æ–‡æ¡£",description:"å°åž‹ã€å¿«é€Ÿã€å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://github.com/pmndrs/zustand",icon:"ðŸ»"},{id:10,title:"MobX æ–‡æ¡£",description:"ç®€å•ã€å¯æ‰©å±•çš„çŠ¶æ€ç®¡ç†",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://mobx.js.org",icon:"ðŸ”„"},{id:11,title:"Vuex æ–‡æ¡£",description:"Vue.js çš„çŠ¶æ€ç®¡ç†åº“",category:"å‰ç«¯çŠ¶æ€ç®¡ç†",url:"https://vuex.vuejs.org",icon:"ðŸª"},{id:12,title:"Tailwind CSS æ–‡æ¡£",description:"å®žç”¨ä¼˜å…ˆçš„ CSS æ¡†æž¶",category:"CSS æ¡†æž¶",url:"https://tailwindcss.com",icon:"ðŸŽ¨"},{id:13,title:"Bootstrap æ–‡æ¡£",description:"æœ€æµè¡Œçš„å‰ç«¯æ¡†æž¶",category:"CSS æ¡†æž¶",url:"https://getbootstrap.com",icon:"ðŸŽ¯"},{id:14,title:"Sass æ–‡æ¡£",description:"ä¸“ä¸šçº§ CSS æ‰©å±•è¯­è¨€",category:"CSS æ¡†æž¶",url:"https://sass-lang.com",icon:"ðŸ’Ž"},{id:15,title:"Less æ–‡æ¡£",description:"CSS é¢„å¤„ç†å™¨",category:"CSS æ¡†æž¶",url:"http://lesscss.org",icon:"âž–"},{id:16,title:"Styled Components",description:"CSS-in-JS æ ·å¼åº“",category:"CSS æ¡†æž¶",url:"https://styled-components.com",icon:"ðŸ’…"},{id:17,title:"Webpack æ–‡æ¡£",description:"æ¨¡å—æ‰“åŒ…å·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://webpack.js.org",icon:"ðŸ“¦"},{id:18,title:"Vite æ–‡æ¡£",description:"ä¸‹ä¸€ä»£å‰ç«¯æž„å»ºå·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://vitejs.dev",icon:"âš¡"},{id:19,title:"Parcel æ–‡æ¡£",description:"é›¶é…ç½®æž„å»ºå·¥å…·",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://parceljs.org",icon:"ðŸ“®"},{id:20,title:"Rollup æ–‡æ¡£",description:"JavaScript æ¨¡å—æ‰“åŒ…å™¨",category:"å‰ç«¯æž„å»ºå·¥å…·",url:"https://rollupjs.org",icon:"ðŸ”„"},{id:21,title:"Jest æ–‡æ¡£",description:"JavaScript æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://jestjs.io",icon:"ðŸŽ­"},{id:22,title:"Cypress æ–‡æ¡£",description:"ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://docs.cypress.io",icon:"ðŸŽ¯"},{id:23,title:"Testing Library",description:"DOM æµ‹è¯•å·¥å…·åº“",category:"å‰ç«¯æµ‹è¯•",url:"https://testing-library.com",icon:"ðŸ§ª"},{id:24,title:"Vitest æ–‡æ¡£",description:"åŸºäºŽ Vite çš„æµ‹è¯•æ¡†æž¶",category:"å‰ç«¯æµ‹è¯•",url:"https://vitest.dev",icon:"âš¡"},{id:25,title:"Express.js æ–‡æ¡£",description:"Node.js Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://expressjs.com",icon:"ðŸš‚"},{id:26,title:"Koa æ–‡æ¡£",description:"ä¸‹ä¸€ä»£ Node.js æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://koajs.com",icon:"ðŸŽ‹"},{id:27,title:"NestJS æ–‡æ¡£",description:"ç”¨äºŽæž„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„æœåŠ¡å™¨ç«¯åº”ç”¨",category:"åŽç«¯æ¡†æž¶",url:"https://nestjs.com",icon:"ðŸªº"},{id:28,title:"Fastify æ–‡æ¡£",description:"å¿«é€Ÿä¸”ä½Žå¼€é”€çš„ Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://fastify.io",icon:"ðŸš€"},{id:29,title:"Hapi æ–‡æ¡£",description:"ä¸°å¯Œçš„æ¡†æž¶ç”¨äºŽæž„å»ºåº”ç”¨å’ŒæœåŠ¡",category:"åŽç«¯æ¡†æž¶",url:"https://hapi.dev",icon:"ðŸŽ¯"},{id:30,title:"Django æ–‡æ¡£",description:"Python Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://docs.djangoproject.com",icon:"ðŸŽ¸"},{id:31,title:"Flask æ–‡æ¡£",description:"Python å¾®æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://flask.palletsprojects.com",icon:"ðŸ¶"},{id:32,title:"FastAPI æ–‡æ¡£",description:"çŽ°ä»£ã€å¿«é€Ÿçš„ Python Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://fastapi.tiangolo.com",icon:"âš¡"},{id:33,title:"Spring æ–‡æ¡£",description:"Java åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://spring.io/docs",icon:"ðŸŒ±"},{id:34,title:"Spring Boot æ–‡æ¡£",description:"ç®€åŒ– Spring åº”ç”¨å¼€å‘",category:"åŽç«¯æ¡†æž¶",url:"https://spring.io/projects/spring-boot",icon:"ðŸ‘¢"},{id:35,title:"Laravel æ–‡æ¡£",description:"PHP Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://laravel.com/docs",icon:"ðŸ”¨"},{id:36,title:"Ruby on Rails æ–‡æ¡£",description:"Ruby Web åº”ç”¨æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://rubyonrails.org",icon:"ðŸ’Ž"},{id:37,title:"ASP.NET Core æ–‡æ¡£",description:".NET Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://docs.microsoft.com/aspnet/core",icon:"ðŸŒ"},{id:38,title:"Gin æ–‡æ¡£",description:"Go è¯­è¨€ Web æ¡†æž¶",category:"åŽç«¯æ¡†æž¶",url:"https://gin-gonic.com",icon:"ðŸ¸"},{id:39,title:"MySQL æ–‡æ¡£",description:"MySQL æ•°æ®åº“å®˜æ–¹æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://dev.mysql.com/doc",icon:"ðŸ¬"},{id:40,title:"PostgreSQL æ–‡æ¡£",description:"PostgreSQL æ•°æ®åº“æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://www.postgresql.org/docs",icon:"ðŸ˜"},{id:41,title:"MongoDB æ–‡æ¡£",description:"MongoDB NoSQL æ•°æ®åº“æ–‡æ¡£",category:"æ•°æ®åº“",url:"https://docs.mongodb.com",icon:"ðŸƒ"},{id:42,title:"Redis æ–‡æ¡£",description:"Redis å†…å­˜æ•°æ®ç»“æž„å­˜å‚¨",category:"æ•°æ®åº“",url:"https://redis.io/documentation",icon:"ðŸ”´"},{id:43,title:"Prisma æ–‡æ¡£",description:"ä¸‹ä¸€ä»£ Node.js TypeScript ORM",category:"æ•°æ®åº“",url:"https://www.prisma.io",icon:"ðŸ›¡ï¸"},{id:44,title:"Sequelize æ–‡æ¡£",description:"Node.js çš„ ORM",category:"æ•°æ®åº“",url:"https://sequelize.org",icon:"ðŸ—„ï¸"},{id:45,title:"Mongoose æ–‡æ¡£",description:"MongoDB å¯¹è±¡å»ºæ¨¡å·¥å…·",category:"æ•°æ®åº“",url:"https://mongoosejs.com",icon:"ðŸ"},{id:46,title:"GraphQL æ–‡æ¡£",description:"API æŸ¥è¯¢è¯­è¨€",category:"API å’Œå¾®æœåŠ¡",url:"https://graphql.org",icon:"ðŸ“ˆ"},{id:47,title:"Apollo æ–‡æ¡£",description:"GraphQL å¹³å°",category:"API å’Œå¾®æœåŠ¡",url:"https://www.apollographql.com",icon:"ðŸš€"},{id:48,title:"Swagger æ–‡æ¡£",description:"API è®¾è®¡å’Œæ–‡æ¡£å·¥å…·",category:"API å’Œå¾®æœåŠ¡",url:"https://swagger.io",icon:"ðŸ“"},{id:49,title:"gRPC æ–‡æ¡£",description:"é«˜æ€§èƒ½ RPC æ¡†æž¶",category:"API å’Œå¾®æœåŠ¡",url:"https://grpc.io",icon:"ðŸ”§"},{id:50,title:"RESTful API æŒ‡å—",description:"REST API æœ€ä½³å®žè·µ",category:"API å’Œå¾®æœåŠ¡",url:"https://restfulapi.net",icon:"ðŸŒ"},{id:51,title:"JWT æ–‡æ¡£",description:"JSON Web Tokens å®˜æ–¹æ–‡æ¡£",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://jwt.io",icon:"ðŸ”"},{id:52,title:"OAuth 2.0 æŒ‡å—",description:"OAuth 2.0 æŽˆæƒæ¡†æž¶",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://oauth.net/2",icon:"ðŸ”‘"},{id:53,title:"Passport.js æ–‡æ¡£",description:"Node.js è®¤è¯ä¸­é—´ä»¶",category:"è®¤è¯å’ŒæŽˆæƒ",url:"http://www.passportjs.org",icon:"ðŸ›‚"},{id:54,title:"Auth0 æ–‡æ¡£",description:"èº«ä»½éªŒè¯å’ŒæŽˆæƒå¹³å°",category:"è®¤è¯å’ŒæŽˆæƒ",url:"https://auth0.com/docs",icon:"ðŸ”’"},{id:55,title:"Docker æ–‡æ¡£",description:"å®¹å™¨åŒ–å¹³å°æ–‡æ¡£",category:"éƒ¨ç½²å’Œ DevOps",url:"https://docs.docker.com",icon:"ðŸ³"},{id:56,title:"Kubernetes æ–‡æ¡£",description:"å®¹å™¨ç¼–æŽ’ç³»ç»Ÿæ–‡æ¡£",category:"éƒ¨ç½²å’Œ DevOps",url:"https://kubernetes.io/docs",icon:"âš“"},{id:57,title:"PM2 æ–‡æ¡£",description:"Node.js è¿›ç¨‹ç®¡ç†å™¨",category:"éƒ¨ç½²å’Œ DevOps",url:"https://pm2.keymetrics.io",icon:"ðŸ”„"},{id:58,title:"Nginx æ–‡æ¡£",description:"Web æœåŠ¡å™¨å’Œåå‘ä»£ç†",category:"éƒ¨ç½²å’Œ DevOps",url:"https://nginx.org/en/docs",icon:"ðŸ”§"},{id:59,title:"TypeScript æ–‡æ¡£",description:"TypeScript è¯­è¨€æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://www.typescriptlang.org",icon:"ðŸ”·"},{id:60,title:"JavaScript MDN",description:"JavaScript è¯­è¨€å‚è€ƒæ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://developer.mozilla.org/javascript",icon:"ðŸ“œ"},{id:61,title:"Python å®˜æ–¹æ–‡æ¡£",description:"Python ç¼–ç¨‹è¯­è¨€å®˜æ–¹æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://docs.python.org",icon:"ðŸ"},{id:62,title:"Node.js æ–‡æ¡£",description:"Node.js è¿è¡Œæ—¶æ–‡æ¡£",category:"ç¼–ç¨‹è¯­è¨€",url:"https://nodejs.org",icon:"ðŸ“¦"},{id:63,title:"Git æ–‡æ¡£",description:"åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿ",category:"å¼€å‘å·¥å…·",url:"https://git-scm.com/doc",icon:"ðŸ“š"},{id:64,title:"NPM æ–‡æ¡£",description:"Node åŒ…ç®¡ç†å™¨æ–‡æ¡£",category:"å¼€å‘å·¥å…·",url:"https://docs.npmjs.com",icon:"ðŸ“¦"},{id:65,title:"Yarn æ–‡æ¡£",description:"å¿«é€Ÿã€å¯é ã€å®‰å…¨çš„ä¾èµ–ç®¡ç†",category:"å¼€å‘å·¥å…·",url:"https://yarnpkg.com",icon:"ðŸ§¶"},{id:66,title:"VS Code æ–‡æ¡£",description:"Visual Studio Code ç¼–è¾‘å™¨æ–‡æ¡£",category:"å¼€å‘å·¥å…·",url:"https://code.visualstudio.com/docs",icon:"ðŸ’»"},{id:67,title:"Lighthouse æ–‡æ¡£",description:"è‡ªåŠ¨åŒ–ç½‘ç«™è´¨é‡è¯„ä¼°å·¥å…·",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://developers.google.com/web/tools/lighthouse",icon:"ðŸ’¡"},{id:68,title:"Web Vitals",description:"ç½‘ç«™ç”¨æˆ·ä½“éªŒè´¨é‡æŒ‡æ ‡",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://web.dev/vitals",icon:"ðŸ“Š"},{id:69,title:"Bundlephobia",description:"æ£€æŸ¥ npm åŒ…å¤§å°å¯¹æ€§èƒ½çš„å½±å“",category:"æ€§èƒ½å’Œä¼˜åŒ–",url:"https://bundlephobia.com",icon:"ðŸ“¦"}],d=[...new Set(l.map(e=>e.category))],h=l.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.description.toLowerCase().includes(t.toLowerCase())||e.category.toLowerCase().includes(t.toLowerCase())),u=()=>{s(null)};return(0,o.jsxs)("div",{className:"documents-container",children:[(0,o.jsxs)("div",{className:"quotes-carousel",children:[(0,o.jsxs)("div",{className:"carousel-container",children:[(0,o.jsx)("button",{className:"carousel-btn prev-btn",onClick:()=>{c(e=>0===e?r.length-1:e-1)},children:"â€¹"}),(0,o.jsx)("div",{className:"quote-slide",children:(0,o.jsxs)("div",{className:"quote-content",children:[(0,o.jsx)("div",{className:"quote-icon",children:"ðŸ’­"}),(0,o.jsxs)("div",{className:"quote-text",children:[(0,o.jsxs)("p",{className:"quote-main",children:['"',r[i].text,'"']}),(0,o.jsxs)("div",{className:"quote-meta",children:[(0,o.jsxs)("span",{className:"quote-author",children:["â€” ",r[i].author]}),(0,o.jsx)("span",{className:"quote-category",children:r[i].category})]})]})]})}),(0,o.jsx)("button",{className:"carousel-btn next-btn",onClick:()=>{c(e=>e===r.length-1?0:e+1)},children:"â€º"})]}),(0,o.jsx)("div",{className:"carousel-indicators",children:r.map((e,s)=>(0,o.jsx)("button",{className:"indicator "+(s===i?"active":""),onClick:()=>c(s)},s))})]}),(0,o.jsxs)("div",{className:"documents-header",children:[(0,o.jsx)("h1",{children:"ðŸ“š å¼€å‘æ–‡æ¡£åº“"}),(0,o.jsxs)("p",{children:["ä¸“æ³¨äºŽå‰ç«¯å’ŒåŽç«¯å¼€å‘æ–‡æ¡£ - å…± ",l.length," ä¸ªèµ„æº"]}),(0,o.jsx)("div",{className:"search-section",children:(0,o.jsxs)("div",{className:"search-box",children:[(0,o.jsx)("span",{className:"search-icon",children:"ðŸ”"}),(0,o.jsx)("input",{type:"text",placeholder:"æœç´¢æ–‡æ¡£åç§°ã€æè¿°æˆ–ç±»åˆ«...",value:t,onChange:e=>n(e.target.value),className:"search-input"}),t&&(0,o.jsx)("button",{className:"clear-search",onClick:()=>n(""),children:"âœ•"})]})})]}),(0,o.jsxs)("div",{className:"documents-content",children:[d.map(e=>{const t=h.filter(s=>s.category===e);return 0===t.length?null:(0,o.jsxs)("div",{className:"category-section",children:[(0,o.jsxs)("h2",{className:"category-title",children:[e,(0,o.jsxs)("span",{className:"category-count",children:["(",t.length,")"]})]}),(0,o.jsx)("div",{className:"documents-grid",children:t.map(e=>(0,o.jsxs)("div",{className:"document-card",onClick:()=>(e=>{s(e)})(e),children:[(0,o.jsxs)("div",{className:"doc-header",children:[(0,o.jsx)("div",{className:"doc-icon",children:e.icon}),(0,o.jsxs)("div",{className:"doc-info",children:[(0,o.jsx)("h3",{className:"doc-title",children:e.title}),(0,o.jsx)("p",{className:"doc-description",children:e.description}),(0,o.jsx)("div",{className:"doc-category",children:e.category})]})]}),(0,o.jsx)("div",{className:"doc-footer",children:(0,o.jsx)("button",{className:"visit-button",children:"è®¿é—®ç½‘ç«™ â†’"})})]},e.id))})]},e)}),0===h.length&&(0,o.jsxs)("div",{className:"no-results",children:[(0,o.jsx)("div",{className:"no-results-icon",children:"ðŸ”"}),(0,o.jsx)("h3",{children:"æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£"}),(0,o.jsx)("p",{children:"å°è¯•è°ƒæ•´æœç´¢å…³é”®è¯"}),(0,o.jsx)("button",{className:"clear-search-btn",onClick:()=>n(""),children:"æ¸…é™¤æœç´¢"})]})]}),e&&(0,o.jsx)("div",{className:"modal-overlay",onClick:u,children:(0,o.jsxs)("div",{className:"modal-content doc-modal",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsxs)("div",{className:"modal-title-section",children:[(0,o.jsx)("span",{className:"doc-modal-icon",children:e.icon}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:e.title}),(0,o.jsx)("span",{className:"doc-category-badge",children:e.category})]})]}),(0,o.jsx)("button",{className:"close-btn",onClick:u,children:"Ã—"})]}),(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsx)("p",{className:"doc-modal-description",children:e.description}),(0,o.jsxs)("div",{className:"doc-url-section",children:[(0,o.jsx)("label",{children:"ç½‘ç«™åœ°å€:"}),(0,o.jsx)("div",{className:"url-display",children:(0,o.jsx)("span",{className:"url-text",children:e.url})})]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"cancel-btn",onClick:u,children:"å…³é—­"}),(0,o.jsx)("button",{className:"visit-site-btn",onClick:()=>{e&&window.open(e.url,"_blank")},children:"ðŸŒ è®¿é—®ç½‘ç«™"})]})]})})]})};class Z{static async getPosts(e={}){const{page:s=1,pageSize:t=20,sortBy:a="createdAt",sortOrder:n="desc",keyword:i="",tag:c="",authorId:r=""}=e,l=new(u().Query)("Post");if(l.equalTo("isPublic",!0),l.equalTo("status","published"),i){const e=new(u().Query)("Post");e.contains("title",i);const s=new(u().Query)("Post");s.contains("content",i),l=u().Query.or(e,s)}if(c&&l.equalTo("tags",c),r){const e=u().Object.createWithoutData("_User",r);l.equalTo("author",e)}return l.include("author"),l.limit(t),l.skip((s-1)*t),l.descending(a),l.find()}static async createPost(e){const s=u().User.current();if(!s)throw new Error("è¯·å…ˆç™»å½•");const t=new(u().Object.extend("Post"));return t.set("title",e.title),t.set("content",e.content),t.set("author",s),t.set("tags",e.tags||[]),t.set("isPublic",!1!==e.isPublic),t.set("status","published"),t.set("likes",0),t.set("views",0),t.set("commentCount",0),t.save()}static async getPostById(e){const s=new(u().Query)("Post");s.include("author");const t=await s.get(e);return t.increment("views",1),await t.save(),t}static async getComments(e,s={}){const{page:t=1,pageSize:a=50}=s,n=new(u().Query)("Comment"),i=u().Object.createWithoutData("Post",e);return n.equalTo("post",i),n.include("author"),n.include("parent"),n.ascending("createdAt"),n.limit(a),n.skip((t-1)*a),n.find()}static async addComment(e,s,t=null){const a=u().User.current();if(!a)throw new Error("è¯·å…ˆç™»å½•");const n=new(u().Object.extend("Comment")),i=u().Object.createWithoutData("Post",e);if(n.set("post",i),n.set("author",a),n.set("content",s),n.set("likes",0),t){const e=u().Object.createWithoutData("Comment",t);n.set("parent",e)}return i.increment("commentCount",1),i.set("lastCommentedAt",new Date),await i.save(),n.save()}static async toggleLike(e){const s=u().User.current();if(!s)throw new Error("è¯·å…ˆç™»å½•");const t=u().Object.extend("Like"),a=new(u().Query)("Like"),n=u().Object.createWithoutData("Post",e);a.equalTo("user",s),a.equalTo("post",n);const i=await a.first();if(i){await i.destroy();const s=await new(u().Query)("Post").get(e);return s.increment("likes",-1),await s.save(),{liked:!1}}{const a=new t;a.set("user",s),a.set("post",n),await a.save();const i=await new(u().Query)("Post").get(e);return i.increment("likes",1),await i.save(),{liked:!0}}}static async getPopularTags(e=10){const s=new(u().Query)("Post");s.equalTo("isPublic",!0),s.equalTo("status","published");const t=await s.find(),a={};return t.forEach(e=>{(e.get("tags")||[]).forEach(e=>{a[e]=(a[e]||0)+1})}),Object.entries(a).sort(([,e],[,s])=>s-e).slice(0,e).map(([e,s])=>({tag:e,count:s}))}}const X=({onClose:e,onSuccess:s})=>{const[t,n]=(0,a.useState)({title:"",content:"",tags:"",isPublic:!0}),[i,c]=(0,a.useState)(!1),[r,l]=(0,a.useState)({}),[d,h]=(0,a.useState)({title:0,content:0}),[m,g]=(0,a.useState)([]),x=(0,a.useRef)(null),j=100,p=5e3,v=["JavaScript","React","ç®—æ³•","LeetCode","å‰ç«¯","é¢è¯•","TypeScript","Vue","CSS","Node.js","æ•°æ®åº“","è®¡ç®—æœºç½‘ç»œ","æ“ä½œç³»ç»Ÿ","æ•°æ®ç»“æž„"];(0,a.useEffect)(()=>{x.current&&(x.current.style.height="auto",x.current.style.height=x.current.scrollHeight+"px")},[t.content]),(0,a.useEffect)(()=>{if(t.title.length>5){const e=v.filter(e=>t.title.toLowerCase().includes(e.toLowerCase()));g(e.slice(0,3))}else g([])},[t.title]);const N=(e,s)=>{n(t=>({...t,[e]:s})),h(t=>({...t,[e]:s.length})),r[e]&&l(s=>({...s,[e]:""}))};return(0,o.jsx)("div",{className:"modal-overlay",onClick:e,children:(0,o.jsxs)("div",{className:"create-post-modal",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsx)("h3",{children:"âœï¸ å‘å¸ƒæ–°å¸–å­"}),(0,o.jsx)("p",{children:"åˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—å’Œç»éªŒ"})]}),(0,o.jsx)("button",{className:"close-btn",onClick:e,children:"âœ•"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return t.title.trim()?t.title.length<5?e.title="æ ‡é¢˜è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦":t.title.length>j&&(e.title="æ ‡é¢˜ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦"):e.title="è¯·è¾“å…¥å¸–å­æ ‡é¢˜",t.content.trim()?t.content.length<10?e.content="å†…å®¹è‡³å°‘éœ€è¦10ä¸ªå­—ç¬¦":t.content.length>p&&(e.content="å†…å®¹ä¸èƒ½è¶…è¿‡5000ä¸ªå­—ç¬¦"):e.content="è¯·è¾“å…¥å¸–å­å†…å®¹",l(e),0===Object.keys(e).length})())if(u().User.current()){c(!0);try{const e=t.tags.split(",").map(e=>e.trim()).filter(e=>e).slice(0,5),a={title:t.title.trim(),content:t.content.trim(),tags:e,isPublic:t.isPublic},n=await Z.createPost(a);c(!1),s(n)}catch(e){console.error("å‘å¸ƒå¤±è´¥:",e),l({submit:e.message||"å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•"}),c(!1)}}else alert("è¯·å…ˆç™»å½•")},className:"post-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"post-title",children:["å¸–å­æ ‡é¢˜ *",(0,o.jsxs)("span",{className:"char-count",style:{color:(()=>{const e=d.title/j;return e>.9?"#ff6b6b":e>.7?"#ffa726":"#4ecdc4"})()},children:[d.title,"/",j]})]}),(0,o.jsx)("input",{id:"post-title",type:"text",placeholder:"è¯·è¾“å…¥æœ‰å¸å¼•åŠ›çš„æ ‡é¢˜...",value:t.title,onChange:e=>N("title",e.target.value),className:r.title?"error":"",maxLength:j}),r.title&&(0,o.jsx)("span",{className:"error-message",children:r.title})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"post-content",children:["å¸–å­å†…å®¹ *",(0,o.jsxs)("span",{className:"char-count",style:{color:(()=>{const e=d.content/p;return e>.9?"#ff6b6b":e>.7?"#ffa726":"#4ecdc4"})()},children:[d.content,"/",p]})]}),(0,o.jsx)("textarea",{ref:x,id:"post-content",placeholder:"è¯¦ç»†æè¿°ä½ çš„é—®é¢˜æˆ–åˆ†äº«ä½ çš„ç»éªŒ...ï¼ˆæ”¯æŒ Markdown æ ¼å¼ï¼‰",value:t.content,onChange:e=>N("content",e.target.value),className:r.content?"error":"",maxLength:p,rows:"6"}),r.content&&(0,o.jsx)("span",{className:"error-message",children:r.content}),(0,o.jsxs)("div",{className:"format-tips",children:[(0,o.jsx)("span",{className:"tip-title",children:"æ ¼å¼æç¤ºï¼š"}),(0,o.jsx)("span",{className:"tip-item",children:"**ç²—ä½“**"}),(0,o.jsx)("span",{className:"tip-item",children:"*æ–œä½“*"}),(0,o.jsx)("span",{className:"tip-item",children:"`ä»£ç `"}),(0,o.jsx)("span",{className:"tip-item",children:"- åˆ—è¡¨é¡¹"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"post-tags",children:["æ ‡ç­¾",(0,o.jsx)("span",{className:"optional",children:"ï¼ˆå¯é€‰ï¼‰"})]}),(0,o.jsx)("input",{id:"post-tags",type:"text",placeholder:"è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆä¾‹å¦‚ï¼šJavaScript,ç®—æ³•,LeetCodeï¼‰",value:t.tags,onChange:e=>N("tags",e.target.value)}),m.length>0&&(0,o.jsxs)("div",{className:"tag-suggestions",children:[(0,o.jsx)("span",{className:"suggestions-label",children:"æŽ¨èæ ‡ç­¾ï¼š"}),m.map(e=>(0,o.jsx)("button",{type:"button",className:"tag-suggestion",onClick:()=>(e=>{const s=t.tags.split(",").map(e=>e.trim()).filter(e=>e);if(!s.includes(e)){const t=[...s,e].join(", ");N("tags",t)}})(e),children:e},e))]}),(0,o.jsx)("div",{className:"tags-hint",children:"æœ€å¤š5ä¸ªæ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ã€‚åˆé€‚çš„æ ‡ç­¾æœ‰åŠ©äºŽæ›´å¤šäººçœ‹åˆ°ä½ çš„å¸–å­ã€‚"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{className:"checkbox-label",children:[(0,o.jsx)("input",{type:"checkbox",checked:t.isPublic,onChange:e=>N("isPublic",e.target.checked)}),(0,o.jsx)("span",{className:"checkmark"}),"å…¬å¼€å¸–å­ï¼ˆæ‰€æœ‰äººå¯è§ï¼‰"]}),(0,o.jsx)("div",{className:"privacy-hint",children:t.isPublic?"âœ… ä½ çš„å¸–å­å°†å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§":"ðŸ”’ åªæœ‰ä½ è‡ªå·±å¯ä»¥çœ‹åˆ°æ­¤å¸–å­"})]}),r.submit&&(0,o.jsxs)("div",{className:"submit-error",children:[(0,o.jsx)("span",{className:"error-icon",children:"âš ï¸"}),r.submit]}),(0,o.jsxs)("div",{className:"form-actions",children:[(0,o.jsx)("button",{type:"button",onClick:e,className:"cancel-btn",disabled:i,children:"å–æ¶ˆ"}),(0,o.jsx)("button",{type:"submit",className:"submit-btn",disabled:i,children:i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"submit-spinner"}),"å‘å¸ƒä¸­..."]}):"ðŸš€ å‘å¸ƒå¸–å­"})]})]})]})})},ee=({onSearch:e,placeholder:s="æœç´¢å¸–å­æ ‡é¢˜æˆ–å†…å®¹..."})=>{const[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[r,l]=(0,a.useState)(!1),d=(0,a.useRef)(null);(0,a.useEffect)(()=>{const s=setTimeout(()=>{e(t)},300);return()=>clearTimeout(s)},[t,e]);const h=s=>{n(s),l(!1),e(s)};return(0,o.jsxs)("div",{className:"search-bar",children:[(0,o.jsxs)("div",{className:"search-input-container "+(i?"focused":""),children:[(0,o.jsx)("div",{className:"search-icon",children:"ðŸ”"}),(0,o.jsx)("input",{ref:d,type:"text",placeholder:s,value:t,onChange:e=>{return s=e.target.value,n(s),void l(s.length>0);var s},onFocus:()=>{c(!0),t.length>0&&l(!0)},onBlur:()=>{c(!1),setTimeout(()=>l(!1),200)},onKeyDown:s=>{"Escape"===s.key?(l(!1),d.current?.blur()):"Enter"===s.key&&(l(!1),e(t))},className:"search-input"}),t&&(0,o.jsx)("button",{className:"clear-search",onClick:()=>{n(""),l(!1),e(""),d.current?.focus()},type:"button",children:"âœ•"}),r&&(0,o.jsxs)("div",{className:"search-suggestions",children:[(0,o.jsxs)("div",{className:"suggestions-header",children:[(0,o.jsx)("span",{className:"suggestions-title",children:"æœç´¢å»ºè®®"}),(0,o.jsx)("button",{className:"close-suggestions",onClick:()=>l(!1),children:"âœ•"})]}),(0,o.jsxs)("div",{className:"suggestions-list",children:[t.length>0&&(0,o.jsxs)("div",{className:"suggestion-item exact-match",onClick:()=>h(t),children:[(0,o.jsx)("span",{className:"suggestion-icon",children:"ðŸ”"}),(0,o.jsxs)("span",{className:"suggestion-text",children:['æœç´¢: "',t,'"']})]}),(0,o.jsxs)("div",{className:"suggestions-section",children:[(0,o.jsx)("div",{className:"section-title",children:"çƒ­é—¨æœç´¢"}),["JavaScript","React","ç®—æ³•","LeetCode","å‰ç«¯","é¢è¯•","TypeScript","Vue"].filter(e=>e.toLowerCase().includes(t.toLowerCase())).map((e,s)=>(0,o.jsxs)("div",{className:"suggestion-item",onClick:()=>h(e),children:[(0,o.jsx)("span",{className:"suggestion-icon",children:"ðŸ”¥"}),(0,o.jsx)("span",{className:"suggestion-text",children:e})]},s))]}),(0,o.jsxs)("div",{className:"search-tips",children:[(0,o.jsx)("div",{className:"tips-title",children:"æœç´¢æç¤º"}),(0,o.jsxs)("div",{className:"tips-list",children:[(0,o.jsxs)("div",{className:"tip-item",children:[(0,o.jsx)("span",{className:"tip-icon",children:"ðŸ’¡"}),(0,o.jsx)("span",{children:"æ”¯æŒæœç´¢å¸–å­æ ‡é¢˜ã€å†…å®¹å’Œæ ‡ç­¾"})]}),(0,o.jsxs)("div",{className:"tip-item",children:[(0,o.jsx)("span",{className:"tip-icon",children:"âŽ"}),(0,o.jsx)("span",{children:"æŒ‰ Enter é”®å¿«é€Ÿæœç´¢"})]}),(0,o.jsxs)("div",{className:"tip-item",children:[(0,o.jsx)("span",{className:"tip-icon",children:"âŽ‹"}),(0,o.jsx)("span",{children:"æŒ‰ ESC é”®æ¸…é™¤æœç´¢"})]})]})]})]})]})]}),t&&(0,o.jsxs)("div",{className:"search-stats",children:[(0,o.jsxs)("span",{className:"stats-text",children:["æ­£åœ¨æœç´¢: ",(0,o.jsxs)("strong",{children:['"',t,'"']})]}),(0,o.jsx)("button",{className:"advanced-search-btn",onClick:()=>l(!0),children:"é«˜çº§æœç´¢"})]})]})},se=({onTagClick:e,maxTags:s=20})=>{const[t,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[r,l]=(0,a.useState)(""),d=[{tag:"JavaScript",count:25,color:"#f7df1e"},{tag:"React",count:18,color:"#61dafb"},{tag:"ç®—æ³•",count:22,color:"#4ecdc4"},{tag:"LeetCode",count:20,color:"#ff6b6b"},{tag:"å‰ç«¯",count:15,color:"#667eea"},{tag:"é¢è¯•",count:12,color:"#f093fb"},{tag:"TypeScript",count:10,color:"#3178c6"},{tag:"Vue",count:8,color:"#41b883"},{tag:"CSS",count:6,color:"#264de4"},{tag:"Node.js",count:5,color:"#68a063"},{tag:"æ•°æ®åº“",count:7,color:"#ffa726"},{tag:"è®¡ç®—æœºç½‘ç»œ",count:4,color:"#26c6da"},{tag:"æ“ä½œç³»ç»Ÿ",count:3,color:"#ab47bc"},{tag:"æ•°æ®ç»“æž„",count:9,color:"#ec407a"},{tag:"Git",count:5,color:"#f4511e"}];(0,a.useEffect)(()=>{h()},[]);const h=async()=>{c(!0);try{const e=await Z.getPopularTags(s);if(e&&e.length>0){const s=e.map((e,s)=>({...e,color:u(s)}));n(s)}else n(d.slice(0,s))}catch(e){console.error("åŠ è½½çƒ­é—¨æ ‡ç­¾å¤±è´¥:",e),n(d.slice(0,s))}finally{c(!1)}},u=e=>{const s=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#f368e0","#ff9f43","#a55eea","#fd79a8","#e17055","#00b894","#00cec9","#0984e3","#6c5ce7","#b2bec3"];return s[e%s.length]},m=()=>{l(""),e("")};if(i)return(0,o.jsxs)("div",{className:"tag-cloud-loading",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("span",{children:"åŠ è½½æ ‡ç­¾ä¸­..."})]});const g=Math.max(...t.map(e=>e.count)),x=t.reduce((e,s)=>e+s.count,0);return(0,o.jsxs)("div",{className:"tag-cloud-container",children:[(0,o.jsx)("div",{className:"tag-cloud-header",children:(0,o.jsxs)("div",{className:"tag-cloud-stats",children:[(0,o.jsxs)("span",{className:"stats-text",children:[t.length," ä¸ªæ ‡ç­¾ â€¢ ",x," ä¸ªå¸–å­"]}),r&&(0,o.jsx)("button",{className:"clear-filter-btn",onClick:m,children:"æ¸…é™¤ç­›é€‰"})]})}),(0,o.jsx)("div",{className:"tag-cloud",children:t.map(({tag:s,count:t,color:a})=>{const n=((e,s)=>{const t=["xs","sm","md","lg","xl"],a=e/s;return a>.8?t[4]:a>.6?t[3]:a>.4?t[2]:a>.2?t[1]:t[0]})(t,g),i=s===r;return(0,o.jsxs)("span",{className:`tag ${n} ${i?"selected":""}`,style:{"--tag-color":a,"--tag-bg-color":i?a:`${a}20`,"--tag-border-color":i?a:`${a}40`},onClick:()=>(s=>{l(s===r?"":s),e(s===r?"":s)})(s),title:`${s} - ${t} ä¸ªå¸–å­`,children:[(0,o.jsx)("span",{className:"tag-text",children:s}),(0,o.jsx)("span",{className:"tag-count",children:t})]},s)})}),r&&(0,o.jsx)("div",{className:"selected-tag-info",children:(0,o.jsxs)("span",{className:"selected-tag-badge",children:[(0,o.jsxs)("span",{className:"selected-tag-text",children:["å·²é€‰æ‹©: ",r]}),(0,o.jsx)("button",{className:"remove-selection",onClick:m,children:"âœ•"})]})}),(0,o.jsx)("div",{className:"tag-cloud-footer",children:(0,o.jsxs)("div",{className:"tag-cloud-tips",children:[(0,o.jsx)("span",{className:"tip-icon",children:"ðŸ’¡"}),(0,o.jsx)("span",{className:"tip-text",children:"ç‚¹å‡»æ ‡ç­¾ç­›é€‰ç›¸å…³å¸–å­"})]})})]})},te=()=>{const[e,s]=(0,a.useState)({totalPosts:0,totalComments:0,totalLikes:0,activeUsers:0,todayPosts:0,trendingTags:[]}),[t,n]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null);(0,a.useEffect)(()=>{r();const e=setInterval(r,3e5);return()=>clearInterval(e)},[]);const r=async()=>{n(!0);try{const e=await new(u().Query)("Post").equalTo("status","published").count().catch(()=>0),t=await new(u().Query)("Comment").count().catch(()=>0),a=await new(u().Query)("Like").count().catch(()=>0),n=new Date;n.setHours(0,0,0,0);const i=await new(u().Query)("Post").greaterThanOrEqualTo("createdAt",n).count().catch(()=>0),r=new Date;r.setDate(r.getDate()-7);const l=await new(u().Query)("Post").greaterThanOrEqualTo("createdAt",r).distinct("author").count().catch(()=>0),o=new(u().Query)("Post"),d=await o.equalTo("status","published").limit(1e3).find().catch(()=>[]),h={};d.forEach(e=>{(e.get("tags")||[]).forEach(e=>{h[e]=(h[e]||0)+1})});const m=Object.entries(h).sort(([,e],[,s])=>s-e).slice(0,5).map(([e,s])=>({tag:e,count:s}));s({totalPosts:e,totalComments:t,totalLikes:a,activeUsers:l,todayPosts:i,trendingTags:m}),c(new Date)}catch(e){console.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",e),s({totalPosts:0,totalComments:0,totalLikes:0,activeUsers:0,todayPosts:0,trendingTags:[]})}finally{n(!1)}},l=e=>e>=1e4?(e/1e4).toFixed(1)+"ä¸‡":e>=1e3?(e/1e3).toFixed(1)+"åƒ":e.toString();return t?(0,o.jsxs)("div",{className:"community-stats",children:[(0,o.jsxs)("div",{className:"stats-header",children:[(0,o.jsx)("h4",{children:"ðŸ“Š ç¤¾åŒºç»Ÿè®¡"}),(0,o.jsx)("button",{className:"refresh-btn",onClick:r,children:"ðŸ”„"})]}),(0,o.jsxs)("div",{className:"stats-loading",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("span",{children:"åŠ è½½ç»Ÿè®¡ä¸­..."})]})]}):(0,o.jsxs)("div",{className:"community-stats",children:[(0,o.jsxs)("div",{className:"stats-header",children:[(0,o.jsx)("h4",{children:"ðŸ“Š ç¤¾åŒºç»Ÿè®¡"}),(0,o.jsxs)("div",{className:"header-actions",children:[i&&(0,o.jsxs)("span",{className:"update-time",children:["æ›´æ–°äºŽ ",i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),(0,o.jsx)("button",{className:"refresh-btn",onClick:r,title:"åˆ·æ–°æ•°æ®",children:"ðŸ”„"})]})]}),(0,o.jsxs)("div",{className:"stats-grid",children:[(0,o.jsxs)("div",{className:"stat-card primary",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:l(e.totalPosts)}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»å¸–å­"}),(0,o.jsxs)("div",{className:"stat-subtext",children:["+",e.todayPosts," ä»Šæ—¥"]})]})]}),(0,o.jsxs)("div",{className:"stat-card success",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ’¬"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:l(e.totalComments)}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»è¯„è®º"}),(0,o.jsx)("div",{className:"stat-subtext",children:"äº’åŠ¨æ´»è·ƒ"})]})]}),(0,o.jsxs)("div",{className:"stat-card warning",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ‘"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:l(e.totalLikes)}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»ç‚¹èµž"}),(0,o.jsx)("div",{className:"stat-subtext",children:"ç¤¾åŒºè®¤å¯"})]})]}),(0,o.jsxs)("div",{className:"stat-card info",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ‘¥"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:l(e.activeUsers)}),(0,o.jsx)("div",{className:"stat-label",children:"æ´»è·ƒç”¨æˆ·"}),(0,o.jsx)("div",{className:"stat-subtext",children:"æœ€è¿‘7å¤©"})]})]})]}),e.trendingTags.length>0&&(0,o.jsxs)("div",{className:"trending-tags",children:[(0,o.jsx)("h5",{children:"ðŸ”¥ çƒ­é—¨æ ‡ç­¾"}),(0,o.jsx)("div",{className:"tags-list",children:e.trendingTags.map(({tag:e,count:s},t)=>(0,o.jsxs)("div",{className:"trending-tag",children:[(0,o.jsxs)("span",{className:"tag-rank",children:["#",t+1]}),(0,o.jsx)("span",{className:"tag-name",children:e}),(0,o.jsx)("span",{className:"tag-count",children:s})]},e))})]}),(0,o.jsx)("div",{className:"community-health",children:(0,o.jsxs)("div",{className:"health-indicator",children:[(0,o.jsx)("div",{className:"health-label",children:"ç¤¾åŒºæ´»è·ƒåº¦"}),(0,o.jsx)("div",{className:"health-bar",children:(0,o.jsx)("div",{className:"health-fill",style:{width:`${Math.min(e.todayPosts/10*100,100)}%`,backgroundColor:e.todayPosts>=5?"#4ecdc4":e.todayPosts>=2?"#ffa726":"#ff6b6b"}})}),(0,o.jsx)("div",{className:"health-status",children:e.todayPosts>=5?"ðŸ”¥ éžå¸¸æ´»è·ƒ":e.todayPosts>=2?"ðŸ’ª æ´»è·ƒ":"ðŸ˜´ å®‰é™"})]})})]})},ae=e=>{if(!e)return"åˆšåˆš";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"åˆšåˆš":t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<7?`${n}å¤©å‰`:new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})},ne=({comment:e,onReply:s,onUpdate:t})=>{const[n,i]=(0,a.useState)(e.get("likes")||0),[c,r]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[g,x]=(0,a.useState)(e.get("content")||""),[j,p]=(0,a.useState)(!1),v=()=>{const s=u().User.current();return s&&e.get("author")?.id===s.id},N=()=>{s(e)};return(0,o.jsxs)("div",{className:"comment-item",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[(0,o.jsxs)("div",{className:"comment-header",children:[(0,o.jsxs)("div",{className:"comment-author",children:[(0,o.jsx)("img",{src:e.get("author")?.get("avatar")||"/default-avatar.png",alt:"ç”¨æˆ·å¤´åƒ",className:"comment-avatar"}),(0,o.jsxs)("div",{className:"author-info",children:[(0,o.jsx)("span",{className:"author-name",children:e.get("author")?.get("username")||"åŒ¿åç”¨æˆ·"}),v()&&(0,o.jsx)("span",{className:"author-badge",children:"ä½œè€…"}),(0,o.jsx)("span",{className:"comment-time",children:ae(e.get("createdAt"))})]})]}),l&&(0,o.jsxs)("div",{className:"comment-actions",children:[(0,o.jsx)("button",{className:"action-btn reply-btn",onClick:N,title:"å›žå¤",children:"â†©ï¸"}),v()&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"action-btn edit-btn",onClick:()=>{m(!0),x(e.get("content")||"")},title:"ç¼–è¾‘",children:"âœï¸"}),(0,o.jsx)("button",{className:"action-btn delete-btn",onClick:async()=>{if(window.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{t()}catch(e){console.error("åˆ é™¤è¯„è®ºå¤±è´¥:",e),alert("åˆ é™¤è¯„è®ºå¤±è´¥: "+e.message)}},title:"åˆ é™¤",children:"ðŸ—‘ï¸"})]})]})]}),(0,o.jsx)("div",{className:"comment-content",children:h?(0,o.jsxs)("div",{className:"edit-comment",children:[(0,o.jsx)("textarea",{value:g,onChange:e=>x(e.target.value),rows:"3",className:"edit-textarea",maxLength:"1000"}),(0,o.jsxs)("div",{className:"edit-actions",children:[(0,o.jsx)("button",{onClick:()=>{m(!1),x(e.get("content")||"")},className:"cancel-edit-btn",disabled:j,children:"å–æ¶ˆ"}),(0,o.jsx)("button",{onClick:async()=>{if(g.trim()){p(!0);try{m(!1),t()}catch(e){console.error("æ›´æ–°è¯„è®ºå¤±è´¥:",e),alert("æ›´æ–°è¯„è®ºå¤±è´¥: "+e.message)}finally{p(!1)}}},className:"save-edit-btn",disabled:!g.trim()||j,children:j?"ä¿å­˜ä¸­...":"ä¿å­˜"})]})]}):(0,o.jsx)("div",{className:"comment-text",dangerouslySetInnerHTML:{__html:(e.get("content")||"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}})}),(0,o.jsxs)("div",{className:"comment-footer",children:[(0,o.jsxs)("button",{className:"like-btn "+(c?"liked":""),onClick:async()=>{try{const s=await Z.toggleLike(e.id,"comment");i(s.liked?n+1:Math.max(0,n-1)),r(s.liked)}catch(e){console.error("ç‚¹èµžè¯„è®ºå¤±è´¥:",e)}},children:[(0,o.jsx)("span",{className:"like-icon",children:"ðŸ‘"}),(0,o.jsx)("span",{className:"like-count",children:n})]}),(0,o.jsx)("button",{className:"reply-footer-btn",onClick:N,children:"å›žå¤"})]}),e.get("parent")&&(0,o.jsxs)("div",{className:"reply-indicator",children:["å›žå¤ ",(0,o.jsxs)("span",{className:"reply-to",children:["@",e.get("parent")?.get("author")?.get("username")||"ç”¨æˆ·"]})]})]})},ie=({postId:e})=>{const[s,t]=(0,a.useState)([]),[n,i]=(0,a.useState)(""),[c,r]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[h,m]=(0,a.useState)("newest"),[g,x]=(0,a.useState)(null),j=(0,a.useRef)(null);(0,a.useEffect)(()=>{p()},[e,h]);const p=async()=>{r(!0);try{const s=[...await Z.getComments(e)].sort((e,s)=>{switch(h){case"oldest":return new Date(e.get("createdAt"))-new Date(s.get("createdAt"));case"popular":return(s.get("likes")||0)-(e.get("likes")||0);default:return new Date(s.get("createdAt"))-new Date(e.get("createdAt"))}});t(s)}catch(e){console.error("åŠ è½½è¯„è®ºå¤±è´¥:",e)}finally{r(!1)}},v=async()=>{if(n.trim())if(u().User.current()){d(!0);try{let s=null;g&&(s=g.id),await Z.addComment(e,n,s),i(""),x(null),await p(),y("è¯„è®ºå‘å¸ƒæˆåŠŸï¼")}catch(e){console.error("å‘å¸ƒè¯„è®ºå¤±è´¥:",e),alert("å‘å¸ƒè¯„è®ºå¤±è´¥: "+e.message)}finally{d(!1)}}else alert("è¯·å…ˆç™»å½•åŽå†è¯„è®º")},N=e=>{x(e),i(`@${e.get("author")?.get("username")||"ç”¨æˆ·"} `),j.current?.focus()},y=e=>{console.log(e)};return(0,o.jsxs)("div",{className:"comment-section",children:[(0,o.jsxs)("div",{className:"comment-header",children:[(0,o.jsxs)("h4",{className:"comment-title",children:["ðŸ’¬ ",(()=>{const e=s.length;return 0===e?"æš‚æ— è¯„è®º":1===e?"1 æ¡è¯„è®º":`${e} æ¡è¯„è®º`})()]}),(0,o.jsxs)("div",{className:"comment-controls",children:[(0,o.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"sort-select",children:[(0,o.jsx)("option",{value:"newest",children:"æœ€æ–°"}),(0,o.jsx)("option",{value:"oldest",children:"æœ€æ—©"}),(0,o.jsx)("option",{value:"popular",children:"æœ€çƒ­"})]}),(0,o.jsx)("button",{className:"refresh-comments",onClick:p,disabled:c,children:"ðŸ”„"})]})]}),(0,o.jsxs)("div",{className:"comment-input-section",children:[g&&(0,o.jsxs)("div",{className:"reply-indicator",children:[(0,o.jsxs)("span",{children:["å›žå¤ @",g.get("author")?.get("username")||"ç”¨æˆ·"]}),(0,o.jsx)("button",{onClick:()=>{x(null),i("")},children:"å–æ¶ˆ"})]}),(0,o.jsxs)("div",{className:"comment-input-wrapper",children:[(0,o.jsx)("textarea",{ref:j,value:n,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&v()},placeholder:g?"å†™ä¸‹ä½ çš„å›žå¤...":"å†™ä¸‹ä½ çš„è¯„è®º...",rows:"3",className:"comment-textarea",maxLength:"1000"}),(0,o.jsxs)("div",{className:"comment-input-footer",children:[(0,o.jsxs)("div",{className:"char-count",children:[n.length,"/1000"]}),(0,o.jsx)("button",{onClick:v,disabled:!n.trim()||l,className:"submit-comment-btn",children:l?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"submit-spinner"}),"å‘å¸ƒä¸­..."]}):"å‘å¸ƒè¯„è®º"})]})]}),(0,o.jsxs)("div",{className:"comment-tips",children:[(0,o.jsx)("span",{className:"tip",children:"ðŸ’¡ æ”¯æŒ Markdown è¯­æ³•"}),(0,o.jsx)("span",{className:"tip",children:"âŽ + Ctrl å¿«é€Ÿå‘å¸ƒ"})]})]}),(0,o.jsx)("div",{className:"comments-list",children:c?(0,o.jsxs)("div",{className:"comments-loading",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("span",{children:"åŠ è½½è¯„è®ºä¸­..."})]}):0===s.length?(0,o.jsxs)("div",{className:"no-comments",children:[(0,o.jsx)("div",{className:"no-comments-icon",children:"ðŸ’¬"}),(0,o.jsx)("h5",{children:"è¿˜æ²¡æœ‰è¯„è®º"}),(0,o.jsx)("p",{children:"æˆä¸ºç¬¬ä¸€ä¸ªè¯„è®ºçš„äººå§ï¼"})]}):s.map(e=>(0,o.jsx)(ne,{comment:e,onReply:N,onUpdate:p},e.id))})]})},ce=e=>{if(!e)return"åˆšåˆš";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"åˆšåˆš":t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<7?`${n}å¤©å‰`:new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},re=({post:e})=>{const[s,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(e.get("likes")||0),[c,r]=(0,a.useState)(!1),[l,d]=(0,a.useState)(e.get("views")||0),h=e=>{const s=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43"];return s[e%s.length]};return(0,o.jsxs)("div",{className:"post-card",children:[(0,o.jsxs)("div",{className:"post-header",children:[(0,o.jsxs)("div",{className:"author-section",children:[(0,o.jsx)("img",{src:e.get("author")?.get("avatar")||"/default-avatar.png",alt:"ç”¨æˆ·å¤´åƒ",className:"author-avatar",style:{width:"40px",height:"40px"}}),(0,o.jsxs)("div",{className:"author-info",children:[(0,o.jsx)("div",{className:"author-name",children:e.get("author")?.get("username")||"åŒ¿åç”¨æˆ·"}),(0,o.jsxs)("div",{className:"post-meta",children:[(0,o.jsx)("span",{className:"post-time",children:ce(e.get("createdAt"))}),e.get("isPinned")&&(0,o.jsx)("span",{className:"pinned-badge",children:"ðŸ“Œ ç½®é¡¶"})]})]})]}),(0,o.jsx)("div",{className:"post-status",children:e.get("difficulty")&&(0,o.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(()=>{switch(e.get("difficulty")||"medium"){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}})()},children:"easy"===e.get("difficulty")?"ç®€å•":"medium"===e.get("difficulty")?"ä¸­ç­‰":"å›°éš¾"})})]}),(0,o.jsxs)("div",{className:"post-content",children:[(0,o.jsx)("h3",{className:"post-title",children:e.get("title")}),(0,o.jsx)("div",{className:"post-body",dangerouslySetInnerHTML:{__html:(e.get("content")||"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}}),(e.get("content")||"").length>150&&!s&&(0,o.jsx)("button",{className:"read-more-btn",onClick:()=>t(!0),children:"é˜…è¯»å…¨æ–‡"})]}),e.get("tags")&&e.get("tags").length>0&&(0,o.jsx)("div",{className:"post-tags",children:e.get("tags").map((e,s)=>(0,o.jsxs)("span",{className:"post-tag",style:{backgroundColor:h(s)+"20",color:h(s),borderColor:h(s)+"40"},children:["#",e]},e))}),(0,o.jsxs)("div",{className:"post-footer",children:[(0,o.jsxs)("div",{className:"post-stats",children:[(0,o.jsxs)("button",{className:"stat-btn like-btn "+(c?"liked":""),onClick:async()=>{try{const s=await Z.toggleLike(e.id);i(s.liked?n+1:Math.max(0,n-1)),r(s.liked)}catch(e){console.error("ç‚¹èµžå¤±è´¥:",e)}},children:[(0,o.jsx)("span",{className:"stat-icon",children:"ðŸ‘"}),(0,o.jsx)("span",{className:"stat-count",children:n})]}),(0,o.jsxs)("button",{className:"stat-btn comment-btn "+(s?"active":""),onClick:()=>{t(!s),s||d(e=>e+1)},children:[(0,o.jsx)("span",{className:"stat-icon",children:"ðŸ’¬"}),(0,o.jsx)("span",{className:"stat-count",children:e.get("commentCount")||0})]}),(0,o.jsxs)("div",{className:"stat-btn view-btn",children:[(0,o.jsx)("span",{className:"stat-icon",children:"ðŸ‘ï¸"}),(0,o.jsx)("span",{className:"stat-count",children:l})]})]}),(0,o.jsxs)("div",{className:"post-actions",children:[(0,o.jsx)("button",{className:"action-btn share-btn",children:"ðŸ”— åˆ†äº«"}),(0,o.jsx)("button",{className:"action-btn bookmark-btn",children:"ðŸ“Œ æ”¶è—"})]})]}),s&&(0,o.jsx)(ie,{postId:e.id})]})},le=()=>{const[e,s]=(0,a.useState)("latest"),[t,n]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[r,l]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)(""),[g,x]=(0,a.useState)({page:1,pageSize:20,hasMore:!0});(0,a.useEffect)(()=>{j(!0)},[e]),(0,a.useEffect)(()=>{if(""===u.trim())n(i);else{const e=i.filter(e=>e.get("title")?.toLowerCase().includes(u.toLowerCase()));n(e)}},[u,i]);const j=async(s=!1)=>{if(!r){l(!0);try{const t=s?1:g.page,a={page:t,pageSize:g.pageSize,sortBy:"latest"===e?"createdAt":"likes",sortOrder:"desc"},r=await Z.getPosts(a);if(s)c(r),n(r);else{const e=[...i,...r];if(c(e),""===u.trim())n(e);else{const s=e.filter(e=>e.get("title")?.toLowerCase().includes(u.toLowerCase()));n(s)}}x(e=>({...e,page:t,hasMore:r.length===g.pageSize}))}catch(e){console.error("åŠ è½½å¸–å­å¤±è´¥:",e)}finally{l(!1)}}},p=e=>{m(e)};return(0,o.jsx)("section",{className:"community-section",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsx)("div",{className:"community-header",children:(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsxs)("div",{className:"header-text",children:[(0,o.jsx)("h2",{children:"å­¦ä¹ ç¤¾åŒº"}),(0,o.jsx)("p",{children:"ä¸Žå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«åˆ·é¢˜ç»éªŒ"})]}),(0,o.jsxs)("button",{className:"create-post-btn modern-btn primary",onClick:()=>h(!0),children:[(0,o.jsx)("span",{className:"btn-icon",children:"âœï¸"}),"å‘å¸ƒå¸–å­"]})]})}),(0,o.jsxs)("div",{className:"community-toolbar",children:[(0,o.jsx)("div",{className:"toolbar-left",children:(0,o.jsx)(ee,{onSearch:p,placeholder:"æœç´¢å¸–å­æ ‡é¢˜..."})}),(0,o.jsx)("div",{className:"toolbar-right",children:(0,o.jsx)(te,{})})]}),u&&(0,o.jsx)("div",{className:"search-results-info",children:(0,o.jsxs)("div",{className:"results-stats",children:[(()=>{if(""===u.trim())return`å…± ${i.length} ä¸ªå¸–å­`;{const e=i.filter(e=>e.get("title")?.toLowerCase().includes(u.toLowerCase())).length;return`æ‰¾åˆ° ${t.length} ä¸ªåŒ¹é…æ ‡é¢˜çš„å¸–å­ï¼ˆå…± ${e} ä¸ªï¼‰`}})(),u&&(0,o.jsxs)("span",{className:"search-keyword",children:["æœç´¢å…³é”®è¯: ",(0,o.jsxs)("strong",{children:['"',u,'"']})]})]})}),(0,o.jsxs)("div",{className:"community-layout",children:[(0,o.jsxs)("aside",{className:"community-sidebar",children:[(0,o.jsxs)("div",{className:"sidebar-section",children:[(0,o.jsx)("h3",{children:"çƒ­é—¨æ ‡ç­¾"}),(0,o.jsx)(se,{onTagClick:e=>p(e)})]}),(0,o.jsxs)("div",{className:"sidebar-section",children:[(0,o.jsx)("h3",{children:"ç¤¾åŒºæŒ‡å—"}),(0,o.jsxs)("div",{className:"community-guidelines",children:[(0,o.jsx)("p",{children:"ðŸ’¡ åˆ†äº«å­¦ä¹ å¿ƒå¾—"}),(0,o.jsx)("p",{children:"ðŸ¤ äº’ç›¸å¸®åŠ©è§£ç­”"}),(0,o.jsx)("p",{children:"ðŸŽ¯ ä¿æŒå†…å®¹ç›¸å…³"}),(0,o.jsx)("p",{children:"ðŸ‘ å°Šé‡ä»–äººè§‚ç‚¹"})]})]})]}),(0,o.jsxs)("main",{className:"community-main",children:[(0,o.jsxs)("div",{className:"community-tabs",children:[(0,o.jsxs)("button",{className:"modern-tab "+("latest"===e?"active":""),onClick:()=>s("latest"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ†•"}),(0,o.jsx)("span",{className:"tab-text",children:"æœ€æ–°å¸–å­"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("popular"===e?"active":""),onClick:()=>s("popular"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ”¥"}),(0,o.jsx)("span",{className:"tab-text",children:"çƒ­é—¨å†…å®¹"})]})]}),(0,o.jsxs)("div",{className:"post-list",children:[r&&(0,o.jsxs)("div",{className:"loading",children:[(0,o.jsx)("div",{className:"spinner"}),(0,o.jsx)("span",{children:"åŠ è½½ä¸­..."})]}),t.map(e=>(0,o.jsx)(re,{post:e},e.id)),!r&&0===t.length&&(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:u?"ðŸ”":"ðŸ’¬"}),(0,o.jsx)("h3",{children:u?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¸–å­":"æš‚æ— å¸–å­"}),(0,o.jsx)("p",{children:u?`æ²¡æœ‰æ ‡é¢˜åŒ…å« "${u}" çš„å¸–å­ï¼Œå°è¯•è°ƒæ•´æœç´¢å…³é”®è¯`:"æˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«å­¦ä¹ å¿ƒå¾—çš„äººå§ï¼"}),u&&(0,o.jsx)("button",{onClick:()=>p(""),className:"clear-search-btn",children:"æ˜¾ç¤ºæ‰€æœ‰å¸–å­"})]})]}),g.hasMore&&t.length>0&&""===u&&(0,o.jsx)("div",{className:"load-more-section",children:(0,o.jsx)("button",{onClick:()=>{!r&&g.hasMore&&j(!1)},disabled:r,className:"load-more-btn",children:r?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤š"})})]})]}),d&&(0,o.jsx)(X,{onClose:()=>h(!1),onSuccess:e=>{c(s=>[e,...s]),(""===u.trim()||e.get("title")?.toLowerCase().includes(u.toLowerCase()))&&n(s=>[e,...s]),h(!1)}})]})})},oe=new c.E({defaultOptions:{queries:{staleTime:3e5,cacheTime:6e5,retry:1}}}),de=()=>{const e=(0,i.Zp)(),[s,t]=(0,a.useState)(""),[n,c]=(0,a.useState)([]),[l,h]=(0,a.useState)([]),[j,p]=(0,a.useState)(!0),[v,w]=(0,a.useState)(null),[b,f]=(0,a.useState)(!1),[C,k]=(0,a.useState)(""),[S,A]=(0,a.useState)("categories"),[q,D]=(0,a.useState)(new Date),[E,P]=(0,a.useState)(!1),[L,J]=(0,a.useState)(""),[G,H]=(0,a.useState)(""),[Z,X]=(0,a.useState)(!1),[ee,se]=(0,a.useState)(!1),[te,ae]=(0,a.useState)(null),[ne,ie]=(0,a.useState)(!1),[ce,re]=(0,a.useState)(7),[de,he]=(0,a.useState)([]),[ue,me]=(0,a.useState)(!1),[ge,xe]=(0,a.useState)(null),[je,pe]=(0,a.useState)(null),[ve,Ne]=(0,a.useState)({x:0,y:0}),[ye,we]=(0,a.useState)(!1),be=(0,a.useRef)(null),fe=(0,a.useCallback)(async()=>{console.log("ðŸ”„ æ‰‹åŠ¨åˆ·æ–°æ•°æ®..."),k("åˆ·æ–°æ•°æ®ä¸­...");try{clearAllCache(),clearCategoryCache(),await Se(),k("æ•°æ®åˆ·æ–°æˆåŠŸï¼"),setTimeout(()=>k(""),3e3)}catch(e){console.error("åˆ·æ–°æ•°æ®å¤±è´¥:",e),k("åˆ·æ–°å¤±è´¥: "+e.message),setTimeout(()=>k(""),5e3)}},[]);(0,a.useEffect)(()=>{const e=()=>{console.log("ðŸ“ æ£€æµ‹åˆ°é¢˜ç›®åˆ›å»ºï¼Œè‡ªåŠ¨åˆ·æ–°æ•°æ®..."),setTimeout(()=>{fe()},1e3)};return window.addEventListener("questionCreated",e),()=>{window.removeEventListener("questionCreated",e)}},[fe]),(0,a.useEffect)(()=>{const e=u().User.current();xe(e),e?Se():p(!1)},[]);const Ce=(0,a.useCallback)((e,s)=>{s.stopPropagation(),ae(e),se(!0)},[]),ke=(0,a.useCallback)(()=>{se(!1),ae(null)},[]);(0,a.useEffect)(()=>{l.length>0&&(()=>{const e=new Date,s=24*ce*60*60*1e3,t=l.filter(t=>{const a=new Date(t.lastReviewedAt||t.createdAt);return e-a>=s}).sort((e,s)=>new Date(e.lastReviewedAt||e.createdAt)-new Date(s.lastReviewedAt||s.createdAt));he(t)})()},[l,ce]);const Se=async()=>{try{m(),console.log("ðŸ”„ å¼€å§‹åŠ è½½æ•°æ®...");const[e,s]=await Promise.all([N({page:1,pageSize:50,sortBy:g.SORT_BY_UPDATED_AT,sortOrder:"desc"}),T(!1)]);console.log("âœ… æ•°æ®åŠ è½½å®Œæˆ:",{åˆ†ç±»æ•°æ®:e.data.length,é¢˜ç›®æ•°æ®:s.length,é¢˜ç›®è¯¦æƒ…:s.slice(0,5).map(e=>({id:e.id,title:e.title}))}),console.log(e),c(e.data),h(s),p(!1)}catch(e){console.error("âŒ åˆå§‹åŒ–æ•°æ®å¤±è´¥:",e),w(e.message),p(!1)}},Ae=(0,a.useMemo)(()=>n.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())),[n,s]),qe=(0,a.useMemo)(()=>{if(!n.length)return{totalCategories:0,totalQuestions:0,categoriesWithQuestions:0};const e=n.reduce((e,s)=>e+(s.questionCount||0),0),s=n.filter(e=>(e.questionCount||0)>0).length;return console.log("ðŸ” è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯:",{åˆ†ç±»æ€»æ•°:n.length,åŸºäºŽåˆ†ç±»çš„é¢˜ç›®æ€»æ•°:e,åŸºäºŽæ‰€æœ‰é¢˜ç›®çš„é¢˜ç›®æ€»æ•°:l.length,å·®å¼‚:Math.abs(e-l.length),æœ‰é¢˜ç›®çš„åˆ†ç±»æ•°:s,å¯¹è±¡:l,å„åˆ†ç±»è¯¦æƒ…:n.map(e=>({åˆ†ç±»åç§°:e.name,æœåŠ¡å±‚é¢˜ç›®æ•°:e.questionCount,å‰ç«¯è®¡ç®—é¢˜ç›®æ•°:l.filter(s=>s.category?.id===e.id).length,æ˜¯å¦åŒ¹é…:e.questionCount===l.filter(s=>s.category?.id===e.id).length}))}),{totalCategories:n.length,totalQuestions:e,categoriesWithQuestions:s}},[n,l]),De=(0,a.useCallback)(e=>{const s=e.toISOString().split("T")[0];return l.filter(e=>new Date(e.createdAt).toISOString().split("T")[0]===s).sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))},[l]),Ee=(0,a.useCallback)(e=>0===e?"#f8f9fa":e<=1?"#4CAF50":e<=3?"#8BC34A":e<=5?"#FFC107":e<=8?"#FF9800":"#F44336",[]),Pe=(0,a.useCallback)(()=>{const e=new Date(q.getFullYear(),q.getMonth(),1),s=new Date(q.getFullYear(),q.getMonth()+1,0),t={};l.forEach(a=>{const n=new Date(a.createdAt);if(n>=e&&n<=s){const e=n.toISOString().split("T")[0];t[e]=(t[e]||0)+1}});const a=[],n=new Date(e);for(;n<=s;){const e=n.toISOString().split("T")[0],s=De(n),t=s.length;a.push({date:new Date(n),count:t,day:n.getDate(),isToday:e===(new Date).toISOString().split("T")[0],questions:s,color:Ee(t)}),n.setDate(n.getDate()+1)}return a},[q,l,De,Ee]),Te=(0,a.useCallback)((e,s)=>{if(pe(e),we(!0),be.current){const e=be.current.getBoundingClientRect(),t=s.currentTarget.getBoundingClientRect();Ne({x:t.left+t.width/2-e.left,y:t.top-e.top-10})}we(!0)},[]),$e=(0,a.useCallback)(()=>{setTimeout(()=>{document.querySelector(".calendar-tooltip:hover")||we(!1)},100)},[]),Le=(0,a.useCallback)(()=>{we(!1),pe(null)},[]),Ie=(0,a.useCallback)(e=>{const s=new Date(q);"prev"===e?s.setMonth(s.getMonth()-1):s.setMonth(s.getMonth()+1),D(s)},[q]),Qe=(0,a.useCallback)(()=>{const e=Pe();return{daysWithQuestions:e.filter(e=>e.count>0).length,totalQuestions:e.reduce((e,s)=>e+s.count,0),maxDaily:Math.max(...e.map(e=>e.count))}},[Pe]),Re=(0,a.useCallback)(()=>{const e={};return l.forEach(s=>{const t=s.category?.name||"æœªåˆ†ç±»";e[t]=(e[t]||0)+1}),Object.entries(e).map(([e,s])=>({name:e.length>8?e.substring(0,8)+"...":e,fullName:e,value:s,percentage:(s/l.length*100).toFixed(1)})).sort((e,s)=>s.value-e.value)},[l]),Ue=(0,a.useCallback)(()=>{const e={};return l.forEach(s=>{const t=s.difficulty||"unknown";e[t]=(e[t]||0)+1}),Object.entries(e).map(([e,s])=>({name:Me(e),value:s,color:Oe(e)}))},[l]),Oe=(0,a.useCallback)(e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}},[]),Me=(0,a.useCallback)(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return"æœªçŸ¥"}},[]),Fe=(0,a.useCallback)(()=>new Set(l.map(e=>new Date(e.createdAt).toDateString())).size,[l]),_e=(0,a.useCallback)(s=>{e(`/category/${s}`)},[e]),Be=(0,a.useCallback)(s=>{const t=l.find(e=>e.id===s);t&&t.category&&e(`/category/${t.category.id}`)},[l,e]),We=(0,a.useCallback)(e=>{if(!e)return"æš‚æ— ";const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<60?`${t}åˆ†é’Ÿå‰`:a<24?`${a}å°æ—¶å‰`:n<30?`${n}å¤©å‰`:new Date(e).toLocaleDateString()},[]),ze=(0,a.useCallback)(e=>{if(!n.length)return 0;const s=Math.max(...n.map(e=>e.questionCount||0));return s>0?e/s*100:0},[n]),Ve=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43"],Je=(0,a.useMemo)(()=>Re(),[Re]),Ge=(0,a.useMemo)(()=>Ue(),[Ue]),He=(0,a.useMemo)(()=>Pe(),[Pe]),Ke=(0,a.useMemo)(()=>Fe(),[Fe]),Ye=(0,a.useMemo)(()=>Qe(),[Qe]),Ze=(0,a.useMemo)(()=>q.toLocaleDateString("zh-CN",{year:"numeric",month:"long"}),[q]);return ge?j?(0,o.jsx)("div",{className:"homepage",children:(0,o.jsxs)("div",{className:"loading-container",children:[(0,o.jsx)("div",{className:"modern-spinner"}),(0,o.jsx)("p",{children:"åŠ è½½çŸ¥è¯†åº“ä¸­..."})]})}):v?(0,o.jsx)("div",{className:"homepage",children:(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,o.jsx)("p",{children:v}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"é‡è¯•"})]})}):(0,o.jsx)(r.Ht,{client:oe,children:(0,o.jsxs)("div",{className:"homepage",children:[(0,o.jsx)("header",{className:"hero-section",children:(0,o.jsxs)("div",{className:"hero-content",children:[(0,o.jsxs)("div",{className:"user-welcome",children:[(0,o.jsx)("h1",{className:"hero-title",children:"æˆ‘çš„çŸ¥è¯†é¢˜åº“"}),(0,o.jsxs)("p",{className:"hero-subtitle",children:["æ¬¢è¿Žå›žæ¥, ",ge.getUsername(),"ï¼æŒ‰ç±»åˆ«ç®¡ç†æ‚¨çš„å­¦ä¹ å†…å®¹"]})]}),(0,o.jsx)("div",{className:"search-container",children:(0,o.jsxs)("div",{className:"search-box",children:[(0,o.jsx)("span",{className:"search-icon",children:"ðŸ”"}),(0,o.jsx)("input",{type:"text",placeholder:"æœç´¢ç±»åˆ«...",value:s,onChange:e=>t(e.target.value),className:"search-input"})]})})]})}),(0,o.jsx)("section",{className:"modern-tabs-section",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsxs)("div",{className:"modern-tabs",children:[(0,o.jsxs)("button",{className:"modern-tab "+("categories"===S?"active":""),onClick:()=>A("categories"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ“š"}),(0,o.jsx)("span",{className:"tab-text",children:"åˆ†ç±»æµè§ˆ"}),"categories"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("review"===S?"active":""),onClick:()=>A("review"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ”„"}),(0,o.jsxs)("span",{className:"tab-text",children:["å¤ä¹ æé†’",de.length>0&&(0,o.jsx)("span",{className:"tab-badge",children:de.length})]}),"review"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("stats"===S?"active":""),onClick:()=>A("stats"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"tab-text",children:"æ•°æ®ç»Ÿè®¡"}),"stats"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("calendar"===S?"active":""),onClick:()=>A("calendar"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ—“ï¸"}),(0,o.jsx)("span",{className:"tab-text",children:"å­¦ä¹ æ—¥åŽ†"}),"calendar"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("documents"===S?"active":""),onClick:()=>A("documents"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ“–"}),(0,o.jsx)("span",{className:"tab-text",children:"å¼€å‘æ–‡æ¡£"}),"documents"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]}),(0,o.jsxs)("button",{className:"modern-tab "+("community"===S?"active":""),onClick:()=>A("community"),children:[(0,o.jsx)("span",{className:"tab-icon",children:"ðŸ‘¥"}),(0,o.jsx)("span",{className:"tab-text",children:"å­¦ä¹ ç¤¾åŒº"}),"community"===S&&(0,o.jsx)("div",{className:"tab-indicator"})]})]})})}),"categories"===S&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("section",{className:"filters-section",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsxs)("div",{className:"filters",children:[(0,o.jsxs)("div",{className:"stats",children:["æ‰¾åˆ° ",Ae.length," ä¸ªç±»åˆ«",n.length>0&&` â€¢ æ€»è®¡ ${l.length} é“é¢˜ç›®`]}),(0,o.jsxs)("button",{className:"add-category-btn",onClick:()=>P(!0),children:[(0,o.jsx)("span",{className:"btn-icon",children:"+"}),"æ–°å»ºåˆ†ç±»"]})]})})}),E&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"åˆ›å»ºæ–°åˆ†ç±»"}),(0,o.jsx)("button",{className:"close-btn",onClick:()=>P(!1),children:"Ã—"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),ge)if(L.trim()){X(!0);try{const e=await y({name:L.trim(),description:G.trim()||void 0});c(s=>[e,...s]),J(""),H(""),P(!1),k(`åˆ†ç±» "${e.name}" åˆ›å»ºæˆåŠŸï¼`),setTimeout(()=>k(""),3e3)}catch(e){console.error("åˆ›å»ºåˆ†ç±»å¤±è´¥:",e),k("åˆ›å»ºåˆ†ç±»å¤±è´¥: "+(e.message||"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"))}finally{X(!1)}}else alert("è¯·è¾“å…¥åˆ†ç±»åç§°");else alert("è¯·å…ˆç™»å½•")},className:"category-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"categoryName",children:"åˆ†ç±»åç§° *"}),(0,o.jsx)("input",{id:"categoryName",type:"text",value:L,onChange:e=>J(e.target.value),placeholder:"è¯·è¾“å…¥åˆ†ç±»åç§°",maxLength:50,autoFocus:!0,style:{color:"black"}})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"categoryDescription",children:"åˆ†ç±»æè¿°"}),(0,o.jsx)("textarea",{id:"categoryDescription",value:G,onChange:e=>H(e.target.value),placeholder:"è¯·è¾“å…¥åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰",rows:"3",maxLength:200,style:{color:"black"}})]}),(0,o.jsxs)("div",{className:"form-actions",children:[(0,o.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>P(!1),children:"å–æ¶ˆ"}),(0,o.jsx)("button",{type:"submit",className:"submit-btn",disabled:Z||!L.trim(),children:Z?"åˆ›å»ºä¸­...":"åˆ›å»ºåˆ†ç±»"})]})]})]})}),ee&&te&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content delete-confirm-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"ç¡®è®¤åˆ é™¤"}),(0,o.jsx)("button",{className:"close-btn",onClick:ke,children:"Ã—"})]}),(0,o.jsxs)("div",{className:"delete-content",children:[(0,o.jsx)("div",{className:"delete-icon",children:"ðŸ—‘ï¸"}),(0,o.jsxs)("div",{className:"delete-message",children:[(0,o.jsxs)("p",{children:["ç¡®å®šè¦åˆ é™¤åˆ†ç±»"," ",(0,o.jsxs)("strong",{children:['"',te.name,'"']})," å—ï¼Ÿ"]}),te.questionCount>0&&(0,o.jsxs)("p",{className:"warning-text",children:["âš ï¸ æ­¤åˆ†ç±»åŒ…å« ",te.questionCount," ","é“é¢˜ç›®ï¼Œåˆ é™¤åŽè¿™äº›é¢˜ç›®å°†å˜ä¸ºæœªåˆ†ç±»çŠ¶æ€ï¼"]}),(0,o.jsx)("p",{className:"delete-hint",children:"æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…Žæ“ä½œã€‚"})]}),(0,o.jsxs)("div",{className:"delete-actions",children:[(0,o.jsx)("button",{className:"cancel-delete-btn",onClick:ke,disabled:ne,children:"å–æ¶ˆ"}),(0,o.jsx)("button",{className:"confirm-delete-btn",onClick:async()=>{if(te){ie(!0);try{await(async e=>{try{const s=u().Object.createWithoutData("Category",e),t=new(u().Query)("Question");t.equalTo("category",s);const a=await t.find();let n=0;return a.length>0&&(await u().Object.destroyAll(a),n=a.length),await s.destroy(),(e=>{e&&(x.categoryDetails.delete(e),x.questionCounts.delete(e)),x.categories.data=null,x.categories.timestamp=0})(e),{success:!0,message:`ç±»åˆ«åŠå…³è”çš„ ${n} ä¸ªé¢˜ç›®å·²åˆ é™¤`,deletedQuestions:n}}catch(e){throw console.error("åˆ é™¤ç±»åˆ«å¤±è´¥:",e),new Error(`åˆ é™¤å¤±è´¥: ${e.message}`)}})(te.id),c(e=>e.filter(e=>e.id!==te.id)),se(!1),ae(null),k(`åˆ†ç±» "${te.name}" åˆ é™¤æˆåŠŸï¼`),setTimeout(()=>k(""),3e3)}catch(e){console.error("åˆ é™¤åˆ†ç±»å¤±è´¥:",e),k("åˆ é™¤åˆ†ç±»å¤±è´¥: "+(e.message||"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"))}finally{ie(!1)}}},disabled:ne,children:ne?"åˆ é™¤ä¸­...":"ç¡®è®¤åˆ é™¤"})]})]})]})}),(0,o.jsx)("section",{className:"categories-section",children:(0,o.jsx)("div",{className:"container",children:0===Ae.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"ðŸ“š"}),(0,o.jsx)("h3",{children:"æš‚æ— ç±»åˆ«æ•°æ®"}),(0,o.jsx)("p",{children:"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç±»åˆ«ï¼Œå°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–åˆ›å»ºæ–°åˆ†ç±»"}),(0,o.jsx)("button",{className:"create-first-category-btn",onClick:()=>P(!0),children:"+ åˆ›å»ºç¬¬ä¸€ä¸ªåˆ†ç±»"})]}):(0,o.jsx)("div",{className:"categories-grid",children:Ae.map((e,s)=>{const t=Ve[s%Ve.length],a=l.filter(s=>s.category?.id===e.id).length,n=a>0?a:e.questionCount||0;return(0,o.jsxs)("div",{className:"category-card",onClick:()=>_e(e.id),style:{"--accent-color":t},children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)("div",{className:"category-icon",style:{backgroundColor:t},children:e.name.charAt(0)}),(0,o.jsxs)("div",{className:"category-info",children:[(0,o.jsx)("h3",{className:"category-name",children:e.name}),e.description&&(0,o.jsx)("p",{className:"category-description",children:e.description}),(0,o.jsxs)("span",{className:"question-count",children:[n,"é¢˜"]})]}),(0,o.jsx)("button",{className:"delete-category-btn",onClick:s=>Ce(e,s),title:"åˆ é™¤åˆ†ç±»",children:"Ã—"})]}),(0,o.jsxs)("div",{className:"card-footer",children:[(0,o.jsxs)("div",{className:"progress-info",children:[(0,o.jsx)("div",{className:"progress-stats",children:(0,o.jsxs)("span",{children:["æœ€è¿‘æ›´æ–°: ",We(e.updatedAt)]})}),(0,o.jsx)("div",{className:"progress-bar",children:(0,o.jsx)("div",{className:"progress-fill",style:{width:`${ze(e.questionCount)}%`,backgroundColor:t}})})]}),(0,o.jsx)("button",{className:"explore-btn",children:"æŸ¥çœ‹é¢˜ç›® â†’"})]})]},e.id)})})})})]}),"review"===S&&(0,o.jsx)(V,{reviewQuestions:de,setReviewQuestions:he,reviewThreshold:ce,setReviewThreshold:re,showReviewSettings:ue,setShowReviewSettings:me,onQuestionClick:Be,onUpdateQuestionTime:async e=>{try{if(console.log("æ›´æ–°é¢˜ç›®å¤ä¹ æ—¶é—´:",e),!l.find(s=>s.id===e))throw new Error("æœªæ‰¾åˆ°å¯¹åº”çš„é¢˜ç›®");const s=new Date;return await $(e,{lastReviewedAt:s}),console.log("LeanCloud æ›´æ–°æˆåŠŸï¼Œå¼€å§‹æ›´æ–°æœ¬åœ°çŠ¶æ€"),h(t=>t.map(t=>t.id===e?{...t,lastReviewedAt:s.toISOString()}:t)),console.log(`é¢˜ç›® ${e} å¤ä¹ æ—¶é—´å·²æ›´æ–°`),!0}catch(s){throw console.error("æ›´æ–°é¢˜ç›®æ—¶é—´å¤±è´¥:",s),console.error("é”™è¯¯è¯¦æƒ…:",{questionId:e,errorMessage:s.message,errorStack:s.stack}),s}},questions:l}),"documents"===S&&(0,o.jsx)("section",{className:"documents-tab-section",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsx)(Y,{})})}),"community"===S&&(0,o.jsx)(le,{}),"stats"===S&&(0,o.jsx)("section",{className:"stats-section",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsxs)("div",{className:"stats-overview",children:[(0,o.jsxs)("div",{className:"modern-stat-card primary",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:qe.totalCategories}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»åˆ†ç±»æ•°"})]})]}),(0,o.jsxs)("div",{className:"modern-stat-card success",children:[(0,o.jsx)("div",{className:"stat-icon",children:"â“"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:l.length}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]})]}),(0,o.jsxs)("div",{className:"modern-stat-card warning",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“…"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:Ke}),(0,o.jsx)("div",{className:"stat-label",children:"æ´»è·ƒå¤©æ•°"})]})]}),(0,o.jsxs)("div",{className:"modern-stat-card info",children:[(0,o.jsx)("div",{className:"stat-icon",children:"âš¡"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:qe.totalQuestions>0?(qe.totalQuestions/Ke).toFixed(1):0}),(0,o.jsx)("div",{className:"stat-label",children:"æ—¥å‡é¢˜ç›®"})]})]})]}),(0,o.jsxs)("div",{className:"charts-grid",children:[(0,o.jsxs)("div",{className:"modern-chart-card",children:[(0,o.jsxs)("div",{className:"chart-header",children:[(0,o.jsx)("h3",{children:"ðŸ“Š åˆ†ç±»é¢˜ç›®åˆ†å¸ƒ"}),(0,o.jsx)("span",{className:"chart-subtitle",children:"å„åˆ†ç±»é¢˜ç›®æ•°é‡å æ¯”"})]}),(0,o.jsx)("div",{className:"chart-container",children:(0,o.jsx)(I.u,{width:"100%",height:300,children:(0,o.jsxs)(Q.r,{children:[(0,o.jsx)(R.F,{data:Je,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:s})=>`${e} ${s}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:Je.map((e,s)=>(0,o.jsx)(U.f,{fill:Ve[s%Ve.length]},`cell-${s}`))}),(0,o.jsx)(O.m,{formatter:(e,s)=>[`${e} é¢˜`,s]}),(0,o.jsx)(M.s,{})]})})})]}),(0,o.jsxs)("div",{className:"modern-chart-card",children:[(0,o.jsxs)("div",{className:"chart-header",children:[(0,o.jsx)("h3",{children:"ðŸŽ¯ éš¾åº¦åˆ†å¸ƒ"}),(0,o.jsx)("span",{className:"chart-subtitle",children:"é¢˜ç›®éš¾åº¦ç­‰çº§ç»Ÿè®¡"})]}),(0,o.jsx)("div",{className:"chart-container",children:(0,o.jsx)(I.u,{width:"100%",height:300,children:(0,o.jsxs)(F.E,{data:Ge,children:[(0,o.jsx)(_.d,{strokeDasharray:"3 3"}),(0,o.jsx)(B.W,{dataKey:"name"}),(0,o.jsx)(W.h,{}),(0,o.jsx)(O.m,{formatter:e=>[`${e} é¢˜`,"æ•°é‡"]}),(0,o.jsx)(z.y,{dataKey:"value",name:"é¢˜ç›®æ•°é‡",children:Ge.map((e,s)=>(0,o.jsx)(U.f,{fill:e.color},`cell-${s}`))})]})})})]})]})]})}),"calendar"===S&&(0,o.jsx)("section",{className:"modern-calendar-section",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsxs)("div",{className:"calendar-header",children:[(0,o.jsx)("h3",{children:"ðŸ—“ï¸ å­¦ä¹ æ—¥åŽ†"}),(0,o.jsx)("p",{children:"æŸ¥çœ‹æ¯æœˆçš„å­¦ä¹ æ´»åŠ¨åˆ†å¸ƒ"})]}),(0,o.jsxs)("div",{className:"modern-calendar-card",ref:be,children:[(0,o.jsxs)("div",{className:"calendar-controls",children:[(0,o.jsx)("button",{onClick:()=>Ie("prev"),className:"month-nav-btn",children:"â† ä¸Šä¸ªæœˆ"}),(0,o.jsx)("h4",{className:"current-month",children:Ze}),(0,o.jsx)("button",{onClick:()=>Ie("next"),className:"month-nav-btn",children:"ä¸‹ä¸ªæœˆ â†’"})]}),(0,o.jsxs)("div",{className:"monthly-calendar",children:[(0,o.jsx)("div",{className:"calendar-weekdays",children:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].map(e=>(0,o.jsx)("div",{className:"weekday",children:e},e))}),(0,o.jsx)("div",{className:"calendar-days",children:He.map((e,s)=>(0,o.jsxs)("div",{className:`calendar-day ${e.count>0?"has-questions":""} ${e.isToday?"today":""}`,style:{backgroundColor:e.color},onMouseEnter:s=>Te(e,s),onMouseLeave:$e,"data-count":e.count,children:[(0,o.jsx)("span",{className:"day-number",children:e.day}),e.count>0&&(0,o.jsx)("div",{className:"question-count-badge",children:e.count})]},s))}),(0,o.jsx)(K,{dayData:je,position:ve,isVisible:ye,onClose:Le})]}),(0,o.jsxs)("div",{className:"calendar-stats",children:[(0,o.jsxs)("div",{className:"calendar-stat",children:[(0,o.jsx)("span",{className:"stat-value",children:Ye.totalQuestions}),(0,o.jsx)("span",{className:"stat-label",children:"æœ¬æœˆé¢˜ç›®"})]}),(0,o.jsxs)("div",{className:"calendar-stat",children:[(0,o.jsx)("span",{className:"stat-value",children:Ye.daysWithQuestions}),(0,o.jsx)("span",{className:"stat-label",children:"å­¦ä¹ å¤©æ•°"})]}),(0,o.jsxs)("div",{className:"calendar-stat",children:[(0,o.jsx)("span",{className:"stat-value",children:Ye.maxDaily}),(0,o.jsx)("span",{className:"stat-label",children:"å•æ—¥æœ€é«˜"})]})]}),(0,o.jsxs)("div",{className:"calendar-legend",children:[(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#f8f9fa"}}),(0,o.jsx)("span",{children:"æ— é¢˜ç›®"})]}),(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#4CAF50"}}),(0,o.jsx)("span",{children:"1é¢˜"})]}),(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#8BC34A"}}),(0,o.jsx)("span",{children:"2-3é¢˜"})]}),(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#FFC107"}}),(0,o.jsx)("span",{children:"4-5é¢˜"})]}),(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#FF9800"}}),(0,o.jsx)("span",{children:"6-8é¢˜"})]}),(0,o.jsxs)("div",{className:"legend-item",children:[(0,o.jsx)("div",{className:"legend-color",style:{backgroundColor:"#F44336"}}),(0,o.jsx)("span",{children:"9é¢˜ä»¥ä¸Š"})]})]})]})]})}),(0,o.jsx)("footer",{className:"footer-section",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsxs)("div",{className:"footer-stats",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("div",{className:"stat-number",children:qe.totalCategories}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»ç±»åˆ«æ•°"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("div",{className:"stat-number",children:l.length}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]})]})})}),(0,o.jsx)(d,{onNavigate:e=>{switch(console.log("å¯¼èˆªåˆ°:",e),e){case"categories":default:A("categories");break;case"review":A("review");break;case"stats":A("stats");break;case"calendar":A("calendar");break;case"community":A("community");break;case"documents":A("documents");break;case"createCategory":P(!0)}window.scrollTo({top:0,behavior:"smooth"})},categories:n,questions:l,currentUser:ge})]})}):(0,o.jsx)("div",{className:"homepage",children:(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„åˆ·é¢˜æ•°æ®"}),(0,o.jsxs)("div",{className:"auth-required-actions",children:[(0,o.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"login"}}))},className:"login-btn primary",children:"ðŸš€ ç«‹å³ç™»å½•"}),(0,o.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"register"}}))},className:"login-btn secondary",children:"ðŸ“ æ³¨å†Œè´¦å·"})]}),(0,o.jsx)("div",{className:"auth-features",children:(0,o.jsxs)("div",{className:"feature-list",children:[(0,o.jsxs)("div",{className:"feature-item",children:[(0,o.jsx)("span",{className:"feature-icon",children:"ðŸ“š"}),(0,o.jsx)("span",{children:"ç®¡ç†æ‚¨çš„åˆ·é¢˜åˆ†ç±»"})]}),(0,o.jsxs)("div",{className:"feature-item",children:[(0,o.jsx)("span",{className:"feature-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{children:"æŸ¥çœ‹å­¦ä¹ ç»Ÿè®¡"})]}),(0,o.jsxs)("div",{className:"feature-item",children:[(0,o.jsx)("span",{className:"feature-icon",children:"ðŸ”„"}),(0,o.jsx)("span",{children:"ä½¿ç”¨å¤ä¹ æé†’åŠŸèƒ½"})]}),(0,o.jsxs)("div",{className:"feature-item",children:[(0,o.jsx)("span",{className:"feature-icon",children:"ðŸ—“ï¸"}),(0,o.jsx)("span",{children:"è®°å½•å­¦ä¹ æ—¥åŽ†"})]})]})})]})})};u().init({appId:"JjTQ2R5rn16RRhUdrcjUSBxW-gzGzoHsz",appKey:"UkvR0e4OPaeW5rYMQwNTvD7Z",serverURL:"https://jjtq2r5r.lc-cn-n1-shared.com"});const he="Post",ue="Comment",me="Like",ge="Follow",xe="published",je=["Title","é¢˜ç›®","Name","åç§°"],pe=["Difficulty","éš¾åº¦"],ve=["Category","ç±»åˆ«","åˆ†ç±»"],Ne=["Tags","æ ‡ç­¾"],ye=["Content","å†…å®¹","Answer","ç­”æ¡ˆ"],we=["CompletionTime","å®Œæˆæ—¶é—´","æ—¶é—´"],be=async()=>{try{return{Post:await fe(),Comment:await Ce(),Like:await ke(),Follow:await Se()}}catch(e){throw new Error(`åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨å¤±è´¥: ${e.message}`)}},fe=async()=>{try{const e=new(u().Query)(he);if(await e.first().catch(()=>null))return{exists:!0,message:"Post class already exists"};const s=new(u().Object.extend(he));s.set("title","æµ‹è¯•å¸–å­æ ‡é¢˜"),s.set("content","è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¸–å­çš„å†…å®¹ï¼Œç”¨äºŽéªŒè¯ Post ç±»çš„åˆ›å»ºã€‚"),s.set("author",u().User.current()),s.set("tags",["æµ‹è¯•","ç¤ºä¾‹"]),s.set("likes",0),s.set("views",0),s.set("commentCount",0),s.set("isPublic",!0),s.set("isPinned",!1),s.set("status",xe);const t=new(u().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),u().User.current()&&t.setWriteAccess(u().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Post ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Post class created successfully"}}catch(e){return console.error("åˆ›å»º Post ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Ce=async()=>{try{const e=new(u().Query)(ue);if(await e.first().catch(()=>null))return console.log("ðŸ“ Comment ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Comment class already exists"};const s=new(u().Object.extend(ue));s.set("content","è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯„è®ºå†…å®¹ã€‚"),s.set("author",u().User.current()),s.set("likes",0);const t=new(u().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),u().User.current()&&t.setWriteAccess(u().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Comment ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Comment class created successfully"}}catch(e){return console.error("åˆ›å»º Comment ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},ke=async()=>{try{const e=new(u().Query)(me);if(await e.first().catch(()=>null))return console.log("ðŸ“ Like ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Like class already exists"};const s=new(u().Object.extend(me));s.set("user",u().User.current());const t=new(u().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),u().User.current()&&t.setWriteAccess(u().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Like ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Like class created successfully"}}catch(e){return console.error("åˆ›å»º Like ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Se=async()=>{try{const e=new(u().Query)(ge);if(await e.first().catch(()=>null))return console.log("ðŸ“ Follow ç±»å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"),{exists:!0,message:"Follow class already exists"};const s=new(u().Object.extend(ge));s.set("follower",u().User.current());const t=new(u().ACL);return t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),u().User.current()&&t.setWriteAccess(u().User.current(),!0),s.setACL(t),await s.save(),console.log("âœ… Follow ç±»åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ æµ‹è¯•æ•°æ®"),await s.destroy(),console.log("ðŸ§¹ å·²æ¸…ç†æµ‹è¯•æ•°æ®"),{success:!0,message:"Follow class created successfully"}}catch(e){return console.error("åˆ›å»º Follow ç±»å¤±è´¥:",e),{success:!1,error:e.message}}},Ae=async()=>{try{console.log("ðŸš€ å¼€å§‹ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®..."),await be();const e={posts:await qe(),comments:await De(),likes:await Ee()};return console.log("âœ… ç¤¾åŒºç¤ºä¾‹æ•°æ®ç”Ÿæˆå®Œæˆ:",e),{success:!0,...e,message:`æˆåŠŸç”Ÿæˆ ${e.posts.length} ä¸ªå¸–å­, ${e.comments.length} æ¡è¯„è®º, ${e.likes.length} ä¸ªç‚¹èµž`}}catch(e){throw console.error("âŒ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥:",e),new Error(`ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥: ${e.message}`)}},qe=async()=>{const e=u().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹å¸–å­"),[];const s=u().Object.extend(he),t=[{title:"æ¬¢è¿Žæ¥åˆ°å­¦ä¹ ç¤¾åŒºï¼",content:"å¤§å®¶å¥½ï¼æ¬¢è¿Žæ¥åˆ°æˆ‘ä»¬çš„å­¦ä¹ ç¤¾åŒºã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªåˆ†äº«ç¼–ç¨‹å­¦ä¹ å¿ƒå¾—ã€äº¤æµåˆ·é¢˜ç»éªŒçš„åœ°æ–¹ã€‚\n\n## ç¤¾åŒºè§„åˆ™ï¼š\n1. å‹å–„äº¤æµï¼Œäº’ç›¸å¸®åŠ©\n2. åˆ†äº«æœ‰ä»·å€¼çš„å†…å®¹\n3. å°Šé‡ä»–äººè§‚ç‚¹\n4. ä¿æŒå†…å®¹ç›¸å…³æ€§\n\nå¸Œæœ›å¤§å®¶éƒ½èƒ½åœ¨è¿™é‡Œæœ‰æ‰€æ”¶èŽ·ï¼ðŸŽ‰",tags:["æ¬¢è¿Ž","å…¬å‘Š","ç¤¾åŒº"],isPublic:!0,isPinned:!0},{title:"JavaScript é—­åŒ…çš„ç†è§£ä¸Žå®žè·µ",content:"ä»Šå¤©æ¥åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹ JavaScript é—­åŒ…çš„ç†è§£...\n\n## ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ\né—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚\n\n## å®žé™…åº”ç”¨åœºæ™¯ï¼š\n1. æ¨¡å—åŒ–å¼€å‘\n2. ç§æœ‰å˜é‡\n3. å‡½æ•°æŸ¯é‡ŒåŒ–\n\nå¤§å®¶æœ‰ä»€ä¹ˆè¡¥å……çš„å—ï¼Ÿ",tags:["JavaScript","é—­åŒ…","å‰ç«¯"],isPublic:!0,isPinned:!1},{title:"React Hooks ä½¿ç”¨å¿ƒå¾—",content:"ä½¿ç”¨ React Hooks æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œåˆ†äº«ä¸€äº›å®žè·µç»éªŒï¼š\n\n- useState: çŠ¶æ€ç®¡ç†\n- useEffect: å‰¯ä½œç”¨å¤„ç†\n- useContext: ä¸Šä¸‹æ–‡ä¼ é€’\n- useMemo: æ€§èƒ½ä¼˜åŒ–\n\nä½ ä»¬è§‰å¾—å“ªä¸ª Hook æœ€å®žç”¨ï¼Ÿ",tags:["React","Hooks","å‰ç«¯"],isPublic:!0,isPinned:!1}],a=[];for(const n of t){const t=new s;t.set("title",n.title),t.set("content",n.content),t.set("author",e),t.set("tags",n.tags),t.set("likes",Math.floor(10*Math.random())),t.set("views",Math.floor(50*Math.random())),t.set("commentCount",Math.floor(5*Math.random())),t.set("isPublic",n.isPublic),t.set("isPinned",n.isPinned),t.set("status",xe);const i=new(u().ACL);i.setPublicReadAccess(!0),i.setPublicWriteAccess(!1),i.setWriteAccess(e,!0),t.setACL(i);const c=await t.save();a.push(c),console.log(`âœ… åˆ›å»ºå¸–å­: "${n.title}"`)}return a},De=async()=>{const e=u().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹è¯„è®º"),[];const s=new(u().Query)(he),t=await s.find();if(0===t.length)return console.log("âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¸–å­ï¼Œè·³è¿‡åˆ›å»ºè¯„è®º"),[];const a=u().Object.extend(ue),n=[{content:"æ¬¢è¿Žæ¬¢è¿Žï¼æœŸå¾…æ›´å¤šç²¾å½©å†…å®¹ï¼ðŸŽŠ"},{content:"é—­åŒ…çš„è®²è§£å¾ˆæ¸…æ™°ï¼Œæ„Ÿè°¢åˆ†äº«ï¼"},{content:"æˆ‘è§‰å¾— useEffect æœ€å®žç”¨ï¼Œèƒ½å¤„ç†å„ç§å‰¯ä½œç”¨ã€‚"},{content:"æ–°äººæŠ¥é“ï¼Œè¯·å¤šæŒ‡æ•™ï¼"},{content:"Hooks ç¡®å®žè®© React å¼€å‘æ›´ç®€æ´äº†ã€‚"}],i=[];for(let s=0;s<n.length;s++){const c=new a;c.set("content",n[s].content),c.set("author",e),c.set("post",t[s%t.length]),c.set("likes",Math.floor(5*Math.random()));const r=new(u().ACL);r.setPublicReadAccess(!0),r.setPublicWriteAccess(!1),r.setWriteAccess(e,!0),c.setACL(r);const l=await c.save();i.push(l),console.log(`âœ… åˆ›å»ºè¯„è®º: "${n[s].content.substring(0,20)}..."`)}return i},Ee=async()=>{const e=u().User.current();if(!e)return console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åˆ›å»ºç¤ºä¾‹ç‚¹èµž"),[];const s=new(u().Query)(he),t=await s.find(),a=new(u().Query)(ue),n=await a.find(),i=u().Object.extend(me),c=[];if(t.length>0){const s=new i;s.set("user",e),s.set("post",t[0]);const a=new(u().ACL);a.setPublicReadAccess(!0),a.setWriteAccess(e,!0),s.setACL(a);const n=await s.save();c.push(n),console.log("âœ… åˆ›å»ºå¸–å­ç‚¹èµž")}if(n.length>0){const s=new i;s.set("user",e),s.set("comment",n[0]);const t=new(u().ACL);t.setPublicReadAccess(!0),t.setWriteAccess(e,!0),s.setACL(t);const a=await s.save();c.push(a),console.log("âœ… åˆ›å»ºè¯„è®ºç‚¹èµž")}return c},Pe=async()=>{try{let e={posts:0,comments:0,likes:0,follows:0};try{const s=new(u().Query)(me),t=await s.find();t.length>0&&(await u().Object.destroyAll(t),e.likes=t.length)}catch(e){}try{const s=new(u().Query)(ue),t=await s.find();t.length>0&&(await u().Object.destroyAll(t),e.comments=t.length)}catch(e){}try{const s=new(u().Query)(he),t=await s.find();t.length>0&&(await u().Object.destroyAll(t),e.posts=t.length)}catch(e){}try{const s=new(u().Query)(ge),t=await s.find();t.length>0&&(await u().Object.destroyAll(t),e.follows=t.length)}catch(e){}const s=`ç¤¾åŒºæ•°æ®æ¸…é™¤å®Œæˆ: ${e.posts} å¸–å­, ${e.comments} è¯„è®º, ${e.likes} ç‚¹èµž, ${e.follows} å…³æ³¨`;return{success:!0,...e,message:s}}catch(e){throw console.error("âŒ æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥:",e),new Error(`æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥: ${e.message}`)}},Te=async()=>{try{if(!"MISSING_ENV_VAR".REACT_APP_NOTION_TOKEN||!"MISSING_ENV_VAR".REACT_APP_NOTION_DATABASE_ID)throw new Error("Notion çŽ¯å¢ƒå˜é‡æœªé…ç½®ï¼Œè¯·æ£€æŸ¥ REACT_APP_NOTION_TOKEN å’Œ REACT_APP_NOTION_DATABASE_ID");try{return await u().Cloud.run("syncProblemsFromNotion")}catch(e){return await $e()}}catch(e){throw console.error("âŒ Notion åŒæ­¥å¤±è´¥:",e),new Error(`åŒæ­¥å¤±è´¥: ${e.message}`)}},$e=async()=>{try{return console.log("ðŸ“ ä½¿ç”¨å®¢æˆ·ç«¯åŒæ­¥æ¨¡å¼ï¼ˆéœ€è¦é…ç½®äº‘å‡½æ•°ï¼‰"),await new Promise(e=>setTimeout(e,2e3)),{success:!0,message:"åŒæ­¥åŠŸèƒ½éœ€è¦éƒ¨ç½²äº‘å‡½æ•°ã€‚è¯·å‚è€ƒä»¥ä¸‹æ­¥éª¤ï¼š\n1. åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½² syncProblemsFromNotion äº‘å‡½æ•°\n2. é…ç½® NOTION_INTEGRATION_TOKEN å’Œ NOTION_DATABASE_ID çŽ¯å¢ƒå˜é‡",data:{synced:0,mode:"client_fallback"}}}catch(e){throw new Error(`å®¢æˆ·ç«¯åŒæ­¥å¤±è´¥: ${e.message}`)}},Le=e=>{try{const s=e.properties,t=Ie(s,je,"title");if(!t)return console.warn("è·³è¿‡æ— æ ‡é¢˜çš„è®°å½•:",e.id),null;const a=Ie(s,pe,"select"),n=Ie(s,ve,"select"),i=Ie(s,Ne,"multi_select")||[],c=Ie(s,ye,"rich_text"),r=Ie(s,we,"number");return{title:t,difficulty:a||"medium",category:n||"æœªåˆ†ç±»",tags:Array.isArray(i)?i:[i],content:c||"",completionTime:r||15,notionPageId:e.id,notionUrl:e.url,lastEditedTime:new Date(e.last_edited_time),isActive:!0}}catch(e){return console.error("è§£æž Notion é¡µé¢å¤±è´¥:",e),null}},Ie=(e,s,t)=>{for(const a of s){const s=e[a];if(s&&s.type===t)switch(t){case"title":return s.title[0]?.text?.content;case"rich_text":return s.rich_text[0]?.text?.content;case"select":return s.select?.name;case"multi_select":return s.multi_select?.map(e=>e.name);case"number":return s.number;default:return null}}return null},Qe=async e=>{const s=u().Object.extend("Question");let t=0;for(const a of e)try{const e=await Re(a.category),n=new(u().Query)("Question");n.equalTo("notionPageId",a.notionPageId);const i=await n.first()||new s;i.set("title",a.title),i.set("content",a.content),i.set("difficulty",a.difficulty),i.set("tags",a.tags),i.set("completionTime",a.completionTime),i.set("category",e),i.set("notionPageId",a.notionPageId),i.set("notionUrl",a.notionUrl),i.set("isActive",!0);const c=new(u().ACL);c.setPublicReadAccess(!0),c.setPublicWriteAccess(!0),i.setACL(c),await i.save(),t++,console.log(`âœ… ä¿å­˜é¢˜ç›®: "${a.title}" â†’ åˆ†ç±» "${a.category}"`)}catch(e){console.error(`ä¿å­˜é¢˜ç›®å¤±è´¥: ${a.title}`,e)}return await Be(),t},Re=async e=>{const s=u().Object.extend("Category"),t=new(u().Query)("Category");t.equalTo("name",e);let a=await t.first();if(!a){a=new s,a.set("name",e),a.set("questionCount",0);const t=new(u().ACL);t.setPublicReadAccess(!0),t.setPublicWriteAccess(!0),a.setACL(t),await a.save()}return a},Ue=async()=>{try{return await u().Cloud.run("checkNotionConnection")}catch(e){return{success:!1,connected:!1,error:e.message,message:"è¯·ç¡®ä¿å·²éƒ¨ç½²äº‘å‡½æ•°å¹¶é…ç½®çŽ¯å¢ƒå˜é‡"}}},Oe=async()=>{try{console.log("å¼€å§‹ç”Ÿæˆç¤ºä¾‹æ•°æ®..."),await We();const e=await Me(),s=await Fe(e);return await _e(e),console.log("ðŸŽ‰ ç¤ºä¾‹æ•°æ®ç”Ÿæˆå®Œæˆï¼"),{success:!0,categoriesCount:e.length,questionsCount:s.length,message:`æˆåŠŸç”Ÿæˆ ${e.length} ä¸ªåˆ†ç±»å’Œ ${s.length} ä¸ªé¢˜ç›®`}}catch(e){throw console.error("âŒ ç”Ÿæˆç¤ºä¾‹æ•°æ®å¤±è´¥:",e),new Error(`ç”Ÿæˆå¤±è´¥: ${e.message}`)}},Me=async()=>{const e=u().Object.extend("Category"),s=[{name:"JavaScript æ ¸å¿ƒæ¦‚å¿µ"},{name:"React æ¡†æž¶åŽŸç†"},{name:"ç®—æ³•ä¸Žæ•°æ®ç»“æž„"},{name:"è®¡ç®—æœºç½‘ç»œ"},{name:"æ•°æ®åº“ç³»ç»Ÿ"},{name:"æ“ä½œç³»ç»Ÿ"},{name:"å‰ç«¯å·¥ç¨‹åŒ–"},{name:"TypeScript è¿›é˜¶"}],t=[];for(const a of s){const s=new e;s.set("name",a.name),s.set("questionCount",0);const n=new(u().ACL);n.setPublicReadAccess(!0),n.setPublicWriteAccess(!0),s.setACL(n);const i=await s.save();t.push(i),console.log(`âœ… åˆ›å»ºåˆ†ç±»: ${a.name}`)}return t},Fe=async e=>{const s=u().Object.extend("Question"),t=[],a=[];for(const n of t){const t=new s;t.set("title",n.title),t.set("answer",n.answer),t.set("tags",n.tags),t.set("difficulty",n.difficulty),t.set("completionTime",n.completionTime),t.set("proficiency",n.proficiency),t.set("category",e[n.categoryIndex]),t.set("isActive",!0);const i=new(u().ACL);i.setPublicReadAccess(!0),i.setPublicWriteAccess(!0),t.setACL(i);const c=await t.save();a.push(c),console.log(`âœ… åˆ›å»ºé¢˜ç›®: "${n.title}" â†’ å±žäºŽ "${e[n.categoryIndex].get("name")}"`)}return a},_e=async e=>{for(const s of e){const e=new(u().Query)("Question");e.equalTo("category",s);const t=await e.count();s.set("questionCount",t),await s.save(),console.log(`ðŸ“Š åˆ†ç±» "${s.get("name")}" æœ‰ ${t} ä¸ªé¢˜ç›®`)}},Be=async()=>{const e=new(u().Query)("Category"),s=await e.find();for(const e of s){const s=new(u().Query)("Question");s.equalTo("category",e);const t=await s.count();e.set("questionCount",t),await e.save()}console.log(`ðŸ“Š æ›´æ–°äº† ${s.length} ä¸ªåˆ†ç±»çš„é¢˜ç›®è®¡æ•°`)},We=async()=>{try{console.log("å¼€å§‹æ¸…é™¤æ‰€æœ‰æ•°æ®...");let e=0,s=0;try{const s=new(u().Query)("Question"),t=await s.find();t.length>0&&(await u().Object.destroyAll(t),e=t.length,console.log(`ðŸ—‘ï¸ åˆ é™¤äº† ${e} ä¸ªé¢˜ç›®`))}catch(e){console.log("æ²¡æœ‰é¢˜ç›®éœ€è¦åˆ é™¤æˆ–åˆ é™¤å¤±è´¥:",e.message)}try{const e=new(u().Query)("Category"),t=await e.find();t.length>0&&(await u().Object.destroyAll(t),s=t.length,console.log(`ðŸ—‘ï¸ åˆ é™¤äº† ${s} ä¸ªåˆ†ç±»`))}catch(e){console.log("æ²¡æœ‰åˆ†ç±»éœ€è¦åˆ é™¤æˆ–åˆ é™¤å¤±è´¥:",e.message)}const t=`æ¸…é™¤å®Œæˆ: ${s} ä¸ªåˆ†ç±», ${e} ä¸ªé¢˜ç›®`;return console.log("âœ… "+t),{success:!0,deletedCategories:s,deletedQuestions:e,message:t}}catch(e){throw console.error("âŒ æ¸…é™¤æ•°æ®å¤±è´¥:",e),new Error(`æ¸…é™¤å¤±è´¥: ${e.message}`)}},ze=async()=>{try{let e=0,s=0;try{const s=new(u().Query)("Category");e=await s.count()}catch(s){e=0}try{const e=new(u().Query)("Question");s=await e.count()}catch(e){s=0}const t={categoryCount:e,questionCount:s,hasData:e>0||s>0};return console.log("ðŸ“Š æ•°æ®çŠ¶æ€:",t),t}catch(e){throw console.error("æ£€æŸ¥æ•°æ®çŠ¶æ€å¤±è´¥:",e),e}};"undefined"!=typeof window&&(window.generateSampleData=Oe,window.clearAllData=We,window.checkDataStatus=ze,window.syncProblemsFromNotion=Te,window.checkNotionConnection=Ue,window.defineNotionCloudFunctions=()=>{void 0!==u().Cloud&&(u().Cloud.define("syncProblemsFromNotion",async e=>{const{Client:s}=t(1007),a=new s({auth:"MISSING_ENV_VAR".NOTION_INTEGRATION_TOKEN});try{console.log("å¼€å§‹ä»Ž Notion æ•°æ®åº“åŒæ­¥æ•°æ®...");const e=await a.databases.query({database_id:"MISSING_ENV_VAR".NOTION_DATABASE_ID,sorts:[{timestamp:"last_edited_time",direction:"descending"}]});console.log(`ä»Ž Notion èŽ·å–åˆ° ${e.results.length} æ¡è®°å½•`);const s=[];let t=0;for(const t of e.results){const e=Le(t);e&&s.push(e)}return t=await Qe(s),{success:!0,message:`åŒæ­¥å®Œæˆï¼å¤„ç† ${e.results.length} æ¡è®°å½•ï¼ŒæˆåŠŸä¿å­˜ ${t} é“é¢˜ç›®`,data:{fetched:e.results.length,saved:t,problems:s.slice(0,5)}}}catch(e){throw console.error("Notion åŒæ­¥é”™è¯¯:",e),new(u().Cloud.Error)(`åŒæ­¥å¤±è´¥: ${e.message}`)}}),u().Cloud.define("checkNotionConnection",async e=>{const{Client:s}=t(1007);try{const e=new s({auth:"MISSING_ENV_VAR".NOTION_INTEGRATION_TOKEN}),t=await e.databases.retrieve({database_id:"MISSING_ENV_VAR".NOTION_DATABASE_ID});return{success:!0,connected:!0,database:{title:t.title[0]?.plain_text||"æœªå‘½å",properties:Object.keys(t.properties),url:t.url}}}catch(e){return{success:!1,connected:!1,error:e.message}}}))},window.createCommunityClasses=be,window.generateCommunitySampleData=Ae,window.clearCommunityData=Pe,console.log("\nðŸŽ¯ æ•°æ®åº“ç®¡ç†å·¥å…·å·²åŠ è½½ï¼\n\nðŸ“š æ•°æ®ç®¡ç†:\n1. generateSampleData()          - ç”Ÿæˆç¤ºä¾‹æ•°æ®\n2. clearAllData()                - æ¸…é™¤æ‰€æœ‰æ•°æ®\n3. checkDataStatus()             - æ£€æŸ¥æ•°æ®çŠ¶æ€\n\nðŸ”„ Notion åŒæ­¥:\n4. syncProblemsFromNotion()      - ä»Ž Notion å¯¼å…¥é¢˜ç›®\n5. checkNotionConnection()       - æ£€æŸ¥ Notion è¿žæŽ¥çŠ¶æ€\n6. defineNotionCloudFunctions()  - å®šä¹‰äº‘å‡½æ•°ï¼ˆç”¨äºŽäº‘å¼•æ“Žï¼‰\n\nðŸ‘¥ ç¤¾åŒºåŠŸèƒ½:\n7. createCommunityClasses()      - åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨\n8. generateCommunitySampleData() - ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®\n9. clearCommunityData()          - æ¸…é™¤ç¤¾åŒºæ•°æ®\n\nðŸ’¡ ä½¿ç”¨æç¤º:\n- é¦–æ¬¡ä½¿ç”¨è¯·è¿è¡Œ generateSampleData() åˆ›å»ºç¤ºä¾‹æ•°æ®\n- ä½¿ç”¨ç¤¾åŒºåŠŸèƒ½å‰è¿è¡Œ createCommunityClasses() åˆ›å»ºæ•°æ®è¡¨\n- é…ç½® Notion çŽ¯å¢ƒå˜é‡åŽä½¿ç”¨ syncProblemsFromNotion() åŒæ­¥\n- äº‘å‡½æ•°éœ€è¦åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½²\n  "));const Ve=()=>{const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(""),[i,c]=(0,a.useState)(null),[r,l]=(0,a.useState)(null),[d,h]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[g,x]=(0,a.useState)("notion"),j=async()=>{s(!0);try{const e=await ze();c(e),n(`ðŸ“Š å½“å‰æ•°æ®: ${e.categoryCount} ä¸ªåˆ†ç±», ${e.questionCount} ä¸ªé¢˜ç›®`)}catch(e){n(`âŒ æ£€æŸ¥å¤±è´¥: ${e.message}`)}finally{s(!1)}},p=async()=>{s(!0);try{const e={postCount:0,commentCount:0,likeCount:0,followCount:0,hasData:!1};try{e.postCount=0,e.commentCount=0,e.likeCount=0,e.followCount=0,e.hasData=!1,n("ðŸ“Š ç¤¾åŒºæ•°æ®çŠ¶æ€å·²æ£€æŸ¥ï¼Œè¯·å…ˆåˆ›å»ºç¤¾åŒºæ•°æ®è¡¨")}catch(e){n('ðŸ“Š ç¤¾åŒºæ•°æ®è¡¨å°šæœªåˆ›å»ºï¼Œè¯·å…ˆç‚¹å‡»"åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨"')}m(e)}catch(e){n(`âŒ æ£€æŸ¥ç¤¾åŒºçŠ¶æ€å¤±è´¥: ${e.message}`)}finally{s(!1)}};return(0,o.jsxs)("div",{className:"init-page",children:[(0,o.jsxs)("header",{className:"page-header",children:[(0,o.jsx)("h1",{children:"ðŸŽ¯ æ•°æ®åº“ç®¡ç†å·¥å…·"}),(0,o.jsx)("p",{children:"ç®¡ç† Categoryã€Question å’Œç¤¾åŒºæ•°æ®ï¼Œæ”¯æŒ Notion åŒæ­¥"})]}),(0,o.jsx)("section",{className:"tab-navigation",children:(0,o.jsxs)("div",{className:"tabs",children:[(0,o.jsx)("button",{className:"tab "+("notion"===g?"active":""),onClick:()=>x("notion"),children:"ðŸ”„ Notion åŒæ­¥"}),(0,o.jsx)("button",{className:"tab "+("data"===g?"active":""),onClick:()=>x("data"),children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,o.jsx)("button",{className:"tab "+("community"===g?"active":""),onClick:()=>x("community"),children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"})]})}),"notion"===g&&(0,o.jsxs)("section",{className:"notion-section",children:[(0,o.jsx)("h2",{children:"ðŸ”„ Notion æ•°æ®åŒæ­¥"}),(0,o.jsxs)("div",{className:"action-buttons",children:[(0,o.jsx)("button",{onClick:async()=>{s(!0),n(""),l(null);try{const e=await Ue();l(e),e.success&&e.connected?n(`âœ… Notion è¿žæŽ¥æ­£å¸¸ï¼æ•°æ®åº“: ${e.database.title}`):n(`âš ï¸ Notion è¿žæŽ¥å¼‚å¸¸: ${e.error||"è¯·æ£€æŸ¥é…ç½®"}`)}catch(e){n(`âŒ æ£€æŸ¥ Notion è¿žæŽ¥å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-notion",children:"ðŸ”— æ£€æŸ¥ Notion è¿žæŽ¥"}),(0,o.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦ä»Ž Notion å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™ä¼šæ·»åŠ æ–°é¢˜ç›®åˆ°çŽ°æœ‰æ•°æ®ä¸­ã€‚")){s(!0),n(""),h(null);try{const e=await Te();h(e),e.success?(n(`âœ… ${e.message}`),await j()):n(`âš ï¸ ${e.message}`)}catch(e){n(`âŒ åŒæ­¥å¤±è´¥: ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-sync",children:"ðŸ“¥ ä»Ž Notion å¯¼å…¥"})]}),r&&(0,o.jsxs)("div",{className:"notion-status",children:[(0,o.jsx)("h4",{children:"Notion è¿žæŽ¥çŠ¶æ€"}),(0,o.jsxs)("div",{className:"status-card "+(r.connected?"connected":"disconnected"),children:[(0,o.jsxs)("div",{className:"status-header",children:[(0,o.jsx)("span",{className:"status-indicator",children:r.connected?"ðŸŸ¢":"ðŸ”´"}),(0,o.jsx)("strong",{children:r.connected?"è¿žæŽ¥æ­£å¸¸":"è¿žæŽ¥å¼‚å¸¸"})]}),r.connected&&r.database&&(0,o.jsxs)("div",{className:"database-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"æ•°æ®åº“:"})," ",r.database.title]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"å±žæ€§å­—æ®µ:"})," ",r.database.properties.length," ä¸ª"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"URL:"}),(0,o.jsx)("a",{href:r.database.url,target:"_blank",rel:"noopener noreferrer",children:"æŸ¥çœ‹æ•°æ®åº“"})]})]}),!r.connected&&(0,o.jsxs)("div",{className:"error-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"é”™è¯¯ä¿¡æ¯:"})," ",r.error]}),(0,o.jsx)("p",{className:"help-text",children:"ðŸ’¡ è¯·ç¡®ä¿å·²éƒ¨ç½²äº‘å‡½æ•°å¹¶é…ç½®çŽ¯å¢ƒå˜é‡"})]})]})]}),d&&(0,o.jsxs)("div",{className:"sync-result",children:[(0,o.jsx)("h4",{children:"åŒæ­¥ç»“æžœ"}),(0,o.jsxs)("div",{className:"result-card",children:[(0,o.jsxs)("div",{className:"result-stats",children:[(0,o.jsxs)("div",{className:"stat",children:[(0,o.jsx)("span",{className:"stat-label",children:"èŽ·å–è®°å½•:"}),(0,o.jsx)("span",{className:"stat-value",children:d.data?.fetched||0})]}),(0,o.jsxs)("div",{className:"stat",children:[(0,o.jsx)("span",{className:"stat-label",children:"æˆåŠŸä¿å­˜:"}),(0,o.jsx)("span",{className:"stat-value",children:d.data?.saved||0})]}),(0,o.jsxs)("div",{className:"stat",children:[(0,o.jsx)("span",{className:"stat-label",children:"åŒæ­¥æ¨¡å¼:"}),(0,o.jsx)("span",{className:"stat-value",children:d.data?.mode||"cloud"})]})]}),d.data?.problems&&d.data.problems.length>0&&(0,o.jsxs)("div",{className:"synced-problems",children:[(0,o.jsx)("h5",{children:"æœ€è¿‘åŒæ­¥çš„é¢˜ç›®:"}),(0,o.jsx)("ul",{children:d.data.problems.slice(0,3).map((e,s)=>(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"problem-title",children:e.title}),(0,o.jsx)("span",{className:"problem-category",children:e.category})]},s))})]})]})]})]}),"data"===g&&(0,o.jsxs)("section",{className:"data-management-section",children:[(0,o.jsx)("h2",{children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,o.jsxs)("div",{className:"action-buttons",children:[(0,o.jsx)("button",{onClick:j,disabled:e,className:"btn btn-info",children:"ðŸ” æ£€æŸ¥çŠ¶æ€"}),(0,o.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await Oe();n(`âœ… ${e.message}`),await j()}catch(e){n(`âŒ ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-success",children:"ðŸš€ ç”Ÿæˆç¤ºä¾‹æ•°æ®"}),(0,o.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")){s(!0),n("");try{const e=await We();n(`âœ… ${e.message}`),await j()}catch(e){n(`âŒ ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-danger",children:"ðŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®"})]}),i&&(0,o.jsxs)("div",{className:"status-info",children:[(0,o.jsx)("h4",{children:"ðŸ“ˆ æ•°æ®çŠ¶æ€"}),(0,o.jsxs)("div",{className:"status-grid",children:[(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"åˆ†ç±»æ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:i.categoryCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"é¢˜ç›®æ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:i.questionCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"æ•°æ®çŠ¶æ€:"}),(0,o.jsx)("span",{className:"value "+(i.hasData?"has-data":"no-data"),children:i.hasData?"æœ‰æ•°æ®":"æ— æ•°æ®"})]})]})]})]}),"community"===g&&(0,o.jsxs)("section",{className:"community-management-section",children:[(0,o.jsx)("h2",{children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"}),(0,o.jsx)("p",{className:"section-description",children:"ç®¡ç†å­¦ä¹ ç¤¾åŒºçš„å¸–å­ã€è¯„è®ºã€ç‚¹èµžç­‰ç¤¾äº¤åŠŸèƒ½æ•°æ®"}),(0,o.jsxs)("div",{className:"action-buttons",children:[(0,o.jsx)("button",{onClick:p,disabled:e,className:"btn btn-info",children:"ðŸ” æ£€æŸ¥ç¤¾åŒºçŠ¶æ€"}),(0,o.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await be();if(e.Post.success&&e.Comment.success&&e.Like.success&&e.Follow.success)n("âœ… ç¤¾åŒºæ•°æ®è¡¨åˆ›å»ºæˆåŠŸï¼æ‰€æœ‰è¡¨éƒ½å·²å°±ç»ª");else{const s=[];e.Post.success||s.push("Post"),e.Comment.success||s.push("Comment"),e.Like.success||s.push("Like"),e.Follow.success||s.push("Follow"),s.length>0?n(`âš ï¸ éƒ¨åˆ†è¡¨åˆ›å»ºå¤±è´¥: ${s.join(", ")}ã€‚å¯èƒ½è¡¨å·²å­˜åœ¨æˆ–æƒé™ä¸è¶³`):n("âœ… ç¤¾åŒºæ•°æ®è¡¨åˆ›å»ºå®Œæˆ")}await p()}catch(e){n(`âŒ åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-primary",children:"ðŸ—ï¸ åˆ›å»ºç¤¾åŒºæ•°æ®è¡¨"}),(0,o.jsx)("button",{onClick:async()=>{s(!0),n("");try{const e=await Ae();n(`âœ… ${e.message}`),await p()}catch(e){n(`âŒ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®å¤±è´¥: ${e.message}`)}finally{s(!1)}},disabled:e,className:"btn btn-success",children:"ðŸš€ ç”Ÿæˆç¤¾åŒºç¤ºä¾‹æ•°æ®"}),(0,o.jsx)("button",{onClick:async()=>{if(window.confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¤¾åŒºæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")){s(!0),n("");try{const e=await Pe();n(`âœ… ${e.message}`),await p()}catch(e){n(`âŒ æ¸…é™¤ç¤¾åŒºæ•°æ®å¤±è´¥: ${e.message}`)}finally{s(!1)}}},disabled:e,className:"btn btn-danger",children:"ðŸ—‘ï¸ æ¸…é™¤ç¤¾åŒºæ•°æ®"})]}),u&&(0,o.jsxs)("div",{className:"status-info",children:[(0,o.jsx)("h4",{children:"ðŸ“ˆ ç¤¾åŒºæ•°æ®çŠ¶æ€"}),(0,o.jsxs)("div",{className:"status-grid",children:[(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"å¸–å­æ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:u.postCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"è¯„è®ºæ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:u.commentCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"ç‚¹èµžæ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:u.likeCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"å…³æ³¨æ•°é‡:"}),(0,o.jsx)("span",{className:"value",children:u.followCount})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"æ•°æ®çŠ¶æ€:"}),(0,o.jsx)("span",{className:"value "+(u.hasData?"has-data":"no-data"),children:u.hasData?"æœ‰æ•°æ®":"æ— æ•°æ®"})]})]})]}),(0,o.jsxs)("div",{className:"community-classes-info",children:[(0,o.jsx)("h4",{children:"ðŸ—ï¸ ç¤¾åŒºæ•°æ®è¡¨ç»“æž„"}),(0,o.jsxs)("div",{className:"classes-grid",children:[(0,o.jsxs)("div",{className:"class-card",children:[(0,o.jsx)("h5",{children:"ðŸ“ Post (å¸–å­)"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"title - å¸–å­æ ‡é¢˜"}),(0,o.jsx)("li",{children:"content - å¸–å­å†…å®¹"}),(0,o.jsx)("li",{children:"author - ä½œè€…"}),(0,o.jsx)("li",{children:"tags - æ ‡ç­¾æ•°ç»„"}),(0,o.jsx)("li",{children:"likes - ç‚¹èµžæ•°"}),(0,o.jsx)("li",{children:"views - æµè§ˆæ•°"}),(0,o.jsx)("li",{children:"commentCount - è¯„è®ºæ•°"}),(0,o.jsx)("li",{children:"isPublic - æ˜¯å¦å…¬å¼€"}),(0,o.jsx)("li",{children:"status - å¸–å­çŠ¶æ€"})]})]}),(0,o.jsxs)("div",{className:"class-card",children:[(0,o.jsx)("h5",{children:"ðŸ’¬ Comment (è¯„è®º)"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"content - è¯„è®ºå†…å®¹"}),(0,o.jsx)("li",{children:"author - è¯„è®ºä½œè€…"}),(0,o.jsx)("li",{children:"post - æ‰€å±žå¸–å­"}),(0,o.jsx)("li",{children:"parent - çˆ¶è¯„è®º"}),(0,o.jsx)("li",{children:"likes - ç‚¹èµžæ•°"})]})]}),(0,o.jsxs)("div",{className:"class-card",children:[(0,o.jsx)("h5",{children:"ðŸ‘ Like (ç‚¹èµž)"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"user - ç‚¹èµžç”¨æˆ·"}),(0,o.jsx)("li",{children:"post - è¢«ç‚¹èµžå¸–å­"}),(0,o.jsx)("li",{children:"comment - è¢«ç‚¹èµžè¯„è®º"})]})]}),(0,o.jsxs)("div",{className:"class-card",children:[(0,o.jsx)("h5",{children:"ðŸ‘¥ Follow (å…³æ³¨)"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"follower - å…³æ³¨è€…"}),(0,o.jsx)("li",{children:"following - è¢«å…³æ³¨è€…"})]})]})]})]})]}),e&&(0,o.jsxs)("div",{className:"loading-state",children:[(0,o.jsx)("div",{className:"spinner"}),(0,o.jsx)("span",{children:"æ‰§è¡Œä¸­..."})]}),t&&(0,o.jsx)("div",{className:"message "+(t.includes("âŒ")?"error":t.includes("âš ï¸")?"warning":"success"),children:t}),(0,o.jsxs)("div",{className:"instructions",children:[(0,o.jsx)("h3",{children:"ðŸ“– ä½¿ç”¨è¯´æ˜Ž"}),"notion"===g&&(0,o.jsxs)("div",{className:"instruction-item",children:[(0,o.jsx)("h4",{children:"ðŸ”„ Notion åŒæ­¥"}),(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ£€æŸ¥è¿žæŽ¥:"})," éªŒè¯ Notion API è¿žæŽ¥çŠ¶æ€"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ä»Ž Notion å¯¼å…¥:"})," å°† Notion æ•°æ®åº“ä¸­çš„é¢˜ç›®åŒæ­¥åˆ°æœ¬åœ°"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ™ºèƒ½åŒ¹é…:"})," è‡ªåŠ¨è¯†åˆ«åˆ†ç±»ã€éš¾åº¦ã€æ ‡ç­¾ç­‰å­—æ®µ"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"åŽ»é‡æœºåˆ¶:"})," åŸºäºŽ Notion Page ID é¿å…é‡å¤å¯¼å…¥"]})]})]}),"data"===g&&(0,o.jsxs)("div",{className:"instruction-item",children:[(0,o.jsx)("h4",{children:"ðŸ“Š é¢˜ç›®æ•°æ®ç®¡ç†"}),(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ç”Ÿæˆç¤ºä¾‹æ•°æ®:"})," åˆ›å»ºåˆ†ç±»å’Œé¢˜ç›®ç¤ºä¾‹æ•°æ®"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ£€æŸ¥çŠ¶æ€:"})," æŸ¥çœ‹å½“å‰æ•°æ®ç»Ÿè®¡"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ¸…é™¤æ•°æ®:"})," åˆ é™¤æ‰€æœ‰é¢˜ç›®å’Œåˆ†ç±»æ•°æ®"]})]})]}),"community"===g&&(0,o.jsxs)("div",{className:"instruction-item",children:[(0,o.jsx)("h4",{children:"ðŸ‘¥ ç¤¾åŒºæ•°æ®ç®¡ç†"}),(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"åˆ›å»ºæ•°æ®è¡¨:"})," åˆå§‹åŒ–ç¤¾åŒºåŠŸèƒ½æ‰€éœ€çš„æ•°æ®è¡¨ï¼ˆPostã€Commentã€Likeã€Followï¼‰"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ç”Ÿæˆç¤ºä¾‹æ•°æ®:"})," åˆ›å»ºç¤ºä¾‹å¸–å­ã€è¯„è®ºå’Œç‚¹èµžæ•°æ®"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ£€æŸ¥çŠ¶æ€:"})," æŸ¥çœ‹ç¤¾åŒºæ•°æ®ç»Ÿè®¡"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"æ¸…é™¤æ•°æ®:"})," åˆ é™¤æ‰€æœ‰ç¤¾åŒºç›¸å…³æ•°æ®"]})]}),(0,o.jsxs)("div",{className:"community-features",children:[(0,o.jsx)("h5",{children:"ç¤¾åŒºåŠŸèƒ½ç‰¹æ€§:"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"ðŸ“ å‘å¸–å’Œå†…å®¹ç®¡ç†"}),(0,o.jsx)("li",{children:"ðŸ’¬ è¯„è®ºå’Œå›žå¤ç³»ç»Ÿ"}),(0,o.jsx)("li",{children:"ðŸ‘ ç‚¹èµžäº’åŠ¨åŠŸèƒ½"}),(0,o.jsx)("li",{children:"ðŸ‘¥ ç”¨æˆ·å…³æ³¨ç³»ç»Ÿ"}),(0,o.jsx)("li",{children:"ðŸ” å®Œå–„çš„æƒé™æŽ§åˆ¶"})]})]})]}),(0,o.jsxs)("div",{className:"instruction-item",children:[(0,o.jsx)("h4",{children:"ðŸ”§ çŽ¯å¢ƒé…ç½®è¦æ±‚"}),(0,o.jsxs)("div",{className:"config-requirements",children:[(0,o.jsxs)("div",{className:"config-item",children:[(0,o.jsx)("strong",{children:"Notion é›†æˆ:"}),(0,o.jsx)("span",{children:"éœ€è¦é…ç½® NOTION_INTEGRATION_TOKEN å’Œ NOTION_DATABASE_ID"})]}),(0,o.jsxs)("div",{className:"config-item",children:[(0,o.jsx)("strong",{children:"äº‘å‡½æ•°éƒ¨ç½²:"}),(0,o.jsx)("span",{children:"éœ€è¦åœ¨ LeanCloud äº‘å¼•æ“Žéƒ¨ç½²åŒæ­¥å‡½æ•°"})]}),(0,o.jsxs)("div",{className:"config-item",children:[(0,o.jsx)("strong",{children:"æ•°æ®åº“æƒé™:"}),(0,o.jsx)("span",{children:"Notion æ•°æ®åº“éœ€è¦åˆ†äº«ç»™é›†æˆ"})]})]})]})]})]})};var Je=t(6475),Ge=t(7097);const He=({question:e,onSave:s,onCancel:t,defaultCategoryId:n,onCategoryChange:i})=>{const[c,r]=(0,a.useState)({title:"",detailedAnswer:"",oralAnswer:"",code:"",url:"",tags:[],difficulty:b,proficiency:f,appearanceLevel:50,categoryId:"",images:[]}),[l,d]=(0,a.useState)([]),[h,m]=(0,a.useState)(""),[g,x]=(0,a.useState)(!1),[j,p]=(0,a.useState)(!1),[N,y]=(0,a.useState)({}),[w,C]=(0,a.useState)("detailed"),[k,S]=(0,a.useState)([]),A=u().User.current(),q=(0,a.useRef)(null),D=(0,a.useRef)(null),P=(0,a.useRef)(null),T=!!e;(0,a.useEffect)(()=>{u().User.current()&&(L(),e?r({title:e.title||"",detailedAnswer:e.detailedAnswer||"",oralAnswer:e.oralAnswer||"",code:e.code||"",url:e.url||"",tags:e.tags||[],difficulty:e.difficulty||b,proficiency:e.proficiency||f,appearanceLevel:e.appearanceLevel||50,categoryId:e.category?.id||"",images:e.images||[]}):n&&r(e=>({...e,categoryId:n})))},[e,n]);const L=async()=>{if(A){p(!0);try{const e=await v(),s=e.filter(e=>{const s=e.createdBy;return s&&s.id===A.id});d(s),console.log("åŠ è½½åˆ°çš„åˆ†ç±»:",{æ€»æ•°:e.length,ç”¨æˆ·åˆ†ç±»:s.length,å½“å‰ç”¨æˆ·:A.id,åˆ†ç±»è¯¦æƒ…:s.map(e=>({id:e.id,name:e.name,createdBy:e.createdBy?.id}))}),!T&&!n&&s.length>0&&!c.categoryId&&(r(e=>({...e,categoryId:s[0].id})),console.log("è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªåˆ†ç±»:",s[0].id))}catch(e){console.error("åŠ è½½ç±»åˆ«å¤±è´¥:",e),y({categories:"åŠ è½½ç±»åˆ«å¤±è´¥: "+e.message})}finally{p(!1)}}},I=async(e,s)=>{const t=e.filter(e=>"image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type);if(0!==t.length)for(const e of t)await Q(e,s);else alert("è¯·é€‰æ‹© JPG æˆ– PNG æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶")},Q=async(e,s)=>{const t=Date.now().toString();try{S(e=>[...e,t]);const a=new(u().File)(e.name,e),n=await a.save(),i={id:t,objectId:n.id,url:n.url(),name:e.name,size:e.size,type:e.type,answerType:s};r(e=>({...e,images:[...e.images,i]})),R(i,s)}catch(e){console.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",e),alert(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${e.message}`)}finally{S(e=>e.filter(e=>e!==t))}},R=(e,s)=>{const t=`![${e.name}](${e.url})`,a="detailed"===s?"detailedAnswer":"oralAnswer";r(e=>{const s=e[a],n=s?`${s}\n${t}`:t;return{...e,[a]:n}})},U=(e,s)=>{r(t=>({...t,[e]:s})),N[e]&&y(s=>({...s,[e]:""}))},O=()=>{const e=h.trim();if(e&&!c.tags.includes(e)){if(c.tags.length>=10)return void y({tags:"æ ‡ç­¾æ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ª"});r(s=>({...s,tags:[...s.tags,e]})),m(""),N.tags&&y(e=>({...e,tags:""}))}},M=(e,s,t)=>{const a=(n=e,c.images.filter(e=>e.answerType===n));var n;const i=k.length>0,l="detailed"===e?"detailedAnswer":"oralAnswer",d="detailed"===e?D:P;return(0,o.jsxs)("div",{className:"tab-panel",children:[(0,o.jsxs)("div",{className:"answer-textarea-container",onDragOver:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?D.current:P.current;t&&t.classList.add("drag-over")})(s,e),onDragLeave:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?D.current:P.current;t&&t.classList.remove("drag-over")})(s,e),onDrop:s=>((e,s)=>{e.preventDefault(),e.stopPropagation();const t="detailed"===s?D.current:P.current;t&&t.classList.remove("drag-over");const a=Array.from(e.dataTransfer.files);I(a,s)})(s,e),children:[(0,o.jsx)("textarea",{ref:d,value:c[l],onChange:e=>U(l,e.target.value),placeholder:s,rows:"detailed"===e?"6":"4",disabled:g,className:N.answer&&!c[l].trim()?"error":""}),(0,o.jsx)("div",{className:"upload-hint",children:(0,o.jsxs)("div",{className:"upload-hint-text",children:["ðŸ’¡ æ”¯æŒæ‹–æ‹½ JPG/PNG å›¾ç‰‡åˆ°æ­¤åŒºåŸŸï¼Œæˆ–",(0,o.jsx)("button",{type:"button",className:"upload-trigger-btn",onClick:()=>(e=>{q.current&&(q.current.setAttribute("data-answer-type",e),q.current.click())})(e),disabled:g||i,children:"ç‚¹å‡»ä¸Šä¼ "})]})})]}),a.length>0&&(0,o.jsxs)("div",{className:"uploaded-images",children:[(0,o.jsxs)("div",{className:"images-title",children:["å·²ä¸Šä¼ å›¾ç‰‡ (",a.length,"):"]}),(0,o.jsx)("div",{className:"images-grid",children:a.map(e=>(0,o.jsxs)("div",{className:"image-item",children:[(0,o.jsx)("img",{src:e.url,alt:e.name}),(0,o.jsxs)("div",{className:"image-info",children:[(0,o.jsx)("span",{className:"image-name",children:e.name}),(0,o.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>{return s=e.id,void r(e=>({...e,images:e.images.filter(e=>e.id!==s)}));var s},disabled:g,children:"Ã—"})]})]},e.id))})]}),(0,o.jsx)("div",{className:"tab-hint",children:t})]})};return A?(0,o.jsx)("div",{className:"question-form-overlay",children:(0,o.jsxs)("div",{className:"question-form-dialog",children:[(0,o.jsxs)("div",{className:"question-form-header",children:[(0,o.jsx)("h3",{children:T?"ç¼–è¾‘é¢˜ç›®":"æ·»åŠ æ–°é¢˜ç›®"}),(0,o.jsx)("div",{className:"user-info",children:(0,o.jsxs)("span",{className:"user-badge",children:["ðŸ‘¤ ",A.getUsername()]})}),(0,o.jsx)("button",{type:"button",className:"close-button",onClick:t,disabled:g,children:"Ã—"})]}),(0,o.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),A){if((()=>{const e={};return c.title.trim()?c.title.trim().length<2&&(e.title="é—®é¢˜æ ‡é¢˜è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦"):e.title="é—®é¢˜æ ‡é¢˜ä¸èƒ½ä¸ºç©º",c.detailedAnswer.trim()||c.oralAnswer.trim()||(e.answer="è‡³å°‘éœ€è¦å¡«å†™ä¸€ä¸ªç­”æ¡ˆç‰ˆæœ¬ï¼ˆè¯¦ç»†ç‰ˆæœ¬æˆ–å£è¿°ç‰ˆæœ¬ï¼‰"),c.categoryId||(e.categoryId="è¯·é€‰æ‹©ç±»åˆ«"),c.tags.length>10&&(e.tags="æ ‡ç­¾æ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ª"),c.url&&!(e=>{try{return new URL(e),!0}catch(e){return!1}})(c.url)&&(e.url="è¯·è¾“å…¥æœ‰æ•ˆçš„URLé“¾æŽ¥"),y(e),0===Object.keys(e).length})()){x(!0);try{if(T){const s=e.category,t=l.find(e=>e.id===c.categoryId),a=s?.id!==t?.id;await $(e.id,c),a&&i&&i({questionId:e.id,oldCategoryId:s?.id,newCategoryId:t?.id,question:{...e,...c,category:t}})}else await E(c);s(),window.dispatchEvent(new CustomEvent("questionCreated",{detail:{question:result}}))}catch(e){console.error("ä¿å­˜é¢˜ç›®å¤±è´¥:",e),y({submit:e.message})}finally{x(!1)}}}else alert("è¯·å…ˆç™»å½•")},className:"question-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"title",children:"é—®é¢˜æ ‡é¢˜ *"}),(0,o.jsx)("input",{id:"title",type:"text",value:c.title,onChange:e=>U("title",e.target.value),placeholder:"è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜",disabled:g,className:N.title?"error":""}),N.title&&(0,o.jsx)("span",{className:"error-message",children:N.title})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"é—®é¢˜ç­”æ¡ˆ *"}),(0,o.jsxs)("div",{className:"answer-tabs-container",children:[(0,o.jsxs)("div",{className:"answer-tab-buttons",children:[(0,o.jsx)("button",{type:"button",className:"answer-tab-button "+("detailed"===w?"active":""),onClick:()=>C("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,o.jsx)("button",{type:"button",className:"answer-tab-button "+("oral"===w?"active":""),onClick:()=>C("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,o.jsxs)("div",{className:"answer-tab-content",children:["detailed"===w&&M("detailed","è¯·è¾“å…¥è¯¦ç»†çš„ç­”æ¡ˆè§£é‡Šï¼ŒåŒ…å«æŠ€æœ¯ç»†èŠ‚ã€åŽŸç†åˆ†æžç­‰","é€‚åˆè®°å½•å®Œæ•´çš„æŠ€æœ¯è§£æžå’Œè¯¦ç»†è¯´æ˜Ž"),"oral"===w&&M("oral","è¯·è¾“å…¥ç®€æ´çš„å£è¿°ç‰ˆæœ¬ç­”æ¡ˆï¼Œé€‚åˆé¢è¯•åœºæ™¯è¡¨è¾¾","é€‚åˆè®°å½•ç®€æ´çš„å£å¤´è¡¨è¾¾ç‰ˆæœ¬ï¼Œä¾¿äºŽé¢è¯•æ—¶å¿«é€Ÿå›žå¿†")]})]}),N.answer&&(0,o.jsx)("span",{className:"error-message",children:N.answer})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"code",children:"ç›¸å…³ä»£ç ï¼ˆå¯é€‰ï¼‰"}),(0,o.jsx)("textarea",{id:"code",value:c.code,onChange:e=>U("code",e.target.value),placeholder:"è¯·è¾“å…¥ä¸Žè¯¥é¢˜ç›®ç›¸å…³çš„ä»£ç ç‰‡æ®µï¼Œå°†ä¿æŒåŽŸæ ¼å¼æ˜¾ç¤º",rows:"8",disabled:g,className:"code-textarea"}),(0,o.jsx)("div",{className:"field-hint",children:"ä»£ç å°†ä¿æŒåŽŸæ ¼å¼æ˜¾ç¤ºï¼Œé€‚åˆå±•ç¤ºç®—æ³•å®žçŽ°ã€ç»„ä»¶ä»£ç ç­‰"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"url",children:"ç›¸å…³é“¾æŽ¥ï¼ˆå¯é€‰ï¼‰"}),(0,o.jsx)("input",{id:"url",type:"url",value:c.url,onChange:e=>U("url",e.target.value),placeholder:"https://example.com",disabled:g,className:N.url?"error":""}),N.url&&(0,o.jsx)("span",{className:"error-message",children:N.url}),(0,o.jsx)("div",{className:"field-hint",children:"å¯æ·»åŠ ç›¸å…³çš„æ–‡æ¡£ã€æ–‡ç« æˆ–å‚è€ƒé“¾æŽ¥"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"tags",children:"æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰"}),(0,o.jsxs)("div",{className:"tags-input-container",children:[(0,o.jsx)("input",{id:"tags",type:"text",value:h,onChange:e=>m(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),O())},placeholder:"è¾“å…¥æ ‡ç­¾åŽæŒ‰å›žè½¦æˆ–ç‚¹å‡»æ·»åŠ ",disabled:g,maxLength:20}),(0,o.jsx)("button",{type:"button",onClick:O,disabled:g||!h.trim(),className:"add-tag-button",children:"æ·»åŠ "})]}),N.tags&&(0,o.jsx)("span",{className:"error-message",children:N.tags}),c.tags.length>0&&(0,o.jsxs)("div",{className:"tags-list",children:[(0,o.jsx)("div",{className:"tags-header",children:(0,o.jsxs)("span",{children:["å·²æ·»åŠ æ ‡ç­¾ (",c.tags.length,"/10):"]})}),(0,o.jsx)("div",{className:"tags-container",children:c.tags.map((e,s)=>(0,o.jsxs)("span",{className:"tag",children:[e,(0,o.jsx)("button",{type:"button",onClick:()=>{return s=e,void r(e=>({...e,tags:e.tags.filter(e=>e!==s)}));var s},disabled:g,className:"remove-tag-button",children:"Ã—"})]},s))})]})]}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"difficulty",children:"éš¾åº¦"}),(0,o.jsxs)("select",{id:"difficulty",value:c.difficulty,onChange:e=>U("difficulty",e.target.value),disabled:g,children:[(0,o.jsx)("option",{value:"easy",children:"ç®€å•"}),(0,o.jsx)("option",{value:b,children:"ä¸­ç­‰"}),(0,o.jsx)("option",{value:"hard",children:"å›°éš¾"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"proficiency",children:"æŽŒæ¡ç¨‹åº¦"}),(0,o.jsxs)("select",{id:"proficiency",value:c.proficiency,onChange:e=>U("proficiency",e.target.value),disabled:g,children:[(0,o.jsx)("option",{value:f,children:"åˆçº§"}),(0,o.jsx)("option",{value:"intermediate",children:"ä¸­çº§"}),(0,o.jsx)("option",{value:"advanced",children:"é«˜çº§"}),(0,o.jsx)("option",{value:"master",children:"ç²¾é€š"})]})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"appearanceLevel",children:["å‡ºçŽ°é¢‘çŽ‡: ",c.appearanceLevel,"%",(0,o.jsx)("span",{className:"field-hint",children:"ï¼ˆæ•°å€¼è¶Šé«˜ï¼Œåœ¨å¤ä¹ æ—¶å‡ºçŽ°çš„æ¦‚çŽ‡è¶Šå¤§ï¼‰"})]}),(0,o.jsx)("input",{id:"appearanceLevel",type:"range",min:"0",max:"100",value:c.appearanceLevel,onChange:e=>U("appearanceLevel",parseInt(e.target.value)),disabled:g,className:"appearance-slider"}),(0,o.jsxs)("div",{className:"slider-labels",children:[(0,o.jsx)("span",{children:"ä½Žé¢‘"}),(0,o.jsx)("span",{children:"ä¸­é¢‘"}),(0,o.jsx)("span",{children:"é«˜é¢‘"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"category",children:"ç±»åˆ« *"}),j?(0,o.jsx)("div",{className:"loading-categories",children:"åŠ è½½ç±»åˆ«ä¸­..."}):0===l.length?(0,o.jsxs)("div",{className:"no-categories",children:[(0,o.jsx)("div",{className:"no-categories-icon",children:"ðŸ“"}),(0,o.jsx)("p",{children:"æš‚æ— ç±»åˆ«ï¼Œè¯·å…ˆåˆ›å»ºç±»åˆ«"}),(0,o.jsx)("button",{type:"button",className:"create-category-btn",onClick:()=>{t(),window.dispatchEvent(new CustomEvent("showCategoryManagement"))},children:"ðŸš€ åŽ»åˆ›å»ºåˆ†ç±»"})]}):(0,o.jsxs)("select",{id:"category",value:c.categoryId,onChange:e=>U("categoryId",e.target.value),disabled:g,className:N.categoryId?"error":"",children:[(0,o.jsx)("option",{value:"",children:"è¯·é€‰æ‹©ç±»åˆ«"}),l.map(e=>(0,o.jsxs)("option",{value:e.id,children:[e.name," (",e.questionCount||0,"é¢˜)"]},e.id))]}),N.categoryId&&(0,o.jsx)("span",{className:"error-message",children:N.categoryId})]}),N.submit&&(0,o.jsx)("div",{className:"submit-error",children:N.submit}),(0,o.jsxs)("div",{className:"form-actions",children:[(0,o.jsx)("button",{type:"button",onClick:t,disabled:g,className:"btn-secondary",children:"å–æ¶ˆ"}),(0,o.jsx)("button",{type:"submit",disabled:g,className:"btn-primary",children:g?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"loading-spinner"}),T?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­..."]}):T?"æ›´æ–°é¢˜ç›®":"æ·»åŠ é¢˜ç›®"})]})]}),(0,o.jsx)("input",{type:"file",ref:q,style:{display:"none"},accept:".jpg,.jpeg,.png",multiple:!0,onChange:e=>{const s=e.target.getAttribute("data-answer-type");((e,s)=>{const t=Array.from(e.target.files);I(t,s),e.target.value=""})(e,s)}})]})}):(0,o.jsx)("div",{className:"question-form-overlay",children:(0,o.jsxs)("div",{className:"question-form-dialog",children:[(0,o.jsxs)("div",{className:"question-form-header",children:[(0,o.jsx)("h3",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("button",{type:"button",className:"close-button",onClick:t,children:"Ã—"})]}),(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯æ·»åŠ æˆ–ç¼–è¾‘é¢˜ç›®"}),(0,o.jsxs)("div",{className:"auth-required-actions",children:[(0,o.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"}),(0,o.jsx)("button",{onClick:t,className:"btn-secondary",children:"å–æ¶ˆ"})]})]})]})})},Ke=({question:e,onDelete:s,isExpandedView:t=!1,onUpdateField:n,onEdit:i,showQuestionForm:c,setShowQuestionForm:r,editingQuestion:l,setEditingQuestion:d})=>{const[h,m]=(0,a.useState)(!1),[g,x]=(0,a.useState)(t),[j,p]=(0,a.useState)(!1),[v,N]=(0,a.useState)(!1),[y,w]=(0,a.useState)("oral"),[b,f]=(0,a.useState)(e?.appearanceLevel||50),[C,k]=(0,a.useState)(!1),[S,A]=(0,a.useState)(!1),[q,D]=(0,a.useState)(7),[E,P]=(0,a.useState)(!1),[T,$]=(0,a.useState)(!1),[L,I]=(0,a.useState)(7),[Q,R]=(0,a.useState)(!1),[U,O]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=u().User.current();O(e)},[]),(0,a.useEffect)(()=>{console.log("question.appearanceLevel å˜åŒ–:",e?.appearanceLevel),f(e?.appearanceLevel)},[e?.appearanceLevel]),(0,a.useEffect)(()=>{console.log("localAppearanceLevel çŠ¶æ€å˜åŒ–:",b)},[b]);const M=e=>e>=80?"#ff6b6b":e>=60?"#ffa726":e>=40?"#4ecdc4":"#95a5a6",F=e=>(e=>{if(!e||""===e.trim())return(0,o.jsx)("span",{className:"no-content",children:"æš‚æ— å†…å®¹"});const s=e.split("\n"),t=[];let a=!1,n=[],i="";return s.forEach((e,s)=>{if(e.trim().startsWith("```"))return a?(a=!1,void t.push((0,o.jsx)("pre",{className:"code-block",children:(0,o.jsx)("code",{className:`language-${i}`,children:n.join("\n")})},`code-${s}`))):(a=!0,i=e.trim().substring(3).trim()||"text",void(n=[]));if(a)return void n.push(e);if(""===e.trim())return void t.push((0,o.jsx)("br",{},`br-${s}`));const c=e.match(/!\[(.*?)\]\((.*?)\)/);if(c){const e=c[1],a=c[2];return void t.push((0,o.jsxs)("div",{className:"markdown-image-container",children:[(0,o.jsx)("img",{src:a,alt:e,className:"markdown-image-preview",onClick:e=>{e.stopPropagation(),window.open(a,"_blank")}}),e&&""!==e&&(0,o.jsx)("div",{className:"image-alt-text",children:e})]},`img-${s}`))}let r=e;if(e.startsWith("### "))return void t.push((0,o.jsx)("h3",{className:"md-h3",children:e.substring(4)},`h3-${s}`));if(e.startsWith("## "))return void t.push((0,o.jsx)("h2",{className:"md-h2",children:e.substring(3)},`h2-${s}`));if(e.startsWith("# "))return void t.push((0,o.jsx)("h1",{className:"md-h1",children:e.substring(2)},`h1-${s}`));if(r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r=r.replace(/__(.*?)__/g,"<strong>$1</strong>"),r=r.replace(/\*(.*?)\*/g,"<em>$1</em>"),r=r.replace(/_(.*?)_/g,"<em>$1</em>"),r=r.replace(/`(.*?)`/g,'<code class="inline-code">$1</code>'),r=r.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="md-link">$1</a>'),e.trim().startsWith("- ")||e.trim().startsWith("* ")){const a=e.trim().substring(2);return void t.push((0,o.jsxs)("div",{className:"md-list-item",children:["â€¢ ",a]},`li-${s}`))}const l=e.trim().match(/^(\d+)\.\s+(.*)$/);l?t.push((0,o.jsxs)("div",{className:"md-list-item",children:[l[1],". ",l[2]]},`oli-${s}`)):e.trim().startsWith("> ")?t.push((0,o.jsx)("blockquote",{className:"md-blockquote",children:e.substring(2)},`blockquote-${s}`)):t.push((0,o.jsx)("div",{className:"md-paragraph",dangerouslySetInnerHTML:{__html:r}},`p-${s}`))}),a&&n.length>0&&t.push((0,o.jsx)("pre",{className:"code-block",children:(0,o.jsx)("code",{className:`language-${i}`,children:n.join("\n")})},"code-final")),(0,o.jsx)("div",{className:"markdown-content",children:t})})(e),_=()=>{U?i?i(e):m(!0):alert("è¯·å…ˆç™»å½•")},B=async()=>{if(U){if(!j&&window.confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${e.title}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)){p(!0);try{await s(e.id)}catch(e){console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e)}finally{p(!1)}}}else alert("è¯·å…ˆç™»å½•")};if(!U)return(0,o.jsx)("div",{className:"question-detail-card "+(t?"expanded-view":""),children:(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("h3",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…"}),(0,o.jsx)("div",{className:"auth-required-actions",children:(0,o.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"})})]})});if(h&&!i)return(0,o.jsx)("div",{className:"question-edit-container "+(t?"expanded-view":""),children:(0,o.jsx)(He,{question:e,onSave:()=>{m(!1)},onCancel:()=>{m(!1)}})});const W=e?.detailedAnswer||"",z=e?.oralAnswer||"",V=e?.code||"",J=e?.url||"",G=b;return(0,o.jsxs)("div",{className:"question-detail-card "+(t?"expanded-view":""),children:[!t&&(0,o.jsxs)("div",{className:"question-header",children:[(0,o.jsxs)("div",{className:"question-title-section",children:[(0,o.jsx)("h3",{className:"question-title",children:e?.title||"æ— æ ‡é¢˜"}),(0,o.jsxs)("div",{className:"question-meta-badges",children:[(0,o.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:(e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}})(e?.difficulty)},children:(e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return e}})(e?.difficulty)}),(0,o.jsx)("span",{className:"proficiency-badge",children:(e=>{switch(e){case"beginner":return"åˆçº§";case"intermediate":return"ä¸­çº§";case"advanced":return"é«˜çº§";case"master":return"ç²¾é€š";default:return e}})(e?.proficiency)})]})]}),(0,o.jsxs)("div",{className:"question-actions",children:[(0,o.jsx)("button",{onClick:_,className:"btn-edit",title:"ç¼–è¾‘é¢˜ç›®",disabled:j,children:v?"ç¼–è¾‘ä¸­...":"âœï¸ ç¼–è¾‘"}),(0,o.jsx)("button",{onClick:()=>$(!0),className:"btn-remove-review",title:"æš‚æ—¶ç§»é™¤å¤ä¹ ",children:"â¸ï¸ æš‚åœå¤ä¹ "}),(0,o.jsx)("button",{onClick:B,className:"btn-delete",title:"åˆ é™¤é¢˜ç›®",disabled:j,children:j?"åˆ é™¤ä¸­...":"ðŸ—‘ï¸ åˆ é™¤"})]})]}),(0,o.jsxs)("div",{className:"appearance-level-display",children:[(0,o.jsxs)("div",{className:"appearance-header",children:[(0,o.jsx)("span",{className:"appearance-label",children:"å‡ºçŽ°é¢‘çŽ‡"}),(0,o.jsx)("span",{className:"appearance-value "+(C?"updating":""),children:C?"ä¿å­˜ä¸­...":`${G}%`})]}),(0,o.jsx)("div",{className:"appearance-slider-container",children:(0,o.jsx)("input",{type:"range",min:"0",max:"100",value:G,onChange:s=>{(async s=>{if(U)if(console.log("å¼€å§‹æ›´æ–°å‡ºçŽ°é¢‘çŽ‡:",{æ–°å€¼:s,å½“å‰propå€¼:e?.appearanceLevel,å½“å‰æœ¬åœ°çŠ¶æ€å€¼:b}),f(s),n&&e?.id){k(!0);try{await n(e.id,"appearanceLevel",s),console.log("å‡ºçŽ°é¢‘çŽ‡æ›´æ–°æˆåŠŸï¼Œç­‰å¾…çˆ¶ç»„ä»¶æ•°æ®æ›´æ–°")}catch(s){console.error("æ›´æ–°å‡ºçŽ°é¢‘çŽ‡å¤±è´¥:",s),f(e?.appearanceLevel||50)}finally{k(!1)}}else console.warn("ç¼ºå°‘ onUpdateField æˆ– question.id");else alert("è¯·å…ˆç™»å½•")})(parseInt(s.target.value))},className:"appearance-slider-editable",disabled:C,style:{background:`linear-gradient(90deg, \n                ${M(0)} 0%, \n                ${M(50)} 50%, \n                ${M(100)} 100%)`}})}),(0,o.jsxs)("div",{className:"appearance-labels",children:[(0,o.jsx)("span",{className:"appearance-label-low",children:"ä½Žé¢‘"}),(0,o.jsx)("span",{className:"appearance-label-high",children:"é«˜é¢‘"})]}),(0,o.jsxs)("div",{className:"appearance-hint",children:["æ‹–åŠ¨æ»‘å—è°ƒæ•´å‡ºçŽ°é¢‘çŽ‡ï¼Œæ•°å€¼è¶Šé«˜åœ¨å¤ä¹ æ—¶å‡ºçŽ°çš„æ¦‚çŽ‡è¶Šå¤§",C&&(0,o.jsx)("span",{className:"saving-indicator",children:" â€¢ ä¿å­˜ä¸­..."})]})]}),(0,o.jsxs)("div",{className:"answer-section",children:[!t&&(0,o.jsxs)("div",{className:"answer-header",children:[(0,o.jsx)("h4",{children:"ç­”æ¡ˆ"}),(0,o.jsxs)("div",{className:"answer-controls",children:[(0,o.jsxs)("div",{className:"answer-tabs",children:[(0,o.jsx)("button",{className:"tab-button "+("detailed"===y?"active":""),onClick:()=>w("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,o.jsx)("button",{className:"tab-button "+("oral"===y?"active":""),onClick:()=>w("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,o.jsx)("button",{onClick:()=>{x(!g)},className:"toggle-answer-btn",children:g?"æ”¶èµ·":"å±•å¼€"})]})]}),(0,o.jsx)("div",{className:"answer-content "+(g||t?"expanded":"collapsed"),children:t?(0,o.jsxs)("div",{className:"expanded-answer-tabs",children:[(0,o.jsxs)("div",{className:"expanded-tab-buttons",children:[(0,o.jsx)("button",{className:"expanded-tab-button "+("detailed"===y?"active":""),onClick:()=>w("detailed"),children:"è¯¦ç»†ç‰ˆæœ¬"}),(0,o.jsx)("button",{className:"expanded-tab-button "+("oral"===y?"active":""),onClick:()=>w("oral"),children:"å£è¿°ç‰ˆæœ¬"})]}),(0,o.jsx)("div",{className:"expanded-tab-content",children:"detailed"===y?(0,o.jsxs)("div",{className:"detailed-answer",children:[(0,o.jsx)("h5",{children:"è¯¦ç»†ç­”æ¡ˆ"}),(0,o.jsx)("div",{className:"answer-text markdown-enabled",children:F(W)})]}):(0,o.jsxs)("div",{className:"oral-answer",children:[(0,o.jsx)("h5",{children:"å£è¿°ç­”æ¡ˆ"}),(0,o.jsx)("div",{className:"answer-text markdown-enabled",children:F(z)})]})})]}):(0,o.jsx)("div",{className:"answer-text markdown-enabled",children:F("detailed"===y?W:z)})}),V&&V.trim()&&(0,o.jsxs)("div",{className:"code-section",children:[(0,o.jsx)("h5",{children:"ç›¸å…³ä»£ç "}),(e=>e&&""!==e.trim()?(0,o.jsx)("pre",{className:"code-block",children:(0,o.jsx)("code",{children:e})}):null)(V)]}),J&&J.trim()&&(0,o.jsxs)("div",{className:"url-section",children:[(0,o.jsx)("h5",{children:"ç›¸å…³é“¾æŽ¥"}),(0,o.jsxs)("a",{href:J,target:"_blank",rel:"noopener noreferrer",className:"question-link",children:["ðŸ”— ",J]})]})]}),(0,o.jsxs)("div",{className:"review-confirm-section",children:[(0,o.jsx)("button",{className:"confirm-review-btn",onClick:()=>A(!0),children:"âœ… ç¡®è®¤å·²å¤ä¹ "}),(0,o.jsx)("p",{className:"review-hint",children:"ç‚¹å‡»ç¡®è®¤åŽï¼Œè¯¥é¢˜ç›®å°†åœ¨ä¸€æ®µæ—¶é—´å†…ä¸ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­"})]}),S&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content review-confirm-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"ç¡®è®¤å¤ä¹ å®Œæˆ"}),(0,o.jsx)("button",{className:"close-btn",onClick:()=>A(!1),children:"Ã—"})]}),(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsx)("p",{children:"è¯·é€‰æ‹©åœ¨å¤šå°‘å¤©å†…ä¸å†æé†’å¤ä¹ è¿™é“é¢˜ç›®ï¼š"}),(0,o.jsxs)("div",{className:"review-days-selector",children:[(0,o.jsx)("div",{className:"days-presets",children:[1,3,7,14,30].map(e=>(0,o.jsxs)("button",{className:"days-preset-btn "+(q===e?"active":""),onClick:()=>D(e),children:[e,"å¤©"]},e))}),(0,o.jsxs)("div",{className:"custom-days-input",children:[(0,o.jsx)("label",{htmlFor:"customDays",children:"è‡ªå®šä¹‰å¤©æ•°ï¼š"}),(0,o.jsx)("input",{id:"customDays",type:"number",min:"1",max:"365",value:q,onChange:e=>D(parseInt(e.target.value)||1),className:"days-input"})]})]}),(0,o.jsxs)("div",{className:"review-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"é¢˜ç›®ï¼š"}),e?.title]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"ä¸‹æ¬¡æé†’æ—¶é—´ï¼š"}),new Date(Date.now()+24*q*60*60*1e3).toLocaleDateString()]})]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"cancel-btn",onClick:()=>A(!1),disabled:E,children:"å–æ¶ˆ"}),(0,o.jsx)("button",{className:"confirm-btn",onClick:async()=>{if(U){if(!E){P(!0);try{const s=new Date;s.setDate(s.getDate()+q),n&&e?.id&&(await n(e.id,"nextReviewDate",s.toISOString()),console.log(`é¢˜ç›®å°†åœ¨ ${q} å¤©åŽå†æ¬¡æé†’å¤ä¹ `),alert(`å·²ç¡®è®¤å¤ä¹ ï¼è¯¥é¢˜ç›®å°†åœ¨ ${q} å¤©åŽå†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­`),A(!1))}catch(e){console.error("ç¡®è®¤å¤ä¹ å¤±è´¥:",e),alert("ç¡®è®¤å¤ä¹ å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{P(!1)}}}else alert("è¯·å…ˆç™»å½•")},disabled:E,children:E?"ç¡®è®¤ä¸­...":"ç¡®è®¤å¤ä¹ "})]})]})}),T&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content remove-review-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"æš‚åœå¤ä¹ æé†’"}),(0,o.jsx)("button",{className:"close-btn",onClick:()=>$(!1),children:"Ã—"})]}),(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsx)("p",{children:"é€‰æ‹©åœ¨å¤šå°‘å¤©å†…ä¸å†æé†’å¤ä¹ è¿™é“é¢˜ç›®ï¼š"}),(0,o.jsxs)("div",{className:"remove-days-selector",children:[(0,o.jsx)("div",{className:"days-presets",children:[1,3,7,14,30,90].map(e=>(0,o.jsxs)("button",{className:"days-preset-btn "+(L===e?"active":""),onClick:()=>I(e),children:[e,"å¤©"]},e))}),(0,o.jsxs)("div",{className:"custom-days-input",children:[(0,o.jsx)("label",{htmlFor:"customRemoveDays",children:"è‡ªå®šä¹‰å¤©æ•°ï¼š"}),(0,o.jsx)("input",{id:"customRemoveDays",type:"number",min:"1",max:"365",value:L,onChange:e=>I(parseInt(e.target.value)||1),className:"days-input"})]})]}),(0,o.jsxs)("div",{className:"remove-review-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"é¢˜ç›®ï¼š"}),e?.title]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"ä¸‹æ¬¡æé†’æ—¶é—´ï¼š"}),new Date(Date.now()+24*L*60*60*1e3).toLocaleDateString()]}),(0,o.jsx)("p",{className:"info-text",children:"ðŸ’¡ åœ¨æ­¤æœŸé—´ï¼Œè¯¥é¢˜ç›®ä¸ä¼šå‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­"})]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"cancel-btn",onClick:()=>$(!1),disabled:Q,children:"å–æ¶ˆ"}),(0,o.jsx)("button",{className:"confirm-btn",onClick:async()=>{if(U){if(!Q){R(!0);try{const s=new Date;s.setDate(s.getDate()+L),n&&e?.id&&(await n(e.id,"nextReviewDate",s.toISOString()),console.log(`é¢˜ç›®å°†åœ¨ ${L} å¤©åŽå†æ¬¡æé†’å¤ä¹ `),alert(`å·²æš‚åœå¤ä¹ ï¼è¯¥é¢˜ç›®å°†åœ¨ ${L} å¤©åŽå†æ¬¡å‡ºçŽ°åœ¨å¤ä¹ åˆ—è¡¨ä¸­`),$(!1))}catch(e){console.error("ç§»é™¤å¤ä¹ å¤±è´¥:",e),alert("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{R(!1)}}}else alert("è¯·å…ˆç™»å½•")},disabled:Q,children:Q?"å¤„ç†ä¸­...":"ç¡®è®¤æš‚åœ"})]})]})}),(0,o.jsxs)("div",{className:"card-details",children:[!t&&(0,o.jsxs)("div",{className:"category-info",children:[(0,o.jsx)("span",{className:"category-label",children:"æ‰€å±žåˆ†ç±»:"}),(0,o.jsx)("span",{className:"category-name",children:e?.category?.name||"æœªåˆ†ç±»"})]}),e?.tags&&e.tags.length>0&&(0,o.jsxs)("div",{className:"tags-section",children:[(0,o.jsx)("h4",{children:"æ ‡ç­¾"}),(0,o.jsx)("div",{className:"tags-container",children:e.tags.map((e,s)=>(0,o.jsxs)("span",{className:"tag",children:["#",e]},s))})]}),(0,o.jsxs)("div",{className:"time-info",children:[(0,o.jsxs)("span",{className:"create-time",children:["åˆ›å»º: ",e?.createdAt?new Date(e.createdAt).toLocaleDateString():"æœªçŸ¥"]}),(0,o.jsxs)("span",{className:"update-time",children:["æ›´æ–°: ",e?.updatedAt?new Date(e.updatedAt).toLocaleDateString():"æœªçŸ¥"]})]})]}),t&&(0,o.jsxs)("div",{className:"expanded-actions",children:[(0,o.jsx)("button",{onClick:_,className:"btn-edit primary",disabled:j,children:"âœï¸ ç¼–è¾‘é¢˜ç›®"}),(0,o.jsx)("button",{onClick:()=>$(!0),className:"btn-remove-review secondary",children:"â¸ï¸ æš‚åœå¤ä¹ "}),(0,o.jsx)("button",{onClick:B,className:"btn-delete secondary",disabled:j,children:"ðŸ—‘ï¸ åˆ é™¤é¢˜ç›®"})]}),c&&l&&l.id===e.id&&(0,o.jsx)("div",{className:"form-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,padding:"20px"},children:(0,o.jsx)(He,{question:l,onSave:()=>{r(!1),d(null)},onCancel:()=>{r(!1),d(null)},defaultCategoryId:e?.category?.id})})]})},Ye=({question:e,index:s,isExpanded:t,onToggle:a,onDelete:n,onEdit:i,onUpdateField:c,viewMode:r,isDragging:l,isDragOver:d,onDragStart:h,onDragOver:u,onDragLeave:m,onDrop:g,onDragEnd:x,canDrag:j,showQuestionForm:p,setShowQuestionForm:v,editingQuestion:N,setEditingQuestion:y})=>{const w=e=>{switch(e){case"easy":return"#52c41a";case"medium":return"#faad14";case"hard":return"#f5222d";default:return"#666"}},b=e=>{switch(e){case"easy":return"#b7eb8f";case"medium":return"#ffe58f";case"hard":return"#ffa39e";default:return"#d9d9d9"}},f=e=>{switch(e){case"easy":return"#f6ffed";case"medium":return"#fffbe6";case"hard":return"#fff2f0";default:return"#fafafa"}},C=e=>{switch(e){case"easy":return"ç®€å•";case"medium":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return e}},k=e=>{switch(e){case"beginner":return"#ff6b6b";case"intermediate":return"#4ecdc4";case"advanced":return"#45b7d1";case"master":return"#96ceb4";default:return"#95a5a6"}},S=e=>{switch(e){case"beginner":return"ðŸŽ€";case"intermediate":return"ðŸŽ—ï¸";case"advanced":return"ðŸ…";case"master":return"ðŸ‘‘";default:return"ðŸŽ¯"}},A=e=>{switch(e){case"beginner":return"åˆçº§";case"intermediate":return"ä¸­çº§";case"advanced":return"é«˜çº§";case"master":return"ç²¾é€š";default:return e}},q=e=>new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=()=>{const s=e.oralAnswer||e.detailedAnswer;return s?s.substring(0,150)+(s.length>150?"...":""):"æš‚æ— ç­”æ¡ˆå†…å®¹"};return t?(0,o.jsxs)("div",{className:"expanded-question-view","data-question-id":e.id,children:[(0,o.jsxs)("div",{className:"expanded-header",children:[(0,o.jsxs)("button",{onClick:a,className:"back-to-list-btn",children:[(0,o.jsx)("span",{className:"back-icon",children:"â†"}),"è¿”å›žåˆ—è¡¨"]}),(0,o.jsxs)("div",{className:"expanded-title",children:[(0,o.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,o.jsx)("h3",{children:e.title})]}),(0,o.jsx)("div",{className:"expanded-actions",children:(0,o.jsx)("button",{onClick:()=>i(e),className:"btn-edit",children:"âœï¸ ç¼–è¾‘"})})]}),(0,o.jsx)("div",{className:"expanded-content",children:(0,o.jsx)(Ke,{question:e,onDelete:n,onUpdateField:c,isExpandedView:!0,onEdit:i,showQuestionForm:p,setShowQuestionForm:v,editingQuestion:N,setEditingQuestion:y})})]}):"grid"===r?(0,o.jsxs)("div",{className:`question-grid-card ${l?"dragging":""} ${d?"drag-over":""}`,onClick:a,draggable:j,onDragStart:h,onDragOver:u,onDragLeave:m,onDrop:g,onDragEnd:x,"data-question-id":e.id,style:{borderLeft:`4px solid ${w(e.difficulty)}`,backgroundColor:f(e.difficulty),border:`1px solid ${b(e.difficulty)}`},children:[(0,o.jsxs)("div",{className:"proficiency-ribbon",style:{backgroundColor:k(e.proficiency)},children:[(0,o.jsx)("span",{className:"ribbon-icon",children:S(e.proficiency)}),(0,o.jsx)("span",{className:"ribbon-text",children:A(e.proficiency)})]}),(0,o.jsxs)("div",{className:"grid-header",children:[(0,o.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,o.jsx)("span",{className:"difficulty-tag",style:{backgroundColor:w(e.difficulty)},children:C(e.difficulty)})]}),(0,o.jsx)("h4",{className:"grid-title",children:e.title}),(0,o.jsxs)("div",{className:"appearance-level-indicator",children:[(0,o.jsx)("div",{className:"appearance-bar",style:{width:`${e.appearanceLevel||50}%`,backgroundColor:(E=e.appearanceLevel||50,E>=80?"#ff6b6b":E>=60?"#ffa726":E>=40?"#4ecdc4":"#95a5a6")}}),(0,o.jsxs)("span",{className:"appearance-text",children:[e.appearanceLevel||50,"%"]})]}),(0,o.jsx)("div",{className:"grid-meta",children:(0,o.jsxs)("span",{className:"update-time",children:["æ›´æ–°: ",q(e.updatedAt)]})}),(0,o.jsx)("div",{className:"grid-preview",children:(0,o.jsx)("div",{className:"preview-content",children:D()})}),j&&(0,o.jsx)("div",{className:"drag-handle",children:"â‹®â‹®"})]}):(0,o.jsxs)("div",{className:`modern-accordion ${t?"expanded":""} ${l?"dragging":""} ${d?"drag-over":""}`,draggable:j,onDragStart:h,onDragOver:u,onDragLeave:m,onDrop:g,onDragEnd:x,"data-question-id":e.id,style:{borderLeft:`4px solid ${w(e.difficulty)}`,backgroundColor:f(e.difficulty),border:`1px solid ${b(e.difficulty)}`},children:[(0,o.jsxs)("div",{className:"proficiency-ribbon",style:{backgroundColor:k(e.proficiency)},children:[(0,o.jsx)("span",{className:"ribbon-icon",children:S(e.proficiency)}),(0,o.jsx)("span",{className:"ribbon-text",children:A(e.proficiency)})]}),(0,o.jsxs)("div",{className:"accordion-header",onClick:a,children:[(0,o.jsxs)("div",{className:"header-main",children:[(0,o.jsxs)("div",{className:"question-meta",children:[(0,o.jsxs)("span",{className:"question-index",children:["#",s+1]}),(0,o.jsx)("span",{className:"difficulty-badge",style:{backgroundColor:w(e.difficulty)},children:C(e.difficulty)}),(0,o.jsxs)("span",{className:"appearance-badge",children:["ðŸ“Š ",e.appearanceLevel||50,"%"]}),(0,o.jsxs)("span",{className:"time-badge",children:["â±ï¸ ",q(e.updatedAt)]})]}),(0,o.jsx)("h3",{className:"question-title",children:e.title}),(0,o.jsx)("div",{className:"question-preview",children:D()})]}),(0,o.jsxs)("div",{className:"header-actions",children:[j&&(0,o.jsx)("div",{className:"drag-handle",onClick:e=>e.stopPropagation(),children:"â‹®â‹®"}),(0,o.jsx)("span",{className:"accordion-icon",children:t?"â–¼":"â–º"})]})]})]});var E},Ze=()=>{const{categoryId:e}=(0,i.g)(),s=(0,i.Zp)(),t=(0,r.jE)(),[n,c]=(0,a.useState)(null),[l,d]=(0,a.useState)([]),[h,g]=(0,a.useState)(!1),[j,p]=(0,a.useState)(null),[N,y]=(0,a.useState)(""),[w,b]=(0,a.useState)("createdAt"),[f,C]=(0,a.useState)(new Set),[k,S]=(0,a.useState)("accordion"),[A,q]=(0,a.useState)(null),[D,E]=(0,a.useState)(null),[T,L]=(0,a.useState)(""),[I,Q]=(0,a.useState)(null),R=(0,a.useRef)(null),U=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=u().User.current();Q(e),e&&O()},[e]),(0,a.useEffect)(()=>{const e=e=>{const{questionId:s}=e.detail,t=document.querySelector(`[data-question-id="${s}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.boxShadow="0 0 0 3px #667eea",setTimeout(()=>{t.style.boxShadow=""},2e3),f.has(s)||ae(s))};return window.addEventListener("scrollToQuestion",e),()=>{window.removeEventListener("scrollToQuestion",e)}},[f]);const O=async()=>{try{m(),await M(),await new Promise(e=>setTimeout(e,300)),await F()}catch(e){console.error("åˆå§‹åŒ–å¤±è´¥:",e),(429===e.code||e.message.includes("Too many requests"))&&(L("è¯·æ±‚è¿‡äºŽé¢‘ç¹ï¼Œè¯·ç¨åŽé‡è¯•"),setTimeout(()=>L(""),5e3))}},M=async()=>{try{const s=await(async e=>{try{const s=u().User.current();if(!s)throw new Error("ç”¨æˆ·æœªç™»å½•");const t=new(u().Query)("Category"),a=await t.get(e);if(a.get("createdBy").id!==s.id)throw new Error("æ— æƒè®¿é—®æ­¤åˆ†ç±»");const n=new(u().Query)("Question");n.equalTo("category",a),n.equalTo("createdBy",s),n.include("category"),n.descending("updatedAt");const i=await n.find(),c=i.map(e=>({id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),difficulty:e.get("difficulty"),appearanceLevel:e.get("appearanceLevel"),proficiency:e.get("proficiency"),tags:e.get("tags")||[],category:{id:e.get("category").id,name:e.get("category").get("name")},createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")})),r={category:{id:a.id,name:a.get("name"),description:a.get("description"),questionCount:i.length,createdAt:a.get("createdAt"),updatedAt:a.get("updatedAt")},questions:c},l=Date.now();return x.questionCounts.set(e,{count:i.length,timestamp:l}),r}catch(e){throw console.error("èŽ·å–åˆ†ç±»è¯¦æƒ…å¤±è´¥:",e),e}})(e);c(s.category)}catch(e){console.error("åŠ è½½åˆ†ç±»ä¿¡æ¯å¤±è´¥:",e)}},F=async()=>{try{const e=(await v()).filter(e=>{const s=e.createdBy;return s&&s.id===I?.id});d(e)}catch(e){console.error("åŠ è½½æ‰€æœ‰åˆ†ç±»å¤±è´¥:",e),(429===e.code||e.message.includes("Too many requests"))&&(L("æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åŽé‡è¯•"),setTimeout(()=>L(""),5e3))}},{data:_,fetchNextPage:B,hasNextPage:W,isFetchingNextPage:z,isLoading:V,error:J,refetch:H}=(0,Je.q)({queryKey:["questions",e,w],queryFn:async({pageParam:s=0})=>{console.log("æ­£åœ¨èŽ·å–ç¬¬",s+1,"é¡µæ•°æ®");const t=await(async(e,s={})=>{try{const t=u().User.current();if(!t)throw new Error("ç”¨æˆ·æœªç™»å½•");const{page:a=1,pageSize:n=20,sortBy:i="updatedAt",sortOrder:c="desc"}=s,r=u().Object.createWithoutData("Category",e),l=new(u().Query)("Question");return l.equalTo("category",r),l.equalTo("createdBy",t),l.include("category"),"asc"===c?l.addAscending(i):l.addDescending(i),l.limit(n),l.skip((a-1)*n),{data:(await l.find()).map(e=>{const s=e.get("category");return{id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),url:e.get("url"),tags:e.get("tags")||[],difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel")||50,category:s?{id:s.id,objectId:s.id,name:s.get("name"),description:s.get("description"),questionCount:s.get("questionCount")||0}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt"),lastReviewedAt:e.get("lastReviewedAt")}})}}catch(e){throw console.error("èŽ·å–åˆ†ç±»é¢˜ç›®å¤±è´¥:",e),new Error(`èŽ·å–é¢˜ç›®å¤±è´¥: ${e.message}`)}})(e,{page:s,pageSize:20,sortBy:w,sortOrder:"desc"});return console.log("ç¬¬",s+1,"é¡µè¿”å›žæ•°æ®:",{dataLength:t.data?.length,hasMore:20===t.data?.length,total:t.total}),{questions:t.data||[],total:t.total,nextPage:20===t.data?.length?s+1:void 0}},getNextPageParam:(e,s)=>e.nextPage,enabled:!!e&&!!I,staleTime:3e5,initialPageParam:0}),K=(0,a.useMemo)(()=>(_?.pages.flatMap(e=>e.questions)||[]).reduce((e,s)=>(e.find(e=>e.id===s.id)?console.warn("å‘çŽ°é‡å¤é¢˜ç›®:",s.id,s.title):e.push(s),e),[]),[_]),Y=(0,a.useMemo)(()=>{if(!N)return K;const e=K.filter(e=>e.title.toLowerCase().includes(N.toLowerCase())||e.detailedAnswer&&e.detailedAnswer.toLowerCase().includes(N.toLowerCase())||e.oralAnswer&&e.oralAnswer.toLowerCase().includes(N.toLowerCase())||e.code&&e.code.toLowerCase().includes(N.toLowerCase())||e.tags&&e.tags.some(e=>e.toLowerCase().includes(N.toLowerCase())));return Array.from(new Map(e.map(e=>[e.id,e])).values())},[K,N]),Z=(0,a.useMemo)(()=>{const e=[...Y].sort((e,s)=>{switch(w){case"title":return e.title.localeCompare(s.title);case"difficulty":const t={easy:1,medium:2,hard:3};return t[e.difficulty]-t[s.difficulty];case"appearanceLevel":default:return(s.appearanceLevel||50)-(e.appearanceLevel||50);case"createdAt":return new Date(s.createdAt)-new Date(e.createdAt);case"updatedAt":return new Date(s.updatedAt)-new Date(e.createdAt)}});return Array.from(new Map(e.map(e=>[e.id,e])).values())},[Y,w]),X=(0,G.Te)({count:Z.length,getScrollElement:()=>U.current,estimateSize:()=>"grid"===k?200:120,overscan:10}),ee=(0,a.useCallback)(()=>{const e=U.current;if(!e||!W||z)return;const{scrollTop:s,scrollHeight:t,clientHeight:a}=e,n=t-s-a;console.log("æ»šåŠ¨æ£€æŸ¥:",{distanceFromBottom:n,shouldLoad:n<100,hasNextPage:W,isFetchingNextPage:z}),n<100&&(console.log("ðŸŽ¯ è§¦å‘åŠ è½½æ›´å¤šï¼å½“å‰é¡µæ•°:",_?.pages?.length||0),B())},[W,z,B,_]);(0,a.useEffect)(()=>{const e=U.current;if(!e)return void console.log("âŒ æœªæ‰¾åˆ°æ»šåŠ¨å®¹å™¨");console.log("âœ… ç»‘å®šæ»šåŠ¨ç›‘å¬å™¨");const s=(e=>{let s;return function(...t){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...t)},50)}})(ee);return e.addEventListener("scroll",s),()=>{e.removeEventListener("scroll",s)}},[ee]),(0,a.useEffect)(()=>{if(!R.current||!W||z)return;console.log("ðŸ” è®¾ç½® Intersection Observer");const e=new IntersectionObserver(e=>{e[0].isIntersecting&&(console.log("ðŸŽ¯ Intersection Observer è§¦å‘åŠ è½½æ›´å¤šï¼"),B())},{threshold:.1,root:U.current,rootMargin:"100px"});return e.observe(R.current),()=>{e.disconnect()}},[W,z,B,Z.length]);const se=(0,Ge.n)({mutationFn:P,onSuccess:()=>{t.invalidateQueries(["questions",e]),L("é¢˜ç›®åˆ é™¤æˆåŠŸ"),setTimeout(()=>L(""),3e3)},onError:e=>{console.error("åˆ é™¤é¢˜ç›®å¤±è´¥:",e),alert("åˆ é™¤å¤±è´¥: "+e.message)}}),te=(0,Ge.n)({mutationFn:({questionId:e,data:s})=>$(e,s),onSuccess:()=>{t.invalidateQueries(["questions",e])},onError:e=>{throw console.error("æ›´æ–°é¢˜ç›®å¤±è´¥:",e),new Error("æ›´æ–°å¤±è´¥: "+e.message)}}),ae=e=>{C(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},ne=()=>{I?(p(null),g(!0)):alert("è¯·å…ˆç™»å½•")},ie=e=>{I?(p(e),g(!0)):alert("è¯·å…ˆç™»å½•")},ce=async e=>{if(!I)return void alert("è¯·å…ˆç™»å½•");const s=Z.find(s=>s.id===e);if(!s)throw new Error("æœªæ‰¾åˆ°è¦åˆ é™¤çš„é¢˜ç›®");const t=`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${s.title}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`;window.confirm(t)&&(se.mutate(e),C(s=>{const t=new Set(s);return t.delete(e),t}))},re=async(e,s,t)=>{if(I)try{await te.mutateAsync({questionId:e,data:{[s]:t}})}catch(e){throw console.error("æ›´æ–°é¢˜ç›®å­—æ®µå¤±è´¥:",e),new Error("æ›´æ–°å¤±è´¥: "+e.message)}else alert("è¯·å…ˆç™»å½•")},le=()=>{s("/")},oe=e=>{E(null)},de=e=>{q(null),E(null),e.currentTarget.style.opacity="1"};return(0,a.useEffect)(()=>{console.log("åˆ†é¡µçŠ¶æ€:",{hasNextPage:W,isFetchingNextPage:z,totalQuestions:K.length,pages:_?.pages?.length||0})},[W,z,K.length,_]),I?V&&!n?(0,o.jsx)("div",{className:"category-detail-page",children:(0,o.jsxs)("div",{className:"loading-container",children:[(0,o.jsx)("div",{className:"modern-spinner"}),(0,o.jsx)("p",{children:"åŠ è½½é¢˜ç›®ä¸­..."})]})}):J&&!n?(0,o.jsx)("div",{className:"category-detail-page",children:(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("div",{className:"error-icon",children:"âš ï¸"}),(0,o.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,o.jsx)("p",{children:J.message}),(0,o.jsxs)("div",{className:"error-actions",children:[(0,o.jsx)("button",{onClick:()=>{H()},className:"btn-retry",children:"é‡æ–°åŠ è½½"}),(0,o.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})]})}):n?(0,o.jsxs)("div",{className:"category-detail-page",children:[(0,o.jsx)("header",{className:"modern-header",children:(0,o.jsx)("div",{className:"container",children:(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsxs)("button",{onClick:le,className:"back-button",children:[(0,o.jsx)("span",{className:"back-icon",children:"â†"}),"è¿”å›žçŸ¥è¯†åº“"]}),(0,o.jsxs)("div",{className:"category-hero",children:[(0,o.jsxs)("div",{className:"category-badge",children:[(0,o.jsx)("span",{className:"category-emoji",children:"ðŸ“š"}),(0,o.jsx)("span",{className:"category-name",children:n.name})]}),(0,o.jsx)("div",{className:"user-welcome",children:(0,o.jsxs)("span",{className:"welcome-text",children:["æ¬¢è¿Ž, ",I.getUsername(),"!"]})}),(0,o.jsxs)("div",{className:"hero-stats",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:n.questionCount}),(0,o.jsx)("span",{className:"stat-label",children:"æ€»é¢˜ç›®"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:K.length}),(0,o.jsx)("span",{className:"stat-label",children:"å·²åŠ è½½"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:f.size}),(0,o.jsx)("span",{className:"stat-label",children:"å·²å±•å¼€"})]})]})]})]})})}),T&&(0,o.jsx)("div",{className:"sync-message",children:T}),(0,o.jsx)("section",{className:"control-panel",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsxs)("div",{className:"panel-grid",children:[(0,o.jsx)("div",{className:"search-panel",children:(0,o.jsxs)("div",{className:"search-wrapper",children:[(0,o.jsx)("div",{className:"search-icon",children:"ðŸ”"}),(0,o.jsx)("input",{type:"text",placeholder:"æœç´¢é¢˜ç›®ã€ç­”æ¡ˆæˆ–æ ‡ç­¾...",value:N,onChange:e=>y(e.target.value),className:"modern-search",style:{color:"#333",backgroundColor:"#fff"}}),N&&(0,o.jsx)("button",{onClick:()=>y(""),className:"clear-search",children:"âœ•"})]})}),(0,o.jsxs)("div",{className:"controls-panel",children:[(0,o.jsxs)("div",{className:"controls-group",children:[(0,o.jsx)("label",{children:"æŽ’åºæ–¹å¼"}),(0,o.jsxs)("select",{value:w,onChange:e=>b(e.target.value),className:"modern-select",style:{color:"#333",backgroundColor:"#fff"},children:[(0,o.jsx)("option",{value:"appearanceLevel",children:"å‡ºçŽ°é¢‘çŽ‡"}),(0,o.jsx)("option",{value:"updatedAt",children:"æœ€è¿‘æ›´æ–°"}),(0,o.jsx)("option",{value:"createdAt",children:"åˆ›å»ºæ—¶é—´"}),(0,o.jsx)("option",{value:"title",children:"æ ‡é¢˜é¡ºåº"}),(0,o.jsx)("option",{value:"difficulty",children:"éš¾åº¦ç­‰çº§"})]})]}),(0,o.jsxs)("div",{className:"controls-group",children:[(0,o.jsx)("label",{children:"æ‰¹é‡æ“ä½œ"}),(0,o.jsxs)("div",{className:"batch-actions",children:[(0,o.jsx)("button",{onClick:()=>{const e=new Set(Z.map(e=>e.id));C(e)},className:"action-btn expand-btn",disabled:0===Z.length,children:"ðŸ“– å±•å¼€å…¨éƒ¨"}),(0,o.jsx)("button",{onClick:()=>{C(new Set)},className:"action-btn collapse-btn",disabled:0===f.size,children:"ðŸ“• æŠ˜å å…¨éƒ¨"})]})]}),(0,o.jsxs)("button",{className:"add-question-btn primary",onClick:ne,children:[(0,o.jsx)("span",{className:"btn-icon",children:"+"}),"æ·»åŠ é¢˜ç›®"]})]})]}),(0,o.jsxs)("div",{className:"debug-controls",style:{marginTop:"10px",padding:"10px",background:"#f0f0f0",borderRadius:"4px"},children:[(0,o.jsx)("button",{onClick:()=>{console.log("ðŸ”„ æ‰‹åŠ¨è§¦å‘åŠ è½½æ›´å¤š"),B()},disabled:!W||z,style:{padding:"5px 10px",fontSize:"12px",background:W?"#1890ff":"#ccc",color:"white",border:"none",borderRadius:"3px"},children:z?"åŠ è½½ä¸­...":W?"æ‰‹åŠ¨åŠ è½½æ›´å¤š":"å·²æ— æ›´å¤š"}),(0,o.jsxs)("span",{style:{marginLeft:"10px",fontSize:"12px",color:"#666"},children:["çŠ¶æ€: ",W?`æœ‰æ›´å¤š (${K.length}/?)`:"å·²åŠ è½½å…¨éƒ¨"]})]})]})}),(0,o.jsx)("section",{className:"content-section",children:(0,o.jsx)("div",{className:"container",children:0===Z.length?(0,o.jsxs)("div",{className:"modern-empty",children:[(0,o.jsx)("div",{className:"empty-illustration",children:N?"ðŸ”":"ðŸ“"}),(0,o.jsx)("h3",{children:N?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢˜ç›®":"æ­¤åˆ†ç±»ä¸‹æš‚æ— é¢˜ç›®"}),(0,o.jsx)("p",{children:N?"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ¸…é™¤æœç´¢æ¡†æ¥æŸ¥çœ‹æ‰€æœ‰é¢˜ç›®":'ç‚¹å‡»"æ·»åŠ é¢˜ç›®"æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªé¢˜ç›®ï¼Œå¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…'}),N?(0,o.jsx)("button",{onClick:()=>y(""),className:"clear-search-btn",children:"æ¸…é™¤æœç´¢æ¡ä»¶"}):(0,o.jsx)("button",{onClick:ne,className:"add-first-btn",children:"ðŸš€ åˆ›å»ºç¬¬ä¸€ä¸ªé¢˜ç›®"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"results-stats",children:[(0,o.jsxs)("span",{className:"results-count",children:["æ‰¾åˆ° ",Z.length," ä¸ªé¢˜ç›®",N&&(0,o.jsxs)("span",{children:['ï¼ˆæœç´¢å…³é”®è¯: "',N,'"ï¼‰']}),W&&(0,o.jsx)("span",{children:" - æ»šåŠ¨åŠ è½½æ›´å¤š"})]}),(0,o.jsxs)("span",{className:"expand-count",children:[f.size," / ",Z.length," å·²å±•å¼€"]}),0===f.size&&(0,o.jsx)("span",{className:"drag-hint",children:"ðŸŽ¯ æç¤º: å¯ä»¥æ‹–æ‹½é¢˜ç›®è°ƒæ•´é¡ºåº"})]}),(0,o.jsxs)("div",{className:"debug-info",style:{fontSize:"12px",color:"#666",padding:"8px",background:"#f5f5f5",borderRadius:"4px",marginBottom:"10px"},children:["åˆ†é¡µçŠ¶æ€: å·²åŠ è½½ ",K.length," é¢˜, è¿˜æœ‰æ›´å¤š: ",W?"æ˜¯":"å¦",", æ­£åœ¨åŠ è½½: ",z?"æ˜¯":"å¦"]}),(0,o.jsxs)("div",{ref:U,className:`questions-container ${k}`,style:{height:"calc(100vh - 400px)",overflow:"auto",position:"relative",border:"1px solid #e1e5e9",borderRadius:"8px"},children:[(0,o.jsx)("div",{style:{height:`${X.getTotalSize()}px`,width:"100%",position:"relative"},children:X.getVirtualItems().map(e=>{const s=Z[e.index];return(0,o.jsx)("div",{"data-index":e.index,ref:X.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:(0,o.jsx)(Ye,{question:s,index:e.index,isExpanded:f.has(s.id),onToggle:()=>ae(s.id),onDelete:ce,onEdit:ie,onUpdateField:re,viewMode:k,isDragging:A===s.id,isDragOver:D===s.id,onDragStart:e=>((e,s)=>{f.size>0||(q(s),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",s),e.currentTarget.style.opacity="0.4")})(e,s.id),onDragOver:e=>((e,s)=>{f.size>0||!A||(e.preventDefault(),e.dataTransfer.dropEffect="move",E(s))})(e,s.id),onDragLeave:oe,onDrop:e=>(async(e,s)=>{if(!(f.size>0)&&A){if(e.preventDefault(),A!==s){const e=Z.findIndex(e=>e.id===A),t=Z.findIndex(e=>e.id===s),a=[...Z],[n]=a.splice(e,1);a.splice(t,0,n);try{await te.mutateAsync({questionId:n.id,data:{appearanceLevel:n.appearanceLevel}}),console.log("æŽ’åºä¿å­˜æˆåŠŸ")}catch(e){console.error("ä¿å­˜æŽ’åºå¤±è´¥:",e),H()}}q(null),E(null)}})(e,s.id),onDragEnd:de,canDrag:0===f.size,showQuestionForm:h,setShowQuestionForm:g,editingQuestion:j,setEditingQuestion:p})},s.id)})}),W&&(0,o.jsx)("div",{ref:R,style:{height:"60px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",background:"transparent"},children:z?(0,o.jsxs)("div",{className:"loading-more",children:[(0,o.jsx)("div",{className:"modern-spinner small"}),(0,o.jsx)("span",{children:"åŠ è½½æ›´å¤šé¢˜ç›®..."})]}):(0,o.jsx)("div",{className:"load-more-trigger",style:{padding:"10px",color:"#666"},children:(0,o.jsx)("span",{children:"â†“ ç»§ç»­æ»šåŠ¨åŠ è½½æ›´å¤š"})})}),!W&&K.length>0&&(0,o.jsxs)("div",{style:{textAlign:"center",padding:"20px",color:"#999",fontStyle:"italic"},children:["å·²åŠ è½½å…¨éƒ¨ ",K.length," ä¸ªé¢˜ç›®"]})]})]})})}),h&&(0,o.jsx)("div",{className:"form-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,padding:"20px"},children:(0,o.jsx)(He,{question:j,onSave:()=>{g(!1),p(null),t.invalidateQueries(["questions",e])},onCancel:()=>{g(!1),p(null)},defaultCategoryId:e,onCategoryChange:({questionId:s,oldCategoryId:a,newCategoryId:i,question:c})=>{if(a===n.id){t.invalidateQueries(["questions",e]),C(e=>{const t=new Set(e);return t.delete(s),t});const a=l.find(e=>e.id===i);L(`é¢˜ç›®å·²ç§»åŠ¨åˆ°åˆ†ç±»: ${a?.name||"å…¶ä»–åˆ†ç±»"}`),setTimeout(()=>L(""),3e3)}}})})]}):(0,o.jsx)("div",{className:"category-detail-page",children:(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("div",{className:"error-icon",children:"ðŸ“"}),(0,o.jsx)("h2",{children:"åˆ†ç±»ä¸å­˜åœ¨"}),(0,o.jsx)("p",{children:"æœªæ‰¾åˆ°æŒ‡å®šçš„åˆ†ç±»ï¼Œå¯èƒ½å·²è¢«åˆ é™¤"}),(0,o.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})}):(0,o.jsx)("div",{className:"category-detail-page",children:(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯æŸ¥çœ‹å’Œç®¡ç†é¢˜ç›®"}),(0,o.jsxs)("div",{className:"auth-required-actions",children:[(0,o.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("showAuthModal")),className:"login-btn",children:"ç«‹å³ç™»å½•"}),(0,o.jsx)("button",{onClick:le,className:"btn-back",children:"è¿”å›žé¦–é¡µ"})]})]})})},Xe=async(e,s,t)=>{try{const a=new(u().User);a.setUsername(e),a.setPassword(s),a.setEmail(t);const n=await a.signUp();return console.log("æ³¨å†ŒæˆåŠŸ:",n),n}catch(e){throw console.error("æ³¨å†Œå¤±è´¥:",e),e}},es=async(e,s)=>{try{const t=await u().User.logIn(e,s);return console.log("ç™»å½•æˆåŠŸ:",t),t}catch(e){throw console.error("ç™»å½•å¤±è´¥:",e),e}},ss=()=>u().User.current(),ts=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1),[i,c]=(0,a.useState)(""),[r,l]=(0,a.useState)({register:{username:"",password:"",email:"",nickname:""},login:{username:"",password:""},category:{name:"",description:""},question:{title:"",detailedAnswer:"",categoryId:""}});(0,a.useEffect)(()=>{d()},[]);const d=()=>{const e=ss();s(e),console.log("å½“å‰ç”¨æˆ·:",e)},h=(e,s,t)=>{l(a=>({...a,[e]:{...a[e],[s]:t}}))};return(0,o.jsxs)("div",{className:"user-test-panel",children:[(0,o.jsx)("h2",{children:"ðŸ§ª ç”¨æˆ·ç³»ç»Ÿæµ‹è¯•é¢æ¿"}),(0,o.jsxs)("div",{className:"user-status",children:[(0,o.jsx)("h3",{children:"å½“å‰çŠ¶æ€"}),e?(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsx)("p",{children:"âœ… å·²ç™»å½•"}),(0,o.jsxs)("p",{children:["ç”¨æˆ·å: ",e.username]}),(0,o.jsxs)("p",{children:["é‚®ç®±: ",e.email]}),(0,o.jsxs)("p",{children:["ç”¨æˆ·ID: ",e.id]}),(0,o.jsx)("button",{onClick:async()=>{n(!0);try{await(async()=>{try{await u().User.logOut(),console.log("é€€å‡ºæˆåŠŸ")}catch(e){throw console.error("é€€å‡ºå¤±è´¥:",e),e}})(),c("âœ… å·²é€€å‡ºç™»å½•"),s(null)}catch(e){c(`âŒ ç™»å‡ºå¤±è´¥: ${e.message}`)}finally{n(!1)}},disabled:t,children:"é€€å‡ºç™»å½•"})]}):(0,o.jsx)("p",{children:"âŒ æœªç™»å½•"})]}),i&&(0,o.jsx)("div",{className:"test-message "+(i.includes("âœ…")?"success":"error"),children:i}),(0,o.jsxs)("div",{className:"test-sections",children:[(0,o.jsxs)("div",{className:"test-section",children:[(0,o.jsx)("h3",{children:"1. ç”¨æˆ·æ³¨å†Œæµ‹è¯•"}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),n(!0),c("");try{const e=await Xe(r.register);c(`âœ… æ³¨å†ŒæˆåŠŸï¼ç”¨æˆ·ID: ${e.id}`),s(e),l(e=>({...e,register:{username:"",password:"",email:"",nickname:""}}))}catch(e){c(`âŒ æ³¨å†Œå¤±è´¥: ${e.message}`)}finally{n(!1)}},children:[(0,o.jsx)("input",{type:"text",placeholder:"ç”¨æˆ·å",value:r.register.username,onChange:e=>h("register","username",e.target.value),required:!0}),(0,o.jsx)("input",{type:"password",placeholder:"å¯†ç ",value:r.register.password,onChange:e=>h("register","password",e.target.value),required:!0}),(0,o.jsx)("input",{type:"email",placeholder:"é‚®ç®±",value:r.register.email,onChange:e=>h("register","email",e.target.value),required:!0}),(0,o.jsx)("input",{type:"text",placeholder:"æ˜µç§° (å¯é€‰)",value:r.register.nickname,onChange:e=>h("register","nickname",e.target.value)}),(0,o.jsx)("button",{type:"submit",disabled:t,children:t?"æ³¨å†Œä¸­...":"æ³¨å†Œ"})]})]}),(0,o.jsxs)("div",{className:"test-section",children:[(0,o.jsx)("h3",{children:"2. ç”¨æˆ·ç™»å½•æµ‹è¯•"}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),n(!0),c("");try{const e=await es(r.login.username,r.login.password);c(`âœ… ç™»å½•æˆåŠŸï¼æ¬¢è¿Ž ${e.username}`),s(e),l(e=>({...e,login:{username:"",password:""}}))}catch(e){c(`âŒ ç™»å½•å¤±è´¥: ${e.message}`)}finally{n(!1)}},children:[(0,o.jsx)("input",{type:"text",placeholder:"ç”¨æˆ·å",value:r.login.username,onChange:e=>h("login","username",e.target.value),required:!0}),(0,o.jsx)("input",{type:"password",placeholder:"å¯†ç ",value:r.login.password,onChange:e=>h("login","password",e.target.value),required:!0}),(0,o.jsx)("button",{type:"submit",disabled:t,children:t?"ç™»å½•ä¸­...":"ç™»å½•"})]})]}),e&&(0,o.jsxs)("div",{className:"test-section",children:[(0,o.jsx)("h3",{children:"3. åˆ›å»ºæµ‹è¯•åˆ†ç±»"}),(0,o.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e){n(!0);try{const e=await y(r.category);c(`âœ… åˆ†ç±»åˆ›å»ºæˆåŠŸï¼ID: ${e.id}`),l(s=>({...s,question:{...s.question,categoryId:e.id},category:{name:"",description:""}}))}catch(e){c(`âŒ åˆ›å»ºåˆ†ç±»å¤±è´¥: ${e.message}`)}finally{n(!1)}}else c("âŒ è¯·å…ˆç™»å½•")},children:[(0,o.jsx)("input",{type:"text",placeholder:"åˆ†ç±»åç§°",value:r.category.name,onChange:e=>h("category","name",e.target.value),required:!0}),(0,o.jsx)("input",{type:"text",placeholder:"åˆ†ç±»æè¿° (å¯é€‰)",value:r.category.description,onChange:e=>h("category","description",e.target.value)}),(0,o.jsx)("button",{type:"submit",disabled:t,children:t?"åˆ›å»ºä¸­...":"åˆ›å»ºåˆ†ç±»"})]})]}),e&&r.question.categoryId&&(0,o.jsxs)("div",{className:"test-section",children:[(0,o.jsx)("h3",{children:"4. åˆ›å»ºæµ‹è¯•é¢˜ç›®"}),(0,o.jsxs)("p",{children:["åˆ†ç±»ID: ",r.question.categoryId]}),(0,o.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e){n(!0);try{const e=await E({...r.question,categoryId:r.question.categoryId,oralAnswer:"è¿™æ˜¯å£è¿°ç‰ˆæœ¬çš„ç­”æ¡ˆ",tags:["æµ‹è¯•","ç¤ºä¾‹"],difficulty:"medium",proficiency:"intermediate"});c(`âœ… é¢˜ç›®åˆ›å»ºæˆåŠŸï¼ID: ${e.id}`),l(e=>({...e,question:{title:"",detailedAnswer:"",categoryId:e.question.categoryId}}))}catch(e){c(`âŒ åˆ›å»ºé¢˜ç›®å¤±è´¥: ${e.message}`)}finally{n(!1)}}else c("âŒ è¯·å…ˆç™»å½•")},children:[(0,o.jsx)("input",{type:"text",placeholder:"é¢˜ç›®æ ‡é¢˜",value:r.question.title,onChange:e=>h("question","title",e.target.value),required:!0}),(0,o.jsx)("textarea",{placeholder:"è¯¦ç»†ç­”æ¡ˆ",value:r.question.detailedAnswer,onChange:e=>h("question","detailedAnswer",e.target.value),required:!0}),(0,o.jsx)("button",{type:"submit",disabled:t,children:t?"åˆ›å»ºä¸­...":"åˆ›å»ºé¢˜ç›®"})]})]})]}),(0,o.jsxs)("div",{className:"quick-test",children:[(0,o.jsx)("h3",{children:"ðŸš€ å¿«é€Ÿæµ‹è¯•"}),(0,o.jsx)("button",{onClick:()=>{l({register:{username:`testuser_${Date.now()}`,password:"123456",email:`test_${Date.now()}@example.com`,nickname:"æµ‹è¯•ç”¨æˆ·"},login:{username:"",password:""},category:{name:"æµ‹è¯•åˆ†ç±»",description:"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ†ç±»"},question:{title:"",detailedAnswer:"",categoryId:""}})},children:"å¡«å……æµ‹è¯•æ•°æ®"})]})]})},as={setupAdminUser:async()=>{try{console.log("è®¾ç½®å½“å‰ç”¨æˆ·ä¸ºç®¡ç†å‘˜...");const e=u().User.current();if(!e)throw new Error("è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜");return console.log("ä½¿ç”¨å½“å‰ç”¨æˆ·ä½œä¸ºç®¡ç†å‘˜:",e.id),{id:e.id,username:e.getUsername(),email:e.getEmail(),nickname:e.get("nickname")}}catch(e){throw console.error("è®¾ç½®ç®¡ç†å‘˜å¤±è´¥:",e),e}},migrateCategoriesToCurrentUser:async()=>{try{console.log("å¼€å§‹è¿ç§»åˆ†ç±»æ•°æ®...");const e=u().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(u().Query)("Category");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦è¿ç§»çš„åˆ†ç±»`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(u().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!0),s.setACL(t),await s.save(),a++,console.log(`âœ… è¿ç§»åˆ†ç±»: ${s.get("name")}`)}catch(e){console.error(`è¿ç§»åˆ†ç±»å¤±è´¥ ${s.id}:`,e)}return console.log(`åˆ†ç±»è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§»åˆ†ç±»æ•°æ®å¤±è´¥:",e),e}},migrateQuestionsToCurrentUser:async()=>{try{console.log("å¼€å§‹è¿ç§»é¢˜ç›®æ•°æ®...");const e=u().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(u().Query)("Question");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦è¿ç§»çš„é¢˜ç›®`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(u().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!0),s.setACL(t),await s.save(),a++,console.log(`âœ… è¿ç§»é¢˜ç›®: ${s.get("title")}`)}catch(e){console.error(`è¿ç§»é¢˜ç›®å¤±è´¥ ${s.id}:`,e)}return console.log(`é¢˜ç›®è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§»é¢˜ç›®æ•°æ®å¤±è´¥:",e),e}},performFullMigration:async()=>{try{console.log("ðŸš€ å¼€å§‹å®Œæ•´æ•°æ®è¿ç§»...");const e=await as.setupAdminUser(),s=await as.migrateCategoriesToCurrentUser(),t=await as.migrateQuestionsToCurrentUser();return console.log("ðŸŽ‰ æ•°æ®è¿ç§»å®Œæˆï¼"),{success:!0,adminUser:e,categories:s,questions:t,message:`è¿ç§»å®Œæˆ: ${s.migrated}ä¸ªåˆ†ç±», ${t.migrated}ä¸ªé¢˜ç›®`}}catch(e){return console.error("æ•°æ®è¿ç§»å¤±è´¥:",e),{success:!1,error:e.message}}},checkMigrationStatus:async()=>{try{const e=new(u().Query)("Category");e.doesNotExist("createdBy");const s=await e.count(),t=new(u().Query)("Question");t.doesNotExist("createdBy");const a=await t.count();return{orphanCategories:s,orphanQuestions:a,totalCategories:await new(u().Query)("Category").count(),totalQuestions:await new(u().Query)("Question").count(),migrationNeeded:s>0||a>0}}catch(e){throw console.error("æ£€æŸ¥è¿ç§»çŠ¶æ€å¤±è´¥:",e),e}},migrateQuestionCreatedBy:async()=>{try{console.log("å¼€å§‹ä¸“é—¨è¿ç§» Question çš„ createdBy å±žæ€§...");const e=u().User.current();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const s=new(u().Query)("Question");s.doesNotExist("createdBy");const t=await s.find();console.log(`æ‰¾åˆ° ${t.length} ä¸ªéœ€è¦æ·»åŠ  createdBy çš„é¢˜ç›®`);let a=0;for(const s of t)try{s.set("createdBy",e);const t=new(u().ACL);t.setReadAccess(e,!0),t.setWriteAccess(e,!0),t.setPublicReadAccess(!1),s.setACL(t),await s.save(),a++,console.log(`âœ… ä¸ºé¢˜ç›®æ·»åŠ  createdBy: ${s.get("title")}`)}catch(e){console.error(`è¿ç§»é¢˜ç›®å¤±è´¥ ${s.id}:`,e)}return console.log(`Question createdBy è¿ç§»å®Œæˆ: ${a}/${t.length}`),{migrated:a,total:t.length}}catch(e){throw console.error("è¿ç§» Question createdBy å¤±è´¥:",e),e}},performQuestionMigrationOnly:async()=>{try{if(console.log("ðŸš€ å¼€å§‹ä¸“é—¨è¿ç§» Question æ•°æ®..."),!u().User.current())throw new Error("è¯·å…ˆç™»å½•");const e=await as.migrateQuestionCreatedBy();return console.log("ðŸŽ‰ Question è¿ç§»å®Œæˆï¼"),{success:!0,questions:e,message:`Question è¿ç§»å®Œæˆ: ${e.migrated}ä¸ªé¢˜ç›®`}}catch(e){return console.error("Question è¿ç§»å¤±è´¥:",e),{success:!1,error:e.message}}}},ns=()=>{const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[r,l]=(0,a.useState)(null);(0,a.useEffect)(()=>{d(),h()},[]);const d=()=>{const e=ss();l(e)},h=async()=>{try{const e=await as.checkMigrationStatus();n(e)}catch(e){console.error("æ£€æŸ¥è¿ç§»çŠ¶æ€å¤±è´¥:",e)}};return(0,o.jsxs)("div",{className:"data-migration-panel",children:[(0,o.jsx)("h2",{children:"ðŸ”„ æ•°æ®è¿ç§»å·¥å…·"}),(0,o.jsx)("p",{children:"å°†çŽ°æœ‰åˆ†ç±»å’Œé¢˜ç›®æ•°æ®å…³è”åˆ°å½“å‰ç™»å½•ç”¨æˆ·"}),(0,o.jsxs)("div",{className:"user-status-section",children:[(0,o.jsx)("h3",{children:"å½“å‰ç”¨æˆ·çŠ¶æ€"}),r?(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsxs)("p",{children:["âœ… å·²ç™»å½•: ",(0,o.jsx)("strong",{children:r.username})]}),(0,o.jsxs)("p",{children:["é‚®ç®±: ",r.email]}),(0,o.jsxs)("p",{children:["ç”¨æˆ·ID: ",r.id]}),(0,o.jsx)("p",{className:"admin-note",children:"æ­¤ç”¨æˆ·å°†è¢«è®¾ç½®ä¸ºæ‰€æœ‰çŽ°æœ‰æ•°æ®çš„ç®¡ç†å‘˜"})]}):(0,o.jsxs)("div",{className:"user-info not-logged-in",children:[(0,o.jsx)("p",{children:"âŒ æœªç™»å½•"}),(0,o.jsx)("p",{className:"login-required",children:"è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜"})]})]}),t&&(0,o.jsxs)("div",{className:"migration-status",children:[(0,o.jsx)("h3",{children:"å½“å‰æ•°æ®çŠ¶æ€"}),(0,o.jsxs)("div",{className:"status-grid",children:[(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"æ€»åˆ†ç±»æ•°:"}),(0,o.jsx)("span",{className:"value",children:t.totalCategories})]}),(0,o.jsxs)("div",{className:"status-item",children:[(0,o.jsx)("span",{className:"label",children:"æ€»é¢˜ç›®æ•°:"}),(0,o.jsx)("span",{className:"value",children:t.totalQuestions})]}),(0,o.jsxs)("div",{className:"status-item warning",children:[(0,o.jsx)("span",{className:"label",children:"æœªå…³è”åˆ†ç±»:"}),(0,o.jsx)("span",{className:"value",children:t.orphanCategories})]}),(0,o.jsxs)("div",{className:"status-item warning",children:[(0,o.jsx)("span",{className:"label",children:"æœªå…³è”é¢˜ç›®:"}),(0,o.jsx)("span",{className:"value",children:t.orphanQuestions})]})]}),t.migrationNeeded?(0,o.jsx)("div",{className:"migration-needed",children:"âš ï¸ æ£€æµ‹åˆ°æœªå…³è”çš„æ•°æ®ï¼Œéœ€è¦æ‰§è¡Œè¿ç§»"}):(0,o.jsx)("div",{className:"migration-complete",children:"âœ… æ‰€æœ‰æ•°æ®éƒ½å·²å…³è”åˆ°ç”¨æˆ·"})]}),(0,o.jsxs)("div",{className:"migration-actions",children:[(0,o.jsx)("button",{onClick:async()=>{if(r){if(window.confirm(`ç¡®å®šè¦å°†æ‰€æœ‰çŽ°æœ‰æ•°æ®å…³è”åˆ°å½“å‰ç”¨æˆ· "${r.username}" å—ï¼Ÿ`)){s(!0),c(null);try{const e=await as.performFullMigration();c(e),await h()}catch(e){c({success:!1,error:e.message})}finally{s(!1)}}}else alert("è¯·å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜")},disabled:e||!r||!t?.migrationNeeded,className:"migrate-btn",children:e?"è¿ç§»ä¸­...":"æ‰§è¡Œæ•°æ®è¿ç§»"}),(0,o.jsx)("button",{onClick:h,disabled:e,className:"refresh-btn",children:"åˆ·æ–°çŠ¶æ€"})]}),i&&(0,o.jsxs)("div",{className:"migration-result "+(i.success?"success":"error"),children:[(0,o.jsx)("h4",{children:i.success?"âœ… è¿ç§»æˆåŠŸ":"âŒ è¿ç§»å¤±è´¥"}),i.success?(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{children:i.message}),i.adminUser&&(0,o.jsxs)("div",{className:"admin-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"ç®¡ç†å‘˜è´¦æˆ·:"})," ",i.adminUser.username]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"ç”¨æˆ·ID:"})," ",i.adminUser.id]})]})]}):(0,o.jsxs)("p",{children:["é”™è¯¯: ",i.error]})]}),(0,o.jsxs)("div",{className:"migration-instructions",children:[(0,o.jsx)("h3",{children:"ðŸ“– ä½¿ç”¨è¯´æ˜Ž"}),(0,o.jsxs)("ol",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"é¦–å…ˆç™»å½•ä¸€ä¸ªè´¦æˆ·"}),"ï¼ˆå¯ä»¥æ˜¯æ–°æ³¨å†Œçš„æˆ–çŽ°æœ‰çš„ï¼‰"]}),(0,o.jsx)("li",{children:"ç¡®è®¤ä¸Šæ–¹æ˜¾ç¤ºæœ‰æœªå…³è”çš„æ•°æ®"}),(0,o.jsx)("li",{children:'ç‚¹å‡»"æ‰§è¡Œæ•°æ®è¿ç§»"æŒ‰é’®'}),(0,o.jsx)("li",{children:"è¿ç§»å®ŒæˆåŽï¼Œæ‰€æœ‰çŽ°æœ‰æ•°æ®å°†å…³è”åˆ°å½“å‰ç™»å½•ç”¨æˆ·"}),(0,o.jsx)("li",{children:"ä¹‹åŽå¯ä»¥ä½¿ç”¨æ­¤è´¦æˆ·ç™»å½•ç³»ç»Ÿç®¡ç†æ‰€æœ‰æ•°æ®"})]}),(0,o.jsxs)("div",{className:"important-notes",children:[(0,o.jsx)("h4",{children:"âš ï¸ é‡è¦æç¤º"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"è¿ç§»è¿‡ç¨‹ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹çŽ°æœ‰æ•°æ®å†…å®¹"}),(0,o.jsx)("li",{children:"åªä¼šæ·»åŠ  createdBy å­—æ®µå’Œæ›´æ–°æƒé™"}),(0,o.jsx)("li",{children:"è¿ç§»åŽï¼Œåªæœ‰å½“å‰ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ‰€æœ‰çŽ°æœ‰æ•°æ®"}),(0,o.jsx)("li",{children:"æ–°æ³¨å†Œçš„ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„æ•°æ®"}),(0,o.jsx)("li",{children:(0,o.jsx)("strong",{children:"å»ºè®®ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„è´¦æˆ·ä½œä¸ºç®¡ç†å‘˜"})})]})]})]})]})},is=()=>(0,o.jsx)("div",{className:"test-page",children:(0,o.jsxs)("div",{className:"container",children:[(0,o.jsx)("h1",{children:"ç”¨æˆ·ç³»ç»Ÿæµ‹è¯•ä¸Žæ•°æ®è¿ç§»"}),(0,o.jsxs)("div",{className:"test-sections",children:[(0,o.jsxs)("section",{className:"test-section",children:[(0,o.jsx)("h2",{children:"ðŸ”„ æ•°æ®è¿ç§»"}),(0,o.jsx)(ns,{})]}),(0,o.jsxs)("section",{className:"test-section",children:[(0,o.jsx)("h2",{children:"ðŸ§ª ç”¨æˆ·åŠŸèƒ½æµ‹è¯•"}),(0,o.jsx)(ts,{})]})]})]})}),cs=({onShowAuthModal:e})=>{const[s,t]=(0,a.useState)(null),[n,c]=(0,a.useState)(!1),r=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=u().User.current();t(e)},[]),(0,a.useEffect)(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.useEffect)(()=>{const e=async()=>{console.log("æ”¶åˆ°å¤´åƒæ›´æ–°äº‹ä»¶ï¼Œé‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®");const e=u().User.current();if(e)try{const s=await e.fetch();t(s)}catch(e){console.error("é‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}};return window.addEventListener("userAvatarUpdated",e),()=>{window.removeEventListener("userAvatarUpdated",e)}},[]);const l=()=>!!s&&"wu1149823510@outlook.com"===s.getEmail(),d=({user:e,size:s="normal"})=>{const t=e.get("avatar"),a=e.getUsername()?.charAt(0).toUpperCase(),n=(()=>{if(!t)return null;if("string"==typeof t){const e=(new Date).getTime();return`${t}?t=${e}`}return"function"==typeof t.get?t.get("url"):null})();return(0,o.jsx)("div",{className:"user-avatar "+("large"===s?"user-avatar-large":""),children:n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("img",{src:n,alt:"ç”¨æˆ·å¤´åƒ",onLoad:()=>console.log("âœ… Navigation å¤´åƒåŠ è½½æˆåŠŸ"),onError:e=>{console.error("âŒ Navigation å¤´åƒåŠ è½½å¤±è´¥:",n),e.target.style.display="none";const s=e.target.nextSibling;s&&(s.style.display="flex")},style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}),(0,o.jsx)("div",{className:"avatar-fallback "+("large"===s?"avatar-fallback-large":""),style:{display:"none"},children:a})]}):(0,o.jsx)("div",{className:"avatar-fallback "+("large"===s?"avatar-fallback-large":""),children:a})})};return(0,o.jsx)("nav",{className:"modern-nav",children:(0,o.jsxs)("div",{className:"nav-container",children:[(0,o.jsxs)("div",{className:"nav-left",children:[(0,o.jsxs)(i.N_,{to:"/",className:"nav-brand",children:[(0,o.jsx)("span",{className:"brand-icon",children:"ðŸ“š"}),(0,o.jsx)("span",{className:"brand-text",children:"çŸ¥è¯†é¢˜åº“"})]}),(0,o.jsxs)("div",{className:"nav-links",children:[(0,o.jsxs)(i.N_,{to:"/",className:"nav-link",children:[(0,o.jsx)("span",{className:"link-icon",children:"ðŸ "}),"é¦–é¡µ"]}),s&&l()&&(0,o.jsxs)(i.N_,{to:"/init",className:"nav-link",children:[(0,o.jsx)("span",{className:"link-icon",children:"âš™ï¸"}),"åˆå§‹åŒ–æ•°æ®åº“"]})]})]}),(0,o.jsx)("div",{className:"nav-right",children:s?(0,o.jsxs)("div",{className:"user-section",ref:r,children:[(0,o.jsxs)("button",{className:"user-menu-trigger",onClick:()=>{c(!n)},children:[(0,o.jsx)(d,{user:s}),(0,o.jsx)("span",{className:"user-name",children:s.getUsername()}),l()&&(0,o.jsx)("span",{className:"admin-badge",title:"ç®¡ç†å‘˜",children:"âš¡"}),(0,o.jsx)("span",{className:"dropdown-arrow "+(n?"open":""),children:"â–¼"})]}),n&&(0,o.jsxs)("div",{className:"user-dropdown-menu",children:[(0,o.jsx)("div",{className:"dropdown-header",children:(0,o.jsxs)("div",{className:"user-info-card",children:[(0,o.jsx)(d,{user:s,size:"large"}),(0,o.jsxs)("div",{className:"user-details",children:[(0,o.jsxs)("div",{className:"user-display-name",children:[s.get("nickname")||s.getUsername(),l()&&(0,o.jsx)("span",{className:"admin-tag",children:"ç®¡ç†å‘˜"})]}),(0,o.jsx)("div",{className:"user-email",children:s.getEmail()||"æœªè®¾ç½®é‚®ç®±"})]})]})}),(0,o.jsx)("div",{className:"dropdown-divider"}),(0,o.jsxs)("div",{className:"dropdown-items",children:[(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings"))},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ‘¤"}),(0,o.jsx)("span",{className:"item-text",children:"è´¦æˆ·è®¾ç½®"})]}),(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings",{detail:{tab:"stats"}}))},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"item-text",children:"å­¦ä¹ ç»Ÿè®¡"})]}),(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.dispatchEvent(new CustomEvent("showUserSettings",{detail:{tab:"preferences"}}))},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ””"}),(0,o.jsx)("span",{className:"item-text",children:"é€šçŸ¥è®¾ç½®"})]})]}),l()&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"dropdown-divider"}),(0,o.jsxs)("div",{className:"dropdown-section",children:[(0,o.jsx)("div",{className:"section-label",children:"ç®¡ç†å‘˜åŠŸèƒ½"}),(0,o.jsxs)("div",{className:"dropdown-items",children:[(0,o.jsxs)(i.N_,{to:"/init",className:"dropdown-item",onClick:()=>c(!1),children:[(0,o.jsx)("span",{className:"item-icon",children:"âš™ï¸"}),(0,o.jsx)("span",{className:"item-text",children:"åˆå§‹åŒ–æ•°æ®åº“"})]}),(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),console.log("ç®¡ç†å‘˜åŠŸèƒ½")},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ”§"}),(0,o.jsx)("span",{className:"item-text",children:"ç³»ç»Ÿç®¡ç†"})]})]})]})]}),(0,o.jsx)("div",{className:"dropdown-divider"}),(0,o.jsxs)("div",{className:"dropdown-items",children:[(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.open("/help","_blank")},children:[(0,o.jsx)("span",{className:"item-icon",children:"â“"}),(0,o.jsx)("span",{className:"item-text",children:"å¸®åŠ©æ–‡æ¡£"})]}),(0,o.jsxs)("button",{className:"dropdown-item",onClick:()=>{c(!1),window.open("mailto:support@example.com","_blank")},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ’¬"}),(0,o.jsx)("span",{className:"item-text",children:"æ„è§åé¦ˆ"})]})]}),(0,o.jsx)("div",{className:"dropdown-divider"}),(0,o.jsx)("div",{className:"dropdown-items",children:(0,o.jsxs)("button",{className:"dropdown-item logout-item",onClick:async()=>{try{await u().User.logOut(),t(null),c(!1),window.location.reload()}catch(e){console.error("é€€å‡ºå¤±è´¥:",e),alert("é€€å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•")}},children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸšª"}),(0,o.jsx)("span",{className:"item-text",children:"é€€å‡ºç™»å½•"})]})})]})]}):(0,o.jsxs)("div",{className:"auth-buttons",children:[(0,o.jsx)("button",{className:"auth-btn login-btn",onClick:()=>e("login"),children:"ç™»å½•"}),(0,o.jsx)("button",{className:"auth-btn login-btn",onClick:()=>e("register"),children:"æ³¨å†Œ"})]})})]})})},rs=({isOpen:e,onClose:s,defaultTab:t="login",onAuthSuccess:n})=>{const[i,c]=(0,a.useState)(t),[r,l]=(0,a.useState)({loginUsername:"",loginPassword:"",registerUsername:"",registerEmail:"",registerPassword:"",registerConfirmPassword:""}),[d,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&(c(t),l({loginUsername:"",loginPassword:"",registerUsername:"",registerEmail:"",registerPassword:"",registerConfirmPassword:""}))},[e,t]);const u=e=>{const{id:s,value:t}=e.target;l(e=>({...e,[s]:t}))};return e?(0,o.jsx)("div",{className:"auth-modal",onClick:s,children:(0,o.jsxs)("div",{className:"auth-content",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"auth-header",children:[(0,o.jsx)("h3",{children:"login"===i?"ç”¨æˆ·ç™»å½•":"ç”¨æˆ·æ³¨å†Œ"}),(0,o.jsx)("button",{className:"close-btn",onClick:s,children:"Ã—"})]}),(0,o.jsxs)("div",{className:"auth-tabs",children:[(0,o.jsx)("button",{className:"auth-tab "+("login"===i?"active":""),onClick:()=>c("login"),children:"ç™»å½•"}),(0,o.jsx)("button",{className:"auth-tab "+("register"===i?"active":""),onClick:()=>c("register"),children:"æ³¨å†Œ"})]}),(0,o.jsxs)("form",{className:"auth-form "+("login"===i?"active":""),onSubmit:async e=>{e.preventDefault();try{await es(r.loginUsername,r.loginPassword),n&&n(),s()}catch(e){alert(`ç™»å½•å¤±è´¥: ${e.message}`)}},children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"loginUsername",children:"ç”¨æˆ·å"}),(0,o.jsx)("input",{type:"text",id:"loginUsername",value:r.loginUsername,onChange:u,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"loginPassword",children:"å¯†ç "}),(0,o.jsx)("input",{type:"password",id:"loginPassword",value:r.loginPassword,onChange:u,required:!0})]}),(0,o.jsx)("button",{type:"submit",className:"auth-btn primary",children:"ç™»å½•"})]}),(0,o.jsxs)("form",{className:"auth-form "+("register"===i?"active":""),onSubmit:async e=>{if(e.preventDefault(),r.registerPassword===r.registerConfirmPassword)try{await Xe(r.registerUsername,r.registerPassword,r.registerEmail),n&&n(),s()}catch(e){alert(`æ³¨å†Œå¤±è´¥: ${e.message}`)}else alert("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")},children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"registerUsername",children:"ç”¨æˆ·å"}),(0,o.jsx)("input",{type:"text",id:"registerUsername",value:r.registerUsername,onChange:u,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"registerEmail",children:"é‚®ç®±"}),(0,o.jsx)("input",{type:"email",id:"registerEmail",value:r.registerEmail,onChange:u,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"registerPassword",children:"å¯†ç "}),(0,o.jsx)("input",{type:"password",id:"registerPassword",value:r.registerPassword,onChange:u,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"registerConfirmPassword",children:"ç¡®è®¤å¯†ç "}),(0,o.jsx)("input",{type:"password",id:"registerConfirmPassword",value:r.registerConfirmPassword,onChange:u,required:!0})]}),(0,o.jsx)("button",{type:"submit",className:"auth-btn secondary",children:"æ³¨å†Œ"})]})]})}):null},ls=({isOpen:e,onClose:s})=>{const[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)("profile"),[r,l]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!1),[m,g]=(0,a.useState)({type:"",text:""}),[x,j]=(0,a.useState)(null),[p,v]=(0,a.useState)(""),[N,y]=(0,a.useState)({totalCategories:0,totalQuestions:0,reviewQuestions:0,todayReviewed:0}),[w,b]=(0,a.useState)({username:"",email:"",nickname:"",bio:""}),[f,C]=(0,a.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[k,S]=(0,a.useState)({theme:"light",language:"zh-CN",notifications:!0,emailUpdates:!1}),[A,q]=(0,a.useState)({emailVerified:!1});(0,a.useEffect)(()=>{if(e){const e=u().User.current();n(e),e&&(D(e),E(e))}},[e]);const D=async e=>{try{const s=await e.fetch();b({username:s.getUsername()||"",email:s.getEmail()||"",nickname:s.get("nickname")||"",bio:s.get("bio")||""}),S({theme:s.get("theme")||"light",language:s.get("language")||"zh-CN",notifications:!1!==s.get("notifications"),emailUpdates:s.get("emailUpdates")||!1}),q({emailVerified:s.get("emailVerified")||!1});const t=s.get("avatar");if(t&&"string"==typeof t){const e=(new Date).getTime();v(`${t}?t=${e}`)}else v("")}catch(e){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},E=async e=>{try{const s=new(u().Query)("Category");s.equalTo("createdBy",e);const t=await s.find(),a=new(u().Query)("Question");a.equalTo("createdBy",e);const n=await a.find(),i=new Date,c=1,r=n.filter(e=>{const s=new Date(e.get("lastReviewedAt")||e.get("createdAt"));return Math.floor((i-s)/864e5)>=c}),l=new Date;l.setHours(0,0,0,0);const o=n.filter(e=>new Date(e.get("lastReviewedAt"))>=l).length;y({totalCategories:t.length,totalQuestions:n.length,reviewQuestions:r.length,todayReviewed:o})}catch(e){console.error("åŠ è½½å­¦ä¹ ç»Ÿè®¡å¤±è´¥:",e),y({totalCategories:0,totalQuestions:0,reviewQuestions:0,todayReviewed:0})}},P=(e,s,t=3e3)=>{g({type:e,text:s}),setTimeout(()=>g({type:"",text:""}),t)},T=(e,s,t)=>{switch(e){case"profile":b(e=>({...e,[s]:t}));break;case"password":C(e=>({...e,[s]:t}));break;case"preferences":S(e=>({...e,[s]:t}))}};return e?(0,o.jsx)("div",{className:"user-settings-overlay",children:(0,o.jsxs)("div",{className:"user-settings-modal",children:[(0,o.jsxs)("div",{className:"settings-header",children:[(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsx)("h2",{children:"è´¦æˆ·è®¾ç½®"}),(0,o.jsx)("p",{children:"ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œåå¥½è®¾ç½®"})]}),(0,o.jsx)("button",{className:"close-button",onClick:s,disabled:d,children:"Ã—"})]}),m.text&&(0,o.jsx)("div",{className:`message ${m.type}`,children:m.text}),(0,o.jsxs)("div",{className:"settings-content",children:[(0,o.jsxs)("div",{className:"settings-sidebar",children:[(0,o.jsxs)("button",{className:"sidebar-item "+("profile"===i?"active":""),onClick:()=>c("profile"),children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ‘¤"}),(0,o.jsx)("span",{className:"item-text",children:"ä¸ªäººä¿¡æ¯"})]}),(0,o.jsxs)("button",{className:"sidebar-item "+("security"===i?"active":""),onClick:()=>c("security"),children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ”’"}),(0,o.jsx)("span",{className:"item-text",children:"å®‰å…¨è®¾ç½®"})]}),(0,o.jsxs)("button",{className:"sidebar-item "+("preferences"===i?"active":""),onClick:()=>c("preferences"),children:[(0,o.jsx)("span",{className:"item-icon",children:"âš™ï¸"}),(0,o.jsx)("span",{className:"item-text",children:"åå¥½è®¾ç½®"})]}),(0,o.jsxs)("button",{className:"sidebar-item "+("data"===i?"active":""),onClick:()=>c("data"),children:[(0,o.jsx)("span",{className:"item-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"item-text",children:"å­¦ä¹ ç»Ÿè®¡"})]})]}),(0,o.jsxs)("div",{className:"settings-main",children:["profile"===i&&(0,o.jsxs)("div",{className:"tab-content",children:[(0,o.jsx)("h3",{children:"ä¸ªäººä¿¡æ¯"}),(0,o.jsxs)("div",{className:"avatar-section",children:[(0,o.jsxs)("div",{className:"avatar-upload",children:[(0,o.jsx)("div",{className:"avatar-preview",children:p?(0,o.jsx)("img",{src:p,alt:"å¤´åƒé¢„è§ˆ",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"},onLoad:()=>console.log("âœ… å¤´åƒé¢„è§ˆåŠ è½½æˆåŠŸ"),onError:e=>{console.error("âŒ å¤´åƒé¢„è§ˆåŠ è½½å¤±è´¥:",p),e.target.style.display="none"}}):(0,o.jsx)("div",{className:"avatar-placeholder",children:w.username?.charAt(0).toUpperCase()})}),(0,o.jsxs)("div",{className:"avatar-controls",children:[(0,o.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(!s)return;if(!s.type.startsWith("image/"))return void P("error","è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼ˆJPGã€PNGã€GIFï¼‰");if(s.size>2097152)return void P("error","å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB");j(s);const t=new FileReader;t.onload=e=>{v(e.target.result)},t.readAsDataURL(s)},className:"avatar-input"}),(0,o.jsx)("label",{htmlFor:"avatar-upload",className:"avatar-upload-btn",children:"é€‰æ‹©å›¾ç‰‡"}),x&&(0,o.jsx)("button",{className:"avatar-save-btn",onClick:async()=>{if(x&&t){h(!0);try{v("");const e=await new Promise((e,s)=>{const t=new FileReader;t.onload=s=>{const t=s.target.result.split(",")[1];e(t)},t.onerror=()=>s(new Error("æ–‡ä»¶è¯»å–å¤±è´¥")),t.readAsDataURL(x)}),s=await u().Cloud.run("updateUserAvatar",{fileData:e,fileName:x.name,mimeType:x.type});if(!s.success)throw new Error(s.message||"å¤´åƒä¸Šä¼ å¤±è´¥");{P("success","å¤´åƒä¸Šä¼ æˆåŠŸï¼");const e=(new Date).getTime(),t=`${s.avatarUrl}?t=${e}`;console.log("è®¾ç½®å¸¦æ—¶é—´æˆ³çš„å¤´åƒURL:",t),v(t),j(null),setTimeout(async()=>{try{const e=await u().User.current().fetch();n(e),console.log("ç”¨æˆ·æ•°æ®å·²æ›´æ–°"),window.dispatchEvent(new CustomEvent("userAvatarUpdated"))}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},1e3)}}catch(e){console.error("âŒ å¤´åƒä¸Šä¼ å¤±è´¥:",e),P("error",`ä¸Šä¼ å¤±è´¥: ${e.message}`)}finally{h(!1)}}else P("error","è¯·å…ˆé€‰æ‹©å›¾ç‰‡")},disabled:d,children:d?"ä¸Šä¼ ä¸­...":"ä¿å­˜å¤´åƒ"})]})]}),(0,o.jsx)("div",{className:"avatar-hint",children:"æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡ 2MB"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t){h(!0);try{console.log("å¼€å§‹æ›´æ–°ä¸ªäººä¿¡æ¯...",{nickname:w.nickname,bio:w.bio});const e=await u().Cloud.run("updateUserProfile",{nickname:w.nickname,bio:w.bio});if(!e.success)throw new Error(e.message||"æ›´æ–°å¤±è´¥");P("success","ä¸ªäººä¿¡æ¯æ›´æ–°æˆåŠŸï¼"),setTimeout(async()=>{try{const e=await u().User.current().fetch();n(e),console.log("ç”¨æˆ·æ•°æ®å·²æ›´æ–°")}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},500)}catch(e){console.error("æ›´æ–°ä¸ªäººä¿¡æ¯å¤±è´¥:",e);let s="æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•";s=401===e.code?"è¯·å…ˆç™»å½•":e.message.includes("network")?"ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ":`æ›´æ–°å¤±è´¥: ${e.message}`,P("error",s)}finally{h(!1)}}},className:"settings-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"ç”¨æˆ·å"}),(0,o.jsx)("input",{type:"text",value:w.username,disabled:!0,className:"disabled-input"}),(0,o.jsx)("div",{className:"field-hint",children:"ç”¨æˆ·ååˆ›å»ºåŽä¸å¯ä¿®æ”¹"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"é‚®ç®±åœ°å€"}),(0,o.jsx)("input",{type:"email",value:w.email,disabled:!0,className:"disabled-input"}),(0,o.jsx)("div",{className:"field-hint",children:w.email?"é‚®ç®±å·²éªŒè¯":"æœªè®¾ç½®é‚®ç®±"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"æ˜µç§°"}),(0,o.jsx)("input",{type:"text",value:w.nickname,onChange:e=>T("profile","nickname",e.target.value),placeholder:"è¯·è¾“å…¥æ‚¨çš„æ˜µç§°",maxLength:20})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"ä¸ªäººç®€ä»‹"}),(0,o.jsx)("textarea",{value:w.bio,onChange:e=>T("profile","bio",e.target.value),placeholder:"ä»‹ç»ä¸€ä¸‹æ‚¨è‡ªå·±...",rows:"3",maxLength:200}),(0,o.jsxs)("div",{className:"char-count",children:[w.bio.length,"/200"]})]}),(0,o.jsx)("div",{className:"form-actions",children:(0,o.jsx)("button",{type:"submit",className:"save-button",disabled:d,children:d?"ä¿å­˜ä¸­...":"ä¿å­˜æ›´æ”¹"})})]})]}),"security"===i&&(0,o.jsxs)("div",{className:"tab-content",children:[(0,o.jsx)("h3",{children:"å®‰å…¨è®¾ç½®"}),(0,o.jsxs)("div",{className:"security-section",children:[(0,o.jsx)("h4",{children:"é‚®ç®±éªŒè¯"}),(0,o.jsxs)("div",{className:"security-item",children:[(0,o.jsxs)("div",{className:"security-info",children:[(0,o.jsx)("span",{className:"security-label",children:"é‚®ç®±çŠ¶æ€"}),(0,o.jsx)("span",{className:"security-status "+(A.emailVerified?"verified":"unverified"),children:A.emailVerified?"å·²éªŒè¯":"æœªéªŒè¯"})]}),!A.emailVerified&&(0,o.jsx)("button",{className:"security-action-btn",onClick:async()=>{if(t&&t.getEmail()){l(!0);try{await u().User.requestEmailVerify(t.getEmail()),P("success","éªŒè¯é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±")}catch(e){console.error("å‘é€éªŒè¯é‚®ä»¶å¤±è´¥:",e),P("error",`å‘é€éªŒè¯é‚®ä»¶å¤±è´¥: ${e.message}`)}finally{l(!1)}}else P("error","è¯·å…ˆè®¾ç½®é‚®ç®±åœ°å€")},disabled:r||!w.email,children:r?"å‘é€ä¸­...":"å‘é€éªŒè¯é‚®ä»¶"})]})]}),(0,o.jsxs)("div",{className:"security-section",children:[(0,o.jsx)("h4",{children:"ä¿®æ”¹å¯†ç "}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f.newPassword===f.confirmPassword)if(f.newPassword.length<6)P("error","æ–°å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦");else{h(!0);try{await t.updatePassword(f.currentPassword,f.newPassword),P("success","å¯†ç ä¿®æ”¹æˆåŠŸï¼"),C({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){console.error("ä¿®æ”¹å¯†ç å¤±è´¥:",e),P("error",`å¯†ç ä¿®æ”¹å¤±è´¥: ${e.message}`)}finally{h(!1)}}else P("error","æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸ä¸€è‡´")},className:"settings-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"å½“å‰å¯†ç "}),(0,o.jsx)("input",{type:"password",value:f.currentPassword,onChange:e=>T("password","currentPassword",e.target.value),placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ",required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"æ–°å¯†ç "}),(0,o.jsx)("input",{type:"password",value:f.newPassword,onChange:e=>T("password","newPassword",e.target.value),placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",minLength:6,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"ç¡®è®¤æ–°å¯†ç "}),(0,o.jsx)("input",{type:"password",value:f.confirmPassword,onChange:e=>T("password","confirmPassword",e.target.value),placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",minLength:6,required:!0})]}),(0,o.jsxs)("div",{className:"password-strength",children:[(0,o.jsx)("div",{className:"strength-bar",children:(0,o.jsx)("div",{className:"strength-fill "+(f.newPassword.length>=6?"strong":"weak"),style:{width:`${Math.min(f.newPassword.length/6*100,100)}%`}})}),(0,o.jsx)("div",{className:"strength-text",children:f.newPassword.length>=6?"å¯†ç å¼ºåº¦è¶³å¤Ÿ":"å¯†ç è‡³å°‘éœ€è¦6ä½"})]}),(0,o.jsx)("div",{className:"form-actions",children:(0,o.jsx)("button",{type:"submit",className:"save-button",disabled:d,children:d?"æ›´æ–°ä¸­...":"ä¿®æ”¹å¯†ç "})})]})]}),(0,o.jsxs)("div",{className:"security-section",children:[(0,o.jsx)("h4",{children:"å¯†ç é‡ç½®"}),(0,o.jsxs)("div",{className:"security-item",children:[(0,o.jsxs)("div",{className:"security-info",children:[(0,o.jsx)("span",{className:"security-label",children:"å¿˜è®°å¯†ç ï¼Ÿ"}),(0,o.jsx)("span",{className:"security-description",children:"é€šè¿‡é‚®ç®±é‡ç½®æ‚¨çš„å¯†ç "})]}),(0,o.jsx)("button",{className:"security-action-btn secondary",onClick:async()=>{if(t&&t.getEmail()){l(!0);try{await u().User.requestPasswordReset(t.getEmail()),P("success","å¯†ç é‡ç½®é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±")}catch(e){console.error("å‘é€é‡ç½®é‚®ä»¶å¤±è´¥:",e),P("error",`å‘é€é‡ç½®é‚®ä»¶å¤±è´¥: ${e.message}`)}finally{l(!1)}}else P("error","è¯·å…ˆè®¾ç½®é‚®ç®±åœ°å€")},disabled:r||!w.email,children:r?"å‘é€ä¸­...":"å‘é€é‡ç½®é‚®ä»¶"})]})]})]}),"preferences"===i&&(0,o.jsxs)("div",{className:"tab-content",children:[(0,o.jsx)("h3",{children:"åå¥½è®¾ç½®"}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t){h(!0);try{console.log("å¼€å§‹æ›´æ–°åå¥½è®¾ç½®...",k);const e=await u().Cloud.run("updateUserPreferences",{theme:k.theme,language:k.language,notifications:k.notifications,emailUpdates:k.emailUpdates});if(!e.success)throw new Error(e.message||"æ›´æ–°å¤±è´¥");P("success","åå¥½è®¾ç½®æ›´æ–°æˆåŠŸï¼"),setTimeout(async()=>{try{const e=await u().User.current().fetch();n(e)}catch(e){console.error("èŽ·å–æ›´æ–°åŽçš„ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},500)}catch(e){console.error("æ›´æ–°åå¥½è®¾ç½®å¤±è´¥:",e),P("error",`æ›´æ–°å¤±è´¥: ${e.message}`)}finally{h(!1)}}},className:"settings-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"ä¸»é¢˜æ¨¡å¼"}),(0,o.jsxs)("div",{className:"radio-group",children:[(0,o.jsxs)("label",{className:"radio-option",children:[(0,o.jsx)("input",{type:"radio",name:"theme",value:"light",checked:"light"===k.theme,onChange:e=>T("preferences","theme",e.target.value)}),(0,o.jsxs)("span",{className:"radio-label",children:[(0,o.jsx)("span",{className:"radio-icon",children:"ðŸŒž"}),"æµ…è‰²æ¨¡å¼"]})]}),(0,o.jsxs)("label",{className:"radio-option",children:[(0,o.jsx)("input",{type:"radio",name:"theme",value:"dark",checked:"dark"===k.theme,onChange:e=>T("preferences","theme",e.target.value)}),(0,o.jsxs)("span",{className:"radio-label",children:[(0,o.jsx)("span",{className:"radio-icon",children:"ðŸŒ™"}),"æ·±è‰²æ¨¡å¼"]})]})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"è¯­è¨€"}),(0,o.jsxs)("select",{value:k.language,onChange:e=>T("preferences","language",e.target.value),children:[(0,o.jsx)("option",{value:"zh-CN",children:"ç®€ä½“ä¸­æ–‡"}),(0,o.jsx)("option",{value:"en-US",children:"English"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"é€šçŸ¥è®¾ç½®"}),(0,o.jsxs)("div",{className:"switch-group",children:[(0,o.jsxs)("label",{className:"switch",children:[(0,o.jsx)("input",{type:"checkbox",checked:k.notifications,onChange:e=>T("preferences","notifications",e.target.checked)}),(0,o.jsx)("span",{className:"slider"})]}),(0,o.jsx)("span",{className:"switch-label",children:"å¯ç”¨æµè§ˆå™¨é€šçŸ¥"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{children:"é‚®ä»¶æ›´æ–°"}),(0,o.jsxs)("div",{className:"switch-group",children:[(0,o.jsxs)("label",{className:"switch",children:[(0,o.jsx)("input",{type:"checkbox",checked:k.emailUpdates,onChange:e=>T("preferences","emailUpdates",e.target.checked)}),(0,o.jsx)("span",{className:"slider"})]}),(0,o.jsx)("span",{className:"switch-label",children:"æŽ¥æ”¶äº§å“æ›´æ–°é‚®ä»¶"})]})]}),(0,o.jsx)("div",{className:"form-actions",children:(0,o.jsx)("button",{type:"submit",className:"save-button",disabled:d,children:d?"ä¿å­˜ä¸­...":"ä¿å­˜è®¾ç½®"})})]})]}),"data"===i&&(0,o.jsxs)("div",{className:"tab-content",children:[(0,o.jsx)("h3",{children:"å­¦ä¹ ç»Ÿè®¡"}),(0,o.jsx)("div",{className:"stats-overview",children:(0,o.jsxs)("div",{className:"stats-grid",children:[(0,o.jsxs)("div",{className:"stat-card",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“š"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:N.totalCategories}),(0,o.jsx)("div",{className:"stat-label",children:"çŸ¥è¯†åˆ†ç±»"})]})]}),(0,o.jsxs)("div",{className:"stat-card",children:[(0,o.jsx)("div",{className:"stat-icon",children:"â“"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:N.totalQuestions}),(0,o.jsx)("div",{className:"stat-label",children:"é¢˜ç›®æ€»æ•°"})]})]}),(0,o.jsxs)("div",{className:"stat-card",children:[(0,o.jsx)("div",{className:"stat-icon",children:"ðŸ“–"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:N.reviewQuestions}),(0,o.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ "})]})]}),(0,o.jsxs)("div",{className:"stat-card",children:[(0,o.jsx)("div",{className:"stat-icon",children:"âš¡"}),(0,o.jsxs)("div",{className:"stat-content",children:[(0,o.jsx)("div",{className:"stat-number",children:N.todayReviewed}),(0,o.jsx)("div",{className:"stat-label",children:"ä»Šæ—¥å¤ä¹ "})]})]})]})}),(0,o.jsx)("div",{className:"progress-section",children:(0,o.jsxs)("div",{className:"progress-item",children:[(0,o.jsxs)("div",{className:"progress-header",children:[(0,o.jsx)("span",{className:"progress-label",children:"å¤ä¹ è¿›åº¦"}),(0,o.jsxs)("span",{className:"progress-percent",children:[N.totalQuestions>0?Math.round((N.totalQuestions-N.reviewQuestions)/N.totalQuestions*100):0,"%"]})]}),(0,o.jsx)("div",{className:"progress-bar",children:(0,o.jsx)("div",{className:"progress-fill",style:{width:(N.totalQuestions>0?(N.totalQuestions-N.reviewQuestions)/N.totalQuestions*100:0)+"%"}})}),(0,o.jsxs)("div",{className:"progress-text",children:["å·²å¤ä¹  ",N.totalQuestions-N.reviewQuestions," / ",N.totalQuestions," é¢˜ç›®"]})]})}),(0,o.jsxs)("div",{className:"data-section",children:[(0,o.jsx)("h4",{children:"æ•°æ®å¯¼å‡º"}),(0,o.jsxs)("div",{className:"data-item",children:[(0,o.jsxs)("div",{className:"data-info",children:[(0,o.jsx)("span",{className:"data-label",children:"å¯¼å‡ºå­¦ä¹ æ•°æ®"}),(0,o.jsx)("span",{className:"data-description",children:"å¯¼å‡ºæ‚¨çš„æ‰€æœ‰åˆ†ç±»å’Œé¢˜ç›®æ•°æ®ä¸º JSON æ ¼å¼"})]}),(0,o.jsx)("button",{className:"data-action-btn",onClick:async()=>{l(!0);try{const[e,s]=await Promise.all([new(u().Query)("Category").equalTo("createdBy",t).find(),new(u().Query)("Question").equalTo("createdBy",t).include("category").find()]),a={exportTime:(new Date).toISOString(),user:{username:t.getUsername(),email:t.getEmail(),nickname:t.get("nickname")},categories:e.map(e=>({id:e.id,name:e.get("name"),description:e.get("description"),questionCount:e.get("questionCount")||0,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")})),questions:s.map(e=>({id:e.id,title:e.get("title"),detailedAnswer:e.get("detailedAnswer"),oralAnswer:e.get("oralAnswer"),code:e.get("code"),difficulty:e.get("difficulty"),proficiency:e.get("proficiency"),appearanceLevel:e.get("appearanceLevel"),tags:e.get("tags")||[],category:e.get("category")?{id:e.get("category").id,name:e.get("category").get("name")}:null,createdAt:e.get("createdAt"),updatedAt:e.get("updatedAt")}))},n=JSON.stringify(a,null,2),i=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(i),r=document.createElement("a");r.href=c,r.download=`knowledge-base-export-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(c),P("success","æ•°æ®å¯¼å‡ºæˆåŠŸï¼")}catch(e){console.error("æ•°æ®å¯¼å‡ºå¤±è´¥:",e),P("error",`æ•°æ®å¯¼å‡ºå¤±è´¥: ${e.message}`)}finally{l(!1)}},disabled:r,children:r?"å¯¼å‡ºä¸­...":"å¯¼å‡ºæ•°æ®"})]})]}),(0,o.jsxs)("div",{className:"data-section",children:[(0,o.jsx)("h4",{children:"æ•°æ®æ¸…ç†"}),(0,o.jsxs)("div",{className:"data-item danger",children:[(0,o.jsxs)("div",{className:"data-info",children:[(0,o.jsx)("span",{className:"data-label",children:"åˆ é™¤è´¦æˆ·æ•°æ®"}),(0,o.jsx)("span",{className:"data-description",children:"æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰å­¦ä¹ æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€"})]}),(0,o.jsx)("button",{className:"data-action-btn danger",disabled:!0,children:"å³å°†å¼€æ”¾"})]})]})]})]})]})]})}):null},os=new c.E({defaultOptions:{queries:{staleTime:3e5,cacheTime:6e5,retry:1}}}),ds=()=>{const e=(0,i.Zp)(),[s,t]=(0,a.useState)([]),[n,c]=(0,a.useState)(!0),[l,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(7),[g,x]=(0,a.useState)([]),[j,p]=(0,a.useState)(!1),[v,N]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=u().User.current();N(e),e?y():c(!1)},[]);const y=async()=>{try{const e=await T();t(e),c(!1)}catch(e){d(e.message),c(!1)}};return(0,a.useEffect)(()=>{s.length>0&&(()=>{const e=new Date,t=24*h*60*60*1e3,a=s.filter(s=>{const a=new Date(s.updatedAt||s.createdAt);return e-a>=t}).sort((e,s)=>new Date(e.updatedAt||e.createdAt)-new Date(s.updatedAt||s.createdAt));x(a)})()},[s,h]),v?n?(0,o.jsx)("div",{className:"review-page",children:(0,o.jsxs)("div",{className:"loading-container",children:[(0,o.jsx)("div",{className:"modern-spinner"}),(0,o.jsx)("p",{children:"åŠ è½½å¤ä¹ æ•°æ®ä¸­..."})]})}):l?(0,o.jsx)("div",{className:"review-page",children:(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("h2",{children:"åŠ è½½å¤±è´¥"}),(0,o.jsx)("p",{children:l}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"é‡è¯•"})]})}):(0,o.jsx)(r.Ht,{client:os,children:(0,o.jsxs)("div",{className:"review-page",children:[(0,o.jsx)("header",{className:"review-hero-section",children:(0,o.jsxs)("div",{className:"hero-content",children:[(0,o.jsxs)("div",{className:"user-welcome",children:[(0,o.jsx)("h1",{className:"hero-title",children:"ðŸ“š å¤ä¹ æé†’"}),(0,o.jsxs)("p",{className:"hero-subtitle",children:["æ™ºèƒ½ç®¡ç†æ‚¨çš„å­¦ä¹ è¿›åº¦ï¼Œ",g.length>0?`æœ‰ ${g.length} é“é¢˜ç›®éœ€è¦å¤ä¹ `:"æ‰€æœ‰é¢˜ç›®éƒ½å·²åŠæ—¶å¤ä¹ "]})]}),(0,o.jsxs)("div",{className:"review-stats-overview",children:[(0,o.jsxs)("div",{className:"stat-card",children:[(0,o.jsx)("div",{className:"stat-number",children:s.length}),(0,o.jsx)("div",{className:"stat-label",children:"æ€»é¢˜ç›®æ•°"})]}),(0,o.jsxs)("div",{className:"stat-card warning",children:[(0,o.jsx)("div",{className:"stat-number",children:g.length}),(0,o.jsx)("div",{className:"stat-label",children:"å¾…å¤ä¹ "})]}),(0,o.jsxs)("div",{className:"stat-card success",children:[(0,o.jsx)("div",{className:"stat-number",children:s.length-g.length}),(0,o.jsx)("div",{className:"stat-label",children:"å·²å¤ä¹ "})]})]})]})}),(0,o.jsx)(V,{reviewQuestions:g,setReviewQuestions:x,reviewThreshold:h,setReviewThreshold:m,showReviewSettings:j,setShowReviewSettings:p,onQuestionClick:t=>{const a=s.find(e=>e.id===t);a&&a.category&&e(`/category/${a.category.id}`)},onUpdateQuestionTime:async e=>{try{console.log("æ›´æ–°é¢˜ç›®å¤ä¹ æ—¶é—´:",e);const s=(new Date).toISOString();return await $(e,{updatedAt:s}),t(t=>t.map(t=>t.id===e?{...t,updatedAt:s}:t)),console.log(`é¢˜ç›® ${e} å¤ä¹ æ—¶é—´å·²æ›´æ–°`),!0}catch(e){throw console.error("æ›´æ–°é¢˜ç›®æ—¶é—´å¤±è´¥:",e),e}},questions:s}),(0,o.jsx)("footer",{className:"review-footer",children:(0,o.jsxs)("div",{className:"footer-actions",children:[(0,o.jsx)("button",{onClick:()=>e("/"),className:"back-to-home-btn",children:"â† è¿”å›žé¦–é¡µ"}),(0,o.jsx)("div",{className:"footer-info",children:"åŸºäºŽé—´éš”é‡å¤åŽŸç†ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆè®°å¿†"})]})})]})}):(0,o.jsx)("div",{className:"review-page",children:(0,o.jsxs)("div",{className:"auth-required-container",children:[(0,o.jsx)("div",{className:"auth-required-icon",children:"ðŸ”"}),(0,o.jsx)("h2",{children:"è¯·å…ˆç™»å½•"}),(0,o.jsx)("p",{children:"ç™»å½•åŽå³å¯ä½¿ç”¨å¤ä¹ æé†’åŠŸèƒ½"}),(0,o.jsxs)("div",{className:"auth-required-actions",children:[(0,o.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"login"}}))},className:"login-btn primary",children:"ðŸš€ ç«‹å³ç™»å½•"}),(0,o.jsx)("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("showAuthModal",{detail:{tab:"register"}}))},className:"login-btn secondary",children:"ðŸ“ æ³¨å†Œè´¦å·"})]})]})})},hs=()=>{const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{const e=e=>{e.preventDefault(),s(e),n(!0)};return window.addEventListener("beforeinstallprompt",e),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]),t?(0,o.jsxs)("div",{style:{position:"fixed",bottom:"20px",right:"20px",background:"white",padding:"16px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,maxWidth:"300px"},children:[(0,o.jsx)("h4",{children:"å®‰è£…åº”ç”¨"}),(0,o.jsx)("p",{children:"å°†æ­¤åº”ç”¨å®‰è£…åˆ°æ‚¨çš„è®¾å¤‡ä¸Šä»¥èŽ·å¾—æ›´å¥½çš„ä½“éªŒ"}),(0,o.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[(0,o.jsx)("button",{onClick:async()=>{if(!e)return;e.prompt();const{outcome:t}=await e.userChoice;"accepted"===t?console.log("ç”¨æˆ·æŽ¥å—äº†å®‰è£…"):console.log("ç”¨æˆ·æ‹’ç»äº†å®‰è£…"),s(null),n(!1)},style:{background:"#007bff",color:"white",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"å®‰è£…"}),(0,o.jsx)("button",{onClick:()=>{s(null),n(!1)},style:{background:"transparent",border:"1px solid #ccc",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"ç¨åŽ"})]})]}):null},us=new c.E({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1,staleTime:3e5,gcTime:6e5}}}),ms=function(){const[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)("login"),[c,l]=(0,a.useState)(!1),[d,h]=(0,a.useState)("profile");return(0,a.useEffect)(()=>{const e=e=>{const t=e.detail?.tab||"login";n(t),s(!0)},t=e=>{const s=e.detail?.tab||"profile";h(s),l(!0)};return window.addEventListener("showAuthModal",e),window.addEventListener("showUserSettings",t),()=>{window.removeEventListener("showAuthModal",e),window.removeEventListener("showUserSettings",t)}},[]),(0,o.jsx)(r.Ht,{client:us,children:(0,o.jsxs)(i.Kd,{children:[(0,o.jsx)(cs,{onShowAuthModal:(e="login")=>{n(e),s(!0)}}),(0,o.jsxs)(i.BV,{children:[(0,o.jsx)(i.qh,{path:"/",element:(0,o.jsx)(de,{})}),(0,o.jsx)(i.qh,{path:"/init",element:(0,o.jsx)(Ve,{})}),(0,o.jsx)(i.qh,{path:"/category/:categoryId",element:(0,o.jsx)(Ze,{})}),(0,o.jsx)(i.qh,{path:"/test",element:(0,o.jsx)(is,{})}),(0,o.jsx)(i.qh,{path:"/review",element:(0,o.jsx)(ds,{})})]}),(0,o.jsx)(rs,{isOpen:e,onClose:()=>s(!1),defaultTab:t,onAuthSuccess:()=>{window.location.reload()}}),(0,o.jsx)(ls,{isOpen:c,onClose:()=>l(!1)}),(0,o.jsx)(hs,{})]})})};n.createRoot(document.getElementById("root")).render((0,o.jsx)(a.StrictMode,{children:(0,o.jsx)(ms,{})})),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=await fetch("/sw.js");if(!e.ok)throw new Error(`sw.js not found: ${e.status}`);const s=e.headers.get("content-type");if(!s||!s.includes("javascript"))throw new Error(`Invalid MIME type: ${s}`);const t=await navigator.serviceWorker.register("/sw.js");console.log("SW registered successfully: ",t)}catch(e){console.log("SW registration failed: ",e),console.log("Error details:",e.message)}})}},e=>{e.O(0,[96],()=>e(e.s=8588)),e.O()}]);
//# sourceMappingURL=main.92afc617.js.map